<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- SEO Meta Tags -->
    <title>ABKBet - Sports Betting Platform | Cyprus Gaming Authority</title>
    <meta name="description" content="ABKBet is a licensed online sports betting platform registered in Cyprus. License No: HE 888999 | B2C-1247-2024. Secure betting with crypto and fiat payments, competitive odds on football, basketball, tennis and more.">
    <meta name="keywords" content="ABKBet, sports betting, online betting, Cyprus gaming license, licensed bookmaker, live betting, football betting, basketball betting, crypto betting, bitcoin betting">
    <meta name="author" content="ABKBet Gaming Ltd">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="ABKBet - Licensed Sports Betting Platform">
    <meta property="og:description" content="Licensed by Cyprus Gaming Authority (HE 888999 | B2C-1247-2024). Secure sports betting with competitive odds and crypto payments.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://abkbet.com">
    <meta property="og:site_name" content="ABKBet">
    
    <!-- Business/Organization Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "ABKBet",
      "legalName": "ABKBet Gaming Ltd",
      "url": "https://abkbet.com",
      "logo": "https://abkbet.com/static/images/logo.png",
      "description": "Licensed online sports betting platform registered in Cyprus",
      "foundingDate": "2024",
      "areaServed": "International",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "28 Oktovriou Avenue, Block B",
        "addressLocality": "Limassol",
        "postalCode": "3107",
        "addressCountry": "CY"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+357-25-123-456",
        "contactType": "Customer Service",
        "email": "support@abkbet.com",
        "availableLanguage": ["English"]
      },
      "sameAs": [
        "https://twitter.com/abkbet",
        "https://t.me/abkbet_support"
      ],
      "hasCredential": {
        "@type": "EducationalOccupationalCredential",
        "credentialCategory": "Gaming License",
        "recognizedBy": {
          "@type": "Organization",
          "name": "Cyprus Gaming Authority"
        },
        "description": "Cyprus Gaming License - HE 888999 | B2C-1247-2024"
      }
    }
    </script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        /* Pulse animation for live scores */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 2px solid #1e40af;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #3b82f6;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-shrink: 0;
            margin-left: auto;
        }

        .balance-display {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            color: #60a5fa;
            display: none;
        }

        .balance-display.active {
            display: block;
        }

        .account-dropdown {
            position: relative;
            display: inline-block;
        }

        .account-btn {
            background: #1e40af;
            color: #e0e7ff;
            border: 1px solid #3b82f6;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-btn:hover {
            background: #3b82f6;
            color: white;
        }

        .account-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 8px;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            min-width: 200px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid #334155;
            z-index: 1000;
            overflow: hidden;
        }

        .account-dropdown-content.show {
            display: block;
        }

        .account-dropdown-item {
            padding: 12px 20px;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
            font-weight: 500;
        }

        .account-dropdown-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .account-dropdown-item i {
            width: 16px;
            text-align: center;
        }

        .nav-buttons button {
            background: #1e40af;
            color: #e0e7ff;
            border: 1px solid #3b82f6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .nav-buttons button:hover {
            background: #3b82f6;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            margin-left: 270px;
            padding: 20px;
            min-height: calc(100vh - 80px);
            transition: margin-left 0.3s ease;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            border-bottom: 2px solid #1e40af;
            overflow-x: auto;
            padding-bottom: 0;
        }

        .tab-button {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-size: 15px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-button:hover {
            color: #60a5fa;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .mybets-subtab {
            padding: 10px 20px;
            border: none;
            background: #1e293b;
            cursor: pointer;
            color: #64748b;
            font-size: 14px;
            font-weight: 600;
            border-radius: 6px 6px 0 0;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .mybets-subtab:hover {
            color: #60a5fa;
            background: #334155;
        }

        .mybets-subtab.active {
            color: #3b82f6;
            background: #0f172a;
            border-bottom-color: #3b82f6;
        }

        .mybets-subtab i {
            margin-right: 6px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .desktop-only {
            display: block;
        }

        h2 {
            color: #e2e8f0;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .matches-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Left Sidebar Styles */
        .left-sidebar {
            position: fixed;
            left: 0;
            top: 80px;
            width: 250px;
            height: calc(100vh - 80px);
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-right: 1px solid #334155;
            overflow-y: auto;
            z-index: 50;
            padding: 20px 0;
        }

        .left-sidebar .league-selector {
            display: block;
            padding: 0 15px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 20px 15px;
            border-bottom: 2px solid #334155;
            margin-bottom: 15px;
        }

        .sidebar-header i {
            color: #3b82f6;
            font-size: 18px;
        }

        .sidebar-header h3 {
            color: #e2e8f0;
            margin: 0;
            font-size: 16px;
            font-weight: 700;
        }

        .league-selector {
            padding: 12px;
            background: #0f172a;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .mobile-league-selector {
            display: none;
        }

        .desktop-league-selector {
            display: block;
        }

        .league-category {
            margin-bottom: 8px;
            position: relative;
        }

        .league-category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0;
        }

        .league-category-header:hover {
            transform: translateX(3px);
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }

        .league-category-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-weight: 700;
            font-size: 13px;
        }

        .league-category-arrow {
            color: #fff;
            transition: transform 0.3s ease;
            font-size: 12px;
        }

        .league-category-arrow.open {
            transform: rotate(180deg);
        }

        .league-buttons {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
            padding: 10px;
            background: #1e293b;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-height: 300px;
            overflow-y: auto;
        }

        .league-buttons.open {
            display: grid;
        }

        .league-btn {
            background: #334155;
            border: 2px solid #475569;
            color: #cbd5e1;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 13px;
        }

        .league-btn:hover {
            border-color: #3b82f6;
            color: #60a5fa;
            background: #1e293b;
        }

        .league-btn.active {
            background: #1e40af;
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .league-btn-count {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 6px;
        }

        .league-btn.active .league-btn-count {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        /* Live Carousel Styles */
        .live-carousel {
            background: linear-gradient(135deg, #7c2d12 0%, #991b1b 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        .carousel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .carousel-header i {
            color: #fbbf24;
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        .carousel-header h3 {
            color: #fef3c7;
            margin: 0;
            font-size: 18px;
            font-weight: 700;
        }

        .carousel-track {
            display: flex;
            gap: 16px;
            animation: scroll 30s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .carousel-track:hover {
            animation-play-state: paused;
        }

        .carousel-match-card {
            flex: 0 0 300px;
            min-width: 300px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .carousel-match-card .odd-box {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            padding: 8px 4px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .carousel-match-card .odd-box:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        /* New Betting Layout */
        .betting-layout {
            display: flex;
            margin-left: 0;
            gap: 20px;
            padding: 0;
        }

        .main-content-area {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            margin-left: 270px;
        }

        .betting-content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 100%;
            margin: 0;
        }

        .hero-banner {
            display: none; /* Removed welcome bonus */
        }

        .hero-banner-image {
            width: 100%;
            height: 350px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9)),
                        url('https://images.unsplash.com/photo-1579952363873-27f3bade9f55?w=400&h=350&fit=crop&q=80');
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .hero-banner-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.5));
            border-radius: 8px;
        }

        .hero-banner-image > * {
            position: relative;
            z-index: 1;
        }

        .hero-banner h3 {
            font-size: 24px;
            color: #fff;
            margin-bottom: 10px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-banner p {
            font-size: 14px;
            color: #e0e7ff;
            line-height: 1.5;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .hero-promo {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .hero-promo h4 {
            color: #1e40af;
            font-size: 18px;
            margin-bottom: 8px;
            font-weight: 900;
        }

        .hero-promo p {
            color: #334155;
            font-size: 13px;
            margin-bottom: 12px;
            text-shadow: none;
        }

        .hero-promo-button {
            background: #1e40af;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        .hero-promo-button:hover {
            background: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* Side Widgets */
        .side-widgets {
            position: sticky;
            right: 400px;
            top: 90px;
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            z-index: 50;
            margin-left: auto;
        }

        .widget {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #334155;
        }

        .widget-header h4 {
            color: #60a5fa;
            font-size: 14px;
            font-weight: 700;
            margin: 0;
            flex: 1;
        }

        .widget-icon {
            color: #3b82f6;
            font-size: 16px;
        }

        .winner-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .winner-name {
            font-size: 12px;
            color: #e2e8f0;
            font-weight: 600;
        }

        .winner-amount {
            font-size: 12px;
            color: #10b981;
            font-weight: 900;
        }

        @media (max-width: 1800px) {
            .side-widgets {
                right: 20px;
                top: 500px;
                width: 320px;
            }
        }

        @media (max-width: 1200px) {
            .side-widgets {
                display: none;
            }
        }

        .matches-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        @media (max-width: 1400px) {
            .betting-content-wrapper {
                flex-direction: column;
            }

            .hero-banner {
                position: relative;
                top: 0;
                flex: 0 0 auto;
                width: 100%;
                max-width: 600px;
                margin: 20px auto 0;
                order: 2;
            }

            .matches-grid {
                order: 1;
            }
        }

        @media (max-width: 1024px) {
            .matches-grid {
                grid-template-columns: 1fr;
                padding-right: 0;
            }

            .hero-banner {
                max-width: 100%;
            }
        }

        .match-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.35s cubic-bezier(0.23, 1, 0.32, 1);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .match-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s ease;
            pointer-events: none;
        }

        .match-card:hover::before {
            left: 100%;
        }

        .match-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #334155;
        }

        .match-league {
            font-size: 11px;
            color: #60a5fa;
            font-weight: 700;
            text-transform: uppercase;
            background: rgba(59, 130, 246, 0.1);
            padding: 3px 10px;
            border-radius: 4px;
        }

        .match-time {
            font-size: 12px;
            color: #94a3b8;
        }

        .match-body {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
        }

        .team-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .team-name {
            font-size: 15px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .vs-section {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .vs-text {
            color: #64748b;
            font-weight: 600;
            font-size: 12px;
        }

        .vs-time {
            font-size: 13px;
            color: #60a5fa;
            font-weight: 600;
        }

        .odds-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
        }

        .odd-box {
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.28s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            min-width: 0;
            flex: 1;
        }

        .odd-box::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.28s ease;
        }

        .odd-box:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.08);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
            transform: scale(1.03);
        }

        .odd-box:hover::after {
            opacity: 1;
        }

        .odd-box.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.12);
            box-shadow: 0 3px 10px rgba(16, 185, 129, 0.2);
            transform: scale(1.04) !important;
        }

        .odd-label {
            font-size: 11px;
            color: #94a3b8;
            margin-bottom: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .odd-value {
            font-size: 16px;
            font-weight: bold;
            color: #3b82f6;
        }

        .odd-box.selected .odd-value {
            color: #10b981;
        }

        .market-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
            flex-wrap: wrap;
            padding: 0 0 6px 0;
            border-bottom: 1px solid #334155;
        }

        .market-tab {
            background: #0f172a;
            border: 1px solid #334155;
            color: #94a3b8;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            position: relative;
        }

        .market-tab::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), transparent);
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .market-tab:hover {
            border-color: #3b82f6;
            color: #60a5fa;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .market-tab:hover::before {
            opacity: 1;
        }

        .market-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .bet-input-row {
            display: grid;
            grid-template-columns: 1fr 120px;
            gap: 8px;
        }

        .bet-input-row input {
            background: #0f172a;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        .bet-input-row input::placeholder {
            color: #64748b;
        }

        .bet-input-row input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .bet-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 7px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-size: 13px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .bet-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .bet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .bet-btn:hover::before {
            opacity: 1;
        }

        .bet-btn:active {
            transform: translateY(0);
        }

        .potential-payout {
            font-size: 12px;
            color: #10b981;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Betslip / Ticket Styles */
        .betslip-container {
            position: fixed;
            right: 20px;
            top: 80px;
            width: 360px;
            max-height: calc(100vh - 100px);
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            z-index: 999;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .betslip-container.hidden {
            transform: translateX(400px);
            opacity: 0;
            pointer-events: none;
        }

        .betslip-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #334155;
        }

        .betslip-header h3 {
            color: white;
            font-size: 18px;
            font-weight: 800;
            margin: 0;
        }

        .betslip-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }

        .betslip-picks {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            max-height: 400px;
        }

        .betslip-pick {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            position: relative;
        }

        .betslip-pick-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .betslip-pick-match {
            font-size: 13px;
            font-weight: 700;
            color: #e2e8f0;
            line-height: 1.4;
            flex: 1;
        }

        .betslip-pick-remove {
            background: #dc2626;
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .betslip-pick-remove:hover {
            background: #b91c1c;
            transform: scale(1.1);
        }

        .betslip-pick-selection {
            font-size: 12px;
            color: #60a5fa;
            margin-bottom: 4px;
        }

        .betslip-pick-odds {
            font-size: 16px;
            font-weight: 800;
            color: #10b981;
        }

        .betslip-empty {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .betslip-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .betslip-summary {
            background: #0f172a;
            border-top: 2px solid #334155;
            padding: 16px 20px;
        }

        .betslip-total-odds {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #334155;
        }

        .betslip-total-odds-label {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 600;
        }

        .betslip-total-odds-value {
            font-size: 20px;
            font-weight: 900;
            color: #10b981;
        }

        .betslip-stake-input {
            width: 100%;
            background: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .betslip-stake-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .betslip-payout {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-size: 13px;
            color: #94a3b8;
        }

        .betslip-payout-value {
            font-size: 18px;
            font-weight: 800;
            color: #3b82f6;
        }

        .betslip-place-btn {
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .betslip-place-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .betslip-place-btn:disabled {
            background: #334155;
            cursor: not-allowed;
            transform: none;
        }

        .betslip-clear-btn {
            width: 100%;
            background: transparent;
            color: #dc2626;
            border: 1px solid #dc2626;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.2s ease;
        }

        .betslip-clear-btn:hover {
            background: #dc2626;
            color: white;
        }

        .betslip-toggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
            z-index: 998;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .betslip-toggle:hover {
            transform: scale(1.1);
        }

        .betslip-toggle .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc2626;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #0f172a;
        }

        @media (max-width: 768px) {
            .betslip-container {
                right: 10px;
                width: calc(100% - 20px);
                max-width: 360px;
                max-height: 45vh;
                top: 70px;
            }
            
            .betslip-header {
                padding: 8px 12px;
            }
            
            .betslip-header h3 {
                font-size: 14px;
            }
            
            .betslip-count {
                padding: 2px 8px;
                font-size: 11px;
            }
            
            .betslip-picks {
                padding: 8px;
                max-height: 150px;
            }
            
            .betslip-pick {
                padding: 6px 8px;
                margin-bottom: 6px;
            }
            
            .betslip-pick-team {
                font-size: 11px;
            }
            
            .betslip-pick-market {
                font-size: 9px;
                margin-top: 2px;
            }
            
            .betslip-pick-odds {
                font-size: 12px;
            }
            
            .betslip-pick-remove {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }
            
            .betslip-summary {
                padding: 8px;
            }
            
            .betslip-total-odds,
            .betslip-payout {
                padding: 6px 8px;
                font-size: 11px;
            }
            
            .betslip-total-odds-value,
            .betslip-payout-value {
                font-size: 13px;
            }
            
            .betslip-stake-input {
                padding: 8px;
                font-size: 12px;
                margin: 6px 0;
            }
            
            .betslip-bonus {
                padding: 6px 8px !important;
                margin: 6px 0 !important;
                font-size: 11px !important;
            }
            
            .betslip-place-btn,
            .betslip-clear-btn {
                padding: 8px;
                font-size: 12px;
                margin-top: 6px;
            }
            
            .betslip-empty {
                padding: 15px;
            }
            
            .betslip-empty i {
                font-size: 28px;
            }
            
            .betslip-empty p {
                font-size: 11px;
            }
        }

        .auth-container {
            max-width: 500px;
            margin: 40px auto;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 40px;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h3 {
            color: #3b82f6;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            color: #cbd5e1;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 13px;
        }

        .form-group input {
            width: 100%;
            background: #0f172a;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .toggle-password {
            transition: color 0.2s;
        }

        .toggle-password:hover {
            color: #3b82f6 !important;
        }

        .toggle-password:active {
            transform: translateY(-50%) scale(0.95) !important;
        }

        details summary {
            list-style: none;
        }

        details summary::-webkit-details-marker {
            display: none;
        }

        details summary::before {
            content: 'â–¶';
            margin-right: 8px;
            transition: transform 0.2s;
            display: inline-block;
        }

        details[open] summary::before {
            transform: rotate(90deg);
        }

        details summary:hover {
            background: rgba(59, 130, 246, 0.1) !important;
        }

        .form-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-submit {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-toggle {
            background: #1e40af;
            color: #cbd5e1;
            border: 1px solid #3b82f6;
            padding: 10px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-toggle:hover {
            color: #60a5fa;
        }

        .profile-info {
            display: none;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
        }

        .profile-info.active {
            display: block;
        }

        .profile-info p {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
        }

        .profile-info strong {
            color: #60a5fa;
        }

        .btn-logout {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #b91c1c;
        }

        .payment-form {
            max-width: 400px;
            margin: 30px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-family: inherit;
        }

        .payment-form h2 {
            text-align: center;
            margin-bottom: 20px;
        
        }

        .payment-form label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
     }

        .payment-input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .payment-button {
            margin-top: 15px;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
}   

        .payment-button:hover {
            background-color: #0056b3;
}

        .payment-result {
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
}

        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .message.active {
            display: block;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .message.error {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid #dc2626;
            color: #fca5a5;
        }

        .bets-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            width: 100%;
        }

        .bet-item {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 16px;
            border-left: 4px solid #3b82f6;
        }

        .bet-item h4 {
            color: #e2e8f0;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .bet-item p {
            color: #cbd5e1;
            font-size: 13px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        .status-badge.active {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .stat-box {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #3b82f6;
        }

        /* Mobile Menu Toggle - Hidden, not needed */
        .mobile-menu-toggle {
            display: none;
        }

        .mobile-overlay {
            display: none;
        }

        @media (max-width: 1024px) {
            .desktop-only {
                display: none !important;
            }

            .header {
                padding: 12px 0;
            }

            .header-content {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 0 10px;
                min-height: 40px;
            }

            .logo {
                font-size: 18px;
                margin: 0;
                flex-shrink: 0;
            }

            .user-section {
                display: flex;
                gap: 8px;
                align-items: center;
                margin: 0;
                flex-shrink: 0;
            }

            .balance-display {
                display: block !important;
                padding: 6px 10px;
                font-size: 11px;
                white-space: nowrap;
                border-radius: 6px;
            }

            .account-btn {
                padding: 6px 10px;
                font-size: 11px;
                border-radius: 6px;
            }

            .account-btn span {
                display: none;
            }

            .account-btn i.fa-user {
                margin-right: 0;
            }

            /* Container - minimal padding */
            .container {
                margin-left: 0;
                padding: 0 10px 15px 10px;
            }

            /* Mobile: Hide left sidebar, show mobile league selector */
            .left-sidebar {
                display: none;
            }

            .mobile-league-selector {
                display: block !important;
            }

            .desktop-league-selector {
                display: none !important;
            }

            .main-content-area {
                margin-left: 0;
            }

            #matches .league-selector {
                display: block !important;
                padding: 0;
                margin-bottom: 10px;
                max-height: 400px;
                overflow-y: auto;
                background: #0f172a;
                border-radius: 8px;
                position: relative;
                z-index: 10;
            }

            .mobile-league-selector {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Mobile dropdown categories */
            .league-category {
                margin-bottom: 0;
                border-bottom: 1px solid #1e293b;
            }

            .league-category:last-child {
                border-bottom: none;
            }

            .league-category-header {
                padding: 12px 10px !important;
                margin-bottom: 0 !important;
                border-radius: 0 !important;
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
                min-height: 44px;
                display: flex;
                align-items: center;
            }

            .league-category-title {
                font-size: 12px !important;
                gap: 8px !important;
            }

            .league-category-arrow {
                font-size: 11px !important;
            }

            .league-buttons {
                display: none;
                padding: 8px !important;
                gap: 6px !important;
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
                max-height: none !important;
                background: #1e293b !important;
            }

            .league-buttons.open {
                display: grid;
            }

            .league-btn {
                padding: 10px 8px !important;
                font-size: 11px !important;
                min-height: 40px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                background: #334155 !important;
                border: 1px solid #475569 !important;
            }

            .league-btn.active {
                background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%) !important;
                border-color: #fbbf24 !important;
                color: #000 !important;
            }

            .league-btn-count {
                font-size: 10px !important;
                padding: 2px 5px !important;
                background: rgba(59, 130, 246, 0.3);
                border-radius: 3px;
            }

            .league-btn.active .league-btn-count {
                background: rgba(0, 0, 0, 0.2);
                color: #000;
            }

            /* Tabs - better mobile spacing */
            .tabs {
                margin-top: 0;
                margin-bottom: 8px;
                gap: 3px;
            }

            .tab-button {
                padding: 8px 12px;
                font-size: 11px;
            }

            /* Removed conflicting mobile league selector styles - using dropdown categories from above instead */

            /* Live Carousel - compact mobile */
            .live-carousel {
                padding: 12px;
                margin-bottom: 15px;
                border-radius: 8px;
            }

            .carousel-header {
                margin-bottom: 3px;
                padding: 3px 0;
            }

            .carousel-header h3 {
                font-size: 11px;
                line-height: 13px;
                font-weight: 900;
            }

            .carousel-header i {
                font-size: 13px;
            }

            .carousel-track {
                gap: 5px;
            }

            .carousel-match-card {
                flex: 0 0 140px;
                min-width: 140px;
                padding: 5px;
                font-size: 9px;
                line-height: 11px;
            }

            /* Matches header */
            .matches-header {
                margin-bottom: 6px;
                margin-top: 0;
            }

            .matches-header h2 {
                font-size: 18px;
            }

            /* Single column matches grid on mobile */
            .matches-grid {
                grid-template-columns: 1fr;
                gap: 8px;
                margin-top: 10px;
            }

            .main-content-area {
                max-width: 100%;
                width: 100%;
            }

            /* Full width betting layout */
            .betting-layout {
                margin-left: 0;
                width: 100%;
            }

            /* Modal - Bet9ja larger mobile sizing */
            .modal-content {
                padding: 12px;
                max-width: 90%;
                font-size: 13px;
                line-height: 16px;
            }

            .btn-primary, .btn-secondary {
                font-size: 13px;
                line-height: 16px;
                padding: 8px 14px;
                font-weight: 700;
            }

            /* Bet9ja ACTUAL Typography (Screenshot-based) */
            body {
                font-size: 13px;
                line-height: 16px;
                font-family: 'Lato', 'Segoe UI', sans-serif;
            }

            .header {
                height: 55px;
            }

            .logo {
                font-size: 18px;
                font-weight: 900;
            }

            .balance-display {
                font-size: 13px;
                line-height: 16px;
                font-weight: 700;
            }

            .tab-button {
                font-size: 13px;
                line-height: 16px;
                padding: 8px 12px;
                font-weight: 700;
            }

            /* Hero section - Compact mobile sizing (ONLY in matches tab) */
            #matches .hero {
                padding: 8px;
                margin-bottom: 6px;
            }

            #matches .hero h1 {
                font-size: 14px;
                line-height: 18px;
                font-weight: 800;
                margin-bottom: 4px;
            }
            #matches .hero p {
                font-size: 11px;
                line-height: 14px;
                margin-bottom: 6px;
            }

            #matches .hero-cta {
                flex-direction: row;
                gap: 6px;
            }

            #matches .hero-cta button {
                font-size: 11px;
                line-height: 14px;
                padding: 6px 10px;
                font-weight: 700;
            }

            /* Market tabs - Bet9ja larger mobile sizing */
            .market-tabs {
                gap: 5px;
                flex-wrap: wrap;
            }

            .market-tab {
                font-size: 13px;
                line-height: 16px;
                padding: 8px 10px;
                font-weight: 700;
            }

            /* Odd boxes - Horizontal 3-column grid on mobile */
            .odds-row {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 4px !important;
            }

            .odd-box {
                padding: 5px 3px !important;
                min-width: 0 !important;
                flex: none !important;
                border-width: 1px !important;
            }

            .odd-label {
                font-size: 8px !important;
                line-height: 10px !important;
                margin-bottom: 2px !important;
            }

            .odd-value {
                font-size: 13px !important;
                line-height: 16px !important;
                font-weight: 800 !important;
            }

            /* Match cards - Bet9ja larger mobile sizing */
            .match-card {
                padding: 10px;
                margin-bottom: 8px;
            }

            .match-header {
                font-size: 13px;
                line-height: 16px;
                font-weight: 700;
                padding: 5px 0;
            }

            .match-time {
                font-size: 11px;
                line-height: 14px;
                font-weight: 700;
            }

            /* League button count badge */
            .league-btn-count {
                font-size: 8px;
                line-height: 11px;
                padding: 1px 3px;
                min-width: 15px;
                font-weight: 700;
            }

            /* My Bets subtabs - mobile friendly */
            .mybets-subtab {
                padding: 8px 12px !important;
                font-size: 11px !important;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .mybets-subtab i {
                margin-right: 4px !important;
                font-size: 10px;
            }

            /* My Bets subtabs - mobile friendly */
            .mybets-subtab {
                padding: 8px 12px !important;
                font-size: 11px !important;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .mybets-subtab i {
                margin-right: 4px !important;
                font-size: 10px;
            }

            /* Wallet and payment forms - mobile grid */
            .wallet-container {
                grid-template-columns: 1fr !important;
                max-width: 100% !important;
            }

            .wallet-actions-grid,
            .premium-actions-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .payment-form {
                padding: 15px !important;
            }

            .payment-form h2 {
                font-size: 16px !important;
            }

            .match-body {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .team-info:last-child {
                order: -1;
            }

            .team-name {
                font-size: 14px;
                line-height: 17px;
                font-weight: 700;
            }

            .team-logo {
                font-size: 20px;
            }

            /* Modal - Bet9ja larger mobile sizing */
            .modal-content {
                padding: 12px;
                font-size: 13px;
                line-height: 16px;
            }

            .btn-primary, .btn-secondary {
                font-size: 13px;
                line-height: 16px;
                padding: 8px 14px;
                font-weight: 700;
            }

            /* Draggable modals on mobile */
            .ticket-modal .ticket-content {
                cursor: move;
                touch-action: none;
            }

            /* Drag handle indicator */
            .ticket-modal .ticket-content::before {
                content: '\u22ee\u22ee';
                position: absolute;
                top: 8px;
                left: 50%;
                transform: translateX(-50%);
                color: rgba(255, 255, 255, 0.3);
                font-size: 20px;
                letter-spacing: 4px;
                pointer-events: none;
                z-index: 1;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 0;
            }

            .logo {
                font-size: 18px;
            }

            .tabs {
                font-size: 13px;
                padding: 8px 0;
            }

            .tab-button {
                padding: 8px 14px;
                font-size: 12px;
            }

            .odds-row {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .match-card {
                padding: 14px;
                border-radius: 8px;
            }

            .match-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .match-time {
                font-size: 11px;
            }

            .market-tabs {
                margin-bottom: 10px;
            }

            .market-tab {
                padding: 5px 10px;
                font-size: 10px;
            }

            .bet-input-row {
                grid-template-columns: 1fr 100px;
                gap: 6px;
            }

            .odd-box {
                padding: 10px;
                border-radius: 6px;
            }

            .odd-label {
                font-size: 10px;
            }

            .odd-value {
                font-size: 16px;
            }

            #matches .hero {
                grid-template-columns: 1fr;
                padding: 20px;
                margin-bottom: 20px;
                text-align: center;
            }

            #matches .hero-right {
                display: none;
            }

            #matches .hero-left {
                text-align: center;
            }

            #matches .hero-left h1 {
                font-size: 18px;
            }

            #matches .hero-left p {
                font-size: 12px;
            }

            #matches .hero-illustration {
                width: 180px;
                height: 120px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 8px 12px 8px;
            }

            .tabs {
                gap: 2px;
                overflow-x: auto;
            }

            .tab-button {
                padding: 6px 10px;
                font-size: 11px;
                white-space: nowrap;
            }

            .match-card {
                padding: 12px;
                border-radius: 6px;
            }

            .odds-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .odd-box {
                padding: 8px;
            }
            


            .odd-label {
                font-size: 9px;
            }

            .odd-value {
                font-size: 14px;
            }

            .bet-input-row {
                grid-template-columns: 1fr;
            }

            #matches .hero {
                padding: 15px;
                margin-bottom: 15px;
            }

            #matches .hero-left h1 {
                font-size: 16px;
            }

            #matches .hero-left p {
                font-size: 11px;
            }

            .hero-illustration {
                width: 100%;
                height: 100px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-box {
                padding: 16px;
            }

            .stat-value {
                font-size: 24px;
            }

            .match-league {
                font-size: 10px;
            }

            .team-name {
                font-size: 13px;
            }

            .market-tabs {
                gap: 4px;
            }

            .market-tab {
                padding: 4px 8px;
                font-size: 9px;
            }

            .wallet-box {
                padding: 16px;
            }

            .wallet-balance {
                font-size: 28px;
            }

            #contact > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        /* Bet Ticket Modal */
        .ticket-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .ticket-modal.active {
            display: flex;
        }

        .ticket-content {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            margin: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .ticket-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .ticket-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            padding: 20px;
            text-align: center;
            border-radius: 10px 10px 0 0;
            position: relative;
        }

        .ticket-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .ticket-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .ticket-close-btn:active {
            transform: scale(0.95);
        }

        .ticket-header h2 {
            margin: 0;
            color: white;
            font-size: 24px;
        }

        .ticket-header .ticket-id {
            color: #cbd5e1;
            font-size: 12px;
            margin-top: 8px;
        }

        .ticket-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }

        .ticket-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .ticket-section h3 {
            color: #60a5fa;
            font-size: 14px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ticket-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            color: #e2e8f0;
        }

        .ticket-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .ticket-value {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 14px;
        }

        .ticket-total {
            background: rgba(59, 130, 246, 0.1);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .ticket-total .ticket-row {
            font-size: 16px;
        }

        .ticket-total .ticket-value {
            color: #3b82f6;
            font-size: 20px;
            font-weight: 800;
        }

        .ticket-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid #334155;
        }

        .ticket-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ticket-btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }

        .ticket-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .ticket-btn-secondary {
            background: #1e293b;
            color: #cbd5e1;
            border: 1px solid #334155;
        }

        .ticket-btn-secondary:hover {
            background: #334155;
        }

        .ticket-barcode {
            text-align: center;
            padding: 20px;
            background: white;
            margin: 16px 0;
            border-radius: 8px;
        }

        .ticket-barcode svg {
            max-width: 100%;
            height: auto;
        }

        .ticket-picks-list {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 12px;
        }

        .ticket-pick-item {
            padding: 12px;
            background: rgba(59, 130, 246, 0.05);
            border-left: 3px solid #3b82f6;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .ticket-pick-item:last-child {
            margin-bottom: 0;
        }

        .ticket-pick-match {
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .ticket-pick-selection {
            color: #94a3b8;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ticket-pick-odds {
            color: #3b82f6;
            font-weight: 700;
            font-size: 16px;
            margin-left: 10px;
            flex-shrink: 0;
        }

        /* Mobile Specific Ticket Styles */
        @media (max-width: 768px) {
            .ticket-modal {
                padding: 5px;
                align-items: flex-start;
                overflow-y: scroll;
                -webkit-overflow-scrolling: touch;
            }

            .ticket-content {
                width: 95%;
                max-width: 95%;
                max-height: 90vh;
                margin: 5px auto;
                border-radius: 8px;
                font-size: 13px;
            }

            .ticket-header {
                padding: 12px;
            }

            .ticket-header h2 {
                font-size: 16px;
                padding-right: 35px;
                margin: 0;
            }

            .ticket-header .ticket-id {
                font-size: 10px;
                margin-top: 4px;
            }

            .ticket-close-btn {
                width: 28px;
                height: 28px;
                font-size: 14px;
                top: 10px;
                right: 10px;
            }

            .ticket-body {
                padding: 12px;
                font-size: 12px;
            }

            .ticket-section {
                margin-bottom: 12px;
                padding-bottom: 12px;
            }

            .ticket-section h3 {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .ticket-row {
                padding: 6px 0;
                font-size: 12px;
            }

            .ticket-label {
                font-size: 11px;
            }

            .ticket-value {
                font-size: 11px;
            }

            .ticket-pick-item {
                padding: 8px;
                margin-bottom: 6px;
            }

            .ticket-pick-match {
                font-size: 12px;
                margin-bottom: 4px;
            }

            .ticket-pick-selection {
                font-size: 11px;
            }

            .ticket-pick-odds {
                font-size: 13px;
            }

            .ticket-total {
                padding: 10px;
                margin-bottom: 12px;
            }

            .ticket-total-label {
                font-size: 11px;
            }

            .ticket-total-amount {
                font-size: 16px;
            }

            .ticket-actions {
                padding: 10px 12px;
                gap: 8px;
                flex-wrap: wrap;
            }

            .ticket-btn {
                flex: 1;
                min-width: 120px;
                padding: 10px 12px;
                font-size: 12px;
            }
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .ticket-modal,
            .ticket-modal * {
                visibility: visible;
            }
            
            .ticket-modal {
                position: absolute;
                left: 0;
                top: 0;
                background: white;
                width: 100%;
                height: auto;
            }
            
            .ticket-content {
                box-shadow: none;
                border: 1px solid #000;
                max-width: 100%;
                background: white;
                color: black;
            }
            
            .ticket-header {
                background: #3b82f6;
                color: white;
            }
            
            .ticket-actions {
                display: none;
            }
        }

        /* League Selector Styles */
        .league-selector {
            padding: 12px;
            background: #0f172a;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .league-category {
            margin-bottom: 8px;
            position: relative;
        }

        .league-category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0;
            position: relative;
            z-index: 10;
        }

        .league-category-header:hover {
            transform: translateX(3px);
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }

        .league-category-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-weight: 700;
            font-size: 13px;
        }

        .league-category-title i {
            font-size: 14px;
        }

        .league-category-arrow {
            color: #fff;
            transition: transform 0.3s ease;
            font-size: 12px;
        }

        .league-category-arrow.open {
            transform: rotate(180deg);
        }

        .league-buttons {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
            padding: 10px;
            background: #1e293b;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .league-buttons.open {
            display: grid;
        }

        .league-btn {
            background: #334155;
            border: 2px solid #475569;
            color: #e2e8f0;
            padding: 8px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 11px;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .league-btn:hover {
            background: #475569;
            border-color: #3b82f6;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(59, 130, 246, 0.2);
        }

        .league-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            color: #fff;
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.4);
        }

        .league-btn-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
        }

        .league-btn.active .league-btn-count {
            background: rgba(255,255,255,0.3);
        }

        /* ========== CRASH GAME STYLES ========== */
        .crash-game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .crash-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .crash-stats {
            display: flex;
            gap: 20px;
        }

        .crash-display {
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #334155;
            border-radius: 16px;
            padding: 60px 40px;
            margin-bottom: 25px;
            min-height: 400px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .crash-multiplier-container {
            text-align: center;
            z-index: 2;
        }

        .crash-multiplier {
            font-size: 96px;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(59, 130, 246, 0.5);
            animation: pulse 2s ease-in-out infinite;
            transition: all 0.1s ease;
        }

        .crash-multiplier.flying {
            animation: multiplierGrow 0.5s ease infinite;
        }

        .crash-multiplier.crashed {
            color: #ef4444;
            background: #ef4444;
            -webkit-text-fill-color: #ef4444;
            animation: shake 0.5s ease;
        }

        @keyframes multiplierGrow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .crash-status {
            font-size: 18px;
            color: #94a3b8;
            margin-top: 15px;
            font-weight: 600;
        }

        .crash-timer {
            font-size: 24px;
            color: #f59e0b;
            margin-top: 10px;
            font-weight: 700;
        }

        .crash-plane {
            position: absolute;
            font-size: 60px;
            color: #3b82f6;
            opacity: 0.3;
            bottom: 40px;
            left: 50px;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .crash-plane.flying {
            animation: planeFly 3s ease-in infinite;
            opacity: 0.8;
        }

        .crash-plane.crashed {
            animation: planeCrash 0.5s ease;
            color: #ef4444;
        }

        @keyframes planeFly {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(calc(100vw - 200px), -300px) rotate(-20deg); opacity: 0; }
        }

        @keyframes planeCrash {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(-15deg); }
            75% { transform: rotate(10deg); }
            100% { transform: rotate(0deg) scale(0.5); opacity: 0; }
        }

        .crash-controls {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .crash-bet-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .crash-quick-bets {
            display: flex;
            gap: 8px;
        }

        .crash-quick-bets button {
            padding: 8px 15px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 6px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 600;
        }

        .crash-quick-bets button:hover {
            background: #475569;
            border-color: #3b82f6;
        }

        .crash-bet-btn, .crash-cashout-btn {
            padding: 18px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .crash-bet-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .crash-bet-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .crash-bet-btn:disabled {
            background: #475569;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .crash-cashout-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .crash-cashout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }

        .crash-history {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
        }

        .crash-history-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .crash-history-item {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            min-width: 80px;
            text-align: center;
            border: 2px solid;
        }

        .crash-history-item.low {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        .crash-history-item.medium {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .crash-history-item.high {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }

        .crash-history-item.mega {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            border-color: #f59e0b;
            color: #f59e0b;
            animation: pulse 2s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .crash-game-container {
                padding: 10px;
            }

            .crash-header h2 {
                font-size: 20px;
            }

            .crash-stats {
                font-size: 12px;
            }

            .crash-display {
                min-height: 280px;
                padding: 30px 15px;
                border-radius: 12px;
                margin-bottom: 15px;
            }

            .crash-multiplier {
                font-size: 56px;
            }

            .crash-status {
                font-size: 14px;
                margin-top: 10px;
            }

            .crash-timer {
                font-size: 16px;
                margin-top: 8px;
                position: relative;
                z-index: 10;
            }

            .crash-plane {
                font-size: 36px;
                bottom: 30px;
                left: 30px;
            }

            .crash-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                margin-bottom: 15px;
            }

            .crash-controls {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 10px;
            }

            .crash-bet-form {
                gap: 12px;
            }

            .crash-bet-form input {
                font-size: 16px;
                padding: 12px;
            }

            .crash-quick-bets {
                flex-wrap: wrap;
            }

            .crash-quick-bets button {
                padding: 8px 12px;
                font-size: 12px;
                flex: 1;
                min-width: 60px;
            }

            .crash-bet-btn, .crash-cashout-btn {
                padding: 14px;
                font-size: 16px;
                border-radius: 8px;
            }

            .crash-history {
                padding: 15px;
                border-radius: 10px;
            }

            .crash-history h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }

            .crash-history-items {
                gap: 8px;
            }

            .crash-history-item {
                padding: 10px 15px;
                font-size: 14px;
                min-width: 70px;
                border-radius: 6px;
            }
        }

        /* ========== GAME CONTAINER (SHARED FOR DICE, MINES, PLINKO) ========== */
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-controls {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .game-action-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .game-action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .game-action-btn:disabled {
            background: #475569;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .game-action-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            animation: pulse 1.5s ease-in-out infinite;
        }

        .game-history {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
        }

        .game-history h3 {
            color: #e2e8f0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ========== DICE GAME STYLES ========== */
        .dice-display {
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #334155;
            border-radius: 16px;
            padding: 60px 40px;
            margin-bottom: 25px;
            height: 200px;
            overflow: hidden;
        }

        .dice-result {
            text-align: center;
            z-index: 2;
        }

        .dice-number {
            font-size: 80px;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s ease-in-out infinite;
        }

        .dice-label {
            font-size: 16px;
            color: #94a3b8;
            margin-top: 10px;
        }

        .dice-target-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #f59e0b;
            transition: left 0.3s ease;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
        }

        .dice-prediction-btns {
            display: flex;
            gap: 10px;
        }

        .prediction-btn {
            flex: 1;
            padding: 12px;
            background: #334155;
            border: 2px solid #475569;
            border-radius: 8px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .prediction-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
        }

        .dice-multiplier {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 32px;
            font-weight: 900;
            color: white;
            margin-bottom: 8px;
        }

        .dice-win-chance {
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
        }

        .dice-history-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .dice-history-item {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 14px;
            border: 2px solid;
        }

        .dice-history-item.won {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }

        .dice-history-item.lost {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        /* ========== MINES GAME STYLES ========== */
        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .mine-tile {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #334155 0%, #1e293b 100%);
            border: 2px solid #475569;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .mine-tile:hover:not(.revealed) {
            transform: scale(1.05);
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .mine-tile.revealed.gem {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
            animation: revealGem 0.5s ease;
        }

        .mine-tile.revealed.mine {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            color: white;
            animation: revealMine 0.5s ease;
        }

        @keyframes revealGem {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        @keyframes revealMine {
            0% { transform: scale(1); }
            25% { transform: scale(0.8) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(0.9) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .mines-current-multi {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 900;
            color: white;
        }

        .mines-info {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
        }

        .mines-info-item {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            flex: 1;
        }

        .mines-info-item span {
            color: #94a3b8;
            font-size: 13px;
            display: block;
            margin-bottom: 8px;
        }

        .mines-info-item strong {
            color: #e2e8f0;
            font-size: 24px;
            font-weight: 900;
        }

        /* ========== PLINKO GAME STYLES ========== */
        .plinko-board {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #334155;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        #plinkoCanvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .plinko-multipliers {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 4px;
        }

        .plinko-multiplier {
            flex: 1;
            padding: 8px 2px;
            border-radius: 6px;
            text-align: center;
            font-weight: 800;
            font-size: 10px;
            border: 2px solid;
            min-width: 0;
            overflow: hidden;
            white-space: nowrap;
        }

        .plinko-multiplier.low {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        .plinko-multiplier.medium {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .plinko-multiplier.high {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }

        .plinko-multiplier.mega {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            border-color: #f59e0b;
            color: #f59e0b;
            animation: pulse 2s ease-in-out infinite;
        }

        .plinko-history-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .plinko-history-item {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 14px;
            border: 2px solid;
        }

        .plinko-history-item.won {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }

        .plinko-history-item.lost {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        /* ========== MOBILE RESPONSIVE FOR ALL GAMES ========== */
        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }

            .game-controls {
                padding: 15px;
            }

            .control-row {
                flex-direction: column;
                gap: 12px;
            }

            .game-action-btn {
                padding: 14px;
                font-size: 16px;
            }

            .dice-display {
                height: 200px;
                padding: 40px 20px;
            }

            .dice-number {
                font-size: 48px;
                line-height: 1.2;
                padding: 10px 0;
            }

            .dice-multiplier {
                font-size: 24px;
                padding: 12px;
            }

            .mines-grid {
                gap: 8px;
                max-width: 100%;
            }

            .mine-tile {
                font-size: 24px;
                border-radius: 8px;
            }

            .mines-current-multi {
                font-size: 18px;
                padding: 6px 15px;
            }

            .plinko-board {
                padding: 15px;
            }

            .plinko-multiplier {
                font-size: 8px;
                padding: 6px 1px;
                border-width: 1px;
            }
        }

        /* ========== VIRTUAL GAMES COMPACT UI ========== */
        .virtual-compact-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .virtual-league-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .virtual-league-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }
        
        .virtual-league-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .virtual-games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        /* Virtual Games Layout - Mobile First */
        .virtual-layout {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .virtual-games-wrapper {
            width: 100%;
            order: 1;
        }
        
        .virtual-standings-container {
            width: 100%;
            order: 2;
            display: none;
        }
        
        .standings-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 16px;
        }
        
        /* Desktop Layout - Sidebar on Right */
        @media (min-width: 1024px) {
            .virtual-layout {
                flex-direction: row;
            }
            
            .virtual-games-wrapper {
                flex: 1;
                order: 1;
            }
            
            .virtual-standings-container {
                width: 300px;
                flex-shrink: 0;
                order: 2;
            }
            
            .standings-card {
                position: sticky;
                top: 20px;
            }
        }
        
        .virtual-match-compact {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s;
        }
        
        .virtual-match-compact:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }
        
        .virtual-match-compact.live {
            border-color: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
            animation: livePulse 2s infinite;
        }
        
        @keyframes livePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.6); }
        }
        
        .virtual-timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .virtual-timer.countdown {
            color: #60a5fa;
        }
        
        .virtual-timer.live {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .virtual-timer.finished {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .virtual-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .virtual-team-name {
            flex: 1;
            font-weight: 600;
            color: #e2e8f0;
            font-size: 14px;
        }
        
        .virtual-vs {
            padding: 0 10px;
            color: #64748b;
            font-weight: 700;
            font-size: 12px;
        }
        
        .virtual-score {
            font-size: 24px;
            font-weight: 700;
            color: #10b981;
            text-align: center;
            margin: 8px 0;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .virtual-score.animating {
            animation: scoreFlash 0.3s;
        }
        
        @keyframes scoreFlash {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); color: #fbbf24; }
        }
        
        .virtual-odds-compact {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-top: 10px;
        }
        
        .virtual-odd-btn {
            padding: 8px 4px;
            background: linear-gradient(135deg, #334155 0%, #1e293b 100%);
            border: 1px solid #475569;
            border-radius: 6px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            font-size: 12px;
        }
        
        .virtual-odd-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            transform: translateY(-2px);
        }
        
        .virtual-odd-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .virtual-odd-btn.selected {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #34d399;
        }
        
        .virtual-odd-label {
            font-weight: 700;
            font-size: 11px;
        }
        
        .virtual-odd-value {
            font-weight: 600;
            color: #fbbf24;
            font-size: 13px;
        }
        
        .virtual-progress-bar {
            width: 100%;
            height: 4px;
            background: #1e293b;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .virtual-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
            transition: width 1s linear;
        }
        
        .virtual-progress-fill.live {
            background: linear-gradient(90deg, #ef4444 0%, #f87171 100%);
        }
        
        .virtual-minute-indicator {
            font-size: 11px;
            color: #94a3b8;
            text-align: center;
            margin-top: 4px;
        }
        /* ========== END VIRTUAL GAMES CSS ========== */
    </style>
</head>
<body>
    <!-- Bet Ticket Modal -->
    <div id="ticketModal" class="ticket-modal" onclick="closeTicketOnOverlay(event)">
        <div class="ticket-content" onclick="event.stopPropagation()">
            <div class="ticket-header">
                <h2><i class="fas fa-ticket-alt"></i> Bet Ticket</h2>
                <button class="ticket-close-btn" onclick="closeTicket()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
                <div class="ticket-id" id="ticketId">Ticket #12345</div>
            </div>
            <div class="ticket-body" id="ticketBody">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="ticket-actions">
                <button class="ticket-btn ticket-btn-secondary" onclick="closeTicket()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="ticket-btn ticket-btn-primary" onclick="printTicket()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo" onclick="location.reload()" style="cursor: pointer;">
                <i class="fas fa-dice"></i> ABKBet
            </div>
            <div class="user-section">
                <div class="balance-display" id="headerBalance">Balance: $0.00</div>
                <div class="account-dropdown">
                    <button class="account-btn" onclick="toggleAccountDropdown()">
                        <i class="fas fa-user"></i>
                        <span id="accountBtnText">Account</span>
                        <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
                    </button>
                    <div class="account-dropdown-content" id="accountDropdown">
                        <button class="account-dropdown-item" id="loginMenuItem" onclick="switchTab('auth'); closeAccountDropdown();">
                            <i class="fas fa-sign-in-alt"></i>
                            Login / Register
                        </button>
                        <button class="account-dropdown-item" id="profileMenuItem" style="display: none;" onclick="switchTab('auth'); closeAccountDropdown();">
                            <i class="fas fa-user-circle"></i>
                            My Profile
                        </button>
                        <button class="account-dropdown-item" id="logoutMenuItem" style="display: none;" onclick="logout(); closeAccountDropdown();">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('matches')"><i class="fas fa-trophy"></i> Matches</button>
            <button class="tab-button" id="mybetsTab" onclick="switchTab('mybets')" style="display: none;"><i class="fas fa-history"></i> My Bets</button>
            <button class="tab-button" id="premiumTab" onclick="switchTab('premium')" style="display: none;"><i class="fas fa-crown"></i> Premium</button>
            <button class="tab-button" id="crashTab" onclick="switchTab('crash')" style="display: none;"><i class="fas fa-plane-departure"></i> Crash</button>
            <button class="tab-button" id="diceTab" onclick="switchTab('dice')" style="display: none;"><i class="fas fa-dice"></i> Dice</button>
            <button class="tab-button" id="minesTab" onclick="switchTab('mines')" style="display: none;"><i class="fas fa-gem"></i> Mines</button>
            <button class="tab-button" id="plinkoTab" onclick="switchTab('plinko')" style="display: none;"><i class="fas fa-circle"></i> Plinko</button>
            <button class="tab-button" id="virtualTab" onclick="switchTab('virtual')" style="display: none;"><i class="fas fa-gamepad"></i> Virtual</button>
            <button class="tab-button" id="walletTab" onclick="switchTab('wallet')" style="display: none;"><i class="fas fa-wallet"></i> Wallet</button>
            <button class="tab-button" id="statsTab" onclick="switchTab('stats')" style="display: none;"><i class="fas fa-chart-bar"></i> Stats</button>
        </div>

        <!-- Messages -->
        <div id="messageBox" class="message"></div>

        <!-- Matches Tab -->
        <div id="matches" class="tab-content active">
            <!-- Hero / Promotional Banner -->
            <div class="hero">
                <div class="hero-left">
                    <h1>Catch the action â€” Bet the markets you love</h1>
                    <p>Multiple market types, instant USD staking, BTC settlement. Select a market, place your stake, celebrate the win.</p>
                    <div class="hero-cta">
                        <button class="btn-primary" onclick="switchTab('wallet')">Fund Wallet</button>
                        <button class="btn-ghost" onclick="document.getElementById('matchesContainer').scrollIntoView({behavior:'smooth'})">Explore Matches</button>
                    </div>
                    
                    <!-- Load Code Box -->
                    <div class="hero-load-code">
                        <div class="load-code-label">
                            <i class="fas fa-ticket-alt"></i>
                            <span>Have a booking code?</span>
                        </div>
                        <div class="load-code-input-wrapper">
                            <input 
                                type="text" 
                                id="bookingCodeInput" 
                                placeholder="Enter code" 
                                maxlength="10"
                                autocomplete="off"
                                class="load-code-input"
                            />
                            <button onclick="loadBookingCode()" class="load-code-btn">
                                <span>Load</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="hero-right">
                    <!-- Promotional Carousel -->
                    <div class="promo-carousel">
                        <div class="promo-slides">
                            <!-- Slide 1: Upcoming Big Match -->
                            <div class="promo-slide active">
                                <div class="promo-badge">UPCOMING</div>
                                <div class="promo-title">Champions League Final</div>
                                <div class="promo-subtitle">Man City vs Real Madrid</div>
                                <div class="promo-date">
                                    <i class="fas fa-calendar"></i> December 20, 2025
                                </div>
                                <div class="promo-action">
                                    <span>Pre-match odds available now</span>
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                            
                            <!-- Slide 2: Virtual Games -->
                            <div class="promo-slide">
                                <div class="promo-badge">NEW</div>
                                <div class="promo-title">Virtual Football</div>
                                <div class="promo-subtitle">Bet 24/7 on Virtual Leagues</div>
                                <div class="promo-date">
                                    <i class="fas fa-gamepad"></i> Play Now
                                </div>
                                <div class="promo-action">
                                    <span>Instant results & payouts</span>
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                            
                            <!-- Slide 3: Live Betting -->
                            <div class="promo-slide">
                                <div class="promo-badge">LIVE</div>
                                <div class="promo-title">In-Play Betting</div>
                                <div class="promo-subtitle">Bet while you watch</div>
                                <div class="promo-date">
                                    <i class="fas fa-bolt"></i> 50+ Live Matches
                                </div>
                                <div class="promo-action">
                                    <span>Real-time odds updates</span>
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                            
                            <!-- Slide 4: Crypto Bonus -->
                            <div class="promo-slide">
                                <div class="promo-badge">BONUS</div>
                                <div class="promo-title">Crypto Deposits</div>
                                <div class="promo-subtitle">Get 10% extra on BTC/USDT</div>
                                <div class="promo-date">
                                    <i class="fab fa-bitcoin"></i> Instant Processing
                                </div>
                                <div class="promo-action">
                                    <span>Fund wallet now</span>
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Carousel Indicators -->
                        <div class="promo-indicators">
                            <span class="promo-indicator active" data-slide="0"></span>
                            <span class="promo-indicator" data-slide="1"></span>
                            <span class="promo-indicator" data-slide="2"></span>
                            <span class="promo-indicator" data-slide="3"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="matches-header">
                <h2><i class="fas fa-fire"></i> Live Matches & Odds</h2>
            </div>

            <!-- League Selector for Mobile (outside sidebar) -->
            <div class="league-selector mobile-league-selector" id="mobileLeagueSelector">
                <div style="text-align: center; padding: 20px; color: #64748b;">Loading leagues...</div>
            </div>

            <!-- Left Sidebar for Desktop -->
            <div class="left-sidebar">
                <div class="sidebar-header">
                    <i class="fas fa-filter"></i>
                    <h3>Filter Leagues</h3>
                </div>
                <div class="league-selector desktop-league-selector" id="desktopLeagueSelector"></div>
            </div>

            <div class="betting-content-wrapper">
                <!-- Matches Grid -->
                <div class="matches-grid" id="matchesContainer">
                    <p style="text-align: center; color: #64748b; margin: 20px 0;">Loading matches...</p>
                </div>
            </div>
        </div>

        <!-- My Bets Tab -->
        <div id="mybets" class="tab-content">
            <h2><i class="fas fa-ticket-alt"></i> My Bets</h2>
            
            <!-- Sub-tabs for different bet statuses -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #1e293b; padding-bottom: 0;">
                <button class="mybets-subtab active" onclick="switchMyBetsTab('active')" id="subtab-active">
                    <i class="fas fa-clock"></i> Active
                </button>
                <button class="mybets-subtab" onclick="switchMyBetsTab('won')" id="subtab-won">
                    <i class="fas fa-trophy"></i> Won
                </button>
                <button class="mybets-subtab" onclick="switchMyBetsTab('settled')" id="subtab-settled">
                    <i class="fas fa-check-circle"></i> Settled
                </button>
                <button class="mybets-subtab" onclick="switchMyBetsTab('lost')" id="subtab-lost">
                    <i class="fas fa-times-circle"></i> Lost
                </button>
            </div>
            
            <div class="bets-list" id="myBetsList"></div>
        </div>

        <!-- Premium Tab -->
        <div id="premium" class="tab-content">
            <h2><i class="fas fa-crown"></i> Premium Bookings</h2>
            
            <div class="premium-actions-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- Enter Premium Code Card -->
                <div class="payment-form">
                    <h3 style="color: #f59e0b; margin-bottom: 20px;">
                        <i class="fas fa-key"></i> Enter Premium Code
                    </h3>
                    
                    <div class="form-group">
                        <label for="premiumCode">Booking Code</label>
                        <input type="text" id="premiumCode" placeholder="Enter code (e.g., PRM1A2B3C4)" 
                               style="text-transform: uppercase; letter-spacing: 2px; font-family: 'Courier New', monospace; font-size: 18px; font-weight: 600;">
                    </div>
                    
                    <button class="btn-submit" onclick="checkPremiumCode()" style="width: 100%;">
                        <i class="fas fa-search"></i> Check Code
                    </button>
                </div>
                
                <!-- Code Info Card (Hidden initially) -->
                <div class="payment-form" id="premiumCodeInfo" style="display: none;">
                    <h3 style="color: #10b981; margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i> Booking Details
                    </h3>
                    
                    <div id="premiumCodeDetails"></div>
                </div>
            </div>
            
            <!-- My Premium Bookings -->
            <div class="payment-form">
                <h3 style="color: #3b82f6; margin-bottom: 20px;">
                    <i class="fas fa-crown"></i> My Premium Bookings
                </h3>
                
                <div id="myPremiumBookings">
                    <p style="color: #94a3b8; text-align: center; padding: 20px;">
                        <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.3; display: block; margin-bottom: 10px;"></i>
                        No premium bookings accessed yet
                    </p>
                </div>
            </div>
        </div>

        <!-- Crash Game Tab -->
        <div id="crash" class="tab-content">
            <div class="crash-game-container">
                <!-- Game Header -->
                <div class="crash-header">
                    <h2 style="display: flex; align-items: center; gap: 10px; margin: 0;">
                        <i class="fas fa-plane-departure" style="color: #3b82f6;"></i> 
                        <span style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Crash</span>
                    </h2>
                    <div class="crash-stats">
                        <span style="color: #94a3b8; font-size: 14px;">
                            <i class="fas fa-users"></i> <span id="crashPlayers">0</span> Playing
                        </span>
                    </div>
                </div>

                <!-- Main Crash Display -->
                <div class="crash-display">
                    <!-- Multiplier Display -->
                    <div class="crash-multiplier-container" id="crashMultiplierContainer">
                        <div class="crash-multiplier" id="crashMultiplier">1.00x</div>
                        <div class="crash-status" id="crashStatus">Waiting for next round...</div>
                        <div class="crash-timer" id="crashTimer"></div>
                    </div>

                    <!-- Plane Animation -->
                    <div class="crash-plane" id="crashPlane">
                        <i class="fas fa-plane-departure"></i>
                    </div>
                </div>

                <!-- Betting Interface -->
                <div class="crash-controls">
                    <div class="crash-bet-form">
                        <div class="form-group">
                            <label for="crashBetAmount">Bet Amount ($)</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="crashBetAmount" placeholder="Enter amount" 
                                       min="1" step="0.01" value="10">
                                <div class="crash-quick-bets">
                                    <button onclick="setCrashBet(10)">$10</button>
                                    <button onclick="setCrashBet(50)">$50</button>
                                    <button onclick="setCrashBet(100)">$100</button>
                                </div>
                            </div>
                        </div>
                        
                        <button class="crash-bet-btn" id="crashBetBtn" onclick="placeCrashBet()">
                            <i class="fas fa-rocket"></i> <span id="crashBetBtnText">Place Bet</span>
                        </button>
                        
                        <button class="crash-cashout-btn" id="crashCashoutBtn" onclick="crashCashOut()" style="display: none;">
                            <i class="fas fa-hand-holding-usd"></i> Cash Out
                        </button>
                    </div>
                </div>

                <!-- Game History -->
                <div class="crash-history">
                    <h3 style="color: #e2e8f0; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-history"></i> Recent Crashes
                    </h3>
                    <div class="crash-history-items" id="crashHistory">
                        <div style="color: #94a3b8; text-align: center; padding: 20px;">
                            Loading history...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dice Game Tab -->
        <div id="dice" class="tab-content">
            <div class="game-container">
                <h2 style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-dice" style="color: #3b82f6;"></i>
                    <span style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Dice</span>
                </h2>

                <!-- Dice Display -->
                <div class="dice-display">
                    <div class="dice-result" id="diceResult">
                        <div class="dice-number">50.00</div>
                        <div class="dice-label">Roll to Play</div>
                    </div>
                    <div class="dice-target-line" id="diceTargetLine" style="left: 50%;"></div>
                </div>

                <!-- Controls -->
                <div class="game-controls">
                    <div class="control-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Bet Amount ($)</label>
                            <input type="number" id="diceBetAmount" placeholder="10" value="10" min="1" step="0.01">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Target Number</label>
                            <input type="number" id="diceTarget" placeholder="50" value="50" min="1" max="98" step="0.01">
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Prediction</label>
                            <div class="dice-prediction-btns">
                                <button class="prediction-btn active" id="diceOver" onclick="selectDicePrediction('over')">
                                    <i class="fas fa-arrow-up"></i> Roll Over
                                </button>
                                <button class="prediction-btn" id="diceUnder" onclick="selectDicePrediction('under')">
                                    <i class="fas fa-arrow-down"></i> Roll Under
                                </button>
                            </div>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Multiplier</label>
                            <div class="dice-multiplier" id="diceMultiplier">1.98x</div>
                            <div class="dice-win-chance" id="diceWinChance">50.00%</div>
                        </div>
                    </div>

                    <button class="game-action-btn" id="rollDiceBtn" onclick="rollDice()">
                        <i class="fas fa-dice"></i> Roll Dice
                    </button>
                </div>

                <!-- History -->
                <div class="game-history">
                    <h3><i class="fas fa-history"></i> Recent Rolls</h3>
                    <div class="dice-history-items" id="diceHistory">
                        <div style="color: #94a3b8; text-align: center; padding: 20px;">
                            No rolls yet
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mines Game Tab -->
        <div id="mines" class="tab-content">
            <div class="game-container">
                <h2 style="display: flex; align-items: center; gap: 10px; justify-content: space-between;">
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-gem" style="color: #10b981;"></i>
                        <span style="background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Mines</span>
                    </span>
                    <span id="minesMultiplier" class="mines-current-multi">1.00x</span>
                </h2>

                <!-- Mines Grid -->
                <div class="mines-grid" id="minesGrid"></div>

                <!-- Controls -->
                <div class="game-controls">
                    <div class="control-row" id="minesStartControls">
                        <div class="form-group" style="flex: 1;">
                            <label>Bet Amount ($)</label>
                            <input type="number" id="minesBetAmount" placeholder="10" value="10" min="1" step="0.01">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Number of Mines</label>
                            <input type="number" id="mineCount" placeholder="3" value="3" min="1" max="24">
                        </div>
                    </div>

                    <button class="game-action-btn" id="startMinesBtn" onclick="startMinesGame()">
                        <i class="fas fa-play"></i> Start Game
                    </button>

                    <button class="game-action-btn game-action-btn-success" id="cashoutMinesBtn" onclick="cashoutMines()" style="display: none;">
                        <i class="fas fa-hand-holding-usd"></i> Cash Out (<span id="minesCashoutAmount">$0.00</span>)
                    </button>
                </div>

                <div class="mines-info">
                    <div class="mines-info-item">
                        <span>Tiles Revealed</span>
                        <strong id="minesTilesRevealed">0</strong>
                    </div>
                    <div class="mines-info-item">
                        <span>Safe Tiles Left</span>
                        <strong id="minesSafeLeft">25</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plinko Game Tab -->
        <div id="plinko" class="tab-content">
            <div class="game-container">
                <h2 style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-circle" style="color: #f59e0b;"></i>
                    <span style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Plinko</span>
                </h2>

                <!-- Plinko Board -->
                <div class="plinko-board">
                    <canvas id="plinkoCanvas" width="400" height="500"></canvas>
                    <div class="plinko-multipliers" id="plinkoMultipliers"></div>
                </div>

                <!-- Controls -->
                <div class="game-controls">
                    <div class="control-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Bet Amount ($)</label>
                            <input type="number" id="plinkoBetAmount" placeholder="10" value="10" min="0.1" step="0.01">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Number of Balls</label>
                            <input type="number" id="plinkoNumBalls" placeholder="1" value="1" min="1" max="10" step="1">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Risk Level</label>
                            <select id="plinkoRisk" onchange="updatePlinkoRisk(this.value)">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>

                    <button class="game-action-btn" id="dropPlinkoBtn" onclick="dropPlinkoBall()">
                        <i class="fas fa-circle"></i> Drop Ball
                    </button>
                </div>

                <!-- History -->
                <div class="game-history">
                    <h3><i class="fas fa-history"></i> Recent Drops</h3>
                    <div class="plinko-history-items" id="plinkoHistory">
                        <div style="color: #94a3b8; text-align: center; padding: 20px;">
                            No drops yet
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Virtual Games Tab -->
        <div id="virtual" class="tab-content">
            <div class="virtual-compact-container">
                <!-- Virtual League Tabs -->
                <div class="virtual-league-tabs">
                    <button id="vLeague1" class="virtual-league-tab active" onclick="showVirtualLeague(1)">
                        <i class="fas fa-trophy"></i> Premier League
                    </button>
                    <button id="vLeague2" class="virtual-league-tab" onclick="showVirtualLeague(2)">
                        <i class="fas fa-trophy"></i> La Liga
                    </button>
                    <button id="vLeague3" class="virtual-league-tab" onclick="showVirtualLeague(3)">
                        <i class="fas fa-trophy"></i> Serie A
                    </button>
                </div>
                
                <!-- Virtual Content Layout - Mobile First -->
                <div class="virtual-layout">
                    <!-- Virtual Games Grid (Shows First on Mobile) -->
                    <div class="virtual-games-wrapper">
                        <div class="virtual-games-grid" id="virtualGamesContainer">
                            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                                <div style="font-size: 64px; margin-bottom: 20px;">âš½</div>
                                <h2 style="color: #60a5fa; margin-bottom: 10px;">Virtual Games</h2>
                                <p style="color: #94a3b8; margin-bottom: 30px;">Click a league to start!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Standings (Shows Below Matches on Mobile, Side on Desktop) -->
                    <div id="virtualStandings" class="virtual-standings-container">
                        <div class="standings-card">
                            <h3 style="color: #e2e8f0; font-size: 16px; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center;">
                                <i class="fas fa-trophy" style="color: #fbbf24; margin-right: 8px;"></i>
                                <span id="standingsLeagueName">Standings</span>
                            </h3>
                            <div id="standingsTable" style="max-height: 600px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wallet Tab -->
        <div id="wallet" class="tab-content">
            <h2><i class="fas fa-wallet"></i> Wallet</h2>
            
            <div class="wallet-container" style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 30px; max-width: 400px;">
                <div class="wallet-box" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 8px; padding: 20px;">
                    <h3 style="color: #60a5fa; margin-bottom: 16px;"><i class="fas fa-dollar-sign"></i> Balance</h3>
                    <div style="font-size: 36px; font-weight: bold; color: #3b82f6; margin-bottom: 8px;" id="walletBalanceUsd">$0.00</div>
                </div>
            </div>

            <div class="wallet-actions-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div class="payment-form">
                    <h2 style="font-weight: 900; font-size: 22px; letter-spacing: 0.5px;">
                        <i class="fas fa-money-bill-wave"></i> DEPOSIT FUNDS
                    </h2>
                    
                    <!-- Step 1: Select Method and Amount -->
                    <div id="depositStep1" style="display: block;">
                        <form onsubmit="showPaymentDetails(event)">
                            <label for="depositMethod">Payment Method:</label>
                            <select id="depositMethod" name="method" class="payment-input" required onchange="updateMethodInfo()">
                                <option value="">-- Select Payment Method --</option>
                                <option value="bitcoin">Bitcoin (BTC)</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="paypal">PayPal</option>
                                <option value="skrill">Skrill</option>
                                <option value="mobile_money">MTN Mobile Money</option>
                                <option value="usdt">USDT (Tether)</option>
                            </select>

                            <div id="methodInfo" style="background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; margin: 12px 0; display: none;">
                                <div style="font-size: 13px; color: #94a3b8;"><i class="fas fa-info-circle"></i> Processing Time: <span id="processingTime">-</span></div>
                                <div style="font-size: 13px; color: #94a3b8; margin-top: 4px;">Min: $<span id="minDeposit">10</span> | Max: $<span id="maxDeposit">10000</span></div>
                            </div>

                            <label for="depositAmount">Amount (USD):</label>
                            <input type="number" id="depositAmount" name="amount" class="payment-input" step="0.01" min="10" placeholder="Enter amount in USD" required />

                            <button type="submit" class="payment-button">
                                <i class="fas fa-arrow-right"></i> Continue to Payment Details
                            </button>
                        </form>
                    </div>

                    <!-- Step 2: Payment Details -->
                    <div id="depositStep2" style="display: none;">
                        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <h3 style="color: #60a5fa; margin-bottom: 12px;"><i class="fas fa-credit-card"></i> Payment Details</h3>
                            <div id="paymentDetailsContent" style="font-size: 14px; color: #e2e8f0;">
                                <!-- Payment details will be inserted here -->
                            </div>
                        </div>

                        <div style="background: #0f172a; border-left: 3px solid #f59e0b; padding: 12px; margin-bottom: 16px; border-radius: 4px;">
                            <strong style="color: #f59e0b;"><i class="fas fa-exclamation-triangle"></i> Important:</strong>
                            <div id="paymentInstructions" style="font-size: 13px; color: #94a3b8; margin-top: 8px;">
                                <!-- Instructions will be inserted here -->
                            </div>
                        </div>

                        <form onsubmit="submitDepositRequest(event)">
                            <label for="depositReference">Transaction Reference / Transaction ID:</label>
                            <input type="text" id="depositReference" name="reference" class="payment-input" placeholder="Enter your transaction ID" required />

                            <label for="depositProof">Payment Proof (Optional):</label>
                            <textarea id="depositProof" name="proof" class="payment-input" rows="2" placeholder="Additional proof or screenshot URL (optional)" style="resize: vertical;"></textarea>

                            <div style="display: flex; gap: 12px;">
                                <button type="button" onclick="backToStep1()" class="payment-button" style="background: #334155; flex: 1;">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button type="submit" class="payment-button" style="flex: 2;">
                                    <i class="fas fa-check-circle"></i> Submit Deposit Request
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Deposit Status / Result -->
                    <div class="payment-result" id="depositResult"></div>

                    <!-- My Deposit Requests -->
                    <div id="myDeposits" style="margin-top: 20px; display: none;">
                        <h3 style="color: #60a5fa; margin-bottom: 12px;">
                            <i class="fas fa-history"></i> My Deposit Requests
                        </h3>
                        <div id="depositsList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Deposit requests will be listed here -->
                        </div>
                    </div>
                </div>

                <div class="payment-form">
                    <h2 style="font-weight: 900; font-size: 22px; letter-spacing: 0.5px;"><i class="fas fa-arrow-circle-up"></i> WITHDRAW FUNDS</h2>
                    
                    <!-- Step 1: Select Method and Amount -->
                    <div id="withdrawStep1" style="display: block;">
                        <form onsubmit="showWithdrawDetails(event); return false;">
                            <label for="withdrawMethod">Withdrawal Method:</label>
                            <select id="withdrawMethod" name="method" class="payment-input" required onchange="updateWithdrawMethodInfo()">
                                <option value="">-- Select Withdrawal Method --</option>
                                <option value="bitcoin">Bitcoin (BTC)</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="paypal">PayPal</option>
                                <option value="skrill">Skrill</option>
                                <option value="mobile_money">MTN Mobile Money</option>
                                <option value="usdt">USDT (Tether)</option>
                            </select>

                            <div id="withdrawMethodInfo" style="background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; margin: 12px 0; display: none;">
                                <div style="font-size: 13px; color: #94a3b8;"><i class="fas fa-info-circle"></i> Processing Time: <span id="withdrawProcessingTime">-</span></div>
                                <div style="font-size: 13px; color: #94a3b8; margin-top: 4px;">Min: $<span id="minWithdraw">20</span> | Max: $<span id="maxWithdraw">50000</span></div>
                            </div>

                            <label for="withdrawAmount">Amount (USD):</label>
                            <input type="number" id="withdrawAmount" name="amount" class="payment-input" step="0.01" min="20" placeholder="Enter amount in USD (min $20)" required />

                            <button type="submit" class="payment-button" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <i class="fas fa-arrow-right"></i> Continue to Withdrawal Details
                            </button>
                        </form>
                    </div>

                    <!-- Step 2: Withdrawal Details -->
                    <div id="withdrawStep2" style="display: none;">
                        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <h3 style="color: #60a5fa; margin-bottom: 12px;"><i class="fas fa-university"></i> Withdrawal Details</h3>
                            <div id="withdrawDetailsForm" style="font-size: 14px; color: #e2e8f0;">
                                <!-- Withdrawal form fields will be inserted here based on method -->
                            </div>
                        </div>

                        <div style="background: #0f172a; border-left: 3px solid #f59e0b; padding: 12px; margin-bottom: 16px; border-radius: 4px;">
                            <strong style="color: #f59e0b;"><i class="fas fa-exclamation-triangle"></i> Important:</strong>
                            <div id="withdrawInstructions" style="font-size: 13px; color: #94a3b8; margin-top: 8px;">
                                <!-- Instructions will be inserted here -->
                            </div>
                        </div>

                        <form onsubmit="submitWithdrawRequest(event)">
                            <div style="display: flex; gap: 12px;">
                                <button type="button" onclick="backToWithdrawStep1()" class="payment-button" style="background: #334155; flex: 1;">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button type="submit" class="payment-button" style="flex: 2; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                    <i class="fas fa-check-circle"></i> Submit Withdrawal Request
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Withdrawal Status / Result -->
                    <div class="payment-result" id="withdrawResult"></div>

                    <!-- My Withdrawal Requests -->
                    <div id="myWithdrawals" style="margin-top: 20px; display: none;">
                        <h3 style="color: #60a5fa; margin-bottom: 12px;">
                            <i class="fas fa-history"></i> My Withdrawal Requests
                        </h3>
                        <div id="withdrawalsList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Withdrawal requests will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="color: #e2e8f0; margin-bottom: 16px;"><i class="fas fa-history"></i> Recent Transactions</h3>
                <div class="bets-list" id="transactionsList">
                    <p style="color: #64748b;">Loading transactions...</p>
                </div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats" class="tab-content">
            <h2><i class="fas fa-chart-bar"></i> Your Statistics</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total Bets</div>
                    <div class="stat-value" id="statTotalBets">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Won</div>
                    <div class="stat-value" style="color: #10b981;" id="statWonBets">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Lost</div>
                    <div class="stat-value" style="color: #dc2626;" id="statLostBets">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Active</div>
                    <div class="stat-value" style="color: #f59e0b;" id="statActiveBets">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value" id="statWinRate">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Wagered</div>
                    <div class="stat-value" style="color: #8b5cf6; font-size: 20px;" id="statWagered">$0.00</div>
                </div>
            </div>
        </div>

        <!-- Auth Tab -->
        <div id="auth" class="tab-content">
            <div class="auth-container">
                <!-- Login Form -->
                <form class="auth-form active" id="loginForm">
                    <h3><i class="fas fa-sign-in-alt"></i> Login</h3>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter username" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <div style="position: relative;">
                            <input type="password" id="loginPassword" placeholder="Enter password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">
                                <i class="fas fa-eye" id="loginPassword-icon"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn-submit" onclick="login()"><i class="fas fa-arrow-right"></i> Login</button>
                        <button type="button" class="btn-toggle" onclick="toggleAuthForm()">Register</button>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="#" onclick="showForgotPassword(); return false;" style="color: #60a5fa; text-decoration: none; font-size: 14px;">
                            <i class="fas fa-key"></i> Forgot Password?
                        </a>
                    </div>
                </form>

                <!-- Register Form -->
                <form class="auth-form" id="registerForm">
                    <h3><i class="fas fa-user-plus"></i> Register</h3>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="registerUsername" placeholder="Choose username" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" placeholder="Enter email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <div style="position: relative;">
                            <input type="password" id="registerPassword" placeholder="Create password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('registerPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">
                                <i class="fas fa-eye" id="registerPassword-icon"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
                            <input type="checkbox" id="acceptTerms" required style="cursor: pointer;">
                            <span>I agree to the <a href="/terms" target="_blank" style="color: #3b82f6; text-decoration: underline;">Terms and Conditions</a></span>
                        </label>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn-submit" onclick="register()"><i class="fas fa-user-plus"></i> Register</button>
                        <button type="button" class="btn-toggle" onclick="toggleAuthForm()">Login</button>
                    </div>
                </form>

                <!-- Profile Info -->
                <div class="profile-info" id="profileInfo">
                    <h3 style="color: #60a5fa; margin-bottom: 16px;"><i class="fas fa-user-circle"></i> Profile</h3>
                    <p><strong>Username:</strong> <span id="profileUsername"></span></p>
                    <p><strong>Email:</strong> <span id="profileEmail"></span></p>
                    <p><strong>Balance:</strong> <span id="profileBalance"></span></p>
                    
                    <!-- Change Password Form -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #334155;">
                        <h4 style="color: #60a5fa; margin-bottom: 12px;"><i class="fas fa-lock"></i> Change Password</h4>
                        <form id="changePasswordForm" onsubmit="changePassword(event)">
                            <div class="form-group">
                                <label>Current Password</label>
                                <div style="position: relative;">
                                    <input type="password" id="currentPassword" required>
                                    <button type="button" class="toggle-password" onclick="togglePassword('currentPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">
                                        <i class="fas fa-eye" id="currentPassword-icon"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>New Password</label>
                                <div style="position: relative;">
                                    <input type="password" id="newPassword" required minlength="8">
                                    <button type="button" class="toggle-password" onclick="togglePassword('newPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">
                                        <i class="fas fa-eye" id="newPassword-icon"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <div style="position: relative;">
                                    <input type="password" id="confirmPassword" required minlength="8">
                                    <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">
                                        <i class="fas fa-eye" id="confirmPassword-icon"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit" style="width: 100%; margin-bottom: 10px;">
                                <i class="fas fa-key"></i> Update Password
                            </button>

                        </form>
                    </div>
                    
                    <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </div>
        </div>


        <!-- Contact Tab -->
        <div id="contact" class="tab-content">
            <h2><i class="fas fa-envelope"></i> Contact Us</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- Contact Information -->
                <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 8px; padding: 24px;">
                    <h3 style="color: #60a5fa; margin-bottom: 20px;"><i class="fas fa-info-circle"></i> Get in Touch</h3>
                    
                    <div style="color: #e2e8f0; line-height: 2;">
                        <div style="margin-bottom: 20px;">
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-envelope"></i> Email Support
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px;">
                                <a href="mailto:support@abkbet.com" style="color: #60a5fa; text-decoration: none;">support@abkbet.com</a>
                                <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Response time: 2-4 hours</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-headset"></i> Live Chat
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px;">
                                Available 24/7
                                <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Click the chat icon in bottom right</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-phone"></i> Phone Support
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px;">
                                +357 25 123 456
                                <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Mon-Fri: 9AM - 6PM CET</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fab fa-telegram"></i> Telegram
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px;">
                                <a href="https://t.me/abkbet_support" style="color: #60a5fa; text-decoration: none;">@abkbet_support</a>
                                <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Fast support via Telegram</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fab fa-twitter"></i> Social Media
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px;">
                                Twitter: <a href="https://twitter.com/abkbet" style="color: #60a5fa; text-decoration: none;">@abkbet</a><br>
                                Discord: <a href="#" style="color: #60a5fa; text-decoration: none;">discord.gg/abkbet</a>
                            </div>
                        </div>

                        <div>
                            <div style="color: #3b82f6; font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-map-marker-alt"></i> Business Address
                            </div>
                            <div style="color: #cbd5e1; padding-left: 24px; font-size: 14px;">
                                ABKBet Gaming Ltd.<br>
                                28 Oktovriou Avenue, Block B<br>
                                3107 Limassol<br>
                                Cyprus
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Form -->
                <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 8px; padding: 24px;">
                    <h3 style="color: #60a5fa; margin-bottom: 20px;"><i class="fas fa-paper-plane"></i> Send Message</h3>
                    
                    <form id="contactForm" onsubmit="sendContactMessage(event)">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" id="contactName" placeholder="Enter your name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="contactEmail" placeholder="your.email@example.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Subject</label>
                            <select id="contactSubject" style="width: 100%; background: #0f172a; border: 1px solid #334155; color: #e2e8f0; padding: 10px 12px; border-radius: 6px; font-size: 14px;">
                                <option value="general">General Inquiry</option>
                                <option value="support">Technical Support</option>
                                <option value="deposit">Deposit Issue</option>
                                <option value="withdrawal">Withdrawal Issue</option>
                                <option value="bet">Bet Settlement Query</option>
                                <option value="account">Account Issue</option>
                                <option value="feedback">Feedback/Suggestions</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Message</label>
                            <textarea id="contactMessage" rows="6" placeholder="Describe your issue or question..." required style="width: 100%; background: #0f172a; border: 1px solid #334155; color: #e2e8f0; padding: 10px 12px; border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                        </div>
                        
                        <button type="submit" class="btn-submit" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                        
                        <p style="color: #64748b; font-size: 12px; margin-top: 12px; text-align: center;">
                            We'll respond within 24 hours
                        </p>
                    </form>
                </div>
            </div>

            <!-- FAQ Section -->
            <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 8px; padding: 24px;">
                <h3 style="color: #60a5fa; margin-bottom: 20px;"><i class="fas fa-question-circle"></i> Frequently Asked Questions</h3>
                
                <div style="color: #e2e8f0;">
                    <details style="margin-bottom: 15px; cursor: pointer;">
                        <summary style="color: #3b82f6; font-weight: 600; padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                            How long do deposits take?
                        </summary>
                        <p style="padding: 15px; color: #cbd5e1; line-height: 1.6;">
                            Bitcoin deposits are credited after 1 confirmation (usually 10-30 minutes). Skrill and PayPal deposits are instant.
                        </p>
                    </details>

                    <details style="margin-bottom: 15px; cursor: pointer;">
                        <summary style="color: #3b82f6; font-weight: 600; padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                            What are the withdrawal limits?
                        </summary>
                        <p style="padding: 15px; color: #cbd5e1; line-height: 1.6;">
                            Minimum withdrawal is $20 USD. Maximum is $50,000 per transaction. VIP members have higher limits.
                        </p>
                    </details>

                    <details style="margin-bottom: 15px; cursor: pointer;">
                        <summary style="color: #3b82f6; font-weight: 600; padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                            Can I cancel a bet after placing it?
                        </summary>
                        <p style="padding: 15px; color: #cbd5e1; line-height: 1.6;">
                            Yes, you can cancel bets before the match starts. Once the match begins, bets are locked and cannot be cancelled.
                        </p>
                    </details>

                    <details style="margin-bottom: 15px; cursor: pointer;">
                        <summary style="color: #3b82f6; font-weight: 600; padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                            Is my Bitcoin safe on ABKBet?
                        </summary>
                        <p style="padding: 15px; color: #cbd5e1; line-height: 1.6;">
                            Yes, we use industry-standard security including cold storage for 95% of funds and multi-signature wallets.
                        </p>
                    </details>

                    <details style="margin-bottom: 15px; cursor: pointer;">
                        <summary style="color: #3b82f6; font-weight: 600; padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                            How do I claim my welcome bonus?
                        </summary>
                        <p style="padding: 15px; color: #cbd5e1; line-height: 1.6;">
                            The 100% welcome bonus is automatically applied to your first deposit. Minimum deposit of $20 required.
                        </p>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/abkbet-client.js?v=2"></script>
    <style>
        /* Hero styles (deep blue + soft yellow palette) - SCOPED TO MATCHES TAB ONLY */
        :root { --deep-blue: #071227; --panel-blue: #0b2140; --soft-yellow: #ffd966; --muted: #94a3b8; }
        /* Reduced hero for compact view */
        #matches .hero {
            display: grid;
            grid-template-columns: 1fr 260px;
            gap: 18px;
            align-items: center;
            padding: 18px;
            margin-bottom: 12px;
            background: 
                linear-gradient(180deg, rgba(7, 18, 39, 0.65) 0%, rgba(11, 33, 64, 0.55) 100%),
                url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=1200&q=80') center/cover;
            border-radius: 8px;
            border: 1px solid rgba(255, 217, 102, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            filter: brightness(1.1) contrast(1.15);
        }
        #matches .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(7, 18, 39, 0.5) 0%, rgba(11, 33, 64, 0.35) 50%, rgba(7, 18, 39, 0.6) 100%);
            z-index: 0;
            pointer-events: none;
        }
        #matches .hero-left,
        #matches .hero-right {
            position: relative;
            z-index: 1;
        }
        #matches .hero-left h1 { margin:0; color:var(--soft-yellow); font-size:22px; letter-spacing:0.2px; }
        #matches .hero-left p { color:var(--muted); margin-top:6px; max-width:440px; font-size:13px; }
        #matches .hero-cta { margin-top:10px; display:flex; gap:10px; }
        #matches .btn-primary { background: linear-gradient(90deg, var(--soft-yellow), #ffd25a); color: #071227; padding:8px 12px; border-radius:8px; font-weight:800; border:none; cursor:pointer; box-shadow: 0 6px 18px rgba(13,37,68,0.18); }
        #matches .btn-ghost { background:transparent; color:var(--muted); padding:8px 10px; border-radius:8px; border:1px solid rgba(148,163,184,0.06); cursor:pointer; }
        
        /* Load Code in Hero */
        .hero-load-code { 
            margin-top: 16px; 
            padding: 12px; 
            background: rgba(30, 64, 175, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-radius: 10px;
            max-width: 380px;
        }
        .load-code-label { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            color: var(--soft-yellow); 
            font-size: 13px; 
            font-weight: 700; 
            margin-bottom: 8px;
        }
        .load-code-label i { color: var(--soft-yellow); font-size: 14px; }
        .load-code-input-wrapper { display: flex; gap: 8px; align-items: center; }
        .load-code-input { 
            flex: 1; 
            padding: 10px 14px; 
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px; 
            color: #e2e8f0; 
            font-size: 14px; 
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            outline: none;
            transition: all 0.3s ease;
        }
        .load-code-input:focus { 
            border-color: var(--soft-yellow); 
            background: rgba(15, 23, 42, 0.8);
            box-shadow: 0 0 0 3px rgba(255, 217, 102, 0.1);
        }
        .load-code-input::placeholder { color: rgba(148, 163, 184, 0.5); text-transform: none; letter-spacing: normal; }
        .load-code-btn { 
            padding: 10px 18px; 
            background: linear-gradient(90deg, var(--soft-yellow), #ffd25a);
            color: #071227; 
            border: none; 
            border-radius: 8px; 
            font-weight: 800; 
            font-size: 13px;
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255, 217, 102, 0.2);
        }
        .load-code-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 16px rgba(255, 217, 102, 0.3);
        }
        .load-code-btn:active { transform: translateY(0); }
        #matches .hero-right { display:flex; justify-content:center; align-items:center; }
        #matches .hero-illustration { width:260px; height:160px; border-radius:10px; overflow:hidden; box-shadow: 0 8px 28px rgba(2,6,23,0.45); border: 1px solid rgba(255,217,102,0.04); background: linear-gradient(180deg, rgba(11,33,64,0.12), rgba(7,18,39,0.06)); }
        
        /* Promotional Carousel */
        .promo-carousel {
            width: 300px;
            height: 180px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .promo-slides {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .promo-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 0;
            transform: translateX(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }
        .promo-slide.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }
        .promo-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(251, 191, 36, 0.9);
            color: #000;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            width: fit-content;
        }
        .promo-title {
            font-size: 20px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 6px;
            line-height: 1.2;
        }
        .promo-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 12px;
        }
        .promo-date {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 16px;
        }
        .promo-date i {
            font-size: 13px;
        }
        .promo-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            font-size: 12px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .promo-action:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(2px);
        }
        .promo-indicators {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }
        .promo-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .promo-indicator.active {
            width: 24px;
            border-radius: 4px;
            background: rgba(251, 191, 36, 0.9);
        }
        
        @media (max-width: 900px) {
            #matches .hero { grid-template-columns: 1fr; text-align:center; padding: 15px 12px; }
            #matches .hero-right { order:-1; }
            #matches .hero-illustration { width:220px; height:140px; margin:0 auto; }
            .promo-carousel {
                width: 100%;
                max-width: 340px;
                height: 160px;
                margin: 0 auto;
            }
            .promo-title {
                font-size: 18px;
            }
            .promo-subtitle {
                font-size: 13px;
            }
            #matches .hero-left { text-align: left; }
            .hero-load-code { 
                max-width: 100%; 
                margin: 16px 0 0 0; 
                padding: 10px;
            }
            .load-code-label { 
                justify-content: flex-start; 
                font-size: 12px;
                margin-bottom: 6px;
            }
            .load-code-input { 
                padding: 8px 10px; 
                font-size: 13px;
            }
            .load-code-btn { 
                padding: 8px 14px; 
                font-size: 12px;
                white-space: nowrap;
            }
            .load-code-btn span { display: none; }
            .load-code-btn i { margin: 0; }
        }
        /* Pulse + confetti */
        @keyframes pulse {
            0% { transform: translateY(0) scale(1); box-shadow: 0 8px 24px rgba(13,37,68,0.18); }
            50% { transform: translateY(-3px) scale(1.02); box-shadow: 0 14px 36px rgba(13,37,68,0.22); }
            100% { transform: translateY(0) scale(1); box-shadow: 0 8px 24px rgba(13,37,68,0.18); }
        }
        .btn-primary.pulse { animation: pulse 1800ms ease-in-out infinite; }
        .confetti-piece { position: absolute; width:8px; height:12px; opacity:0; pointer-events:none; transform: translateY(0) rotate(0deg); border-radius:2px; }
        .confetti-wrap { position: absolute; left:0; right:0; top:0; bottom:0; overflow:visible; pointer-events:none; }
        @keyframes confetti-fall {
            0% { opacity: 1; transform: translateY(-10px) rotate(0deg); }
            100% { opacity: 0; transform: translateY(220px) rotate(360deg); }
        }
    </style>

    <script>
        const client = new ABKBetClient();
        
        // Initialize session on page load
        (async function initSession() {
            // Wait for session restoration
            if (client.token) {
                await client.restoreSession();
            }
            // Update UI based on login state
            if (typeof updateAuthUI === 'function') {
                updateAuthUI();
            }
        })();
        
        // Deposit system variables - declare at top to avoid hoisting issues
        let selectedPaymentMethod = null;
        let depositAmount = 0;
        
        const leagues = [
            { id: 'all', name: 'All' },
            { id: 'pl', name: 'ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Premier League' },
            { id: 'la', name: 'ðŸ‡ªðŸ‡¸ La Liga' },
            { id: 'ser', name: 'ðŸ‡®ðŸ‡¹ Serie A' },
            { id: 'bun', name: 'ðŸ‡©ðŸ‡ª Bundesliga' },
            { id: 'ligue', name: 'ðŸ‡«ðŸ‡· Ligue 1' },
            { id: 'ucl', name: 'ðŸ† Champions League' },
            { id: 'nfl', name: 'ðŸˆ NFL' },
            { id: 'nba', name: 'ðŸ€ NBA' },
            { id: 'mlb', name: 'âš¾ MLB' },
            { id: 'manual', name: 'ðŸŒ Rest of the World' }
        ];

        let currentLeague = 'all';
        let selectedMatch = null;
        let selectedOdd = null;

        // Enhanced matches database with 30+ matches across multiple sports
        const matches = [
            // Premier League (5 matches)
            { id: 1, league: 'pl', leagueName: 'Premier League', home: 'Manchester United', away: 'Liverpool', time: '15:00', date: '2025-12-18', status: 'scheduled', odds: { home: 2.10, draw: 3.50, away: 3.20, gg: 1.80, ng: 2.10, over1: 1.45, under1: 2.85, over2: 1.85, under2: 2.05, over3: 2.50, under3: 1.55, ah1: 1.95, ah0: 1.90, dc12: 1.25, dc1x: 1.80, dcx2: 2.15, htft_1x: 3.50, htft_x2: 4.20, cs_10: 5.00, cs_20: 8.50, cs_21: 9.00 } },
            { id: 2, league: 'pl', leagueName: 'Premier League', home: 'Arsenal', away: 'Chelsea', time: '17:30', date: '2025-12-18', status: 'scheduled', odds: { home: 1.95, draw: 3.60, away: 3.60, gg: 1.75, ng: 2.20, over1: 1.50, under1: 2.70, over2: 1.80, under2: 2.10, over3: 2.45, under3: 1.60, ah1: 1.88, ah0: 1.98, dc12: 1.30, dc1x: 1.75, dcx2: 2.10, htft_1x: 3.40, htft_x2: 4.10, cs_10: 4.80, cs_20: 8.00, cs_21: 8.50 } },
            { id: 3, league: 'pl', leagueName: 'Premier League', home: 'Manchester City', away: 'Tottenham', time: '20:00', date: '2025-12-18', status: 'scheduled', odds: { home: 1.50, draw: 4.20, away: 6.00, gg: 1.65, ng: 2.40, over1: 1.30, under1: 3.50, over2: 1.70, under2: 2.20, over3: 2.30, under3: 1.75, ah1: 1.42, ah0: 2.70, dc12: 1.15, dc1x: 1.55, dcx2: 3.10, htft_1x: 2.80, htft_x2: 5.50, cs_10: 3.50, cs_20: 5.50, cs_21: 6.50 } },
            { id: 4, league: 'pl', leagueName: 'Premier League', home: 'Newcastle', away: 'Brighton', time: '12:30', date: '2025-12-18', status: 'scheduled', odds: { home: 2.05, draw: 3.40, away: 3.50, gg: 1.70, ng: 2.30, over1: 1.48, under1: 2.75, over2: 1.88, under2: 2.02, over3: 2.55, under3: 1.52, ah1: 1.98, ah0: 1.92, dc12: 1.28, dc1x: 1.78, dcx2: 2.12, htft_1x: 3.60, htft_x2: 4.00, cs_10: 5.20, cs_20: 8.80, cs_21: 9.50 } },
            { id: 5, league: 'pl', leagueName: 'Premier League', home: 'Aston Villa', away: 'West Ham', time: '19:45', date: '2025-12-18', status: 'scheduled', odds: { home: 1.85, draw: 3.70, away: 4.10, gg: 1.72, ng: 2.35, over1: 1.42, under1: 2.95, over2: 1.82, under2: 2.08, over3: 2.40, under3: 1.68, ah1: 1.80, ah0: 2.05, dc12: 1.22, dc1x: 1.70, dcx2: 2.30, htft_1x: 3.20, htft_x2: 4.50, cs_10: 4.50, cs_20: 7.50, cs_21: 8.00 } },
            
            // La Liga (4 matches)
            { id: 6, league: 'la', leagueName: 'La Liga', home: 'Barcelona', away: 'Real Madrid', time: '20:45', date: '2025-12-18', status: 'scheduled', odds: { home: 2.55, draw: 3.20, away: 2.75, gg: 1.88, ng: 2.00, over1: 1.52, under1: 2.60, over2: 1.92, under2: 1.95, over3: 2.65, under3: 1.48, ah1: 2.45, ah0: 1.60, dc12: 1.35, dc1x: 1.90, dcx2: 1.95, htft_1x: 3.80, htft_x2: 3.70, cs_10: 5.50, cs_20: 9.00, cs_21: 9.50 } },
            { id: 7, league: 'la', leagueName: 'La Liga', home: 'Atletico Madrid', away: 'Sevilla', time: '18:00', date: '2025-12-18', status: 'scheduled', odds: { home: 1.80, draw: 3.50, away: 4.20, gg: 1.65, ng: 2.50, over1: 1.40, under1: 3.00, over2: 1.75, under2: 2.15, over3: 2.35, under3: 1.70, ah1: 1.75, ah0: 2.10, dc12: 1.20, dc1x: 1.62, dcx2: 2.40, htft_1x: 3.10, htft_x2: 4.80, cs_10: 4.20, cs_20: 7.00, cs_21: 7.50 } },
            { id: 8, league: 'la', leagueName: 'La Liga', home: 'Valencia', away: 'Villarreal', time: '16:00', date: '2025-12-18', status: 'scheduled', odds: { home: 2.00, draw: 3.40, away: 3.80, gg: 1.68, ng: 2.40, over1: 1.46, under1: 2.80, over2: 1.80, under2: 2.10, over3: 2.50, under3: 1.58, ah1: 1.92, ah0: 1.98, dc12: 1.26, dc1x: 1.74, dcx2: 2.20, htft_1x: 3.50, htft_x2: 4.20, cs_10: 5.00, cs_20: 8.50, cs_21: 9.00 } },
            { id: 9, league: 'la', leagueName: 'La Liga', home: 'Real Sociedad', away: 'Betis', time: '21:00', date: '2025-12-18', status: 'scheduled', odds: { home: 2.20, draw: 3.30, away: 3.40, gg: 1.70, ng: 2.32, over1: 1.44, under1: 2.90, over2: 1.85, under2: 2.05, over3: 2.58, under3: 1.50, ah1: 2.10, ah0: 1.85, dc12: 1.32, dc1x: 1.82, dcx2: 2.05, htft_1x: 3.70, htft_x2: 3.90, cs_10: 5.25, cs_20: 9.00, cs_21: 9.50 } },
            
            // Serie A (4 matches)
            { id: 10, league: 'ser', leagueName: 'Serie A', home: 'AC Milan', away: 'Inter Milan', time: '18:00', date: '2025-12-18', status: 'scheduled', odds: { home: 2.30, draw: 3.40, away: 3.00, gg: 1.90, ng: 1.98, over1: 1.50, under1: 2.70, over2: 1.95, under2: 1.95, over3: 2.60, under3: 1.52, ah1: 2.20, ah0: 1.77, dc12: 1.33, dc1x: 1.88, dcx2: 2.00, htft_1x: 3.70, htft_x2: 3.85, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            { id: 11, league: 'ser', leagueName: 'Serie A', home: 'Juventus', away: 'Napoli', time: '20:45', date: '2025-12-18', status: 'scheduled', odds: { home: 2.00, draw: 3.60, away: 3.75, gg: 1.72, ng: 2.18, over1: 1.44, under1: 2.88, over2: 1.88, under2: 2.02, over3: 2.48, under3: 1.58, ah1: 1.92, ah0: 2.00, dc12: 1.28, dc1x: 1.80, dcx2: 2.15, htft_1x: 3.50, htft_x2: 4.10, cs_10: 5.00, cs_20: 8.50, cs_21: 9.00 } },
            { id: 12, league: 'ser', leagueName: 'Serie A', home: 'Roma', away: 'Lazio', time: '19:00', date: '2025-12-18', status: 'scheduled', odds: { home: 1.95, draw: 3.50, away: 3.90, gg: 1.70, ng: 2.25, over1: 1.42, under1: 2.95, over2: 1.82, under2: 2.08, over3: 2.42, under3: 1.65, ah1: 1.88, ah0: 2.05, dc12: 1.25, dc1x: 1.75, dcx2: 2.20, htft_1x: 3.35, htft_x2: 4.25, cs_10: 4.80, cs_20: 8.00, cs_21: 8.50 } },
            { id: 13, league: 'ser', leagueName: 'Serie A', home: 'Fiorentina', away: 'Atalanta', time: '15:00', date: '2025-12-18', status: 'scheduled', odds: { home: 2.40, draw: 3.20, away: 3.10, gg: 1.88, ng: 2.00, over1: 1.54, under1: 2.55, over2: 1.92, under2: 1.95, over3: 2.68, under3: 1.46, ah1: 2.30, ah0: 1.68, dc12: 1.37, dc1x: 1.95, dcx2: 1.90, htft_1x: 3.90, htft_x2: 3.60, cs_10: 5.60, cs_20: 9.50, cs_21: 10.00 } },
            
            // Bundesliga (4 matches)
            { id: 14, league: 'bun', leagueName: 'Bundesliga', home: 'Bayern Munich', away: 'Borussia Dortmund', time: '19:30', date: '2025-12-18', status: 'scheduled', odds: { home: 1.70, draw: 3.80, away: 5.00, gg: 1.55, ng: 2.80, over1: 1.32, under1: 3.45, over2: 1.60, under2: 2.35, over3: 2.30, under3: 1.75, ah1: 1.65, ah0: 2.40, dc12: 1.18, dc1x: 1.50, dcx2: 2.90, htft_1x: 2.75, htft_x2: 5.25, cs_10: 3.40, cs_20: 5.25, cs_21: 6.25 } },
            { id: 15, league: 'bun', leagueName: 'Bundesliga', home: 'RB Leipzig', away: 'Bayer Leverkusen', time: '15:30', date: '2025-12-18', status: 'scheduled', odds: { home: 2.20, draw: 3.30, away: 3.20, gg: 1.80, ng: 2.10, over1: 1.48, under1: 2.75, over2: 1.88, under2: 2.00, over3: 2.55, under3: 1.52, ah1: 2.10, ah0: 1.88, dc12: 1.28, dc1x: 1.78, dcx2: 2.12, htft_1x: 3.60, htft_x2: 4.00, cs_10: 5.20, cs_20: 8.80, cs_21: 9.50 } },
            { id: 16, league: 'bun', leagueName: 'Bundesliga', home: 'Stuttgart', away: 'Borussia Monchengladbach', time: '17:00', date: '2025-12-18', status: 'scheduled', odds: { home: 1.90, draw: 3.60, away: 3.70, gg: 1.75, ng: 2.15, over1: 1.46, under1: 2.80, over2: 1.85, under2: 2.05, over3: 2.50, under3: 1.58, ah1: 1.82, ah0: 2.12, dc12: 1.24, dc1x: 1.72, dcx2: 2.25, htft_1x: 3.40, htft_x2: 4.40, cs_10: 4.80, cs_20: 8.00, cs_21: 8.50 } },
            { id: 17, league: 'bun', leagueName: 'Bundesliga', home: 'Union Berlin', away: 'Cologne', time: '20:30', date: '2025-12-18', status: 'scheduled', odds: { home: 2.15, draw: 3.40, away: 3.30, gg: 1.78, ng: 2.12, over1: 1.50, under1: 2.70, over2: 1.90, under2: 1.98, over3: 2.58, under3: 1.50, ah1: 2.05, ah0: 1.90, dc12: 1.31, dc1x: 1.85, dcx2: 2.05, htft_1x: 3.75, htft_x2: 3.95, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            
            // Ligue 1 (3 matches)
            { id: 18, league: 'ligue', leagueName: 'Ligue 1', home: 'Paris Saint-Germain', away: 'Marseille', time: '20:45', date: '2025-12-19', status: 'scheduled', odds: { home: 1.55, draw: 4.00, away: 5.50, gg: 1.42, ng: 3.20, over1: 1.28, under1: 3.60, over2: 1.50, under2: 2.60, over3: 2.20, under3: 1.85, ah1: 1.50, ah0: 2.70, dc12: 1.12, dc1x: 1.38, dcx2: 3.40, htft_1x: 2.55, htft_x2: 5.80, cs_10: 2.80, cs_20: 4.20, cs_21: 5.00 } },
            { id: 19, league: 'ligue', leagueName: 'Ligue 1', home: 'Monaco', away: 'Lyon', time: '18:00', date: '2025-12-19', status: 'scheduled', odds: { home: 2.10, draw: 3.50, away: 3.30, gg: 1.82, ng: 2.08, over1: 1.46, under1: 2.80, over2: 1.90, under2: 1.98, over3: 2.55, under3: 1.52, ah1: 2.00, ah0: 1.92, dc12: 1.30, dc1x: 1.80, dcx2: 2.10, htft_1x: 3.60, htft_x2: 4.05, cs_10: 5.30, cs_20: 8.90, cs_21: 9.50 } },
            { id: 20, league: 'ligue', leagueName: 'Ligue 1', home: 'Lens', away: 'Lille', time: '19:00', date: '2025-12-19', status: 'scheduled', odds: { home: 2.30, draw: 3.40, away: 3.00, gg: 1.85, ng: 2.05, over1: 1.52, under1: 2.60, over2: 1.92, under2: 1.95, over3: 2.65, under3: 1.48, ah1: 2.20, ah0: 1.78, dc12: 1.35, dc1x: 1.90, dcx2: 1.95, htft_1x: 3.80, htft_x2: 3.70, cs_10: 5.50, cs_20: 9.00, cs_21: 9.50 } },
            
            // Champions League (4 matches)
            { id: 21, league: 'ucl', leagueName: 'Champions League', home: 'Bayern Munich', away: 'PSG', time: '20:00', date: '2025-12-19', status: 'scheduled', odds: { home: 2.00, draw: 3.50, away: 3.50, gg: 1.88, ng: 2.00, over1: 1.50, under1: 2.70, over2: 1.95, under2: 1.93, over3: 2.60, under3: 1.52, ah1: 1.92, ah0: 2.00, dc12: 1.33, dc1x: 1.88, dcx2: 2.00, htft_1x: 3.70, htft_x2: 3.85, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            { id: 22, league: 'ucl', leagueName: 'Champions League', home: 'Manchester City', away: 'Real Madrid', time: '20:00', date: '2025-12-19', status: 'scheduled', odds: { home: 1.85, draw: 3.70, away: 4.00, gg: 1.80, ng: 2.15, over1: 1.44, under1: 2.90, over2: 1.88, under2: 2.02, over3: 2.48, under3: 1.58, ah1: 1.78, ah0: 2.18, dc12: 1.25, dc1x: 1.75, dcx2: 2.20, htft_1x: 3.35, htft_x2: 4.25, cs_10: 4.80, cs_20: 8.00, cs_21: 8.50 } },
            { id: 23, league: 'ucl', leagueName: 'Champions League', home: 'Liverpool', away: 'Inter Milan', time: '20:00', date: '2025-12-19', status: 'scheduled', odds: { home: 2.10, draw: 3.40, away: 3.30, gg: 1.85, ng: 2.05, over1: 1.48, under1: 2.75, over2: 1.92, under2: 1.95, over3: 2.55, under3: 1.52, ah1: 2.02, ah0: 1.90, dc12: 1.31, dc1x: 1.85, dcx2: 2.05, htft_1x: 3.75, htft_x2: 3.95, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            { id: 24, league: 'ucl', leagueName: 'Champions League', home: 'Barcelona', away: 'Juventus', time: '20:00', date: '2025-12-19', status: 'scheduled', odds: { home: 1.95, draw: 3.50, away: 3.80, gg: 1.82, ng: 2.10, over1: 1.46, under1: 2.80, over2: 1.90, under2: 1.98, over3: 2.50, under3: 1.58, ah1: 1.88, ah0: 2.08, dc12: 1.27, dc1x: 1.78, dcx2: 2.15, htft_1x: 3.55, htft_x2: 4.15, cs_10: 5.10, cs_20: 8.60, cs_21: 9.10 } },
            
            // NFL (5 matches)
            { id: 25, league: 'nfl', home: 'Kansas City Chiefs', away: 'Buffalo Bills', time: '13:30', date: '2025-12-18', odds: { home: 1.95, draw: 21.00, away: 1.95, gg: 1.85, ng: 2.10, over1: 1.48, under1: 2.75, over2: 1.92, under2: 1.95, over3: 2.65, under3: 1.48, ah1: 1.88, ah0: 2.05, dc12: 1.32, dc1x: 1.82, dcx2: 1.95, htft_1x: 3.65, htft_x2: 3.80, cs_10: 5.35, cs_20: 8.95, cs_21: 9.45 } },
            { id: 26, league: 'nfl', home: 'Dallas Cowboys', away: 'New York Giants', time: '16:00', date: '2025-12-18', odds: { home: 1.72, draw: 21.00, away: 2.15, gg: 1.68, ng: 2.35, over1: 1.40, under1: 2.95, over2: 1.80, under2: 2.10, over3: 2.40, under3: 1.68, ah1: 1.65, ah0: 2.40, dc12: 1.20, dc1x: 1.62, dcx2: 2.40, htft_1x: 3.10, htft_x2: 4.80, cs_10: 4.20, cs_20: 7.00, cs_21: 7.50 } },
            { id: 27, league: 'nfl', home: 'San Francisco 49ers', away: 'Seattle Seahawks', time: '16:25', date: '2025-12-18', odds: { home: 1.65, draw: 21.00, away: 2.30, gg: 1.60, ng: 2.50, over1: 1.35, under1: 3.20, over2: 1.75, under2: 2.20, over3: 2.30, under3: 1.80, ah1: 1.58, ah0: 2.50, dc12: 1.16, dc1x: 1.50, dcx2: 2.95, htft_1x: 2.80, htft_x2: 5.40, cs_10: 3.50, cs_20: 5.40, cs_21: 6.30 } },
            { id: 28, league: 'nfl', home: 'Cincinnati Bengals', away: 'Pittsburgh Steelers', time: '20:20', date: '2025-12-18', odds: { home: 1.88, draw: 21.00, away: 2.00, gg: 1.80, ng: 2.15, over1: 1.46, under1: 2.80, over2: 1.88, under2: 2.02, over3: 2.48, under3: 1.58, ah1: 1.82, ah0: 2.18, dc12: 1.28, dc1x: 1.80, dcx2: 2.15, htft_1x: 3.50, htft_x2: 4.10, cs_10: 5.00, cs_20: 8.50, cs_21: 9.00 } },
            { id: 29, league: 'nfl', home: 'Green Bay Packers', away: 'Chicago Bears', time: '13:00', date: '2025-12-19', odds: { home: 1.80, draw: 21.00, away: 2.05, gg: 1.75, ng: 2.25, over1: 1.44, under1: 2.90, over2: 1.85, under2: 2.08, over3: 2.42, under3: 1.65, ah1: 1.72, ah0: 2.35, dc12: 1.25, dc1x: 1.75, dcx2: 2.20, htft_1x: 3.35, htft_x2: 4.25, cs_10: 4.80, cs_20: 8.00, cs_21: 8.50 } },
            
            // NBA (5 matches)
            { id: 30, league: 'nba', home: 'Los Angeles Lakers', away: 'Boston Celtics', time: '19:30', date: '2025-12-18', odds: { home: 1.95, draw: 21.00, away: 1.85, gg: 1.88, ng: 2.05, over1: 1.50, under1: 2.70, over2: 1.92, under2: 1.95, over3: 2.60, under3: 1.52, ah1: 1.90, ah0: 2.00, dc12: 1.33, dc1x: 1.88, dcx2: 2.00, htft_1x: 3.70, htft_x2: 3.85, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            { id: 31, league: 'nba', home: 'Golden State Warriors', away: 'Denver Nuggets', time: '21:30', date: '2025-12-18', odds: { home: 1.90, draw: 21.00, away: 1.90, gg: 1.85, ng: 2.08, over1: 1.48, under1: 2.75, over2: 1.90, under2: 1.98, over3: 2.55, under3: 1.52, ah1: 1.88, ah0: 2.00, dc12: 1.31, dc1x: 1.85, dcx2: 2.05, htft_1x: 3.75, htft_x2: 3.95, cs_10: 5.40, cs_20: 9.00, cs_21: 9.50 } },
            { id: 32, league: 'nba', home: 'Miami Heat', away: 'New York Knicks', time: '19:00', date: '2025-12-18', odds: { home: 2.00, draw: 21.00, away: 1.80, gg: 1.92, ng: 2.00, over1: 1.52, under1: 2.60, over2: 1.95, under2: 1.93, over3: 2.65, under3: 1.48, ah1: 1.95, ah0: 1.95, dc12: 1.35, dc1x: 1.90, dcx2: 1.95, htft_1x: 3.80, htft_x2: 3.70, cs_10: 5.50, cs_20: 9.00, cs_21: 9.50 } },
            { id: 33, league: 'nba', home: 'LA Clippers', away: 'Phoenix Suns', time: '22:00', date: '2025-12-18', odds: { home: 1.88, draw: 21.00, away: 1.92, gg: 1.82, ng: 2.12, over1: 1.46, under1: 2.80, over2: 1.88, under2: 2.02, over3: 2.48, under3: 1.58, ah1: 1.85, ah0: 2.05, dc12: 1.28, dc1x: 1.80, dcx2: 2.10, htft_1x: 3.60, htft_x2: 4.05, cs_10: 5.30, cs_20: 8.90, cs_21: 9.50 } },
            { id: 34, league: 'nba', home: 'Milwaukee Bucks', away: 'Chicago Bulls', time: '20:00', date: '2025-12-19', odds: { home: 1.55, draw: 21.00, away: 2.40, gg: 1.48, ng: 2.85, over1: 1.28, under1: 3.60, over2: 1.60, under2: 2.40, over3: 2.20, under3: 1.85, ah1: 1.50, ah0: 2.65, dc12: 1.12, dc1x: 1.38, dcx2: 3.40, htft_1x: 2.55, htft_x2: 5.80, cs_10: 2.80, cs_20: 4.20, cs_21: 5.00 } },
            
            // MLB (3 matches)
            { id: 35, league: 'mlb', home: 'New York Yankees', away: 'Boston Red Sox', time: '19:00', date: '2025-12-18', odds: { home: 1.88, draw: 21.00, away: 1.88, gg: 1.82, ng: 2.10, over1: 1.44, under1: 2.90, over2: 1.90, under2: 1.98, over3: 2.50, under3: 1.58, ah1: 1.85, ah0: 2.05, dc12: 1.27, dc1x: 1.78, dcx2: 2.15, htft_1x: 3.55, htft_x2: 4.15, cs_10: 5.10, cs_20: 8.60, cs_21: 9.10 } },
            { id: 36, league: 'mlb', home: 'Los Angeles Dodgers', away: 'San Francisco Giants', time: '22:00', date: '2025-12-18', odds: { home: 1.72, draw: 21.00, away: 2.15, gg: 1.68, ng: 2.35, over1: 1.40, under1: 2.95, over2: 1.80, under2: 2.10, over3: 2.40, under3: 1.68, ah1: 1.65, ah0: 2.40, dc12: 1.20, dc1x: 1.62, dcx2: 2.40, htft_1x: 3.10, htft_x2: 4.80, cs_10: 4.20, cs_20: 7.00, cs_21: 7.50 } },
            { id: 37, league: 'mlb', home: 'Houston Astros', away: 'Atlanta Braves', time: '20:00', date: '2025-12-19', odds: { home: 1.85, draw: 21.00, away: 1.95, gg: 1.78, ng: 2.18, over1: 1.46, under1: 2.80, over2: 1.88, under2: 2.02, over3: 2.48, under3: 1.58, ah1: 1.80, ah0: 2.15, dc12: 1.26, dc1x: 1.74, dcx2: 2.20, htft_1x: 3.50, htft_x2: 4.20, cs_10: 5.00, cs_20: 8.50, cs_21: 9.00 } }
        ];

        function btcToUsd(usd) { return usd; }  // Already in USD after migration
        function usdToBtc(usd) { return usd; }  // Already in USD after migration
        function formatUsd(usd) { return `$${usd.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` }
        function formatBtc(btc) { return `â‚¿${btc.toFixed(8)}`; }

        // Update balance in UI after game results
        function updateBalanceUI(newBalance) {
            if (typeof newBalance === 'number') {
                // Update client.user if exists
                if (client && client.user) {
                    client.user.balance = newBalance;
                }
                // Update balance displays
                document.getElementById('headerBalance').textContent = `Balance: ${formatUsd(newBalance)}`;
                const profileBalance = document.getElementById('profileBalance');
                if (profileBalance) {
                    profileBalance.textContent = formatUsd(newBalance);
                }
            }
        }

        function showMessage(message, type = 'success') {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            box.className = `message active ${type}`;
            setTimeout(() => box.classList.remove('active'), 5000);
        }

        function toggleAccountDropdown() {
            const dropdown = document.getElementById('accountDropdown');
            dropdown.classList.toggle('show');
        }

        function closeAccountDropdown() {
            const dropdown = document.getElementById('accountDropdown');
            dropdown.classList.remove('show');
        }

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.account-btn') && !event.target.closest('.account-btn')) {
                closeAccountDropdown();
            }
        }

        function switchTab(tab) {
            // Check if user is logged in for restricted tabs
            if (!client.isLoggedIn() && tab !== 'matches' && tab !== 'auth') {
                showMessage('Please login to access this section', 'error');
                switchTab('auth');
                return;
            }
            
            // Clear cashout update interval when leaving mybets tab
            if (cashoutUpdateInterval) {
                clearInterval(cashoutUpdateInterval);
                cashoutUpdateInterval = null;
            }
            
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
            
            // Show security badges only on matches page
            const securityBadges = document.getElementById('securityBadges');
            if (securityBadges) {
                securityBadges.style.display = (tab === 'matches') ? 'block' : 'none';
            }

            if (tab === 'matches') loadMatches();
            else if (tab === 'mybets') {
                // Ensure active sub-tab is selected
                currentMyBetsTab = 'active';
                document.querySelectorAll('.mybets-subtab').forEach(btn => btn.classList.remove('active'));
                const activeBtn = document.getElementById('subtab-active');
                if (activeBtn) activeBtn.classList.add('active');
                loadMyBets();
            }
            else if (tab === 'premium') loadMyPremiumBookings();
            else if (tab === 'virtual') loadVirtualGames();
            else if (tab === 'wallet') loadWallet();
            else if (tab === 'stats') loadStats();
            else if (tab === 'auth' && client.isLoggedIn()) refreshUserBalance();
        }

        function initializeLeagueSelector() {
            const mobileSelector = document.getElementById('mobileLeagueSelector');
            const desktopSelector = document.getElementById('desktopLeagueSelector');
            if (!mobileSelector && !desktopSelector) return;
            
            // Use dropdown categories for both mobile and desktop
            const categories = [
                    {
                        title: 'âš¡ Quick Filters',
                        icon: 'fas fa-bolt',
                        leagues: [
                            { name: 'ðŸ”´ Live', filter: 'live' },
                            { name: 'All Matches', filter: 'all' }
                        ]
                    },
                    {
                        title: 'ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ England',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Premier League', filter: 'premier' },
                            { name: 'Championship', filter: 'championship' },
                            { name: 'League One', filter: 'leagueone' },
                            { name: 'League Two', filter: 'leaguetwo' }
                        ]
                    },
                    {
                        title: 'ðŸ‡ªðŸ‡¸ Spain',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'La Liga', filter: 'laliga' },
                            { name: 'La Liga 2', filter: 'laliga2' }
                        ]
                    },
                    {
                        title: 'ðŸ‡©ðŸ‡ª Germany',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Bundesliga', filter: 'bundesliga' },
                            { name: 'Bundesliga 2', filter: 'bundesliga2' }
                        ]
                    },
                    {
                        title: 'ðŸ‡®ðŸ‡¹ Italy',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Serie A', filter: 'seriea' },
                            { name: 'Serie B', filter: 'serieb' }
                        ]
                    },
                    {
                        title: 'ðŸ‡«ðŸ‡· France',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Ligue 1', filter: 'ligue1' },
                            { name: 'Ligue 2', filter: 'ligue2' }
                        ]
                    },
                    {
                        title: 'ï¿½ðŸ‡¹ Portugal',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Primeira Liga', filter: 'primeiraliga' },
                            { name: 'Liga Portugal 2', filter: 'ligaportugal2' }
                        ]
                    },
                    {
                        title: 'ðŸ‡¦ðŸ‡· Argentina',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Primera DivisiÃ³n', filter: 'argentina' },
                            { name: 'Copa Argentina', filter: 'copaargentina' }
                        ]
                    },
                    {
                        title: 'ðŸ‡§ðŸ‡· Brazil',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'BrasileirÃ£o', filter: 'brasileirao' },
                            { name: 'Copa do Brasil', filter: 'copadobrasil' }
                        ]
                    },
                    {
                        title: 'ðŸ‡³ðŸ‡± Netherlands',
                        icon: 'fas fa-flag',
                        leagues: [
                            { name: 'Eredivisie', filter: 'eredivisie' },
                            { name: 'Eerste Divisie', filter: 'eerstdivisie' }
                        ]
                    },
                    {
                        title: 'ðŸ† Europe',
                        icon: 'fas fa-trophy',
                        leagues: [
                            { name: 'Champions League', filter: 'ucl' },
                            { name: 'Europa League', filter: 'europa' },
                            { name: 'Conference League', filter: 'conference' }
                        ]
                    },
                    {
                        title: 'ðŸ€ Basketball',
                        icon: 'fas fa-basketball-ball',
                        leagues: [
                            { name: 'NBA', filter: 'nba' },
                            { name: 'EuroLeague', filter: 'euroleague' },
                            { name: 'NCAA', filter: 'ncaa' }
                        ]
                    },
                    {
                        title: 'ðŸ’ Ice Hockey',
                        icon: 'fas fa-hockey-puck',
                        leagues: [
                            { name: 'NHL', filter: 'nhl' },
                            { name: 'KHL', filter: 'khl' },
                            { name: 'SHL', filter: 'shl' }
                        ]
                    },
                    {
                        title: 'ðŸ Volleyball',
                        icon: 'fas fa-volleyball-ball',
                        leagues: [
                            { name: 'CEV Champions League', filter: 'cev' },
                            { name: 'Italian SuperLega', filter: 'superlegavolley' },
                            { name: 'Brazilian Superliga', filter: 'superligavolley' }
                        ]
                    },
                    {
                        title: 'ðŸˆ American Football',
                        icon: 'fas fa-football-ball',
                        leagues: [
                            { name: 'NFL', filter: 'nfl' },
                            { name: 'NCAA Football', filter: 'ncaafootball' }
                        ]
                    },
                    {
                        title: 'ðŸŒ Others',
                        icon: 'fas fa-globe',
                        leagues: [
                            { name: 'Rest of World', filter: 'other' }
                        ]
                    }
                ];
            
            // Generate HTML for mobile selector
            let mobileHtml = '';
            categories.forEach((category, catIndex) => {
                mobileHtml += `
                    <div class="league-category">
                        <div class="league-category-header" onclick="toggleCategory('mobile-${catIndex}')">
                            <div class="league-category-title">
                                <i class="${category.icon}"></i>
                                <span>${category.title}</span>
                            </div>
                            <i class="fas fa-chevron-down league-category-arrow" id="arrow-mobile-${catIndex}"></i>
                        </div>
                        <div class="league-buttons" id="category-mobile-${catIndex}">
                `;
                
                category.leagues.forEach((league, index) => {
                    const matchCount = getMatchCountForLeague(league.filter);
                    const activeClass = (catIndex === 0 && index === 1) ? 'active' : '';
                    mobileHtml += `
                        <button class="league-btn ${activeClass}" onclick="filterLeague('${league.filter}', event)">
                            ${league.name}
                            <span class="league-btn-count">${matchCount}</span>
                        </button>
                    `;
                });
                
                mobileHtml += `
                        </div>
                    </div>
                `;
            });
            
            // Generate HTML for desktop selector with different IDs
            let desktopHtml = '';
            categories.forEach((category, catIndex) => {
                desktopHtml += `
                    <div class="league-category">
                        <div class="league-category-header" onclick="toggleCategory('desktop-${catIndex}')">
                            <div class="league-category-title">
                                <i class="${category.icon}"></i>
                                <span>${category.title}</span>
                            </div>
                            <i class="fas fa-chevron-down league-category-arrow" id="arrow-desktop-${catIndex}"></i>
                        </div>
                        <div class="league-buttons" id="category-desktop-${catIndex}">
                `;
                
                category.leagues.forEach((league, index) => {
                    const matchCount = getMatchCountForLeague(league.filter);
                    const activeClass = (catIndex === 0 && index === 1) ? 'active' : '';
                    desktopHtml += `
                        <button class="league-btn ${activeClass}" onclick="filterLeague('${league.filter}', event)">
                            ${league.name}
                            <span class="league-btn-count">${matchCount}</span>
                        </button>
                    `;
                });
                
                desktopHtml += `
                        </div>
                    </div>
                `;
            });
            
            // Populate both mobile and desktop selectors with unique IDs
            if (mobileSelector) mobileSelector.innerHTML = mobileHtml;
            if (desktopSelector) desktopSelector.innerHTML = desktopHtml;
            
            currentLeague = 'all';
        }
        
        function toggleCategory(id) {
            const isMobile = window.innerWidth <= 1024;
            const category = document.getElementById(`category-${id}`);
            const arrow = document.getElementById(`arrow-${id}`);
            
            if (category && arrow) {
                // On mobile, close other categories when opening a new one
                if (isMobile && !category.classList.contains('open')) {
                    document.querySelectorAll('.league-buttons.open').forEach(cat => {
                        if (cat.id !== `category-${id}`) {
                            cat.classList.remove('open');
                        }
                    });
                    document.querySelectorAll('.league-category-arrow.open').forEach(arr => {
                        if (arr.id !== `arrow-${id}`) {
                            arr.classList.remove('open');
                        }
                    });
                }
                
                category.classList.toggle('open');
                arrow.classList.toggle('open');
            }
        }
        
        function getMatchCountForLeague(filter) {
            if (!matches || matches.length === 0) return 0;
            
            if (filter === 'live') {
                return matches.filter(m => m.status === 'live').length;
            } else if (filter === 'all') {
                return matches.length;
            } else {
                return matches.filter(m => {
                    const leagueName = (m.leagueName || '').toLowerCase();
                    
                    if (filter === 'premier' && leagueName.includes('premier')) return true;
                    if (filter === 'championship' && leagueName.includes('championship')) return true;
                    if (filter === 'leagueone' && leagueName.includes('league one')) return true;
                    if (filter === 'leaguetwo' && leagueName.includes('league two')) return true;
                    if (filter === 'laliga' && leagueName.includes('la liga') && !leagueName.includes('2')) return true;
                    if (filter === 'laliga2' && leagueName.includes('la liga 2')) return true;
                    if (filter === 'ligue1' && (leagueName.includes('ligue 1') || leagueName.includes('ligue1')) && !leagueName.includes('2')) return true;
                    if (filter === 'ligue2' && leagueName.includes('ligue 2')) return true;
                    if (filter === 'bundesliga' && leagueName.includes('bundesliga') && !leagueName.includes('2')) return true;
                    if (filter === 'bundesliga2' && leagueName.includes('bundesliga 2')) return true;
                    if (filter === 'seriea' && leagueName.includes('serie a') && !leagueName.includes('b')) return true;
                    if (filter === 'serieb' && leagueName.includes('serie b')) return true;
                    if (filter === 'nba' && leagueName.includes('nba')) return true;
                    if (filter === 'euroleague' && leagueName.includes('euroleague')) return true;
                    if (filter === 'ucl' && leagueName.includes('champions')) return true;
                    if (filter === 'europa' && leagueName.includes('europa') && !leagueName.includes('conference')) return true;
                    if (filter === 'conference' && leagueName.includes('conference')) return true;
                    if (filter === 'other') {
                        return !leagueName.includes('premier') && 
                               !leagueName.includes('championship') &&
                               !leagueName.includes('la liga') && 
                               !leagueName.includes('ligue') && 
                               !leagueName.includes('bundesliga') && 
                               !leagueName.includes('serie') &&
                               !leagueName.includes('nba') &&
                               !leagueName.includes('euroleague') &&
                               !leagueName.includes('champions') &&
                               !leagueName.includes('europa') &&
                               !leagueName.includes('conference');
                    }
                    
                    return false;
                }).length;
            }
        }

        function filterLeague(leagueId, event) {
            if (event) {
                // Remove active class from all buttons
                document.querySelectorAll('.league-btn').forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                event.currentTarget.classList.add('active');
            }
            
            currentLeague = leagueId;
            displayMatches();
        }

        async function loadMatches() {
            try {
                console.log('Loading matches from API...');
                // Fetch all matches (both manual and API) from backend
                const response = await client.request('/bets/matches/manual?_t=' + Date.now());
                console.log('Matches API response:', response);
                
                if (response.matches && response.matches.length > 0) {
                    console.log(`Found ${response.matches.length} matches from API`);
                    // Convert API format to frontend format
                    matches.length = 0; // Clear existing matches
                    response.matches.forEach(match => {
                        console.log('Processing match:', match.home_team, 'vs', match.away_team, 'League:', match.league, 'Status:', match.status, 'Scores:', match.home_score, '-', match.away_score);
                        
                        // Get league name with fallback
                        const leagueName = match.league || 'Rest of World';
                        const leagueNameLower = leagueName.toLowerCase();
                        
                        // Map league name to league ID
                        let leagueId = 'manual'; // default to manual/rest of world
                        
                        if (leagueNameLower.includes('premier')) leagueId = 'pl';
                        else if (leagueNameLower.includes('la liga') || leagueNameLower.includes('spain')) leagueId = 'la';
                        else if (leagueNameLower.includes('serie') || leagueNameLower.includes('italy')) leagueId = 'ser';
                        else if (leagueNameLower.includes('bundesliga') || leagueNameLower.includes('germany')) leagueId = 'bun';
                        else if (leagueNameLower.includes('ligue') || leagueNameLower.includes('france')) leagueId = 'ligue';
                        else if (leagueNameLower.includes('champions')) leagueId = 'ucl';
                        else if (leagueNameLower.includes('europa')) leagueId = 'ucl';
                        else if (leagueNameLower.includes('nfl')) leagueId = 'nfl';
                        else if (leagueNameLower.includes('nba')) leagueId = 'nba';
                        else if (leagueNameLower.includes('mlb') || leagueNameLower.includes('baseball')) leagueId = 'mlb';
                        
                        console.log('Mapped league:', leagueName, '->', leagueId);
                        
                        // Determine sport type from API or infer from league name
                        let sportType = match.sport || 'Football';
                        if (!match.sport) {
                            // Infer sport from league name if not provided by API
                            if (leagueNameLower.includes('nba') || leagueNameLower.includes('basketball')) sportType = 'Basketball';
                            else if (leagueNameLower.includes('nfl') || leagueNameLower.includes('american football')) sportType = 'NFL';
                            else if (leagueNameLower.includes('nhl') || leagueNameLower.includes('hockey')) sportType = 'Hockey';
                            else if (leagueNameLower.includes('mlb') || leagueNameLower.includes('baseball')) sportType = 'Baseball';
                        }
                        console.log('Sport type:', sportType);
                        
                        matches.push({
                            id: match.id,
                            league: leagueId,
                            leagueName: leagueName, // Keep original league name with fallback
                            sport: sportType, // Store sport type
                            home: match.home_team,
                            away: match.away_team,
                            time: new Date(match.match_date).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                            date: match.match_date.split('T')[0],
                            status: match.status,
                            home_score: match.home_score,
                            away_score: match.away_score,
                            ht_home_score: match.ht_home_score,
                            ht_away_score: match.ht_away_score,
                            ht_status: match.ht_status,
                            odds: {
                                home: match.home_odds || 2.0,
                                draw: match.draw_odds || 3.0,
                                away: match.away_odds || 2.5,
                                gg: match.gg_odds || 1.8,
                                ng: match.ng_odds || 2.0,
                                over1: match.over15_odds || 1.45,
                                under1: match.under15_odds || 2.75,
                                over2: match.over25_odds || 1.85,
                                under2: match.under25_odds || 2.0,
                                over3: match.over35_odds || 2.5,
                                under3: match.under35_odds || 1.55,
                                ah1: 1.95, ah0: 1.90,
                                dc12: match.dc_12_odds || 1.25,
                                dc1x: match.dc_1x_odds || 1.80,
                                dcx2: match.dc_x2_odds || 2.15,
                                htft_1x: match.htft_home_draw_odds || 3.50,
                                htft_x2: match.htft_draw_away_odds || 4.20,
                                cs_10: match.cs_1_0_odds || 5.00,
                                cs_20: match.cs_2_0_odds || 8.50,
                                cs_21: match.cs_2_1_odds || 9.00
                            }
                        });
                    });
                    console.log(`Loaded ${matches.length} matches from API`);
                }
                
                initializeLeagueSelector();
                displayMatches();
            } catch (err) {
                console.error('Error loading matches:', err);
                // Fall back to hardcoded matches if API fails
                initializeLeagueSelector();
                displayMatches();
            }
        }

        async function loadManualMatches() {
            // This button now shows any manual matches in a modal (if any exist)
            // Otherwise it can be used for admin to add manual matches
            showMessage('Manual matches feature - use admin panel to add custom matches', 'info');
        }

        function displayManualMatchesModal(manualMatches) {
            // Create modal overlay
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1e293b;
                    border: 1px solid #334155;
                    border-radius: 12px;
                    max-width: 900px;
                    width: 100%;
                    max-height: 80vh;
                    overflow-y: auto;
                    padding: 24px;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #a78bfa; font-size: 24px;">
                            <i class="fas fa-globe"></i> Rest of the World
                        </h2>
                        <button onclick="this.closest('div').parentElement.parentElement.remove()" style="
                            background: #dc2626;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                        ">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    
                    <div style="display: grid; gap: 16px;">
                        ${manualMatches.map(m => {
                            const matchDate = new Date(m.match_date);
                            const formattedDate = matchDate.toLocaleDateString('en-US', { 
                                month: 'short', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            const statusColors = {
                                scheduled: '#3b82f6',
                                live: '#f59e0b',
                                finished: '#10b981',
                                cancelled: '#dc2626'
                            };
                            
                            const statusColor = statusColors[m.status] || '#64748b';
                            
                            // Debug logging
                            if (m.home_score !== null && m.away_score !== null) {
                                console.log('Match status debug:', {
                                    teams: `${m.home} vs ${m.away}`,
                                    status: m.status,
                                    home_score: m.home_score,
                                    away_score: m.away_score
                                });
                            }
                            
                            // Build score display with HT and FT scores
                            let scoreDisplay = '';
                            if (m.ht_home_score !== null && m.ht_away_score !== null && m.ht_status === 'completed') {
                                // Show HT score
                                scoreDisplay += `<div style="font-size: 14px; color: #94a3b8; margin: 8px 0;">
                                    HT: ${m.ht_home_score} - ${m.ht_away_score}
                                </div>`;
                            }
                            if (m.home_score !== null && m.away_score !== null) {
                                // Show score with appropriate label based on match status
                                console.log(`Match ${m.home_team} vs ${m.away_team}: status="${m.status}", will show as ${m.status === 'live' ? 'LIVE' : 'FT'}`);
                                
                                let scoreLabel = 'FT';
                                let scoreColor = '#3b82f6';
                                let pulseAnimation = '';
                                
                                if (m.status === 'live') {
                                    // Show match time for live matches
                                    scoreLabel = m.match_time ? `${m.match_time}'` : 'LIVE';
                                    scoreColor = '#f59e0b';
                                    pulseAnimation = 'animation: pulse 2s infinite;';
                                }
                                
                                scoreDisplay += `<div style="font-size: 20px; color: ${scoreColor}; font-weight: bold; margin: 8px 0; ${pulseAnimation}">
                                    ${scoreLabel}: ${m.home_score} - ${m.away_score}
                                </div>`;
                            }
                            
                            return `
                                <div style="
                                    background: #0f172a;
                                    border: 1px solid #334155;
                                    border-radius: 8px;
                                    padding: 16px;
                                ">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                        <div>
                                            <div style="font-size: 18px; font-weight: bold; color: #e2e8f0; margin-bottom: 4px;">
                                                ${m.home_team} vs ${m.away_team}
                                            </div>
                                            <div style="color: #94a3b8; font-size: 13px;">
                                                ${m.league || 'Custom League'} â€¢ ${formattedDate}
                                            </div>
                                        </div>
                                        <div style="
                                            background: ${statusColor}33;
                                            color: ${statusColor};
                                            padding: 4px 12px;
                                            border-radius: 4px;
                                            font-size: 12px;
                                            font-weight: 600;
                                            text-transform: uppercase;
                                        ">
                                            ${m.status}
                                        </div>
                                    </div>
                                    
                                    ${scoreDisplay}
                                    
                                    ${m.status !== 'finished' && m.status !== 'cancelled' ? `
                                        <!-- 1X2 Market -->
                                        <div style="margin-top: 16px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Match Result (1X2)</div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                                <div onclick="selectManualMatchOdd(${m.id}, 'home', ${m.home_odds}, '${m.home_team} vs ${m.away_team}', '1x2')" style="
                                                    background: rgba(59, 130, 246, 0.1);
                                                    border: 1px solid #3b82f6;
                                                    padding: 12px;
                                                    border-radius: 6px;
                                                    text-align: center;
                                                    cursor: pointer;
                                                    transition: all 0.2s;
                                                " onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Home</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #3b82f6;">${m.home_odds.toFixed(2)}</div>
                                                </div>
                                                <div onclick="selectManualMatchOdd(${m.id}, 'draw', ${m.draw_odds}, '${m.home_team} vs ${m.away_team}', '1x2')" style="
                                                    background: rgba(139, 92, 246, 0.1);
                                                    border: 1px solid #a78bfa;
                                                    padding: 12px;
                                                    border-radius: 6px;
                                                    text-align: center;
                                                    cursor: pointer;
                                                    transition: all 0.2s;
                                                " onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'" onmouseout="this.style.background='rgba(139, 92, 246, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Draw</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #a78bfa;">${m.draw_odds.toFixed(2)}</div>
                                                </div>
                                                <div onclick="selectManualMatchOdd(${m.id}, 'away', ${m.away_odds}, '${m.home_team} vs ${m.away_team}', '1x2')" style="
                                                    background: rgba(236, 72, 153, 0.1);
                                                    border: 1px solid #ec4899;
                                                    padding: 12px;
                                                    border-radius: 6px;
                                                    text-align: center;
                                                    cursor: pointer;
                                                    transition: all 0.2s;
                                                " onmouseover="this.style.background='rgba(236, 72, 153, 0.2)'" onmouseout="this.style.background='rgba(236, 72, 153, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Away</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #ec4899;">${m.away_odds.toFixed(2)}</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        ${m.home_draw_odds || m.home_away_odds || m.draw_away_odds || m.gg_odds || m.ng_odds || m.over15_odds || m.under15_odds || m.over25_odds || m.under25_odds || m.over35_odds || m.under35_odds || m.htft_odds || m.correct_score_odds ? `
                                        <!-- View More Options Button -->
                                        <div style="margin-top: 12px;">
                                            <button onclick="toggleMoreOptions(${m.id})" id="moreBtn_${m.id}" style="
                                                width: 100%;
                                                background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
                                                color: white;
                                                border: none;
                                                padding: 10px 16px;
                                                border-radius: 6px;
                                                font-size: 13px;
                                                font-weight: 600;
                                                cursor: pointer;
                                                display: flex;
                                                align-items: center;
                                                justify-content: center;
                                                gap: 8px;
                                                transition: all 0.3s;
                                            " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                <i class="fas fa-chevron-down" id="moreIcon_${m.id}"></i>
                                                <span id="moreText_${m.id}">View More Options</span>
                                            </button>
                                        </div>
                                        
                                        <!-- Collapsible Options Container -->
                                        <div id="moreOptions_${m.id}" style="display: none; margin-top: 12px;">
                                        
                                        ${m.home_draw_odds || m.home_away_odds || m.draw_away_odds ? `
                                        <!-- Double Chance -->
                                        <div style="margin-top: 12px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Double Chance</div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                                ${m.home_draw_odds ? `<div onclick="selectManualMatchOdd(${m.id}, '1X', ${m.home_draw_odds}, '${m.home_team} vs ${m.away_team}', 'dc')" style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">1X</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #10b981;">${m.home_draw_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.home_away_odds ? `<div onclick="selectManualMatchOdd(${m.id}, '12', ${m.home_away_odds}, '${m.home_team} vs ${m.away_team}', 'dc')" style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">12</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #10b981;">${m.home_away_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.draw_away_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'X2', ${m.draw_away_odds}, '${m.home_team} vs ${m.away_team}', 'dc')" style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">X2</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #10b981;">${m.draw_away_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        ${m.gg_odds || m.ng_odds ? `
                                        <!-- Both Teams to Score -->
                                        <div style="margin-top: 12px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Both Teams to Score</div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                                ${m.gg_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'GG', ${m.gg_odds}, '${m.home_team} vs ${m.away_team}', 'gg')" style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.2)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Both Score (GG)</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #f59e0b;">${m.gg_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.ng_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'NG', ${m.ng_odds}, '${m.home_team} vs ${m.away_team}', 'gg')" style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.2)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Not Both (NG)</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #f59e0b;">${m.ng_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        ${m.over25_odds || m.under25_odds || m.over15_odds || m.under15_odds || m.over35_odds || m.under35_odds ? `
                                        <!-- Over/Under -->
                                        <div style="margin-top: 12px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Over/Under Goals</div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                                ${m.over15_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Over 1.5', ${m.over15_odds}, '${m.home_team} vs ${m.away_team}', 'ou15')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Over 1.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.over15_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.under15_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Under 1.5', ${m.under15_odds}, '${m.home_team} vs ${m.away_team}', 'ou15')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Under 1.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.under15_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.over25_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Over 2.5', ${m.over25_odds}, '${m.home_team} vs ${m.away_team}', 'ou25')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Over 2.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.over25_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.under25_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Under 2.5', ${m.under25_odds}, '${m.home_team} vs ${m.away_team}', 'ou25')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Under 2.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.under25_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.over35_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Over 3.5', ${m.over35_odds}, '${m.home_team} vs ${m.away_team}', 'ou35')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Over 3.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.over35_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                                ${m.under35_odds ? `<div onclick="selectManualMatchOdd(${m.id}, 'Under 3.5', ${m.under35_odds}, '${m.home_team} vs ${m.away_team}', 'ou35')" style="background: rgba(99, 102, 241, 0.1); border: 1px solid #6366f1; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.1)'">
                                                    <div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">Under 3.5</div>
                                                    <div style="font-size: 16px; font-weight: bold; color: #6366f1;">${m.under35_odds.toFixed(2)}</div>
                                                </div>` : ''}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        ${m.htft_odds ? `
                                        <!-- Half Time/Full Time -->
                                        <div style="margin-top: 12px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Half Time / Full Time</div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                                ${(() => {
                                                    try {
                                                        const htft = JSON.parse(m.htft_odds);
                                                        const outcomes = [
                                                            {key: 'HH', label: 'Home/Home'},
                                                            {key: 'HD', label: 'Home/Draw'},
                                                            {key: 'HA', label: 'Home/Away'},
                                                            {key: 'DH', label: 'Draw/Home'},
                                                            {key: 'DD', label: 'Draw/Draw'},
                                                            {key: 'DA', label: 'Draw/Away'},
                                                            {key: 'AH', label: 'Away/Home'},
                                                            {key: 'AD', label: 'Away/Draw'},
                                                            {key: 'AA', label: 'Away/Away'}
                                                        ];
                                                        return outcomes.map(o => {
                                                            if (htft[o.key]) {
                                                                return '<div onclick="selectManualMatchOdd(' + m.id + ', \'' + o.label + '\', ' + htft[o.key] + ', \'' + m.home_team + ' vs ' + m.away_team + '\', \'htft\')" style="background: rgba(236, 72, 153, 0.1); border: 1px solid #ec4899; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background=\'rgba(236, 72, 153, 0.2)\'" onmouseout="this.style.background=\'rgba(236, 72, 153, 0.1)\'">' +
                                                                    '<div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">' + o.key + '</div>' +
                                                                    '<div style="font-size: 16px; font-weight: bold; color: #ec4899;">' + htft[o.key].toFixed(2) + '</div>' +
                                                                '</div>';
                                                            }
                                                            return '';
                                                        }).join('');
                                                    } catch (e) {
                                                        return '';
                                                    }
                                                })()}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        ${m.correct_score_odds ? `
                                        <!-- Correct Score -->
                                        <div style="margin-top: 12px;">
                                            <div style="color: #94a3b8; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Correct Score</div>
                                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                                ${(() => {
                                                    try {
                                                        const cs = JSON.parse(m.correct_score_odds);
                                                        const scores = [
                                                            '1-0', '2-0', '2-1', '3-0', '3-1', '3-2',
                                                            '0-0', '1-1', '2-2',
                                                            '0-1', '0-2', '1-2', '0-3', '1-3', '2-3',
                                                            'Other'
                                                        ];
                                                        return scores.map(score => {
                                                            if (cs[score]) {
                                                                return '<div onclick="selectManualMatchOdd(' + m.id + ', \'' + score + '\', ' + cs[score] + ', \'' + m.home_team + ' vs ' + m.away_team + '\', \'cs\')" style="background: rgba(6, 182, 212, 0.1); border: 1px solid #06b6d4; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer;" onmouseover="this.style.background=\'rgba(6, 182, 212, 0.2)\'" onmouseout="this.style.background=\'rgba(6, 182, 212, 0.1)\'">' +
                                                                    '<div style="font-size: 11px; color: #94a3b8; margin-bottom: 4px;">' + score + '</div>' +
                                                                    '<div style="font-size: 16px; font-weight: bold; color: #06b6d4;">' + cs[score].toFixed(2) + '</div>' +
                                                                '</div>';
                                                            }
                                                            return '';
                                                        }).join('');
                                                    } catch (e) {
                                                        return '';
                                                    }
                                                })()}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        </div>
                                        ` : ''}
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function toggleMoreOptions(matchId) {
            const container = document.getElementById(`moreOptions_${matchId}`);
            const icon = document.getElementById(`moreIcon_${matchId}`);
            const text = document.getElementById(`moreText_${matchId}`);
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
                text.textContent = 'Hide Options';
            } else {
                container.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
                text.textContent = 'View More Options';
            }
        }

        function selectManualMatchOdd(matchId, selection, odds, matchDescription, market = '1x2') {
            // Add to betslip
            const marketLabels = {
                '1x2': 'Match Result',
                'dc': 'Double Chance',
                'gg': 'Both Teams Score',
                'ou15': 'Over/Under 1.5',
                'ou25': 'Over/Under 2.5',
                'ou35': 'Over/Under 3.5',
                'htft': 'Half Time/Full Time',
                'cs': 'Correct Score'
            };
            
            const pick = {
                matchId: matchId,
                type: selection,
                odds: odds,
                value: odds,  // Need this for betslip display
                match: matchDescription,
                market: market,
                label: selection.charAt(0).toUpperCase() + selection.slice(1)
            };
            
            // Remove any existing bet for this match
            betslip = betslip.filter(b => b.matchId !== matchId);
            
            // Add new pick
            betslip.push(pick);
            
            updateBetslip();
            showMessage(`Added ${matchDescription} (${marketLabels[market] || market}: ${pick.label}) to betslip`, 'success');
        }

        let currentMarket = {}; // Track selected market per match

        function displayMatches() {
            let filtered;
            if (currentLeague === 'live') {
                // Show only matches with live status
                filtered = matches.filter(m => m.status === 'live');
            } else if (currentLeague === 'all') {
                filtered = matches;
            } else {
                filtered = matches.filter(m => {
                    const leagueName = (m.leagueName || '').toLowerCase();
                    
                    // Simple league matching - check leagueName field
                    if (currentLeague === 'premier' && leagueName.includes('premier')) return true;
                    if (currentLeague === 'laliga' && leagueName.includes('la liga')) return true;
                    if (currentLeague === 'ligue1' && (leagueName.includes('ligue 1') || leagueName.includes('ligue1'))) return true;
                    if (currentLeague === 'bundesliga' && leagueName.includes('bundesliga')) return true;
                    if (currentLeague === 'seriea' && leagueName.includes('serie a')) return true;
                    if (currentLeague === 'nba' && leagueName.includes('nba')) return true;
                    if (currentLeague === 'ucl' && leagueName.includes('champions')) return true;
                    if (currentLeague === 'other') {
                        // Other - matches that don't match popular leagues
                        return !leagueName.includes('premier') && 
                               !leagueName.includes('la liga') && 
                               !leagueName.includes('ligue') && 
                               !leagueName.includes('bundesliga') && 
                               !leagueName.includes('serie a') &&
                               !leagueName.includes('nba') &&
                               !leagueName.includes('champions');
                    }
                    
                    return false;
                });
            }
            
            const container = document.getElementById('matchesContainer');
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">No matches available</p>';
                return;
            }

            container.innerHTML = filtered.map(m => {
                    const market = currentMarket[m.id] || '1x2';
                    const odds = m.odds;
                    const leagueDisplay = m.leagueName || 'Rest of World';
                    const matchDate = new Date(m.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    
                    // Build score display with LIVE indicator
                    let scoreDisplay = '';
                    let liveIndicator = '';
                    
                    // Show LIVE badge for live matches
                    if (m.status === 'live') {
                        const matchTime = m.match_time ? `${m.match_time}'` : '';
                        liveIndicator = `<div style="display: inline-flex; align-items: center; gap: 6px; background: #dc2626; color: white; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-top: 6px;">
                            <i class="fas fa-circle" style="font-size: 6px; animation: pulse 2s infinite;"></i>
                            LIVE ${matchTime}
                        </div>`;
                    }
                    
                    if (m.ht_home_score !== undefined && m.ht_home_score !== null && m.ht_away_score !== undefined && m.ht_away_score !== null && m.ht_status === 'completed') {
                        scoreDisplay += `<div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">HT: ${m.ht_home_score} - ${m.ht_away_score}</div>`;
                    }
                    if (m.home_score !== undefined && m.home_score !== null && m.away_score !== undefined && m.away_score !== null) {
                        // Show LIVE or FT based on match status
                        const scoreLabel = m.status === 'live' ? 'LIVE' : 'FT';
                        const scoreColor = m.status === 'live' ? '#f59e0b' : '#3b82f6';
                        const pulseStyle = m.status === 'live' ? 'animation: pulse 2s infinite;' : '';
                        scoreDisplay += `<div style="font-size: 16px; color: ${scoreColor}; font-weight: bold; margin-top: 4px; ${pulseStyle}">${scoreLabel}: ${m.home_score} - ${m.away_score}</div>`;
                    }

                    return `
                    <div class="match-card" style="${m.status === 'live' ? 'border-left: 3px solid #dc2626;' : ''}">
                        <div class="match-header">
                            <div style="display:flex; flex-direction:column; gap:4px;">
                                ${leagueDisplay ? `<div style="font-size:11px; color:#64748b; font-weight:600;">${leagueDisplay}</div>` : ''}
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <div style="font-weight:700;">${m.home}</div>
                                    <div style="color:var(--muted);">vs</div>
                                    <div style="font-weight:700;">${m.away}</div>
                                </div>
                                ${liveIndicator}
                                ${scoreDisplay}
                            </div>
                            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:2px;">
                                <div class="match-time">${m.time}</div>
                                <div style="font-size:11px; color:#64748b;">${matchDate}</div>
                            </div>
                        </div>

                        <!-- Market Selection Tabs -->
                        <div class="market-tabs">
                            ${getMarketTabs(m, market)}
                        </div>

                        <!-- Dynamic Odds Display -->
                        <div class="odds-row" id="odds_${m.id}">
                            ${getMarketOdds(m, market)}
                        </div>
                    </div>
                    `;
                }).join('');
        }

        function getMarketTabs(match, market) {
            const sport = match.sport || 'Football';
            
            // Football has all markets
            if (sport === 'Football' || sport === 'football') {
                return `
                    <button class="market-tab ${market === '1x2' ? 'active' : ''}" onclick="switchMarket(${match.id}, '1x2')">1X2</button>
                    <button class="market-tab ${market === 'dc' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'dc')">Double Chance</button>
                    <button class="market-tab ${market === 'gg' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'gg')">GG/NG</button>
                    <button class="market-tab ${market === 'ou1' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou1')">O/U 1.5</button>
                    <button class="market-tab ${market === 'ou2' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou2')">O/U 2.5</button>
                    <button class="market-tab ${market === 'ou3' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou3')">O/U 3.5</button>
                    <button class="market-tab ${market === 'htft' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'htft')">HT/FT</button>
                    <button class="market-tab ${market === 'cs' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'cs')">Correct Score</button>
                `;
            }
            
            // Basketball, Hockey, Baseball, NFL - only winner and over/under (no draws)
            if (sport === 'Basketball' || sport === 'basketball' || 
                sport === 'Hockey' || sport === 'hockey' || 
                sport === 'Baseball' || sport === 'baseball' ||
                sport === 'NBA' || sport === 'nba' ||
                sport === 'NHL' || sport === 'nhl' ||
                sport === 'MLB' || sport === 'mlb' ||
                sport === 'NFL' || sport === 'nfl' ||
                sport === 'American Football' || sport === 'american football') {
                return `
                    <button class="market-tab ${market === '1x2' ? 'active' : ''}" onclick="switchMarket(${match.id}, '1x2')">Winner</button>
                    <button class="market-tab ${market === 'ou2' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou2')">O/U 2.5</button>
                    <button class="market-tab ${market === 'ou3' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou3')">O/U 3.5</button>
                `;
            }
            
            // Default fallback - basic markets
            return `
                <button class="market-tab ${market === '1x2' ? 'active' : ''}" onclick="switchMarket(${match.id}, '1x2')">Winner</button>
                <button class="market-tab ${market === 'ou2' ? 'active' : ''}" onclick="switchMarket(${match.id}, 'ou2')">O/U 2.5</button>
            `;
        }

        function getMarketOdds(match, market) {
            const odds = match.odds;
            const pick = betslip.find(p => p.matchId === match.id);
            const isSelected = (type) => pick && pick.type === type && pick.market === market;
            
            switch(market) {
                case '1x2':
                    // Check if sport has draws (soccer/football) or not (basketball, hockey, baseball, NFL)
                    const sport = match.sport || 'Football';
                    const hasDraw = sport === 'Football' || sport === 'football' || sport === 'Soccer' || sport === 'soccer';
                    
                    if (hasDraw) {
                        return `
                            <div class="odd-box ${isSelected('home') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'home', ${odds.home}, '1x2')">
                                <div class="odd-label">Home</div>
                                <div class="odd-value">${odds.home.toFixed(2)}</div>
                            </div>
                            <div class="odd-box ${isSelected('draw') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'draw', ${odds.draw}, '1x2')">
                                <div class="odd-label">Draw</div>
                                <div class="odd-value">${odds.draw.toFixed(2)}</div>
                            </div>
                            <div class="odd-box ${isSelected('away') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'away', ${odds.away}, '1x2')">
                                <div class="odd-label">Away</div>
                                <div class="odd-value">${odds.away.toFixed(2)}</div>
                            </div>
                        `;
                    } else {
                        // No draw option for basketball, hockey, baseball
                        return `
                            <div class="odd-box ${isSelected('home') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'home', ${odds.home}, '1x2')" style="flex: 1;">
                                <div class="odd-label">${match.home}</div>
                                <div class="odd-value">${odds.home.toFixed(2)}</div>
                            </div>
                            <div class="odd-box ${isSelected('away') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'away', ${odds.away}, '1x2')" style="flex: 1;">
                                <div class="odd-label">${match.away}</div>
                                <div class="odd-value">${odds.away.toFixed(2)}</div>
                            </div>
                        `;
                    }
                case 'gg':
                    return `
                        <div class="odd-box ${isSelected('yes') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'yes', ${odds.gg}, 'gg')">
                            <div class="odd-label">Yes (GG)</div>
                            <div class="odd-value">${odds.gg.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('no') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'no', ${odds.ng}, 'gg')">
                            <div class="odd-label">No (NG)</div>
                            <div class="odd-value">${odds.ng.toFixed(2)}</div>
                        </div>
                    `;
                case 'ou1':
                    return `
                        <div class="odd-box ${isSelected('over1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'over1', ${odds.over1}, 'ou1')">
                            <div class="odd-label">Over 1.5</div>
                            <div class="odd-value">${odds.over1.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('under1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'under1', ${odds.under1}, 'ou1')">
                            <div class="odd-label">Under 1.5</div>
                            <div class="odd-value">${odds.under1.toFixed(2)}</div>
                        </div>
                    `;
                case 'ou2':
                    return `
                        <div class="odd-box ${isSelected('over2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'over2', ${odds.over2}, 'ou2')">
                            <div class="odd-label">Over 2.5</div>
                            <div class="odd-value">${odds.over2.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('under2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'under2', ${odds.under2}, 'ou2')">
                            <div class="odd-label">Under 2.5</div>
                            <div class="odd-value">${odds.under2.toFixed(2)}</div>
                        </div>
                    `;
                case 'ou3':
                    return `
                        <div class="odd-box ${isSelected('over3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'over3', ${odds.over3}, 'ou3')">
                            <div class="odd-label">Over 3.5</div>
                            <div class="odd-value">${odds.over3.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('under3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'under3', ${odds.under3}, 'ou3')">
                            <div class="odd-label">Under 3.5</div>
                            <div class="odd-value">${odds.under3.toFixed(2)}</div>
                        </div>
                    `;
                case 'dc':
                    return `
                        <div class="odd-box ${isSelected('1x') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '1x', ${(odds.home * 0.6).toFixed(2)}, 'dc')">
                            <div class="odd-label">1X</div>
                            <div class="odd-value">${(odds.home * 0.6).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('12') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '12', ${((odds.home + odds.away) * 0.4).toFixed(2)}, 'dc')">
                            <div class="odd-label">12</div>
                            <div class="odd-value">${((odds.home + odds.away) * 0.4).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('x2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'x2', ${(odds.away * 0.6).toFixed(2)}, 'dc')">
                            <div class="odd-label">X2</div>
                            <div class="odd-value">${(odds.away * 0.6).toFixed(2)}</div>
                        </div>
                    `;
                case 'htft':
                    return `
                        <div class="odd-box ${isSelected('hh') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'hh', ${(odds.home * 1.8).toFixed(2)}, 'htft')">
                            <div class="odd-label">H/H</div>
                            <div class="odd-value">${(odds.home * 1.8).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('hd') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'hd', ${(odds.home * 2.5).toFixed(2)}, 'htft')">
                            <div class="odd-label">H/D</div>
                            <div class="odd-value">${(odds.home * 2.5).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('ha') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'ha', ${(odds.home * 3.2).toFixed(2)}, 'htft')">
                            <div class="odd-label">H/A</div>
                            <div class="odd-value">${(odds.home * 3.2).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('dh') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'dh', ${(odds.draw * 2.2).toFixed(2)}, 'htft')">
                            <div class="odd-label">D/H</div>
                            <div class="odd-value">${(odds.draw * 2.2).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('dd') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'dd', ${(odds.draw * 2.8).toFixed(2)}, 'htft')">
                            <div class="odd-label">D/D</div>
                            <div class="odd-value">${(odds.draw * 2.8).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('da') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'da', ${(odds.draw * 2.2).toFixed(2)}, 'htft')">
                            <div class="odd-label">D/A</div>
                            <div class="odd-value">${(odds.draw * 2.2).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('ah') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'ah', ${(odds.away * 3.2).toFixed(2)}, 'htft')">
                            <div class="odd-label">A/H</div>
                            <div class="odd-value">${(odds.away * 3.2).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('ad') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'ad', ${(odds.away * 2.5).toFixed(2)}, 'htft')">
                            <div class="odd-label">A/D</div>
                            <div class="odd-value">${(odds.away * 2.5).toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('aa') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'aa', ${(odds.away * 1.8).toFixed(2)}, 'htft')">
                            <div class="odd-label">A/A</div>
                            <div class="odd-value">${(odds.away * 1.8).toFixed(2)}</div>
                        </div>
                    `;
                case 'cs':
                    return `
                        <div class="odd-box ${isSelected('0-0') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '0-0', 6.5, 'cs')">
                            <div class="odd-label">0-0</div>
                            <div class="odd-value">6.50</div>
                        </div>
                        <div class="odd-box ${isSelected('1-0') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '1-0', 7.5, 'cs')">
                            <div class="odd-label">1-0</div>
                            <div class="odd-value">7.50</div>
                        </div>
                        <div class="odd-box ${isSelected('2-0') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '2-0', 9.0, 'cs')">
                            <div class="odd-label">2-0</div>
                            <div class="odd-value">9.00</div>
                        </div>
                        <div class="odd-box ${isSelected('3-0') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '3-0', 12.0, 'cs')">
                            <div class="odd-label">3-0</div>
                            <div class="odd-value">12.00</div>
                        </div>
                        <div class="odd-box ${isSelected('0-1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '0-1', 7.5, 'cs')">
                            <div class="odd-label">0-1</div>
                            <div class="odd-value">7.50</div>
                        </div>
                        <div class="odd-box ${isSelected('1-1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '1-1', 5.5, 'cs')">
                            <div class="odd-label">1-1</div>
                            <div class="odd-value">5.50</div>
                        </div>
                        <div class="odd-box ${isSelected('2-1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '2-1', 8.5, 'cs')">
                            <div class="odd-label">2-1</div>
                            <div class="odd-value">8.50</div>
                        </div>
                        <div class="odd-box ${isSelected('3-1') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '3-1', 11.0, 'cs')">
                            <div class="odd-label">3-1</div>
                            <div class="odd-value">11.00</div>
                        </div>
                        <div class="odd-box ${isSelected('0-2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '0-2', 9.0, 'cs')">
                            <div class="odd-label">0-2</div>
                            <div class="odd-value">9.00</div>
                        </div>
                        <div class="odd-box ${isSelected('1-2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '1-2', 8.5, 'cs')">
                            <div class="odd-label">1-2</div>
                            <div class="odd-value">8.50</div>
                        </div>
                        <div class="odd-box ${isSelected('2-2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '2-2', 10.0, 'cs')">
                            <div class="odd-label">2-2</div>
                            <div class="odd-value">10.00</div>
                        </div>
                        <div class="odd-box ${isSelected('3-2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '3-2', 13.0, 'cs')">
                            <div class="odd-label">3-2</div>
                            <div class="odd-value">13.00</div>
                        </div>
                        <div class="odd-box ${isSelected('0-3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '0-3', 12.0, 'cs')">
                            <div class="odd-label">0-3</div>
                            <div class="odd-value">12.00</div>
                        </div>
                        <div class="odd-box ${isSelected('1-3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '1-3', 11.0, 'cs')">
                            <div class="odd-label">1-3</div>
                            <div class="odd-value">11.00</div>
                        </div>
                        <div class="odd-box ${isSelected('2-3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '2-3', 13.0, 'cs')">
                            <div class="odd-label">2-3</div>
                            <div class="odd-value">13.00</div>
                        </div>
                        <div class="odd-box ${isSelected('3-3') ? 'selected' : ''}" onclick="selectOdd(${match.id}, '3-3', 15.0, 'cs')">
                            <div class="odd-label">3-3</div>
                            <div class="odd-value">15.00</div>
                        </div>
                    `;
                case 'ah':
                    return `
                        <div class="odd-box ${isSelected('ah_home') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'ah_home', ${odds.ah1}, 'ah')">
                            <div class="odd-label">${match.home} AH</div>
                            <div class="odd-value">${odds.ah1.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('ah_away') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'ah_away', ${odds.ah0}, 'ah')">
                            <div class="odd-label">${match.away} AH</div>
                            <div class="odd-value">${odds.ah0.toFixed(2)}</div>
                        </div>
                    `;
                case 'dc':
                    return `
                        <div class="odd-box ${isSelected('dc12') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'dc12', ${odds.dc12}, 'dc')">
                            <div class="odd-label">Home or Draw</div>
                            <div class="odd-value">${odds.dc12.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('dc1x') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'dc1x', ${odds.dc1x}, 'dc')">
                            <div class="odd-label">Home or Away</div>
                            <div class="odd-value">${odds.dc1x.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('dcx2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'dcx2', ${odds.dcx2}, 'dc')">
                            <div class="odd-label">Draw or Away</div>
                            <div class="odd-value">${odds.dcx2.toFixed(2)}</div>
                        </div>
                    `;
                case 'htft':
                    return `
                        <div class="odd-box ${isSelected('htft_1x') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'htft_1x', ${odds.htft_1x}, 'htft')">
                            <div class="odd-label">HT: Home</div>
                            <div class="odd-value">${odds.htft_1x.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('htft_x2') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'htft_x2', ${odds.htft_x2}, 'htft')">
                            <div class="odd-label">HT: Draw</div>
                            <div class="odd-value">${odds.htft_x2.toFixed(2)}</div>
                        </div>
                    `;
                case 'cs':
                    return `
                        <div class="odd-box ${isSelected('cs_10') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'cs_10', ${odds.cs_10}, 'cs')">
                            <div class="odd-label">1-0</div>
                            <div class="odd-value">${odds.cs_10.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('cs_20') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'cs_20', ${odds.cs_20}, 'cs')">
                            <div class="odd-label">2-0</div>
                            <div class="odd-value">${odds.cs_20.toFixed(2)}</div>
                        </div>
                        <div class="odd-box ${isSelected('cs_21') ? 'selected' : ''}" onclick="selectOdd(${match.id}, 'cs_21', ${odds.cs_21}, 'cs')">
                            <div class="odd-label">2-1</div>
                            <div class="odd-value">${odds.cs_21.toFixed(2)}</div>
                        </div>
                    `;
                default:
                    return '';
            }
        }

        let betslip = []; // Array to store multiple picks
        let currentMyBetsTab = 'active'; // Track current My Bets sub-tab

        function selectOdd(matchId, type, value, market) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;

            // Check if this match already exists in betslip
            const existingIndex = betslip.findIndex(pick => pick.matchId === matchId);
            
            if (existingIndex >= 0) {
                // Update existing pick
                betslip[existingIndex] = {
                    matchId,
                    match: `${match.home} vs ${match.away}`,
                    type,
                    value,
                    market,
                    home: match.home,
                    away: match.away,
                    league: match.league || '',
                    match_date: match.match_date || match.time || ''
                };
            } else {
                // Add new pick
                betslip.push({
                    matchId,
                    match: `${match.home} vs ${match.away}`,
                    type,
                    value,
                    market,
                    home: match.home,
                    away: match.away,
                    league: match.league || '',
                    match_date: match.match_date || match.time || ''
                });
            }

            updateBetslip();
            displayMatches(); // Refresh to show selected states
        }

        function updateBetslip() {
            const container = document.getElementById('betslipPicks');
            const summary = document.getElementById('betslipSummary');
            const count = document.getElementById('betslipCount');
            const badge = document.getElementById('betslipBadge');
            const betslipContainer = document.getElementById('betslipContainer');

            count.textContent = betslip.length;
            badge.textContent = betslip.length;
            
            if (betslip.length > 0) {
                badge.style.display = 'flex';
                betslipContainer.classList.remove('hidden');
            } else {
                badge.style.display = 'none';
            }

            if (betslip.length === 0) {
                container.innerHTML = `
                    <div class="betslip-empty">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Select odds to add to your bet slip</p>
                    </div>
                `;
                summary.style.display = 'none';
                return;
            }

            // Display picks
            const marketLabels = {
                '1x2': 'Match Result',
                'gg': 'Both Teams Score',
                'ou1': 'Over/Under 1.5',
                'ou2': 'Over/Under 2.5',
                'ou3': 'Over/Under 3.5',
                'ah': 'Asian Handicap',
                'dc': 'Double Chance',
                'htft': 'HT/FT',
                'cs': 'Correct Score'
            };

            container.innerHTML = betslip.map((pick, index) => `
                <div class="betslip-pick">
                    <div class="betslip-pick-header">
                        <div class="betslip-pick-match">${pick.match}</div>
                        <button class="betslip-pick-remove" onclick="removePick(${index})">Ã—</button>
                    </div>
                    <div class="betslip-pick-selection">
                        ${marketLabels[pick.market] || pick.market} - <strong>${pick.type.toUpperCase()}</strong>
                    </div>
                    <div class="betslip-pick-odds">@ ${pick.value.toFixed(2)}</div>
                </div>
            `).join('');

            // Calculate total odds
            const totalOdds = betslip.reduce((acc, pick) => acc * pick.value, 1);
            document.getElementById('betslipTotalOdds').textContent = totalOdds.toFixed(2);

            summary.style.display = 'block';
            updateBetslipPayout();
        }

        function updateBetslipPayout() {
            const stake = parseFloat(document.getElementById('betslipStake').value) || 0;
            const totalOdds = parseFloat(document.getElementById('betslipTotalOdds').textContent) || 1;
            const numPicks = betslip.length;
            
            // Calculate bonus based on number of picks
            let bonusPercentage = 0;
            if (numPicks >= 10) bonusPercentage = 15;
            else if (numPicks >= 8) bonusPercentage = 10;
            else if (numPicks >= 6) bonusPercentage = 7;
            else if (numPicks >= 5) bonusPercentage = 5;
            else if (numPicks >= 4) bonusPercentage = 3;
            else if (numPicks >= 3) bonusPercentage = 2;
            
            const basePayout = stake * totalOdds;
            const bonusAmount = basePayout * (bonusPercentage / 100);
            const totalPayout = basePayout + bonusAmount;
            
            document.getElementById('betslipPayout').textContent = formatUsd(totalPayout);
            
            // Update bonus display
            const bonusDisplay = document.getElementById('betslipBonus');
            if (bonusPercentage > 0 && stake > 0) {
                bonusDisplay.style.display = 'flex';
                document.getElementById('betslipBonusPercent').textContent = bonusPercentage + '%';
                document.getElementById('betslipBonusAmount').textContent = formatUsd(bonusAmount);
            } else {
                bonusDisplay.style.display = 'none';
            }
        }

        function removePick(index) {
            betslip.splice(index, 1);
            updateBetslip();
            displayMatches(); // Refresh to remove selected states
        }

        function clearBetslip() {
            if (betslip.length > 0 && !confirm('Clear all picks from bet slip?')) return;
            betslip = [];
            virtualSelectedBets = [];
            updateBetslip();
            updateVirtualBetslipUI();
            displayMatches();
        }

        function toggleBetslip() {
            const container = document.getElementById('betslipContainer');
            container.classList.toggle('hidden');
        }

        async function placeBetslipBet() {
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }

            // Handle virtual bets
            if (virtualSelectedBets && virtualSelectedBets.length > 0) {
                try {
                    const stake = parseFloat(document.getElementById('betslipStake').value);
                    if (!stake || stake < 1) {
                        showMessage('Please enter a valid stake (minimum $1)', 'error');
                        return;
                    }
                    const betData = {
                        stake: stake,
                        selections: virtualSelectedBets.map(bet => ({
                            game_id: bet.gameId,
                            market: bet.market || '1X2',
                            selection: bet.selection,
                            odd: bet.odd
                        }))
                    };
                    const response = await fetch('/api/virtual/bets', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${client.token}`},
                        body: JSON.stringify(betData)
                    });
                    const data = await response.json();
                    if (data.success) {
                        showMessage(`âœ… Virtual bet placed! Bet ID: ${data.bet_id}`, 'success');
                        virtualSelectedBets = [];
                        updateVirtualBetslipUI();
                        await refreshUserBalance();
                    } else {
                        showMessage(data.error || 'Failed to place virtual bet', 'error');
                    }
                } catch (error) {
                    console.error('Error placing virtual bet:', error);
                    showMessage('Error placing virtual bet', 'error');
                }
                return;
            }

            if (betslip.length === 0) {
                showMessage('Add picks to your bet slip first!', 'error');
                return;
            }

            const stake = parseFloat(document.getElementById('betslipStake').value);
            if (!stake || stake <= 0) {
                showMessage('Enter a valid stake amount!', 'error');
                return;
            }

            const totalOdds = parseFloat(document.getElementById('betslipTotalOdds').textContent);
            const stakeBtc = usdToBtc(stake);
            
            // Calculate bonus
            const numPicks = betslip.length;
            let bonusPercentage = 0;
            if (numPicks >= 10) bonusPercentage = 15;
            else if (numPicks >= 8) bonusPercentage = 10;
            else if (numPicks >= 6) bonusPercentage = 7;
            else if (numPicks >= 5) bonusPercentage = 5;
            else if (numPicks >= 4) bonusPercentage = 3;
            else if (numPicks >= 3) bonusPercentage = 2;
            
            const basePayout = stake * totalOdds;
            const bonusAmount = basePayout * (bonusPercentage / 100);
            const totalPayout = basePayout + bonusAmount;

            try {
                // Create description
                const marketLabels = {
                    '1x2': 'Match Result',
                    'dc': 'Double Chance',
                    'gg': 'Both Teams Score',
                    'ou15': 'Over/Under 1.5',
                    'ou25': 'Over/Under 2.5',
                    'ou35': 'Over/Under 3.5',
                    'htft': 'Half Time/Full Time',
                    'cs': 'Correct Score'
                };

                const desc = betslip.map(pick => 
                    `${pick.match} [${marketLabels[pick.market] || pick.market}] ${pick.label || pick.type} @${pick.value.toFixed(2)}`
                ).join(' | ');

                // Generate booking code first
                let bookingCode = null;
                try {
                    const bookingData = await client.generateBookingCode(betslip);
                    bookingCode = bookingData.code;
                } catch (err) {
                    console.error('Failed to generate booking code:', err);
                }

                // Determine if single or multi bet
                const isMultiBet = betslip.length > 1;
                const betDescription = isMultiBet ? `MULTI: ${desc}` : desc;
                const marketType = isMultiBet ? 'accumulator' : betslip[0].market;
                const betTypeLabel = isMultiBet ? 'Multi-Bet' : 'Single Bet';
                const betSelection = isMultiBet ? `${numPicks} picks` : betslip[0].type;
                const matchId = !isMultiBet ? betslip[0].matchId : null;
                
                // Create bet
                const betResponse = await client.createBet(
                    stakeBtc, 
                    totalOdds, 
                    'sports', 
                    betDescription, 
                    marketType, 
                    betSelection,
                    bookingCode,
                    matchId
                );
                
                showMessage(`âœ… ${betTypeLabel} placed! ${betslip.length} picks at ${totalOdds.toFixed(2)} odds for ${formatUsd(stake)}`);
                if (window.triggerConfetti) try { window.triggerConfetti(); } catch(e) { /* ignore */ }
                
                // Show ticket
                showBetTicket({
                    id: betResponse.bet?.id || Date.now(),
                    type: betTypeLabel,
                    picks: betslip.map(pick => ({
                        match: pick.match,
                        league: pick.league || '',
                        matchTime: pick.match_date || '',
                        market: marketLabels[pick.market] || pick.market,
                        selection: pick.label || pick.type,
                        odds: pick.value
                    })),
                    stake: stake,
                    odds: totalOdds,
                    potentialReturn: totalPayout,
                    bonusPercentage: bonusPercentage,
                    bonusAmount: bonusAmount,
                    timestamp: new Date().toISOString(),
                    bookingCode: bookingCode
                });
                
                // Clear betslip
                betslip = [];
                document.getElementById('betslipStake').value = '';
                updateBetslip();
                displayMatches();
                loadMyBets();
                loadStats();
            } catch (err) {
                showMessage(err.message || 'Failed to place bet', 'error');
                console.error('Bet placement error:', err);
            }
        }

        function switchMarket(matchId, market) {
            currentMarket[matchId] = market;
            selectedMatch = null;
            selectedOdd = null;
            displayMatches();
        }

        function updatePayout(matchId) {
            const input = document.getElementById(`betAmount_${matchId}`);
            const payout = document.getElementById(`payout_${matchId}`);
            if (!selectedOdd || selectedMatch !== matchId) return;
            
            const amountUsd = parseFloat(input.value) || 0;
            if (amountUsd > 0) {
                const returnUsd = amountUsd * selectedOdd.value;
                const profitUsd = returnUsd - amountUsd;
                payout.textContent = `Potential Return: ${formatUsd(returnUsd)} (Profit: ${formatUsd(profitUsd)})`;
            } else {
                payout.textContent = '';
            }
        }

        async function placeBet(matchId) {
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }
            if (!selectedOdd || selectedMatch !== matchId) {
                showMessage('Please select odds first!', 'error');
                return;
            }

            const input = document.getElementById(`betAmount_${matchId}`);
            const amountUsd = parseFloat(input.value);
            if (!amountUsd || amountUsd <= 0) {
                showMessage('Enter a valid amount!', 'error');
                return;
            }

            try {
                const match = matches.find(m => m.id === matchId);
                const amountBtc = usdToBtc(amountUsd);
                const market = currentMarket[matchId] || '1x2';
                const marketLabel = {
                    '1x2': 'Match Result',
                    'gg': 'Both Teams Score',
                    'ou1': 'Over/Under 1.5',
                    'ou2': 'Over/Under 2.5',
                    'ou3': 'Over/Under 3.5',
                    'ah': 'Asian Handicap',
                    'dc': 'Double Chance',
                    'htft': 'HT/FT',
                    'cs': 'Correct Score'
                }[market] || market;
                const desc = `${match.home} vs ${match.away} - [${marketLabel}] ${selectedOdd.type.toUpperCase()} @ ${selectedOdd.value.toFixed(2)}`;

                const selection = selectedOdd.type;
                const betResponse = await client.createBet(amountBtc, selectedOdd.value, 'sports', desc, market, selection, null, matchId);
                
                showMessage(`âœ… Bet placed! ${formatUsd(amountUsd)} on ${match.home} vs ${match.away} (${marketLabel})`);
                if (window.triggerConfetti) try { window.triggerConfetti(); } catch(e) { /* ignore */ }
                
                // Show ticket
                showBetTicket({
                    id: betResponse.bet?.id || Date.now(),
                    type: 'Single Bet',
                    picks: [{
                        match: `${match.home} vs ${match.away}`,
                        league: match.league || 'League',
                        matchTime: match.match_date || match.time || '',
                        market: marketLabel,
                        selection: selectedOdd.type.toUpperCase(),
                        odds: selectedOdd.value
                    }],
                    stake: amountUsd,
                    odds: selectedOdd.value,
                    potentialReturn: amountUsd * selectedOdd.value,
                    timestamp: new Date().toISOString()
                });
                
                input.value = '';
                selectedOdd = null;
                loadMyBets();
                loadStats();
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        function toggleAuthForm() {
            document.getElementById('loginForm').classList.toggle('active');
            document.getElementById('registerForm').classList.toggle('active');
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(inputId + '-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;

            if (!acceptTerms) {
                showMessage('Please accept the Terms and Conditions to continue', 'error');
                return;
            }

            try {
                const response = await client.register(username, email, password);
                
                // Show success message prominently
                if (response.show_success_message) {
                    showMessage(response.message || 'âœ… Registration successful! Check your email for confirmation.', 'success');
                } else {
                    showMessage('âœ… Registration successful!');
                }
                
                updateAuthUI();
                
                // Switch to matches tab to show dashboard
                switchTab('matches');
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        async function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showMessage('New passwords do not match!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${client.token}`
                    },
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Password change failed');
                }
                
                // Show success message prominently
                if (data.show_success_message) {
                    showMessage(data.message || 'âœ… Password changed successfully! Check your email for confirmation.', 'success');
                } else {
                    showMessage('âœ… Password changed successfully!');
                }
                
                // Clear the form
                document.getElementById('changePasswordForm').reset();
                
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        function sendContactMessage(event) {
            event.preventDefault();
            
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            // In a real application, this would send to a backend API
            // For now, just show a success message
            showMessage(`âœ… Message sent successfully! We'll respond to ${email} within 24 hours.`, 'success');
            
            // Clear the form
            document.getElementById('contactForm').reset();
            
            // Log for development
            console.log('Contact form submitted:', { name, email, subject, message });
        }

        function showBetTicket(ticketData) {
            const modal = document.getElementById('ticketModal');
            const ticketId = document.getElementById('ticketId');
            const ticketBody = document.getElementById('ticketBody');
            
            // Generate ticket ID
            const ticketNumber = `ABK-${ticketData.id.toString().padStart(8, '0')}`;
            ticketId.textContent = `Ticket #${ticketNumber}`;
            
            // Format timestamp
            const date = new Date(ticketData.timestamp);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Build picks HTML
            const picksHtml = ticketData.picks.map(pick => {
                const pickOdds = pick.odds || pick.value || ticketData.odds;
                
                // Expand league abbreviations
                const leagueMap = {
                    'pl': 'Premier League',
                    'epl': 'Premier League',
                    'laliga': 'La Liga',
                    'll': 'La Liga',
                    'seriea': 'Serie A',
                    'sa': 'Serie A',
                    'bundesliga': 'Bundesliga',
                    'bl': 'Bundesliga',
                    'ligue1': 'Ligue 1',
                    'l1': 'Ligue 1',
                    'ucl': 'Champions League',
                    'uel': 'Europa League',
                    'worldcup': 'World Cup',
                    'wc': 'World Cup'
                };
                
                let leagueName = pick.league || '';
                if (leagueName && leagueName !== 'manual' && leagueName !== 'Manual') {
                    const lowerLeague = leagueName.toLowerCase().trim();
                    leagueName = leagueMap[lowerLeague] || leagueName;
                } else {
                    leagueName = ''; // Hide if manual or empty
                }
                
                // Format match time if available
                let matchInfo = '';
                if (leagueName || pick.matchTime) {
                    let timeStr = '';
                    if (pick.matchTime) {
                        try {
                            const matchDate = new Date(pick.matchTime);
                            if (!isNaN(matchDate.getTime())) {
                                timeStr = matchDate.toLocaleString('en-US', { 
                                    month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                                });
                            }
                        } catch (e) {
                            // Invalid date, skip
                        }
                    }
                    
                    if (leagueName || timeStr) {
                        matchInfo = `<div style="color: #60a5fa; font-size: 11px; margin-bottom: 4px; font-weight: 600;">
                            ${leagueName ? `<i class="fas fa-trophy"></i> ${leagueName}` : ''}
                            ${leagueName && timeStr ? ' â€¢ ' : ''}
                            ${timeStr ? `<i class="fas fa-clock"></i> ${timeStr}` : ''}
                        </div>`;
                    }
                }
                
                return `
                    <div class="ticket-pick-item">
                        <div class="ticket-pick-match">
                            ${matchInfo}
                            ${pick.match}
                        </div>
                        <div class="ticket-pick-selection">
                            <span>Selected: [${pick.market || 'Market'}] <strong>${pick.selection || pick.type}</strong></span>
                            <span class="ticket-pick-odds">${pickOdds.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Build ticket body
            ticketBody.innerHTML = `
                <div class="ticket-section">
                    <h3><i class="fas fa-info-circle"></i> Bet Information</h3>
                    <div class="ticket-row">
                        <span class="ticket-label">Bet Type:</span>
                        <span class="ticket-value">${ticketData.type}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Date & Time:</span>
                        <span class="ticket-value">${formattedDate}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Status:</span>
                        <span class="ticket-value" style="color: ${ticketData.isCashedOut ? '#10b981' : '#fbbf24'};">
                            <i class="fas fa-${ticketData.isCashedOut ? 'check-circle' : 'clock'}"></i> ${ticketData.isCashedOut ? 'Paid Out' : 'Pending'}
                        </span>
                    </div>
                </div>

                ${ticketData.bookingCode ? `
                <div class="ticket-section" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1)); border: 1px dashed #3b82f6; padding: 10px 15px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="color: #3b82f6; font-size: 10px; font-weight: 600; margin-bottom: 3px; text-transform: uppercase;">Booking Code</div>
                            <div id="bookingCodeDisplay" style="font-size: 18px; font-weight: bold; color: #3b82f6; letter-spacing: 2px; font-family: 'Courier New', monospace;">
                                ${ticketData.bookingCode}
                            </div>
                        </div>
                        <button onclick="copyBookingCode('${ticketData.bookingCode}')" style="padding: 6px 14px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; white-space: nowrap;">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                ` : ''}

                ${ticketData.isCashedOut ? `
                <div class="ticket-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border: 1px solid #10b981; padding: 10px 15px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="color: #10b981; font-size: 10px; font-weight: 600; margin-bottom: 3px; text-transform: uppercase;">Payout</div>
                            <div style="font-size: 16px; font-weight: bold; color: #10b981;" id="ticket-cashed-out-value">${formatUsd(btcToUsd(ticketData.cashedOutValue || 0))}</div>
                            <div style="color: #64748b; font-size: 9px; margin-top: 2px;">Bet was closed early</div>
                        </div>
                        <button disabled style="padding: 7px 16px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: not-allowed; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0.7;">
                            <i class="fas fa-check-circle"></i> Paid Out
                        </button>
                    </div>
                </div>
                ` : !ticketData.isCashedOut && ticketData.status === 'Active' ? `
                <div class="ticket-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border: 1px solid #10b981; padding: 10px 15px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="color: #10b981; font-size: 10px; font-weight: 600; margin-bottom: 3px; text-transform: uppercase;">Cashout Available</div>
                            <div style="font-size: 16px; font-weight: bold; color: #10b981;" id="ticket-cashout-value-${ticketData.betIdForCashout}">Loading...</div>
                            <div style="color: #64748b; font-size: 9px; margin-top: 2px;">100% < 1min, 85% after</div>
                        </div>
                        <button onclick="cashoutBet(${ticketData.betIdForCashout})" style="padding: 7px 16px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; white-space: nowrap; transition: all 0.3s ease;">
                            <i class="fas fa-money-bill-wave"></i> Cash Out
                        </button>
                    </div>
                </div>
                ` : ''}

                <div class="ticket-section">
                    <h3><i class="fas fa-list"></i> Your Selections</h3>
                    <div class="ticket-picks-list">
                        ${picksHtml}
                    </div>
                </div>

                <div class="ticket-section">
                    <h3><i class="fas fa-calculator"></i> Bet Details</h3>
                    <div class="ticket-row">
                        <span class="ticket-label">Stake Amount:</span>
                        <span class="ticket-value">${formatUsd(ticketData.stake)}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Total Odds:</span>
                        <span class="ticket-value">${ticketData.odds.toFixed(2)}</span>
                    </div>
                    ${ticketData.bonusPercentage > 0 ? `
                    <div class="ticket-row" style="background: rgba(16, 185, 129, 0.05); padding: 10px; border-radius: 6px; margin: 8px 0; border-left: 3px solid #10b981;">
                        <span class="ticket-label" style="color: #10b981;">
                            <i class="fas fa-gift"></i> Multi-Bet Bonus (${ticketData.bonusPercentage}%):
                        </span>
                        <span class="ticket-value" style="color: #10b981; font-weight: 800;">
                            +${formatUsd(ticketData.bonusAmount)}
                        </span>
                    </div>
                    ` : ''}
                    <div class="ticket-total">
                        <div class="ticket-row">
                            <span class="ticket-label">Potential Return:</span>
                            <span class="ticket-value">${formatUsd(ticketData.potentialReturn)}</span>
                        </div>
                        <div class="ticket-row">
                            <span class="ticket-label">Potential Profit:</span>
                            <span class="ticket-value" style="color: #10b981;">
                                ${formatUsd(ticketData.potentialReturn - ticketData.stake)}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="ticket-barcode">
                    <svg width="250" height="60">
                        <rect x="0" y="0" width="4" height="60" fill="#000"/>
                        <rect x="6" y="0" width="2" height="60" fill="#000"/>
                        <rect x="10" y="0" width="4" height="60" fill="#000"/>
                        <rect x="16" y="0" width="2" height="60" fill="#000"/>
                        <rect x="20" y="0" width="6" height="60" fill="#000"/>
                        <rect x="28" y="0" width="2" height="60" fill="#000"/>
                        <rect x="32" y="0" width="4" height="60" fill="#000"/>
                        <rect x="38" y="0" width="2" height="60" fill="#000"/>
                        <rect x="42" y="0" width="4" height="60" fill="#000"/>
                        <rect x="48" y="0" width="6" height="60" fill="#000"/>
                        <rect x="56" y="0" width="2" height="60" fill="#000"/>
                        <rect x="60" y="0" width="4" height="60" fill="#000"/>
                        <text x="125" y="55" text-anchor="middle" font-size="10" fill="#666">${ticketNumber}</text>
                    </svg>
                </div>

                <div style="text-align: center; color: #64748b; font-size: 12px; padding: 12px; background: rgba(100, 116, 139, 0.05); border-radius: 6px; margin-top: 16px;">
                    <i class="fas fa-shield-alt"></i> Keep this ticket safe. You may need the ticket number to claim winnings.
                </div>
            `;
            
            // Show modal and prevent body scroll
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Update cashout value if available
            if (ticketData.betIdForCashout && !ticketData.isCashedOut) {
                updateTicketCashoutValue(ticketData.betIdForCashout);
            }
        }

        async function updateTicketCashoutValue(betId) {
            const valueElement = document.getElementById(`ticket-cashout-value-${betId}`);
            if (!valueElement) return;
            
            try {
                const data = await client.getCashoutValue(betId);
                const cashoutBtc = parseFloat(data.cashout_value);
                const cashoutUsd = btcToUsd(cashoutBtc);
                const percentage = parseFloat(data.cashout_percentage);
                
                valueElement.innerHTML = `${formatUsd(cashoutUsd)} <span style="font-size: 11px; color: #64748b;">(${percentage.toFixed(1)}%)</span>`;
            } catch (err) {
                console.error('Failed to update ticket cashout value:', err);
                valueElement.textContent = 'Unavailable';
            }
        }

        function closeTicket() {
            document.getElementById('ticketModal').classList.remove('active');
            document.body.style.overflow = ''; // Re-enable body scroll
        }

        function closeTicketOnOverlay(event) {
            // Close ticket if clicking on the dark overlay (not the ticket content)
            if (event.target.id === 'ticketModal') {
                closeTicket();
            }
        }

        function printTicket() {
            window.print();
        }

        function copyBookingCode(code) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(code).then(function() {
                    showMessage('Booking code copied to clipboard!', 'success');
                }).catch(function() {
                    // Fallback for older browsers
                    copyToClipboardFallback(code);
                });
            } else {
                copyToClipboardFallback(code);
            }
        }

        function copyToClipboardFallback(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showMessage('Booking code copied!', 'success');
            } catch (err) {
                showMessage('Failed to copy code', 'error');
            }
            document.body.removeChild(textArea);
        }

        // Cashout functionality
        let cashoutUpdateInterval = null;

        async function updateAllCashoutValues(activeBets) {
            // Clear existing interval
            if (cashoutUpdateInterval) {
                clearInterval(cashoutUpdateInterval);
            }

            // Update immediately
            await updateCashoutValues(activeBets);

            // Then update every 5 seconds
            cashoutUpdateInterval = setInterval(() => {
                updateCashoutValues(activeBets);
            }, 5000);
        }

        async function updateCashoutValues(activeBets) {
            for (const bet of activeBets) {
                if (bet.is_cashed_out) continue;

                const valueElement = document.getElementById(`cashout-value-${bet.id}`);
                if (!valueElement) continue;

                try {
                    const data = await client.getCashoutValue(bet.id);
                    const cashoutBtc = parseFloat(data.cashout_value);
                    const cashoutUsd = btcToUsd(cashoutBtc);
                    const percentage = parseFloat(data.cashout_percentage);
                    
                    valueElement.innerHTML = `${formatUsd(cashoutUsd)} <span style="font-size: 12px; color: #64748b;">(${percentage.toFixed(1)}%)</span>`;
                } catch (err) {
                    console.error('Failed to update cashout value:', err);
                    valueElement.textContent = 'Unavailable';
                }
            }
        }

        async function cashoutBet(betId) {
            try {
                // Get current cashout value
                const data = await client.getCashoutValue(betId);
                const cashoutBtc = parseFloat(data.cashout_value);
                const cashoutUsd = btcToUsd(cashoutBtc);
                const percentage = parseFloat(data.cashout_percentage);

                // Confirm with user
                const confirmed = confirm(
                    `Cash out this bet for ${formatUsd(cashoutUsd)}?\n\n` +
                    `Current cashout: ${percentage.toFixed(1)}% of your stake amount.\n` +
                    `(100% refund before 1 min, 85% after with 15% fee)\n\n` +
                    `This action cannot be undone.`
                );

                if (!confirmed) return;

                // Disable cashout button to prevent double clicks
                const betElement = document.getElementById(`bet-${betId}`);
                const cashoutButton = betElement.querySelector('button[onclick*="cashoutBet"]');
                if (cashoutButton) {
                    cashoutButton.disabled = true;
                    cashoutButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                }

                // Execute cashout
                const result = await client.cashoutBet(betId);
                
                showMessage(`âœ… Bet cashed out successfully! ${formatUsd(cashoutUsd)} credited to your balance`, 'success');
                
                // Close ticket modal if open
                const modal = document.getElementById('ticketModal');
                if (modal && modal.classList.contains('active')) {
                    closeTicket();
                }
                
                // Refresh data
                await loadMyBets();
                await loadStats();
                
            } catch (err) {
                showMessage(err.message || 'Failed to cash out bet', 'error');
                
                // Re-enable button on error
                const betElement = document.getElementById(`bet-${betId}`);
                const cashoutButton = betElement.querySelector('button[onclick*="cashoutBet"]');
                if (cashoutButton) {
                    cashoutButton.disabled = false;
                    cashoutButton.innerHTML = '<i class="fas fa-money-bill-wave"></i> Cash Out';
                }
            }
        }



        async function loadBookingCode() {
            const input = document.getElementById('bookingCodeInput');
            const code = input.value.trim().toUpperCase();
            
            if (!code || code.length !== 10) {
                showMessage('Please enter a valid 10-character booking code', 'error');
                return;
            }
            
            try {
                const response = await client.loadBookingCode(code);
                const loadedBets = JSON.parse(response.bet_data);
                
                // Clear current betslip
                betslip = [];
                
                // Load picks from booking code
                betslip = loadedBets;
                
                updateBetslip();
                showMessage(`âœ… Loaded ${loadedBets.length} picks from booking code ${code}`, 'success');
                input.value = '';
                
                // Scroll to top to see loaded betslip
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (err) {
                showMessage(err.message || 'Invalid or expired booking code', 'error');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('ticketModal');
            if (event.target === modal) {
                closeTicket();
            }
        });

        function viewBetTicket(betId, description, stake, odds, potentialReturn, createdAt, status, bookingCode, isCashedOut, betIdForCashout, cashedOutValue, matchData) {
            console.log('viewBetTicket called with:', {betId, description, matchData, typeOfMatchData: typeof matchData});
            
            // Parse the description to extract picks
            const picks = [];
            let matchScores = null;
            
            // Parse match data if provided
            if (matchData && matchData !== 'null' && matchData !== null) {
                // matchData is already parsed as JSON by the browser
                matchScores = matchData;
                console.log('Parsed match scores:', matchScores);
            }
            
            // Check if it's a multi-bet
            if (description.includes('MULTI:')) {
                const pickStrings = description.replace('MULTI: ', '').split(' | ');
                pickStrings.forEach(pickStr => {
                    // Updated regex to capture individual odds
                    const match = pickStr.match(/(.+?) \[(.+?)\] (.+?) @(.+)/);
                    if (match) {
                        picks.push({
                            match: match[1].trim(),
                            market: match[2].trim(),
                            selection: match[3].trim(),
                            odds: parseFloat(match[4]) || 1.00,
                            league: '',
                            matchTime: ''
                        });
                    } else {
                        // Fallback for old format without odds
                        const oldMatch = pickStr.match(/(.+?) \[(.+?)\] (.+)/);
                        if (oldMatch) {
                            picks.push({
                                match: oldMatch[1].trim(),
                                market: oldMatch[2].trim(),
                                selection: oldMatch[3].trim(),
                                odds: (odds / pickStrings.length).toFixed(2),
                                league: '',
                                matchTime: ''
                            });
                        }
                    }
                });
            } else {
                // Single bet - parse the description
                const match = description.match(/(.+?) - \[(.+?)\] (.+?) @ (.+)/);
                if (match) {
                    picks.push({
                        match: match[1].trim(),
                        market: match[2].trim(),
                        selection: match[3].trim(),
                        odds: parseFloat(match[4]) || odds,
                        league: '',
                        matchTime: ''
                    });
                } else {
                    // Fallback if pattern doesn't match
                    picks.push({
                        match: description,
                        market: 'Sports Bet',
                        selection: 'Selected',
                        odds: odds,
                        league: '',
                        matchTime: ''
                    });
                }
            }
            
            // Determine bet type based on the description format
            const betType = description.includes('MULTI:') ? 'Multi-Bet' : 'Single Bet';
            
            // Calculate bonus for multi-bets
            let bonusPercentage = 0;
            let bonusAmount = 0;
            if (picks.length >= 3) {
                if (picks.length >= 10) bonusPercentage = 15;
                else if (picks.length >= 8) bonusPercentage = 10;
                else if (picks.length >= 6) bonusPercentage = 7;
                else if (picks.length >= 5) bonusPercentage = 5;
                else if (picks.length >= 4) bonusPercentage = 3;
                else if (picks.length >= 3) bonusPercentage = 2;
                
                const basePayout = stake * odds;
                bonusAmount = basePayout * (bonusPercentage / 100);
            }
            
            // Map status
            const statusMap = {
                'pending': 'Pending',
                'won': 'Won',
                'lost': 'Lost',
                'void': 'Void',
                'active': 'Active'
            };
            
            console.log('About to call showBetTicket with matchScores:', matchScores);
            
            const ticketData = {
                id: betId,
                type: betType,
                picks: picks,
                stake: stake,
                odds: odds,
                potentialReturn: potentialReturn,
                bonusPercentage: bonusPercentage,
                bonusAmount: bonusAmount,
                timestamp: createdAt,
                status: statusMap[status.toLowerCase()] || 'Active',
                bookingCode: bookingCode,
                isCashedOut: isCashedOut,
                betIdForCashout: betIdForCashout,
                cashedOutValue: cashedOutValue,
                matchScores: matchScores
            };
            
            showBetTicketFromBet(ticketData);
        }

        function showBetTicketFromBet(ticketData) {
            const modal = document.getElementById('ticketModal');
            const ticketId = document.getElementById('ticketId');
            const ticketBody = document.getElementById('ticketBody');
            
            // Generate ticket ID
            const ticketNumber = `ABK-${ticketData.id.toString().padStart(8, '0')}`;
            ticketId.textContent = `Ticket #${ticketNumber}`;
            
            // Format timestamp
            const date = new Date(ticketData.timestamp);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Build picks HTML with match scores if available
            const picksHtml = ticketData.picks.map((pick, index) => {
                const pickOdds = pick.odds || pick.value || ticketData.odds;
                
                // Clean the match name - remove any odds that might be embedded
                let cleanMatch = pick.match;
                // Remove patterns like "@2.50" or "2.50" at the end
                cleanMatch = cleanMatch.replace(/\s*@?\d+\.\d+\s*$/, '').trim();
                // Remove patterns like "(2.50)" at the end
                cleanMatch = cleanMatch.replace(/\s*\(\d+\.\d+\)\s*$/, '').trim();
                
                // Add score display if match data is available and bet is settled
                let scoreDisplay = '';
                if (ticketData.matchScores && (ticketData.status === 'Won' || ticketData.status === 'Lost')) {
                    // Check if matchScores is an array (multi-bet) or single object
                    if (Array.isArray(ticketData.matchScores)) {
                        const matchScore = ticketData.matchScores[index];
                        if (matchScore && matchScore.home_score !== null && matchScore.away_score !== null) {
                            scoreDisplay = ` <span style="color: #10b981; font-weight: bold;">[${matchScore.home_score}-${matchScore.away_score}]</span>`;
                        }
                    } else if (ticketData.matchScores.home_score !== null && ticketData.matchScores.away_score !== null) {
                        scoreDisplay = ` <span style="color: #10b981; font-weight: bold;">[${ticketData.matchScores.home_score}-${ticketData.matchScores.away_score}]</span>`;
                    }
                }
                
                // Expand league abbreviations
                const leagueMap = {
                    'pl': 'Premier League',
                    'epl': 'Premier League',
                    'laliga': 'La Liga',
                    'll': 'La Liga',
                    'seriea': 'Serie A',
                    'sa': 'Serie A',
                    'bundesliga': 'Bundesliga',
                    'bl': 'Bundesliga',
                    'ligue1': 'Ligue 1',
                    'l1': 'Ligue 1',
                    'ucl': 'Champions League',
                    'uel': 'Europa League',
                    'worldcup': 'World Cup',
                    'wc': 'World Cup'
                };
                
                let leagueName = pick.league || '';
                if (leagueName && leagueName !== 'manual' && leagueName !== 'Manual') {
                    const lowerLeague = leagueName.toLowerCase().trim();
                    leagueName = leagueMap[lowerLeague] || leagueName;
                } else {
                    leagueName = ''; // Hide if manual or empty
                }
                
                // Format match time if available
                let matchInfo = '';
                if (leagueName || pick.matchTime) {
                    let timeStr = '';
                    if (pick.matchTime) {
                        try {
                            const matchDate = new Date(pick.matchTime);
                            if (!isNaN(matchDate.getTime())) {
                                timeStr = matchDate.toLocaleString('en-US', { 
                                    month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                                });
                            }
                        } catch (e) {
                            // Invalid date, skip
                        }
                    }
                    
                    if (leagueName || timeStr) {
                        matchInfo = `<div style="color: #60a5fa; font-size: 11px; margin-bottom: 4px; font-weight: 600;">
                            ${leagueName ? `<i class="fas fa-trophy"></i> ${leagueName}` : ''}
                            ${leagueName && timeStr ? ' â€¢ ' : ''}
                            ${timeStr ? `<i class="fas fa-clock"></i> ${timeStr}` : ''}
                        </div>`;
                    }
                }
                
                return `
                    <div class="ticket-pick-item">
                        <div class="ticket-pick-match">
                            ${matchInfo}
                            ${cleanMatch}${scoreDisplay}
                        </div>
                        <div class="ticket-pick-selection">
                            <span>Selected: [${pick.market || 'Market'}] <strong>${pick.selection || pick.type}</strong></span>
                            <span class="ticket-pick-odds">${pickOdds.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Status styling
            const statusColors = {
                'Pending': '#fbbf24',
                'Active': '#fbbf24',
                'Won': '#10b981',
                'Lost': '#ef4444',
                'Void': '#64748b'
            };
            const statusIcons = {
                'Pending': 'clock',
                'Active': 'clock',
                'Won': 'check-circle',
                'Lost': 'times-circle',
                'Void': 'ban'
            };
            const statusColor = statusColors[ticketData.status] || '#fbbf24';
            const statusIcon = statusIcons[ticketData.status] || 'clock';
            
            // Build ticket body
            ticketBody.innerHTML = `
                <div class="ticket-section">
                    <h3><i class="fas fa-info-circle"></i> Bet Information</h3>
                    <div class="ticket-row">
                        <span class="ticket-label">Bet Type:</span>
                        <span class="ticket-value">${ticketData.type}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Date & Time:</span>
                        <span class="ticket-value">${formattedDate}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Status:</span>
                        <span class="ticket-value" style="color: ${statusColor};">
                            <i class="fas fa-${statusIcon}"></i> ${ticketData.status}
                        </span>
                    </div>
                </div>

                <div class="ticket-section">
                    <h3><i class="fas fa-list"></i> Your Selections</h3>
                    <div class="ticket-picks-list">
                        ${picksHtml}
                    </div>
                </div>

                <div class="ticket-section">
                    <h3><i class="fas fa-calculator"></i> Bet Details</h3>
                    <div class="ticket-row">
                        <span class="ticket-label">Stake Amount:</span>
                        <span class="ticket-value">${formatUsd(ticketData.stake)}</span>
                    </div>
                    <div class="ticket-row">
                        <span class="ticket-label">Total Odds:</span>
                        <span class="ticket-value">${ticketData.odds.toFixed(2)}</span>
                    </div>
                    ${ticketData.bonusPercentage > 0 ? `
                    <div class="ticket-row" style="background: rgba(16, 185, 129, 0.05); padding: 10px; border-radius: 6px; margin: 8px 0; border-left: 3px solid #10b981;">
                        <span class="ticket-label" style="color: #10b981;">
                            <i class="fas fa-gift"></i> Multi-Bet Bonus (${ticketData.bonusPercentage}%):
                        </span>
                        <span class="ticket-value" style="color: #10b981; font-weight: 800;">
                            +${formatUsd(ticketData.bonusAmount)}
                        </span>
                    </div>
                    ` : ''}
                    <div class="ticket-total">
                        ${ticketData.status === 'Won' || ticketData.status === 'Lost' ? `
                        <div class="ticket-row" style="background: ${ticketData.status === 'Won' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; padding: 12px; border-radius: 8px; margin: 10px 0; border: 2px solid ${ticketData.status === 'Won' ? '#10b981' : '#ef4444'};">
                            <span class="ticket-label" style="font-size: 16px; font-weight: bold; color: ${ticketData.status === 'Won' ? '#10b981' : '#ef4444'};">
                                <i class="fas fa-${ticketData.status === 'Won' ? 'trophy' : 'times-circle'}"></i> ${ticketData.status === 'Won' ? 'YOU WON!' : 'BET LOST'}
                            </span>
                        </div>
                        <div class="ticket-row">
                            <span class="ticket-label">${ticketData.status === 'Won' ? 'Actual Payout:' : 'Potential Return:'}</span>
                            <span class="ticket-value" style="${ticketData.status === 'Lost' ? 'text-decoration: line-through; color: #64748b;' : 'color: #10b981; font-weight: bold; font-size: 18px;'}">
                                ${formatUsd(ticketData.potentialReturn)}
                            </span>
                        </div>
                        <div class="ticket-row">
                            <span class="ticket-label">${ticketData.status === 'Won' ? 'Net Profit:' : 'Amount Lost:'}</span>
                            <span class="ticket-value" style="color: ${ticketData.status === 'Won' ? '#10b981' : '#ef4444'}; font-weight: bold; font-size: 16px;">
                                ${ticketData.status === 'Won' ? '+' : '-'}${formatUsd(ticketData.status === 'Won' ? ticketData.potentialReturn - ticketData.stake : ticketData.stake)}
                            </span>
                        </div>
                        ` : `
                        <div class="ticket-row">
                            <span class="ticket-label">Potential Return:</span>
                            <span class="ticket-value">${formatUsd(ticketData.potentialReturn)}</span>
                        </div>
                        <div class="ticket-row">
                            <span class="ticket-label">Potential Profit:</span>
                            <span class="ticket-value" style="color: #10b981;">
                                ${formatUsd(ticketData.potentialReturn - ticketData.stake)}
                            </span>
                        </div>
                        `}
                    </div>
                </div>

                <div class="ticket-barcode">
                    <svg width="250" height="60">
                        <rect x="0" y="0" width="4" height="60" fill="#000"/>
                        <rect x="6" y="0" width="2" height="60" fill="#000"/>
                        <rect x="10" y="0" width="4" height="60" fill="#000"/>
                        <rect x="16" y="0" width="2" height="60" fill="#000"/>
                        <rect x="20" y="0" width="6" height="60" fill="#000"/>
                        <rect x="28" y="0" width="2" height="60" fill="#000"/>
                        <rect x="32" y="0" width="4" height="60" fill="#000"/>
                        <rect x="38" y="0" width="2" height="60" fill="#000"/>
                        <rect x="42" y="0" width="4" height="60" fill="#000"/>
                        <rect x="48" y="0" width="6" height="60" fill="#000"/>
                        <rect x="56" y="0" width="2" height="60" fill="#000"/>
                        <rect x="60" y="0" width="4" height="60" fill="#000"/>
                        <text x="125" y="55" text-anchor="middle" font-size="10" fill="#666">${ticketNumber}</text>
                    </svg>
                </div>

                <div style="text-align: center; color: #64748b; font-size: 12px; padding: 12px; background: rgba(100, 116, 139, 0.05); border-radius: 6px; margin-top: 16px;">
                    <i class="fas fa-shield-alt"></i> Keep this ticket safe. You may need the ticket number to claim winnings.
                </div>
            `;
            
            // Show modal
            modal.classList.add('active');
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await client.login(username, password);
                showMessage('âœ… Logged in!');
                
                // Ensure all modals are closed
                closeAllModals();
                
                updateAuthUI();
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        // Forgot Password Functions
        function showForgotPassword() {
            document.getElementById('forgotPasswordModal').style.display = 'block';
            document.getElementById('forgotPasswordStep1').style.display = 'block';
            document.getElementById('forgotPasswordStep2').style.display = 'none';
            document.getElementById('forgotPasswordEmail').value = '';
        }

        function closeForgotPassword() {
            document.getElementById('forgotPasswordModal').style.display = 'none';
        }

        // Close all modals helper function
        function closeAllModals() {
            // Close forgot password modal
            const forgotModal = document.getElementById('forgotPasswordModal');
            if (forgotModal) forgotModal.style.display = 'none';
            
            // Close ticket modal
            const ticketModal = document.getElementById('ticketModal');
            if (ticketModal) ticketModal.classList.remove('active');
            
            // Any other modals can be added here
        }

        async function requestPasswordReset() {
            const email = document.getElementById('forgotPasswordEmail').value;
            
            if (!email) {
                showMessage('Please enter your email address', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('forgotPasswordStep1').style.display = 'none';
                    document.getElementById('forgotPasswordStep2').style.display = 'block';
                    showMessage(data.message, 'success');
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                console.error('Forgot password error:', error);
                showMessage('Failed to send reset email. Please try again.', 'error');
            }
        }

        function logout() {
            client.logout();
            
            // Clear all user data from UI
            document.getElementById('myBetsList').innerHTML = '<p style="color: #64748b;">Please login to view your bets</p>';
            document.getElementById('walletBalanceUsd').textContent = '$0.00';
            document.getElementById('transactionsList').innerHTML = '<p style="color: #64748b;">No transactions</p>';
            
            // Clear deposit history
            const myDepositsDiv = document.getElementById('myDeposits');
            if (myDepositsDiv) {
                myDepositsDiv.style.display = 'none';
                const depositsList = document.getElementById('depositsList');
                if (depositsList) {
                    depositsList.innerHTML = '';
                }
            }
            
            // Reset deposit form
            const depositStep1 = document.getElementById('depositStep1');
            const depositStep2 = document.getElementById('depositStep2');
            if (depositStep1 && depositStep2) {
                depositStep1.style.display = 'block';
                depositStep2.style.display = 'none';
            }
            const depositMethod = document.getElementById('depositMethod');
            const depositAmount = document.getElementById('depositAmount');
            const depositReference = document.getElementById('depositReference');
            const depositProof = document.getElementById('depositProof');
            if (depositMethod) depositMethod.value = '';
            if (depositAmount) depositAmount.value = '';
            if (depositReference) depositReference.value = '';
            if (depositProof) depositProof.value = '';
            
            // Clear withdrawal history
            const myWithdrawalsDiv = document.getElementById('myWithdrawals');
            if (myWithdrawalsDiv) {
                myWithdrawalsDiv.style.display = 'none';
                const withdrawalsList = document.getElementById('withdrawalsList');
                if (withdrawalsList) withdrawalsList.innerHTML = '';
            }
            // Reset withdrawal form
            const withdrawStep1 = document.getElementById('withdrawStep1');
            const withdrawStep2 = document.getElementById('withdrawStep2');
            if (withdrawStep1 && withdrawStep2) {
                withdrawStep1.style.display = 'block';
                withdrawStep2.style.display = 'none';
            }
            const withdrawMethod = document.getElementById('withdrawMethod');
            const withdrawAmountInput = document.getElementById('withdrawAmount');
            if (withdrawMethod) withdrawMethod.value = '';
            if (withdrawAmountInput) withdrawAmountInput.value = '';
            
            // Clear stats
            document.getElementById('statTotalBets').textContent = '0';
            document.getElementById('statWonBets').textContent = '0';
            document.getElementById('statLostBets').textContent = '0';
            document.getElementById('statActiveBets').textContent = '0';
            document.getElementById('statWinRate').textContent = '0.0%';
            
            // Clear betslip
            betslip = [];
            updateBetslip();
            
            updateAuthUI();
            showMessage('Logged out');
            
            // Switch to home tab
            switchTab('home');
        }

        async function refreshUserBalance() {
            try {
                if (!client.isLoggedIn()) return;
                
                // Fetch fresh user data
                const response = await client.request('/auth/profile');
                if (response.user) {
                    // Update client.user
                    client.user = response.user;
                    
                    // Update UI - balance is already in USD
                    const balanceUsd = parseFloat(client.user.balance) || 0;
                    document.getElementById('profileBalance').textContent = formatUsd(balanceUsd);
                    document.getElementById('headerBalance').textContent = `Balance: ${formatUsd(balanceUsd)}`;
                }
            } catch (err) {
                console.error('Error refreshing balance:', err);
            }
        }

        function updateAuthUI() {
            if (client.isLoggedIn() && client.user) {
                document.getElementById('loginForm').classList.remove('active');
                document.getElementById('registerForm').classList.remove('active');
                document.getElementById('profileInfo').classList.add('active');
                document.getElementById('profileUsername').textContent = client.user.username || '';
                document.getElementById('profileEmail').textContent = client.user.email || '';
                
                // Balance is already in USD
                const balanceUsd = parseFloat(client.user.balance) || 0;
                document.getElementById('profileBalance').textContent = formatUsd(balanceUsd);
                document.getElementById('headerBalance').classList.add('active');
                document.getElementById('headerBalance').textContent = `Balance: ${formatUsd(balanceUsd)}`;
                
                // Update account dropdown
                document.getElementById('accountBtnText').textContent = client.user.username || 'Account';
                document.getElementById('loginMenuItem').style.display = 'none';
                document.getElementById('profileMenuItem').style.display = 'flex';
                document.getElementById('logoutMenuItem').style.display = 'flex';
                
                // Show restricted tabs when logged in
                document.getElementById('mybetsTab').style.display = 'inline-block';
                document.getElementById('premiumTab').style.display = 'inline-block';
                document.getElementById('crashTab').style.display = 'inline-block';
                document.getElementById('diceTab').style.display = 'inline-block';
                document.getElementById('minesTab').style.display = 'inline-block';
                document.getElementById('plinkoTab').style.display = 'inline-block';
                document.getElementById('virtualTab').style.display = 'inline-block';
                document.getElementById('walletTab').style.display = 'inline-block';
                document.getElementById('statsTab').style.display = 'inline-block';
                
                // Load data with error handling to prevent UI blocking
                setTimeout(() => {
                    try { loadWallet(); } catch(e) { console.error('loadWallet error:', e); }
                    try { loadMyBets(); } catch(e) { console.error('loadMyBets error:', e); }
                    try { loadStats(); } catch(e) { console.error('loadStats error:', e); }
                }, 100);
            } else {
                document.getElementById('loginForm').classList.add('active');
                document.getElementById('registerForm').classList.remove('active');
                document.getElementById('profileInfo').classList.remove('active');
                document.getElementById('headerBalance').classList.remove('active');
                
                // Update account dropdown
                document.getElementById('accountBtnText').textContent = 'Account';
                document.getElementById('loginMenuItem').style.display = 'flex';
                document.getElementById('profileMenuItem').style.display = 'none';
                document.getElementById('logoutMenuItem').style.display = 'none';
                
                // Hide restricted tabs when not logged in
                document.getElementById('mybetsTab').style.display = 'none';
                document.getElementById('premiumTab').style.display = 'none';
                document.getElementById('crashTab').style.display = 'none';
                document.getElementById('diceTab').style.display = 'none';
                document.getElementById('minesTab').style.display = 'none';
                document.getElementById('plinkoTab').style.display = 'none';
                document.getElementById('virtualTab').style.display = 'none';
                document.getElementById('walletTab').style.display = 'none';
                document.getElementById('statsTab').style.display = 'none';
            }
        }

        async function loadWallet() {
            try {
                const balance = await client.getBalance();
                const wallet = await client.getWallet();
                const transactions = await client.getTransactions(5);

                // Balance is already in USD
                const balanceUsd = balance.balance || balance.balance_usd || 0;
                document.getElementById('walletBalanceUsd').textContent = formatUsd(balanceUsd);

                const txHtml = transactions.transactions.length > 0 
                    ? transactions.transactions.map(tx => {
                        const amountUsd = parseFloat(tx.amount) || 0;
                        return `
                            <div class="bet-item">
                                <h4>${tx.type.toUpperCase()}</h4>
                                <p><span>${formatUsd(amountUsd)}</span></p>
                                <p><span>Status:</span> <span>${tx.status}</span></p>
                                <p><span>Date:</span> <span>${new Date(tx.created_at).toLocaleString()}</span></p>
                            </div>
                        `;
                    }).join('')
                    : '<p style="color: #64748b;">No transactions yet</p>';
                
                document.getElementById('transactionsList').innerHTML = txHtml;
                
                // Load deposit requests when wallet loads
                if (typeof loadMyDeposits === 'function') {
                    loadMyDeposits();
                }
                // Load withdrawal requests when wallet loads
                if (typeof loadMyWithdrawals === 'function') {
                    loadMyWithdrawals();
                }
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        // Old deposit function - keeping for backwards compatibility
        async function depositFunds(event) {
            event.preventDefault();
            showMessage('Please use the new deposit form with payment details', 'error');
        }

        // New deposit system functions
        // Update method info when payment method changes
        async function updateMethodInfo() {
            const method = document.getElementById('depositMethod').value;
            const infoDiv = document.getElementById('methodInfo');
            
            if (!method) {
                infoDiv.style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`/api/deposit/method/${method}`);
                const data = await response.json();
                
                if (response.ok) {
                    selectedPaymentMethod = data.method;
                    document.getElementById('processingTime').textContent = data.method.details.processing_time;
                    document.getElementById('minDeposit').textContent = data.method.min_deposit;
                    document.getElementById('maxDeposit').textContent = data.method.max_deposit;
                    document.getElementById('depositAmount').min = data.method.min_deposit;
                    document.getElementById('depositAmount').max = data.method.max_deposit;
                    infoDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching payment method:', error);
            }
        }

        // Show payment details (Step 2)
        function showPaymentDetails(event) {
            event.preventDefault();
            
            console.log('showPaymentDetails called');
            
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }
            
            const method = document.getElementById('depositMethod').value;
            const amount = parseFloat(document.getElementById('depositAmount').value);
            
            console.log('Method:', method, 'Amount:', amount, 'selectedPaymentMethod:', selectedPaymentMethod);
            
            if (!method) {
                showMessage('Please select a payment method', 'error');
                return;
            }
            
            if (!selectedPaymentMethod) {
                showMessage('Payment method details not loaded. Please select the method again.', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showMessage('Please enter a valid amount', 'error');
                return;
            }
            
            if (amount < selectedPaymentMethod.min_deposit || amount > selectedPaymentMethod.max_deposit) {
                showMessage(`Amount must be between $${selectedPaymentMethod.min_deposit} and $${selectedPaymentMethod.max_deposit}`, 'error');
                return;
            }
            
            depositAmount = amount;
            
            // Build payment details HTML
            const details = selectedPaymentMethod.details;
            let detailsHTML = '';
            
            if (method === 'bitcoin' || method === 'usdt') {
                detailsHTML = `
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Wallet Address:</strong>
                        <div style="background: #0f172a; padding: 10px; border-radius: 4px; margin-top: 4px; word-break: break-all; font-family: monospace;">
                            ${details.address}
                        </div>
                        <button type="button" onclick="copyToClipboard('${details.address}')" style="margin-top: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-copy"></i> Copy Address
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;"><strong>Network:</strong> ${details.network}</div>
                    <div style="margin-bottom: 8px;"><strong>Amount to Send:</strong> $${amount.toFixed(2)} USD</div>
                `;
            } else if (method === 'bank_transfer') {
                // Show country and bank selection for Africa
                const countries = details.countries;
                let countryOptions = '';
                let bankHTML = '';
                
                // Build country dropdown
                Object.keys(countries).forEach(key => {
                    const country = countries[key];
                    const disabled = !country.available ? 'disabled' : '';
                    const comingSoon = !country.available ? ' (Coming Soon)' : '';
                    countryOptions += `<option value="${key}" ${disabled}>${country.name}${comingSoon}</option>`;
                });
                
                // For Nigeria, show banks
                if (countries.nigeria && countries.nigeria.available) {
                    const banks = countries.nigeria.banks;
                    bankHTML = `
                        <div id="bankSelector" style="margin-top: 16px; display: none;">
                            <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Select Bank:</label>
                            <select id="selectedBank" onchange="showBankDetails()" style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;">
                                <option value="">-- Choose Your Bank --</option>
                                ${banks.map((bank, idx) => `<option value="${idx}">${bank.bank_name}</option>`).join('')}
                            </select>
                            <div id="bankDetailsDisplay" style="display: none;"></div>
                        </div>
                    `;
                }
                
                detailsHTML = `
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Select Country:</label>
                    <select id="countrySelector" onchange="handleCountryChange()" style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;">
                        <option value="">-- Select Your Country --</option>
                        ${countryOptions}
                    </select>
                    ${bankHTML}
                    <div style="margin-top: 16px;"><strong>Amount to Send:</strong> $${amount.toFixed(2)} USD</div>
                    <div style="color: #f59e0b; font-size: 13px; margin-top: 8px;"><i class="fas fa-info-circle"></i> Use your username as the transfer reference</div>
                `;
                
                // Store banks data for later use
                window.nigeriaBanks = countries.nigeria ? countries.nigeria.banks : [];
            } else if (method === 'paypal' || method === 'skrill') {
                detailsHTML = `
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Send Payment To:</strong>
                        <div style="background: #0f172a; padding: 10px; border-radius: 4px; margin-top: 4px; font-family: monospace;">
                            ${details.email}
                        </div>
                        <button type="button" onclick="copyToClipboard('${details.email}')" style="margin-top: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-copy"></i> Copy Email
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;"><strong>Amount to Send:</strong> $${amount.toFixed(2)} USD</div>
                    <div style="color: #f59e0b; font-size: 13px; margin-top: 8px;"><i class="fas fa-info-circle"></i> Add your username in the payment note</div>
                `;
            } else if (method === 'mobile_money') {
                detailsHTML = `
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Send Mobile Money To:</strong>
                        <div style="background: #0f172a; padding: 10px; border-radius: 4px; margin-top: 4px; font-size: 18px; font-weight: bold;">
                            ${details.phone}
                        </div>
                        <button type="button" onclick="copyToClipboard('${details.phone}')" style="margin-top: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-copy"></i> Copy Number
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;"><strong>Amount to Send:</strong> $${amount.toFixed(2)} USD</div>
                    <div style="color: #f59e0b; font-size: 13px; margin-top: 8px;"><i class="fas fa-info-circle"></i> Use your username as reference when sending</div>
                `;
            }
            
            document.getElementById('paymentDetailsContent').innerHTML = detailsHTML;
            
            // Build instructions HTML
            const instructions = selectedPaymentMethod.instructions;
            let instructionsHTML = '<ol style="margin: 0; padding-left: 20px;">';
            instructions.forEach(instruction => {
                instructionsHTML += `<li style="margin-bottom: 6px;">${instruction}</li>`;
            });
            instructionsHTML += '</ol>';
            document.getElementById('paymentInstructions').innerHTML = instructionsHTML;
            
            // Switch to step 2
            document.getElementById('depositStep1').style.display = 'none';
            document.getElementById('depositStep2').style.display = 'block';
        }

        // Back to step 1
        function backToStep1() {
            document.getElementById('depositStep2').style.display = 'none';
            document.getElementById('depositStep1').style.display = 'block';
        }

        // Submit deposit request
        async function submitDepositRequest(event) {
            event.preventDefault();
            
            const method = document.getElementById('depositMethod').value;
            const reference = document.getElementById('depositReference').value;
            const proof = document.getElementById('depositProof').value;
            
            try {
                const response = await client.request('/deposit/request', {
                    method: 'POST',
                    body: JSON.stringify({
                        amount: depositAmount,
                        payment_method: method,
                        transaction_reference: reference,
                        payment_proof: proof
                    })
                });
                
                showMessage('âœ… Deposit request submitted! Admin will review and approve shortly.');
                
                // Reset form
                document.getElementById('depositStep2').style.display = 'none';
                document.getElementById('depositStep1').style.display = 'block';
                document.getElementById('depositMethod').value = '';
                document.getElementById('depositAmount').value = '';
                document.getElementById('depositReference').value = '';
                document.getElementById('depositProof').value = '';
                document.getElementById('methodInfo').style.display = 'none';
                
                // Load user's deposit requests
                loadMyDeposits();
                
            } catch (error) {
                showMessage(`âŒ ${error.message}`, 'error');
            }
        }

        // Load user's deposit requests
        async function loadMyDeposits() {
            try {
                const response = await client.request('/deposit/my-requests');
                const deposits = response.deposits;
                
                if (deposits.length === 0) {
                    document.getElementById('myDeposits').style.display = 'none';
                    return;
                }
                
                let html = '';
                deposits.forEach(deposit => {
                    const statusColor = deposit.status === 'approved' ? '#10b981' : 
                                       deposit.status === 'rejected' ? '#ef4444' : '#f59e0b';
                    const statusIcon = deposit.status === 'approved' ? 'check-circle' :
                                      deposit.status === 'rejected' ? 'times-circle' : 'clock';
                    
                    html += `
                        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 6px; padding: 12px; margin-bottom: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 16px; font-weight: bold; color: #e2e8f0;">$${deposit.amount.toFixed(2)}</div>
                                    <div style="font-size: 13px; color: #94a3b8;">${deposit.payment_method} â€¢ ${new Date(deposit.created_at).toLocaleDateString()}</div>
                                </div>
                                <div style="text-align: right;">
                                    <span style="color: ${statusColor}; font-size: 14px; font-weight: bold;">
                                        <i class="fas fa-${statusIcon}"></i> ${deposit.status.toUpperCase()}
                                    </span>
                                </div>
                            </div>
                            ${deposit.admin_notes ? `<div style="margin-top: 8px; padding: 8px; background: #0f172a; border-radius: 4px; font-size: 12px; color: #94a3b8;"><strong>Note:</strong> ${deposit.admin_notes}</div>` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('depositsList').innerHTML = html;
                document.getElementById('myDeposits').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading deposits:', error);
            }
        }

        // Copy to clipboard utility
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('âœ… Copied to clipboard!');
            }).catch(() => {
                showMessage('Failed to copy', 'error');
            });
        }

        // Handle country selection for bank transfer
        function handleCountryChange() {
            const country = document.getElementById('countrySelector').value;
            const bankSelector = document.getElementById('bankSelector');
            
            if (country === 'nigeria') {
                bankSelector.style.display = 'block';
            } else if (country) {
                // Show coming soon message for other countries
                showMessage('Bank transfers for this country will be available soon!', 'error');
                bankSelector.style.display = 'none';
            } else {
                bankSelector.style.display = 'none';
            }
        }

        // Show selected bank details
        function showBankDetails() {
            const bankIndex = document.getElementById('selectedBank').value;
            const bankDetailsDisplay = document.getElementById('bankDetailsDisplay');
            
            if (!bankIndex && bankIndex !== 0) {
                bankDetailsDisplay.style.display = 'none';
                return;
            }
            
            const bank = window.nigeriaBanks[parseInt(bankIndex)];
            if (!bank) return;
            
            bankDetailsDisplay.innerHTML = `
                <div style="background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 16px; margin-top: 12px;">
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Bank Name:</strong>
                        <div style="color: #e2e8f0; margin-top: 4px;">${bank.bank_name}</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Account Name:</strong>
                        <div style="color: #e2e8f0; margin-top: 4px;">${bank.account_name}</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong style="color: #3b82f6;">Account Number:</strong>
                        <div style="background: #0f172a; padding: 10px; border-radius: 4px; margin-top: 4px; font-family: monospace; color: #e2e8f0;">
                            ${bank.account_number}
                        </div>
                        <button type="button" onclick="copyToClipboard('${bank.account_number}')" style="margin-top: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-copy"></i> Copy Account Number
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #3b82f6;">Sort Code:</strong>
                        <div style="color: #e2e8f0; margin-top: 4px;">${bank.sort_code}</div>
                    </div>
                </div>
            `;
            bankDetailsDisplay.style.display = 'block';
        }

        async function withdrawFunds(event) {
            event.preventDefault();
            
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }

            const address = document.getElementById('withdrawAddress').value;
            const amountUsd = parseFloat(document.getElementById('withdrawAmount').value);

            if (!address.trim()) {
                showMessage('Please enter a valid Bitcoin address!', 'error');
                return;
            }

            if (!amountUsd || amountUsd <= 0) {
                showMessage('Please enter a valid amount!', 'error');
                return;
            }

            // Check if user has sufficient balance
            const balance = await client.getBalance();
            const balanceUsd = balance.balance || balance.balance_usd || 0;
            
            if (amountUsd > balanceUsd) {
                showMessage(`Insufficient balance! You have ${formatUsd(balanceUsd)} available.`, 'error');
                return;
            }

            // Confirm withdrawal
            if (!confirm(`Withdraw ${formatUsd(amountUsd)} to ${address}?\n\nThis action cannot be undone.`)) {
                return;
            }

            try {
                const result = await client.withdraw(address, amountUsd);
                showMessage(`âœ… Withdrawal initiated! ${formatUsd(amountUsd)} will be sent to your address.`);
                
                // Clear form
                document.getElementById('withdrawAddress').value = '';
                document.getElementById('withdrawAmount').value = '';
                
                // Reload wallet and update balance
                await loadWallet();
                updateAuthUI();
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        // Update BTC amount in real-time for withdrawal
        document.addEventListener('DOMContentLoaded', () => {
            // Ensure all modals are closed on page load
            closeAllModals();
        });

        // ===== NEW WITHDRAWAL SYSTEM =====
        let selectedWithdrawMethod = null;
        let withdrawAmount = 0;
        let withdrawFormData = {};

        // Update withdrawal method info
        async function updateWithdrawMethodInfo() {
            const method = document.getElementById('withdrawMethod').value;
            const infoDiv = document.getElementById('withdrawMethodInfo');
            
            if (!method) {
                infoDiv.style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`/api/withdrawal/methods`, {
                    headers: {
                        'Authorization': `Bearer ${client.getToken()}`
                    }
                });
                const data = await response.json();
                
                if (response.ok && data.methods[method]) {
                    selectedWithdrawMethod = data.methods[method];
                    document.getElementById('withdrawProcessingTime').textContent = data.methods[method].details.processing_time;
                    document.getElementById('minWithdraw').textContent = data.methods[method].min_withdrawal;
                    document.getElementById('maxWithdraw').textContent = data.methods[method].max_withdrawal;
                    document.getElementById('withdrawAmount').min = data.methods[method].min_withdrawal;
                    document.getElementById('withdrawAmount').max = data.methods[method].max_withdrawal;
                    infoDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching withdrawal method:', error);
            }
        }

        // Show withdrawal details (Step 2)
        async function showWithdrawDetails(event) {
            event.preventDefault();
            console.log('showWithdrawDetails called');
            
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }
            
            const method = document.getElementById('withdrawMethod').value;
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            
            console.log('Method:', method, 'Amount:', amount);
            
            if (!method) {
                showMessage('Please select a withdrawal method', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showMessage('Please enter a valid amount', 'error');
                return;
            }
            
            // Fetch withdrawal methods if not already loaded
            if (!selectedWithdrawMethod) {
                console.log('Fetching withdrawal methods...');
                try {
                    const response = await fetch(`/api/withdrawal/methods`, {
                        headers: {
                            'Authorization': `Bearer ${client.getToken()}`
                        }
                    });
                    const data = await response.json();
                    
                    console.log('Withdrawal methods response:', data);
                    
                    if (response.ok && data.methods[method]) {
                        selectedWithdrawMethod = data.methods[method];
                        console.log('Selected method:', selectedWithdrawMethod);
                    } else {
                        showMessage('Error loading withdrawal method details. Please try again.', 'error');
                        return;
                    }
                } catch (error) {
                    console.error('Error fetching withdrawal method:', error);
                    showMessage('Error loading withdrawal method details. Please try again.', 'error');
                    return;
                }
            }
            
            if (amount < selectedWithdrawMethod.min_withdrawal || amount > selectedWithdrawMethod.max_withdrawal) {
                showMessage(`Amount must be between $${selectedWithdrawMethod.min_withdrawal} and $${selectedWithdrawMethod.max_withdrawal}`, 'error');
                return;
            }
            
            withdrawAmount = amount;
            withdrawFormData = { method, amount };
            
            console.log('Building form for method:', method);
            
            // Build withdrawal form fields
            const details = selectedWithdrawMethod.details;
            let formHTML = '';
            
            if (method === 'bitcoin' || method === 'usdt') {
                formHTML = `
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Your Wallet Address:</label>
                    <input type="text" id="withdrawWalletAddress" class="payment-input" placeholder="Enter your ${method === 'bitcoin' ? 'Bitcoin' : 'USDT'} wallet address" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                    <div style="color: #94a3b8; font-size: 13px; margin-top: 8px;">
                        <strong>Network:</strong> ${details.network}
                    </div>
                `;
            } else if (method === 'paypal' || method === 'skrill') {
                formHTML = `
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Your ${method === 'paypal' ? 'PayPal' : 'Skrill'} Email:</label>
                    <input type="email" id="withdrawEmail" class="payment-input" placeholder="Enter your ${method === 'paypal' ? 'PayPal' : 'Skrill'} email address" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                    <div style="color: #f59e0b; font-size: 13px; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> Ensure this email is registered and verified with ${method === 'paypal' ? 'PayPal' : 'Skrill'}
                    </div>
                `;
            } else if (method === 'mobile_money') {
                formHTML = `
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Your Mobile Money Number:</label>
                    <input type="text" id="withdrawPhoneNumber" class="payment-input" placeholder="Enter your MTN Mobile Money number (e.g., +234...)" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                    <div style="color: #94a3b8; font-size: 13px; margin-top: 8px;">
                        <strong>Network:</strong> ${details.network}
                    </div>
                    <div style="color: #f59e0b; font-size: 13px; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> Ensure your number is correctly registered with MTN Mobile Money
                    </div>
                `;
            } else if (method === 'bank_transfer') {
                const countries = details.countries;
                let countryOptions = '';
                
                Object.keys(countries).forEach(key => {
                    const country = countries[key];
                    const disabled = !country.available ? 'disabled' : '';
                    const comingSoon = !country.available ? ' (Coming Soon)' : '';
                    countryOptions += `<option value="${key}" ${disabled}>${country.name}${comingSoon}</option>`;
                });
                
                formHTML = `
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Country:</label>
                    <select id="withdrawCountry" onchange="handleWithdrawCountryChange()" class="payment-input" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;">
                        <option value="">-- Select Country --</option>
                        ${countryOptions}
                    </select>
                    
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Bank Name:</label>
                    <input type="text" id="withdrawBankName" class="payment-input" placeholder="Enter your bank name" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                    
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Account Name:</label>
                    <input type="text" id="withdrawAccountName" class="payment-input" placeholder="Full name as shown on account" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                    
                    <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Account Number:</label>
                    <input type="text" id="withdrawAccountNumber" class="payment-input" placeholder="Enter your account number" required style="width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; margin-bottom: 16px;" />
                `;
            }
            
            console.log('Setting form HTML');
            document.getElementById('withdrawDetailsForm').innerHTML = formHTML;
            
            // Build instructions
            const instructions = selectedWithdrawMethod.instructions || [];
            const instructionsHTML = instructions.map((inst, idx) => `
                <div style="margin-bottom: 4px;">${idx + 1}. ${inst}</div>
            `).join('');
            document.getElementById('withdrawInstructions').innerHTML = instructionsHTML;
            
            console.log('Showing step 2');
            // Hide step 1, show step 2
            document.getElementById('withdrawStep1').style.display = 'none';
            document.getElementById('withdrawStep2').style.display = 'block';
            
            console.log('Step 2 should now be visible');
        }

        function handleWithdrawCountryChange() {
            const country = document.getElementById('withdrawCountry').value;
            if (country && country !== 'nigeria') {
                showMessage('Bank transfers for this country will be available soon!', 'error');
            }
        }

        function backToWithdrawStep1() {
            document.getElementById('withdrawStep1').style.display = 'block';
            document.getElementById('withdrawStep2').style.display = 'none';
            document.getElementById('withdrawResult').innerHTML = '';
        }

        async function submitWithdrawRequest(event) {
            event.preventDefault();
            
            if (!client.isLoggedIn()) {
                showMessage('Please login first!', 'error');
                return;
            }
            
            try {
                const method = withdrawFormData.method;
                const amount = withdrawFormData.amount;
                
                // Gather method-specific data
                let requestData = {
                    payment_method: method,
                    amount_usd: amount
                };
                
                if (method === 'bitcoin' || method === 'usdt') {
                    requestData.wallet_address = document.getElementById('withdrawWalletAddress').value;
                } else if (method === 'paypal' || method === 'skrill') {
                    requestData.email = document.getElementById('withdrawEmail').value;
                } else if (method === 'mobile_money') {
                    requestData.phone_number = document.getElementById('withdrawPhoneNumber').value;
                } else if (method === 'bank_transfer') {
                    requestData.country = document.getElementById('withdrawCountry').value;
                    requestData.bank_name = document.getElementById('withdrawBankName').value;
                    requestData.account_name = document.getElementById('withdrawAccountName').value;
                    requestData.account_number = document.getElementById('withdrawAccountNumber').value;
                }
                
                const response = await fetch('/api/withdrawal/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${client.getToken()}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`âœ… ${data.message}`, 'success');
                    document.getElementById('withdrawResult').innerHTML = `
                        <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 16px; border-radius: 8px; margin-top: 16px;">
                            <strong><i class="fas fa-check-circle"></i> Withdrawal Request Submitted!</strong>
                            <p style="margin-top: 8px; font-size: 14px;">Your withdrawal request has been submitted for review. Status: <strong>PENDING</strong></p>
                            <p style="margin-top: 4px; font-size: 13px;">Withdrawal ID: ${data.withdrawal_id}</p>
                        </div>
                    `;
                    
                    // Reset form
                    backToWithdrawStep1();
                    document.getElementById('withdrawMethod').value = '';
                    document.getElementById('withdrawAmount').value = '';
                    selectedWithdrawMethod = null;
                    withdrawAmount = 0;
                    withdrawFormData = {};
                    
                    // Reload wallet and withdrawals
                    await loadWallet();
                    await loadMyWithdrawals();
                } else {
                    showMessage(data.message || 'Failed to submit withdrawal request', 'error');
                }
            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                showMessage('Error submitting withdrawal request', 'error');
            }
        }

        async function loadMyWithdrawals() {
            if (!client.isLoggedIn()) return;
            
            try {
                const response = await fetch('/api/withdrawal/history', {
                    headers: {
                        'Authorization': `Bearer ${client.getToken()}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.withdrawals && data.withdrawals.length > 0) {
                    const withdrawalsHTML = data.withdrawals.map(w => {
                        const statusColor = w.status === 'APPROVED' ? '#10b981' : 
                                          w.status === 'REJECTED' ? '#ef4444' : '#f59e0b';
                        const statusIcon = w.status === 'APPROVED' ? 'check-circle' :
                                         w.status === 'REJECTED' ? 'times-circle' : 'clock';
                        
                        return `
                            <div class="bet-item" style="border-left: 3px solid ${statusColor};">
                                <h4 style="color: ${statusColor};"><i class="fas fa-${statusIcon}"></i> ${w.status}</h4>
                                <p><span>Method:</span> <span>${w.payment_method.replace('_', ' ')}</span></p>
                                <p><span>Amount:</span> <span>${formatUsd(w.amount_usd)}</span></p>
                                ${w.bank_name ? `<p><span>Bank:</span> <span>${w.bank_name}</span></p>` : ''}
                                ${w.wallet_address ? `<p><span>Address:</span> <span>${w.wallet_address.slice(0, 20)}...</span></p>` : ''}
                                ${w.admin_notes ? `<p><span>Notes:</span> <span>${w.admin_notes}</span></p>` : ''}
                                <p><span>Date:</span> <span>${new Date(w.created_at).toLocaleString()}</span></p>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('withdrawalsList').innerHTML = withdrawalsHTML;
                    document.getElementById('myWithdrawals').style.display = 'block';
                } else {
                    document.getElementById('myWithdrawals').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading withdrawals:', error);
            }
        }

        function switchMyBetsTab(tab) {
            currentMyBetsTab = tab;
            
            // Update active button
            document.querySelectorAll('.mybets-subtab').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`subtab-${tab}`).classList.add('active');
            
            // Load corresponding bets
            if (tab === 'active') {
                loadMyBets();
            } else if (tab === 'won') {
                loadBetsByStatus('won');
            } else if (tab === 'settled') {
                loadBetsByStatus('settled');
            } else if (tab === 'lost') {
                loadBetsByStatus('lost');
            }
        }

        async function loadMyBets() {
            try {
                // Ensure we're on the active tab
                currentMyBetsTab = 'active';
                document.querySelectorAll('.mybets-subtab').forEach(btn => btn.classList.remove('active'));
                const activeBtn = document.getElementById('subtab-active');
                if (activeBtn) activeBtn.classList.add('active');
                
                const bets = await client.getActiveBets();
                const container = document.getElementById('myBetsList');

                if (!bets.active_bets || bets.active_bets.length === 0) {
                    container.innerHTML = '<p style="color: #64748b;">No active bets</p>';
                    return;
                }
                
                // Sort bets by created_at descending (newest first)
                const sortedBets = [...bets.active_bets].sort((a, b) => {
                    return new Date(b.created_at) - new Date(a.created_at);
                });
                
                // Remove duplicates based on bet ID (in case backend returns duplicates)
                const uniqueBets = sortedBets.filter((bet, index, self) =>
                    index === self.findIndex((b) => b.id === bet.id)
                );
                
                try {
                    container.innerHTML = uniqueBets.map(bet => {
                        const amountUsd = parseFloat(bet.amount) || 0;
                        const payoutUsd = parseFloat(bet.potential_payout) || 0;
                        const profitUsd = payoutUsd - amountUsd;
                        
                        // Determine if it's a multi-bet or single bet
                        const isMultiBet = bet.event_description.includes('MULTI:');
                        const betTypeLabel = isMultiBet ? 'Multi' : 'Single';
                        const betTypeColor = isMultiBet ? '#8b5cf6' : '#3b82f6';
                        
                        // Build match score display if available
                        let matchScoreDisplay = '';
                        if (bet.match) {
                            if (bet.match.ht_home_score !== null && bet.match.ht_away_score !== null && bet.match.ht_status === 'completed') {
                                matchScoreDisplay += `<div style="background: rgba(148, 163, 184, 0.1); padding: 4px 8px; border-radius: 4px; margin: 8px 0;">
                                    <span style="font-size: 11px; color: #94a3b8;">HT:</span> 
                                    <span style="font-size: 13px; font-weight: bold; color: #cbd5e1;">${bet.match.ht_home_score} - ${bet.match.ht_away_score}</span>
                                </div>`;
                            }
                            if (bet.match.home_score !== null && bet.match.away_score !== null) {
                                matchScoreDisplay += `<div style="background: rgba(59, 130, 246, 0.1); padding: 4px 8px; border-radius: 4px; margin: 8px 0;">
                                    <span style="font-size: 11px; color: #3b82f6;">FT:</span> 
                                    <span style="font-size: 15px; font-weight: bold; color: #3b82f6;">${bet.match.home_score} - ${bet.match.away_score}</span>
                                </div>`;
                            }
                        }
                    
                    return `
                        <div class="bet-item" id="bet-${bet.id}">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <h4 style="margin: 0; flex: 1;">${bet.event_description}</h4>
                                <span style="background: ${betTypeColor}22; color: ${betTypeColor}; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap; margin-left: 8px;">${betTypeLabel}</span>
                            </div>
                            
                            ${matchScoreDisplay}
                            ${bet.booking_code ? `
                            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1)); border: 1px dashed #3b82f6; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="color: #3b82f6; font-size: 9px; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">Code</div>
                                        <div style="font-size: 13px; font-weight: bold; color: #3b82f6; letter-spacing: 1px; font-family: 'Courier New', monospace;">${bet.booking_code}</div>
                                    </div>
                                    <button onclick="copyBookingCode('${bet.booking_code}')" style="padding: 4px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: 600; white-space: nowrap;">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${bet.is_cashed_out ? `
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border: 1px solid #10b981; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="color: #10b981; font-size: 9px; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">Payout</div>
                                        <div style="font-size: 14px; font-weight: bold; color: #10b981;">${formatUsd(btcToUsd(bet.cashout_value || 0))}</div>
                                    </div>
                                    <button disabled style="padding: 5px 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: not-allowed; font-size: 11px; font-weight: 600; white-space: nowrap; opacity: 0.7;">
                                        <i class="fas fa-check-circle"></i> Paid Out
                                    </button>
                                </div>
                                <div style="color: #64748b; font-size: 8px; margin-top: 3px;">Bet was closed early</div>
                            </div>
                            ` : !bet.is_cashed_out ? `
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); border: 1px solid #10b981; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="color: #10b981; font-size: 9px; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">Cashout</div>
                                        <div style="font-size: 14px; font-weight: bold; color: #10b981;" id="cashout-value-${bet.id}">Loading...</div>
                                    </div>
                                    <button onclick="cashoutBet(${bet.id})" style="padding: 5px 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; white-space: nowrap; transition: all 0.3s ease;">
                                        <i class="fas fa-money-bill-wave"></i> Cash Out
                                    </button>
                                </div>
                                <div style="color: #64748b; font-size: 8px; margin-top: 3px;">100% < 1min, 85% after</div>
                            </div>
                            ` : ''}
                            
                            <p><span>Stake:</span> <span>${formatUsd(amountUsd)}</span></p>
                            <p><span>Odds:</span> <span>${bet.odds}</span></p>
                            <p><span>Potential Return:</span> <span>${formatUsd(payoutUsd)}</span></p>
                            <p><span>Potential Profit:</span> <span style="color: #10b981;">${formatUsd(profitUsd)}</span></p>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 12px;">
                                <span class="status-badge active">Active</span>
                                <button class="btn-submit" style="padding: 6px 16px; font-size: 12px;" onclick='viewBetTicket(${bet.id}, ${JSON.stringify(bet.event_description)}, ${amountUsd}, ${bet.odds}, ${payoutUsd}, ${JSON.stringify(bet.created_at)}, ${JSON.stringify(bet.status)}, ${JSON.stringify(bet.booking_code || "")}, ${bet.is_cashed_out ? "true" : "false"}, ${bet.id}, ${bet.cashout_value || 0}, ${bet.match ? JSON.stringify(bet.match) : "null"})'>
                                    <i class="fas fa-ticket-alt"></i> View Ticket
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                } catch (renderErr) {
                    console.error('Error rendering bets:', renderErr);
                    container.innerHTML = '<p style="color: #ef4444;">Error rendering bets</p>';
                }
                
                // Start updating cashout values
                updateAllCashoutValues(uniqueBets);
            } catch (err) {
                console.error('Error in loadMyBets():', err);
                showMessage(err.message, 'error');
            }
        }

        async function loadBetsByStatus(status) {
            try {
                const response = await client.getUserBets(status);
                const container = document.getElementById('myBetsList');
                const bets = response.bets;

                if (bets.length === 0) {
                    container.innerHTML = `<p style="color: #64748b;">No ${status} bets</p>`;
                    return;
                }

                container.innerHTML = bets.map(bet => {
                    console.log('Bet data:', bet.id, 'Status:', bet.status, 'Match:', bet.match);
                    const amountUsd = parseFloat(bet.amount) || 0;
                    const payoutUsd = parseFloat(bet.potential_payout) || 0;
                    const profitUsd = payoutUsd - amountUsd;
                    const actualPayoutUsd = bet.settled_payout ? parseFloat(bet.settled_payout) : 0;
                    const actualProfitUsd = actualPayoutUsd - amountUsd;
                    
                    // Determine status badge based on bet status
                    let statusBadge = '';
                    let statusColor = '';
                    
                    // Check won/lost first (these are final statuses)
                    if (bet.status === 'won' || status === 'won') {
                        statusBadge = 'Won';
                        statusColor = '#10b981';
                    } else if (bet.status === 'lost' || status === 'lost') {
                        statusBadge = 'Lost';
                        statusColor = '#ef4444';
                    } else if (bet.is_cashed_out) {
                        // Only show "Payout" if bet hasn't been settled as won/lost
                        statusBadge = 'Payout';
                        statusColor = '#10b981';
                    } else if (status === 'settled') {
                        statusBadge = 'Settled';
                        statusColor = '#3b82f6';
                    }
                    
                    return `
                        <div class="bet-item" id="bet-${bet.id}">
                            <h4>${bet.event_description || `Bet #${bet.id}`}</h4>
                            
                            ${bet.booking_code ? `
                            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1)); border: 1px dashed #3b82f6; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="color: #3b82f6; font-size: 9px; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">Code</div>
                                        <div style="font-size: 13px; font-weight: bold; color: #3b82f6; letter-spacing: 1px; font-family: 'Courier New', monospace;">${bet.booking_code}</div>
                                    </div>
                                    <button onclick="copyBookingCode('${bet.booking_code}')" style="padding: 4px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: 600; white-space: nowrap;">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                            </div>
                            ` : ''}
                            
                            <p><span>Stake:</span> <span>${formatUsd(amountUsd)}</span></p>
                            <p><span>Odds:</span> <span>${bet.odds}</span></p>
                            ${bet.is_cashed_out ? `
                                <p><span>Cashout Payout:</span> <span style="color: #10b981; font-weight: bold;">${formatUsd(btcToUsd(parseFloat(bet.cashout_value || 0)))}</span></p>
                                <p><span>Net Result:</span> <span style="color: ${actualProfitUsd >= 0 ? '#10b981' : '#ef4444'}; font-weight: bold;">${formatUsd(Math.abs(actualProfitUsd))}</span></p>
                            ` : status === 'won' ? `
                                <p><span>Payout:</span> <span style="color: #10b981; font-weight: bold;">${formatUsd(actualPayoutUsd)}</span></p>
                                <p><span>Profit:</span> <span style="color: #10b981; font-weight: bold;">${formatUsd(actualProfitUsd)}</span></p>
                            ` : status === 'lost' ? `
                                <p><span>Potential Return:</span> <span style="text-decoration: line-through; color: #64748b;">${formatUsd(payoutUsd)}</span></p>
                                <p><span>Loss:</span> <span style="color: #ef4444; font-weight: bold;">-${formatUsd(amountUsd)}</span></p>
                            ` : `
                                <p><span>Potential Return:</span> <span>${formatUsd(payoutUsd)}</span></p>
                                <p><span>Potential Profit:</span> <span style="color: #10b981;">${formatUsd(profitUsd)}</span></p>
                                ${bet.settled_payout ? `<p><span>Actual Payout:</span> <span style="color: #3b82f6; font-weight: bold;">${formatUsd(actualPayoutUsd)}</span></p>` : ''}
                            `}
                            <p><span>Date:</span> <span>${bet.created_at ? new Date(bet.created_at).toLocaleString() : 'N/A'}</span></p>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 12px;">
                                <span class="status-badge" style="background: ${statusColor};">${statusBadge}</span>
                                <button class="btn-submit" style="padding: 6px 16px; font-size: 12px;" onclick='viewBetTicket(${bet.id}, ${JSON.stringify(bet.event_description)}, ${amountUsd}, ${bet.odds}, ${payoutUsd}, ${JSON.stringify(bet.created_at)}, ${JSON.stringify(bet.status)}, ${JSON.stringify(bet.booking_code || "")}, ${bet.is_cashed_out ? "true" : "false"}, ${bet.id}, ${bet.cashout_value || 0}, ${bet.match ? JSON.stringify(bet.match) : "null"})'>
                                    <i class="fas fa-ticket-alt"></i> View Ticket
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        // ========== PREMIUM BOOKING FUNCTIONS ==========
        
        let currentPremiumBooking = null;
        
        async function checkPremiumCode() {
            const code = document.getElementById('premiumCode').value.trim().toUpperCase();
            
            if (!code) {
                showMessage('Please enter a booking code', 'error');
                return;
            }
            
            if (!client.isLoggedIn()) {
                showMessage('Please login first to check premium codes', 'error');
                return;
            }
            
            try {
                const response = await client.request(`/premium/check-code/${code}`, 'GET');
                currentPremiumBooking = response.booking;
                const hasAccess = response.has_access;
                
                const infoCard = document.getElementById('premiumCodeInfo');
                const detailsDiv = document.getElementById('premiumCodeDetails');
                
                infoCard.style.display = 'block';
                
                if (hasAccess) {
                    // User already purchased - show full details
                    detailsDiv.innerHTML = `
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 24px;"></i>
                            <p style="color: #10b981; margin-top: 10px; font-weight: 600;">You own this booking!</p>
                        </div>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Booking Code</div>
                            <div style="font-size: 20px; font-weight: 700; color: #3b82f6; font-family: 'Courier New', monospace; letter-spacing: 2px;">${currentPremiumBooking.booking_code}</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Selections</div>
                                <div style="font-size: 18px; font-weight: 700; color: #3b82f6;">${currentPremiumBooking.num_selections}</div>
                            </div>
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Total Odds</div>
                                <div style="font-size: 18px; font-weight: 700; color: #10b981;">${currentPremiumBooking.total_odds}</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="color: #10b981; margin-bottom: 15px;"><i class="fas fa-list"></i> Your Selections</h4>
                            ${currentPremiumBooking.selections.map(sel => `
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
                                    <div style="font-weight: 600; margin-bottom: 5px;">${sel.match}</div>
                                    <div style="color: #94a3b8; font-size: 14px;">${sel.market}: <span style="color: #3b82f6; font-weight: 600;">${sel.selection}</span> @ ${sel.odds}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Place Bet Section -->
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 15px;"><i class="fas fa-money-bill-wave"></i> Place Your Bet</h4>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="color: #94a3b8; font-size: 13px; display: block; margin-bottom: 5px;">Stake Amount (USD)</label>
                                <input type="number" id="premiumStakeAmount" min="1" step="0.01" placeholder="Enter amount" 
                                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid #334155; border-radius: 6px; color: white; font-size: 16px;">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Total Odds</div>
                                    <div style="font-size: 18px; font-weight: 700; color: #10b981;">${currentPremiumBooking.total_odds}</div>
                                </div>
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Potential Win</div>
                                    <div id="premiumPotentialWin" style="font-size: 18px; font-weight: 700; color: #3b82f6;">$0.00</div>
                                </div>
                            </div>
                            
                            <button onclick="placePremiumBet()" class="btn-submit" style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600;">
                                <i class="fas fa-check-circle"></i> Place Bet Now
                            </button>
                        </div>
                    `;
                } else {
                    // User doesn't have access - check balance requirement
                    const requiresDeposit = response.requires_deposit;
                    const userBalanceUsd = response.user_balance_usd || 0;
                    const depositNeeded = response.deposit_needed || 0;
                    const minBalance = response.minimum_balance_required || 250;
                    
                    detailsDiv.innerHTML = `
                        ${requiresDeposit ? `
                            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 24px;"></i>
                                <p style="color: #ef4444; margin-top: 10px; font-weight: 600;">Insufficient Balance</p>
                                <p style="color: #94a3b8; margin-top: 8px; font-size: 14px;">You need $${minBalance.toFixed(2)} minimum balance to view premium selections</p>
                            </div>
                        ` : `
                            <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid #f59e0b; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <i class="fas fa-lock" style="color: #f59e0b; font-size: 24px;"></i>
                                <p style="color: #f59e0b; margin-top: 10px; font-weight: 600;">Locked Premium Booking</p>
                            </div>
                        `}
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Booking Code</div>
                            <div style="font-size: 20px; font-weight: 700; color: #3b82f6; font-family: 'Courier New', monospace; letter-spacing: 2px;">${currentPremiumBooking.booking_code}</div>
                        </div>
                        
                        ${currentPremiumBooking.description ? `
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; margin-bottom: 15px; color: #cbd5e1;">
                                <i class="fas fa-info-circle"></i> ${currentPremiumBooking.description}
                            </div>
                        ` : ''}
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Selections</div>
                                <div style="font-size: 18px; font-weight: 700; color: #3b82f6;">${currentPremiumBooking.num_selections}</div>
                            </div>
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">Total Odds</div>
                                <div style="font-size: 18px; font-weight: 700; color: #10b981;">${currentPremiumBooking.total_odds}</div>
                            </div>
                        </div>
                        
                        ${currentPremiumBooking.matches_preview ? `
                            <div style="background: rgba(15, 23, 42, 0.5); border: 1px solid #334155; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <h4 style="color: #cbd5e1; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-futbol"></i> Matches Included
                                </h4>
                                ${currentPremiumBooking.matches_preview.map((match, index) => `
                                    <div style="background: rgba(59, 130, 246, 0.05); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #3b82f6;">
                                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                            <span style="background: #3b82f6; color: white; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 4px;">${index + 1}</span>
                                            <div style="font-weight: 600; color: #e2e8f0;">${match.match}</div>
                                        </div>
                                        <div style="color: #94a3b8; font-size: 13px; margin-left: 28px;">
                                            Market: ${match.market} â€¢ <span style="color: #f59e0b;"><i class="fas fa-lock"></i> Selection Hidden</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${requiresDeposit ? `
                            <!-- User needs to deposit -->
                            <div style="background: rgba(15, 23, 42, 0.7); border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                <div style="text-align: center; margin-bottom: 15px;">
                                    <div style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">Your Balance</div>
                                    <div style="font-size: 28px; font-weight: 700; color: #3b82f6;">$${userBalanceUsd.toFixed(2)}</div>
                                </div>
                                
                                <div style="text-align: center; padding: 15px 0; border-top: 1px solid #334155; border-bottom: 1px solid #334155; margin-bottom: 15px;">
                                    <div style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">Minimum Required</div>
                                    <div style="font-size: 28px; font-weight: 700; color: #10b981;">$${minBalance.toFixed(2)}</div>
                                </div>
                                
                                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px; padding: 15px; text-align: center;">
                                    <div style="color: #94a3b8; font-size: 14px; margin-bottom: 5px;">Deposit Needed</div>
                                    <div style="font-size: 32px; font-weight: 900; color: #ef4444;">$${depositNeeded.toFixed(2)}</div>
                                </div>
                            </div>
                            
                            <button class="btn-submit" onclick="switchTab('wallet')" style="width: 100%; background: linear-gradient(135deg, #10b981, #059669); font-size: 16px; padding: 15px;">
                                <i class="fas fa-wallet"></i> Deposit Funds to Unlock
                            </button>
                            
                            <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 12px; margin-top: 15px;">
                                <p style="color: #94a3b8; font-size: 13px; text-align: center; margin: 0;">
                                    <i class="fas fa-info-circle"></i> Premium games will be revealed automatically once you deposit $${depositNeeded.toFixed(2)} or more
                                </p>
                            </div>
                        ` : `
                            <!-- User has enough balance -->
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1)); border: 2px solid #10b981; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px;">
                                <div style="color: #94a3b8; font-size: 14px; margin-bottom: 5px;">Your Balance</div>
                                <div style="font-size: 36px; font-weight: 900; color: #10b981;">$${userBalanceUsd.toFixed(2)}</div>
                                <div style="color: #10b981; font-size: 14px; margin-top: 8px;">
                                    <i class="fas fa-check-circle"></i> Sufficient balance to view selections
                                </div>
                            </div>
                            
                            <button class="btn-submit" onclick="viewPremiumSelections()" style="width: 100%; background: linear-gradient(135deg, #10b981, #059669); font-size: 16px; padding: 15px;">
                                <i class="fas fa-unlock"></i> View Premium Selections
                            </button>
                        `}
                        
                        ${currentPremiumBooking.expires_at ? `
                            <p style="color: #f59e0b; text-align: center; margin-top: 10px; font-size: 12px;">
                                <i class="fas fa-clock"></i> Expires: ${new Date(currentPremiumBooking.expires_at).toLocaleString()}
                            </p>
                        ` : ''}
                    `;
                }
                
            } catch (error) {
                console.error('Premium code check error:', error);
                showMessage(error.message || 'Failed to check premium code', 'error');
                document.getElementById('premiumCodeInfo').style.display = 'none';
            }
        }
        
        async function viewPremiumSelections() {
            if (!currentPremiumBooking) {
                showMessage('No booking selected', 'error');
                return;
            }
            
            try {
                // Just reload the premium code to show full selections
                // since user already has sufficient balance
                showMessage('Loading premium selections... âœ¨', 'success');
                await checkPremiumCode();
                
            } catch (error) {
                showMessage(error.message, 'error');
            }
        }
        
        async function purchasePremiumBooking() {
            // Legacy function - kept for backwards compatibility
            // Now just calls viewPremiumSelections
            await viewPremiumSelections();
        }
        
        async function loadMyPremiumBookings() {
            try {
                const response = await client.request('/premium/my-purchases', 'GET');
                const purchases = response.purchases || [];
                
                const container = document.getElementById('myPremiumBookings');
                
                if (purchases.length === 0) {
                    container.innerHTML = `
                        <p style="color: #94a3b8; text-align: center; padding: 20px;">
                            <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.3; display: block; margin-bottom: 10px;"></i>
                            No purchased bookings yet
                        </p>
                    `;
                    return;
                }
                
                container.innerHTML = purchases.map(booking => `
                    <div style="background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 24px; font-weight: 700; color: #3b82f6; font-family: 'Courier New', monospace; letter-spacing: 2px; margin-bottom: 5px;">
                                    ${booking.booking_code}
                                </div>
                                <div style="color: #94a3b8; font-size: 12px;">
                                    <i class="fas fa-calendar"></i> Purchased: ${new Date(booking.purchased_at).toLocaleString()}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 3px;">Paid</div>
                                <div style="font-size: 18px; font-weight: 700; color: #10b981;">$${booking.amount_paid_usd}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 10px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 11px; margin-bottom: 3px;">Selections</div>
                                <div style="font-size: 16px; font-weight: 700; color: #3b82f6;">${booking.num_selections}</div>
                            </div>
                            <div style="background: rgba(15, 23, 42, 0.5); padding: 10px; border-radius: 6px; text-align: center;">
                                <div style="color: #94a3b8; font-size: 11px; margin-bottom: 3px;">Total Odds</div>
                                <div style="font-size: 16px; font-weight: 700; color: #10b981;">${booking.total_odds}</div>
                            </div>
                        </div>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #3b82f6; font-weight: 600; padding: 8px 0;">
                                <i class="fas fa-eye"></i> View Selections & Place Bet
                            </summary>
                            <div style="margin-top: 10px;">
                                ${booking.selections.map(sel => `
                                    <div style="background: rgba(15, 23, 42, 0.5); padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                                        <div style="font-weight: 600; margin-bottom: 5px;">${sel.match}</div>
                                        <div style="color: #94a3b8; font-size: 13px;">${sel.market}: <span style="color: #3b82f6; font-weight: 600;">${sel.selection}</span> @ ${sel.odds}</div>
                                    </div>
                                `).join('')}
                                
                                <!-- Quick Bet Section -->
                                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 15px; margin-top: 15px;">
                                    <h5 style="color: #3b82f6; margin-bottom: 10px; font-size: 14px;"><i class="fas fa-money-bill-wave"></i> Quick Bet</h5>
                                    
                                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                                        <div style="flex: 1;">
                                            <label style="color: #94a3b8; font-size: 11px; display: block; margin-bottom: 5px;">Stake (USD)</label>
                                            <input type="number" id="quickStake_${booking.booking_code}" min="1" step="0.01" placeholder="Amount" 
                                                style="width: 100%; padding: 10px; background: rgba(15, 23, 42, 0.5); border: 1px solid #334155; border-radius: 6px; color: white; font-size: 14px;"
                                                oninput="updateQuickWin('${booking.booking_code}', ${booking.total_odds})">
                                        </div>
                                        <div style="flex: 1; text-align: center;">
                                            <div style="color: #94a3b8; font-size: 11px; margin-bottom: 5px;">Win</div>
                                            <div id="quickWin_${booking.booking_code}" style="font-size: 16px; font-weight: 700; color: #10b981;">$0.00</div>
                                        </div>
                                        <button onclick="quickPlaceBet('${booking.booking_code}', ${booking.total_odds})" class="btn-submit" style="padding: 10px 20px; font-size: 13px; white-space: nowrap;">
                                            <i class="fas fa-check"></i> Bet
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                `).join('');
                
            } catch (error) {
                showMessage(error.message, 'error');
            }
        }
        
        // Calculate potential win when stake changes
        function updatePremiumPotentialWin() {
            const stakeInput = document.getElementById('premiumStakeAmount');
            const potentialWinDiv = document.getElementById('premiumPotentialWin');
            
            if (stakeInput && potentialWinDiv && currentPremiumBooking) {
                const stake = parseFloat(stakeInput.value) || 0;
                const potentialWin = stake * currentPremiumBooking.total_odds;
                potentialWinDiv.textContent = `$${potentialWin.toFixed(2)}`;
            }
        }
        
        // Update quick bet potential win
        function updateQuickWin(bookingCode, odds) {
            const stakeInput = document.getElementById(`quickStake_${bookingCode}`);
            const winDiv = document.getElementById(`quickWin_${bookingCode}`);
            
            if (stakeInput && winDiv) {
                const stake = parseFloat(stakeInput.value) || 0;
                const potentialWin = stake * odds;
                winDiv.textContent = `$${potentialWin.toFixed(2)}`;
            }
        }
        
        // Quick place bet from "My Premium Bookings"
        async function quickPlaceBet(bookingCode, odds) {
            const stakeInput = document.getElementById(`quickStake_${bookingCode}`);
            const stake = parseFloat(stakeInput.value);
            
            if (!stake || stake <= 0) {
                showMessage('Please enter a valid stake amount', 'error');
                return;
            }
            
            if (stake < 1) {
                showMessage('Minimum bet is $1.00', 'error');
                return;
            }
            
            const potentialWin = stake * odds;
            if (!confirm(`Place bet for $${stake.toFixed(2)}?\n\nPotential Win: $${potentialWin.toFixed(2)}\nTotal Odds: ${odds}`)) {
                return;
            }
            
            try {
                const response = await client.request(`/premium/place-bet/${bookingCode}`, 'POST', {
                    stake_usd: stake
                });
                
                showMessage(response.message || 'Bet placed successfully! ðŸŽ‰', 'success');
                if (window.triggerConfetti) try { window.triggerConfetti(); } catch(e) { /* ignore */ }
                
                // Clear input
                stakeInput.value = '';
                updateQuickWin(bookingCode, odds);
                
                // Refresh balance
                await refreshUserBalance();
                
                // Show bet ticket - need to get booking details
                if (response.bet) {
                    // Reload purchases to get latest data and show ticket
                    const purchasesResponse = await client.request('/premium/my-purchases', 'GET');
                    const booking = purchasesResponse.purchases.find(p => p.booking_code === bookingCode);
                    
                    if (booking) {
                        const picks = booking.selections.map(sel => ({
                            match: sel.match,
                            market: sel.market,
                            selection: sel.selection,
                            odds: sel.odds
                        }));
                        
                        showBetTicket({
                            id: response.bet.id,
                            type: `Premium Bet (${picks.length} ${picks.length === 1 ? 'Selection' : 'Selections'})`,
                            picks: picks,
                            stake: response.bet.stake_usd,
                            odds: response.bet.odds,
                            potentialReturn: response.bet.potential_payout_usd,
                            timestamp: response.bet.created_at,
                            bookingCode: response.bet.booking_code,
                            isCashedOut: false
                        });
                    }
                }
                
                // Reload bets
                loadMyBets();
                
            } catch (error) {
                console.error('Quick bet error:', error);
                showMessage(error.message || 'Failed to place bet', 'error');
            }
        }
        
        // Add event listener to stake input when premium code is checked
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event delegation for dynamically created stake input
            document.body.addEventListener('input', function(e) {
                if (e.target && e.target.id === 'premiumStakeAmount') {
                    updatePremiumPotentialWin();
                }
            });
        });
        
        async function placePremiumBet() {
            if (!currentPremiumBooking) {
                showMessage('No booking selected', 'error');
                return;
            }
            
            const stakeInput = document.getElementById('premiumStakeAmount');
            const stake = parseFloat(stakeInput.value);
            
            if (!stake || stake <= 0) {
                showMessage('Please enter a valid stake amount', 'error');
                return;
            }
            
            if (stake < 1) {
                showMessage('Minimum bet is $1.00', 'error');
                return;
            }
            
            // Confirm bet placement
            const potentialWin = stake * currentPremiumBooking.total_odds;
            if (!confirm(`Place bet for $${stake.toFixed(2)}?\n\nPotential Win: $${potentialWin.toFixed(2)}\nTotal Odds: ${currentPremiumBooking.total_odds}`)) {
                return;
            }
            
            try {
                const response = await client.request(`/premium/place-bet/${currentPremiumBooking.booking_code}`, 'POST', {
                    stake_usd: stake
                });
                
                showMessage(response.message || 'Bet placed successfully! ðŸŽ‰', 'success');
                if (window.triggerConfetti) try { window.triggerConfetti(); } catch(e) { /* ignore */ }
                
                // Clear stake input
                stakeInput.value = '';
                updatePremiumPotentialWin();
                
                // Refresh balance
                await refreshUserBalance();
                
                // Show bet ticket
                if (response.bet) {
                    // Create match description from premium selections
                    const picks = currentPremiumBooking.selections.map(sel => ({
                        match: sel.match,
                        market: sel.market,
                        selection: sel.selection,
                        odds: sel.odds
                    }));
                    
                    showBetTicket({
                        id: response.bet.id,
                        type: `Premium Bet (${picks.length} ${picks.length === 1 ? 'Selection' : 'Selections'})`,
                        picks: picks,
                        stake: response.bet.stake_usd,
                        odds: response.bet.odds,
                        potentialReturn: response.bet.potential_payout_usd,
                        timestamp: response.bet.created_at,
                        bookingCode: response.bet.booking_code,
                        isCashedOut: false
                    });
                }
                
                // Reload bets
                loadMyBets();
                
            } catch (error) {
                console.error('Place premium bet error:', error);
                showMessage(error.message || 'Failed to place bet', 'error');
            }
        }

        async function loadStats() {
            try {
                // Refresh user balance first
                await refreshUserBalance();
                
                const stats = await client.getStatistics();
                const s = stats.statistics;

                document.getElementById('statTotalBets').textContent = s.total_bets;
                document.getElementById('statWonBets').textContent = s.won_bets;
                document.getElementById('statLostBets').textContent = s.lost_bets;
                document.getElementById('statActiveBets').textContent = s.active_bets;
                document.getElementById('statWinRate').textContent = s.win_rate.toFixed(1) + '%';
                
                const wageredUsd = parseFloat(s.total_wagered) || 0;
                document.getElementById('statWagered').textContent = formatUsd(wageredUsd);
            } catch (err) {
                showMessage(err.message, 'error');
            }
        }

        // Initialize - loadMatches only (updateAuthUI is called in initSession)
        loadMatches();
        
        // Auto-refresh matches every 2 minutes to show updated scores and times
        setInterval(async () => {
            console.log('[Auto-Refresh] Reloading matches for live updates...');
            await loadMatches();
        }, 2 * 60 * 1000); // 2 minutes
        
        // Auto-update live match scores every 2 minutes (if logged in as admin)
        setInterval(async () => {
            if (client.token && client.user && client.user.is_admin) {
                console.log('[Live Update] Updating live match scores...');
                try {
                    await client.request('/admin/update-live-matches', 'POST');
                    console.log('[Live Update] Success! Reloading matches...');
                    await loadMatches();
                } catch (err) {
                    console.error('[Live Update] Failed:', err);
                }
            }
        }, 2 * 60 * 1000); // 2 minutes
        
        // Auto-fetch fresh matches from API-Sports every 30 minutes (if logged in as admin)
        setInterval(async () => {
            if (client.token && client.user && client.user.is_admin) {
                console.log('[Auto-Fetch] Fetching fresh matches from API-Sports...');
                try {
                    await client.request('/admin/fetch-matches', 'POST');
                    console.log('[Auto-Fetch] Success! Reloading matches...');
                    await loadMatches();
                } catch (err) {
                    console.error('[Auto-Fetch] Failed:', err);
                }
            }
        }, 30 * 60 * 1000); // 30 minutes
    </script>

    <script>
        // ========== VIRTUAL GAMES - LEAGUE-WIDE COUNTDOWN WITH LOGOS ==========
        const VIRTUAL_CONFIG = {
            COUNTDOWN_SECONDS: 180,  // 3 minutes countdown for betting
            GAME_DURATION_SECONDS: 90,  // 90 seconds game play (1 real second = 1 virtual minute)
            BUFFER_SECONDS: 15,  // 15 seconds buffer between races
            LEAGUE_INTERVAL: 60,  // 1 minute offset between leagues
            RACE_CYCLE_TIME: 285,  // 180 + 90 + 15 = total time per race
            UPDATE_INTERVAL_MS: 1000,
            MATCHES_PER_RACE: 10,  // 10 matches per race (all 20 teams play)
            RACES_PER_SEASON: 38  // 19 matchdays Ã— 2 (home + away)
        };

        const TEAM_LOGOS = {
            // Premier League - 20 teams
            'Man City': 'https://media.api-sports.io/football/teams/50.png',
            'Arsenal': 'https://media.api-sports.io/football/teams/42.png',
            'Liverpool': 'https://media.api-sports.io/football/teams/40.png',
            'Chelsea': 'https://media.api-sports.io/football/teams/49.png',
            'Man United': 'https://media.api-sports.io/football/teams/33.png',
            'Tottenham': 'https://media.api-sports.io/football/teams/47.png',
            'Newcastle': 'https://media.api-sports.io/football/teams/34.png',
            'Brighton': 'https://media.api-sports.io/football/teams/51.png',
            'Aston Villa': 'https://media.api-sports.io/football/teams/66.png',
            'West Ham': 'https://media.api-sports.io/football/teams/48.png',
            'Crystal Palace': 'https://media.api-sports.io/football/teams/52.png',
            'Fulham': 'https://media.api-sports.io/football/teams/36.png',
            'Brentford': 'https://media.api-sports.io/football/teams/55.png',
            'Everton': 'https://media.api-sports.io/football/teams/45.png',
            'Nottingham': 'https://media.api-sports.io/football/teams/65.png',
            'Wolves': 'https://media.api-sports.io/football/teams/39.png',
            'Bournemouth': 'https://media.api-sports.io/football/teams/35.png',
            'Luton Town': 'https://media.api-sports.io/football/teams/1359.png',
            'Burnley': 'https://media.api-sports.io/football/teams/44.png',
            'Sheffield Utd': 'https://media.api-sports.io/football/teams/62.png',
            // La Liga - 20 teams
            'Real Madrid': 'https://media.api-sports.io/football/teams/541.png',
            'Barcelona': 'https://media.api-sports.io/football/teams/529.png',
            'Atletico Madrid': 'https://media.api-sports.io/football/teams/530.png',
            'Sevilla': 'https://media.api-sports.io/football/teams/536.png',
            'Real Sociedad': 'https://media.api-sports.io/football/teams/548.png',
            'Real Betis': 'https://media.api-sports.io/football/teams/543.png',
            'Villarreal': 'https://media.api-sports.io/football/teams/533.png',
            'Valencia': 'https://media.api-sports.io/football/teams/532.png',
            'Athletic Bilbao': 'https://media.api-sports.io/football/teams/531.png',
            'Osasuna': 'https://media.api-sports.io/football/teams/727.png',
            'Girona': 'https://media.api-sports.io/football/teams/547.png',
            'Getafe': 'https://media.api-sports.io/football/teams/546.png',
            'Las Palmas': 'https://media.api-sports.io/football/teams/728.png',
            'Celta Vigo': 'https://media.api-sports.io/football/teams/538.png',
            'Rayo Vallecano': 'https://media.api-sports.io/football/teams/728.png',
            'Mallorca': 'https://media.api-sports.io/football/teams/798.png',
            'Alaves': 'https://media.api-sports.io/football/teams/542.png',
            'Cadiz': 'https://media.api-sports.io/football/teams/724.png',
            'Granada': 'https://media.api-sports.io/football/teams/715.png',
            'Almeria': 'https://media.api-sports.io/football/teams/723.png',
            // Serie A - 20 teams
            'Inter Milan': 'https://media.api-sports.io/football/teams/505.png',
            'AC Milan': 'https://media.api-sports.io/football/teams/489.png',
            'Juventus': 'https://media.api-sports.io/football/teams/496.png',
            'Napoli': 'https://media.api-sports.io/football/teams/492.png',
            'Roma': 'https://media.api-sports.io/football/teams/497.png',
            'Lazio': 'https://media.api-sports.io/football/teams/487.png',
            'Atalanta': 'https://media.api-sports.io/football/teams/499.png',
            'Fiorentina': 'https://media.api-sports.io/football/teams/502.png',
            'Bologna': 'https://media.api-sports.io/football/teams/500.png',
            'Torino': 'https://media.api-sports.io/football/teams/503.png',
            'Frosinone': 'https://media.api-sports.io/football/teams/512.png',
            'Verona': 'https://media.api-sports.io/football/teams/504.png',
            'Monza': 'https://media.api-sports.io/football/teams/1579.png',
            'Genoa': 'https://media.api-sports.io/football/teams/495.png',
            'Lecce': 'https://media.api-sports.io/football/teams/867.png',
            'Udinese': 'https://media.api-sports.io/football/teams/494.png',
            'Cagliari': 'https://media.api-sports.io/football/teams/490.png',
            'Empoli': 'https://media.api-sports.io/football/teams/511.png',
            'Sassuolo': 'https://media.api-sports.io/football/teams/488.png',
            'Salernitana': 'https://media.api-sports.io/football/teams/509.png'
        };

        let virtualGames = {1: [], 2: [], 3: []};
        
        // Load saved state OR sync with server race state
        function loadVirtualState() {
            try {
                const saved = sessionStorage.getItem('virtualLeagueStates');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Validate saved state has required fields
                    if (parsed[1] && parsed[1].countdown !== undefined) {
                        console.log('ðŸ“¥ Restored race state from sessionStorage');
                        return parsed;
                    }
                }
            } catch (e) {
                console.warn('Failed to load saved state:', e);
            }
            // Return defaults (will be synced with server during init)
            return {
                1: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS, isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1},
                2: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS + VIRTUAL_CONFIG.LEAGUE_INTERVAL, isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1},
                3: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS + (VIRTUAL_CONFIG.LEAGUE_INTERVAL * 2), isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1}
            };
        }
        
        let virtualLeagueStates = loadVirtualState();
        let virtualSelectedBets = [];
        let virtualUpdateInterval = null;
        let virtualInitialized = false;
        
        // Save state every second
        function saveVirtualState() {
            try {
                sessionStorage.setItem('virtualLeagueStates', JSON.stringify(virtualLeagueStates));
            } catch (e) {
                console.warn('Failed to save state:', e);
            }
        }

        async function initVirtualGames() {
            if (virtualInitialized) {
                console.log('âš ï¸ Virtual games already initialized, skipping...');
                return;
            }
            console.log('ðŸš€ [INIT] Starting virtual games initialization...');
            virtualInitialized = true;
            
            try {
                console.log('ðŸš€ [INIT] Fetching leagues...');
                const response = await fetch('/api/virtual/leagues');
                const data = await response.json();
                console.log('ðŸš€ [INIT] Leagues response:', data);
                
                if (data.success && data.leagues.length > 0) {
                    console.log('ðŸš€ [INIT] Found', data.leagues.length, 'leagues');
                    
                    // Load race numbers from server (for display only)
                    for (const league of data.leagues) {
                        console.log(`ðŸš€ [INIT] Loading games for league ${league.id}...`);
                        await loadVirtualLeagueGames(league.id, false);
                        console.log(`ðŸš€ [INIT] Games loaded for league ${league.id}:`, virtualGames[league.id]?.length || 0, 'games');
                        
                        try {
                            const raceInfo = await fetch(`/api/virtual/leagues/${league.id}/race-info`);
                            const raceData = await raceInfo.json();
                            
                            if (raceData.success && virtualLeagueStates[league.id]) {
                                // Only update race numbers if server is ahead
                                if (raceData.race_number >= virtualLeagueStates[league.id].raceNumber) {
                                    virtualLeagueStates[league.id].raceNumber = raceData.race_number;
                                    virtualLeagueStates[league.id].seasonNumber = raceData.season_number;
                                    console.log(`ðŸ“ League ${league.id}: Season ${raceData.season_number}, Race ${raceData.race_number}`);
                                }
                            }
                        } catch (e) {
                            console.warn(`Failed to load race info for league ${league.id}:`, e);
                        }
                    }
                    
                    console.log('ðŸš€ [INIT] Saving state and starting update loop...');
                    saveVirtualState();
                    startVirtualUpdateLoop();
                    console.log('ðŸš€ [INIT] Showing league 1...');
                    await showVirtualLeague(1);
                    console.log('âœ… [INIT] Initialization complete!');
                } else {
                    console.error('âŒ [INIT] No leagues found or API failed');
                }
            } catch (error) {
                console.error('âŒ [INIT] Error initializing virtual games:', error);
                virtualInitialized = false;
            }
        }

        async function loadVirtualLeagueGames(leagueId, showAfter = true) {
            try {
                const response = await fetch(`/api/virtual/leagues/${leagueId}/games`);
                const data = await response.json();
                if (data.success && data.games && data.games.length > 0) {
                    console.log(`ðŸ“¥ Games from API for league ${leagueId}:`, data.games[0]); // DEBUG: Check first game
                    virtualGames[leagueId] = data.games.map(game => ({
                        ...game,
                        displayHomeScore: 0,
                        displayAwayScore: 0,
                        isLive: false,
                        status: game.status || 'scheduled',
                        homeLogo: TEAM_LOGOS[game.home_team] || 'https://via.placeholder.com/50x50/334155/ffffff?text=' + game.home_team.charAt(0),
                        awayLogo: TEAM_LOGOS[game.away_team] || 'https://via.placeholder.com/50x50/334155/ffffff?text=' + game.away_team.charAt(0)
                    }));
                    console.log(`âœ… Loaded ${data.games.length} games for league ${leagueId}`);
                    console.log(`ðŸŽ² First game odds:`, {
                        home: virtualGames[leagueId][0].home_odds,
                        draw: virtualGames[leagueId][0].draw_odds,
                        away: virtualGames[leagueId][0].away_odds
                    }); // DEBUG: Check odds
                    if (showAfter) showVirtualLeague(leagueId);
                } else {
                    console.warn(`No games found for league ${leagueId}`);
                }
            } catch (error) {
                console.error('Error loading league games:', error);
            }
        }

        async function showVirtualLeague(leagueId) {
            console.log(`ðŸŽ® Showing virtual league ${leagueId}`);
            document.querySelectorAll('.virtual-league-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`vLeague${leagueId}`)?.classList.add('active');
            renderVirtualGames(leagueId);
            // CRITICAL: Always load standings for the selected league
            await loadVirtualStandings(leagueId);
            console.log(`âœ… League ${leagueId} displayed with standings`);
        }
        
        async function loadVirtualStandings(leagueId) {
            console.log(`ðŸ” Loading standings for league ${leagueId}...`);
            try {
                // Fetch ALL finished games from database for accurate standings
                const response = await fetch(`/api/virtual/leagues/${leagueId}/standings`);
                const data = await response.json();
                
                console.log(`ðŸ“Š Standings API Response for League ${leagueId}:`, {
                    success: data.success,
                    standingsCount: data.standings?.length || 0,
                    gamesPlayed: data.games_played || 0
                });
                
                if (data.success && data.standings) {
                    // Use server-calculated standings
                    const standings = data.standings;
                    
                    // Update league name
                    const leagueNames = {1: 'Premier League', 2: 'La Liga', 3: 'Serie A'};
                    document.getElementById('standingsLeagueName').textContent = leagueNames[leagueId] || 'Standings';
                    
                    // Render table
                    const html = standings.length > 0 ? `
                        <table style="width: 100%; font-size: 11px; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 1px solid #334155;">
                                    <th style="padding: 6px 4px; text-align: left; color: #94a3b8; font-weight: 600;">#</th>
                                    <th style="padding: 6px 4px; text-align: left; color: #94a3b8; font-weight: 600;">Team</th>
                                    <th style="padding: 6px 3px; text-align: center; color: #94a3b8; font-weight: 600;">P</th>
                                    <th style="padding: 6px 3px; text-align: center; color: #94a3b8; font-weight: 600;">W</th>
                                    <th style="padding: 6px 3px; text-align: center; color: #94a3b8; font-weight: 600;">D</th>
                                    <th style="padding: 6px 3px; text-align: center; color: #94a3b8; font-weight: 600;">L</th>
                                    <th style="padding: 6px 3px; text-align: center; color: #94a3b8; font-weight: 600;">GD</th>
                                    <th style="padding: 6px 4px; text-align: center; color: #94a3b8; font-weight: 600;">Pts</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${standings.map((team, i) => `
                                    <tr style="border-bottom: 1px solid #1e293b;">
                                        <td style="padding: 6px 4px; color: #64748b; font-weight: 600;">${i + 1}</td>
                                        <td style="padding: 6px 4px; color: #e2e8f0; font-weight: 500;">${team.name}</td>
                                        <td style="padding: 6px 3px; text-align: center; color: #94a3b8;">${team.played}</td>
                                        <td style="padding: 6px 3px; text-align: center; color: #10b981;">${team.won}</td>
                                        <td style="padding: 6px 3px; text-align: center; color: #f59e0b;">${team.drawn}</td>
                                        <td style="padding: 6px 3px; text-align: center; color: #ef4444;">${team.lost}</td>
                                        <td style="padding: 6px 3px; text-align: center; color: #94a3b8;">${team.gf - team.ga > 0 ? '+' : ''}${team.gf - team.ga}</td>
                                        <td style="padding: 6px 4px; text-align: center; color: #60a5fa; font-weight: 700;">${team.pts}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<div style="text-align: center; color: #94a3b8; padding: 20px; font-size: 12px;">No games played yet</div>';
                    
                    document.getElementById('standingsTable').innerHTML = html;
                    document.getElementById('virtualStandings').style.display = 'block';
                    return;
                }
                
                // Fallback to local calculation if API fails
                const games = virtualGames[leagueId] || [];
                const teams = {};
                
                // First, initialize ALL teams from the league with 0 stats
                games.forEach(game => {
                    if (!teams[game.home_team]) teams[game.home_team] = {
                        name: game.home_team, 
                        played: 0, won: 0, drawn: 0, lost: 0, 
                        gf: 0, ga: 0, pts: 0
                    };
                    if (!teams[game.away_team]) teams[game.away_team] = {
                        name: game.away_team,
                        played: 0, won: 0, drawn: 0, lost: 0,
                        gf: 0, ga: 0, pts: 0
                    };
                });
                
                // Calculate standings from finished games only
                const finishedGames = games.filter(g => g.status === 'finished');
                finishedGames.forEach(game => {
                    teams[game.home_team].played++;
                    teams[game.away_team].played++;
                    teams[game.home_team].gf += game.home_score || 0;
                    teams[game.home_team].ga += game.away_score || 0;
                    teams[game.away_team].gf += game.away_score || 0;
                    teams[game.away_team].ga += game.home_score || 0;
                    
                    if (game.home_score > game.away_score) {
                        teams[game.home_team].won++;
                        teams[game.home_team].pts += 3;
                        teams[game.away_team].lost++;
                    } else if (game.home_score < game.away_score) {
                        teams[game.away_team].won++;
                        teams[game.away_team].pts += 3;
                        teams[game.home_team].lost++;
                    } else {
                        teams[game.home_team].drawn++;
                        teams[game.away_team].drawn++;
                        teams[game.home_team].pts++;
                        teams[game.away_team].pts++;
                    }
                });
                
                // Sort: alphabetically if no games played, otherwise by points/GD
                const standings = Object.values(teams).sort((a, b) => {
                    const anyGamesPlayed = finishedGames.length > 0;
                    if (!anyGamesPlayed) {
                        // Sort alphabetically when league just started
                        return a.name.localeCompare(b.name);
                    }
                    // Sort by points, then goal difference, then goals scored
                    if (b.pts !== a.pts) return b.pts - a.pts;
                    if ((b.gf - b.ga) !== (a.gf - a.ga)) return (b.gf - b.ga) - (a.gf - a.ga);
                    return b.gf - a.gf;
                });
                
                // Update league name
                const leagueNames = {1: 'Premier League', 2: 'La Liga', 3: 'Serie A'};
                document.getElementById('standingsLeagueName').textContent = leagueNames[leagueId] || 'Standings';
                
                // Render table
                const html = standings.length > 0 ? `
                    <table style="width: 100%; font-size: 11px; border-collapse: collapse;">
                        <thead style="position: sticky; top: 0; background: #334155; z-index: 10;">
                            <tr style="color: #94a3b8; font-weight: 600;">
                                <th style="padding: 6px 2px; text-align: left;">#</th>
                                <th style="padding: 6px 4px; text-align: left;">Team</th>
                                <th style="padding: 6px 2px; text-align: center;">P</th>
                                <th style="padding: 6px 2px; text-align: center;">GD</th>
                                <th style="padding: 6px 2px; text-align: center; color: #fbbf24;">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${standings.map((team, idx) => {
                                const pos = idx + 1;
                                const posColor = pos <= 4 ? '#10b981' : pos <= 6 ? '#3b82f6' : pos >= 18 ? '#ef4444' : '#94a3b8';
                                return `
                                    <tr style="border-bottom: 1px solid #334155;">
                                        <td style="padding: 6px 2px; color: ${posColor}; font-weight: 700;">${pos}</td>
                                        <td style="padding: 6px 4px; color: #e2e8f0; font-weight: 600; font-size: 10px;">${team.name.substring(0, 12)}</td>
                                        <td style="padding: 6px 2px; text-align: center; color: #cbd5e1;">${team.played}</td>
                                        <td style="padding: 6px 2px; text-align: center; color: ${(team.gf - team.ga) >= 0 ? '#10b981' : '#ef4444'};">${team.gf - team.ga >= 0 ? '+' : ''}${team.gf - team.ga}</td>
                                        <td style="padding: 6px 2px; text-align: center; color: #fbbf24; font-weight: 700;">${team.pts}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                ` : '<div style="text-align: center; color: #94a3b8; padding: 20px; font-size: 12px;">No games played yet</div>';
                
                document.getElementById('standingsTable').innerHTML = html;
                document.getElementById('virtualStandings').style.display = 'block';
            } catch (error) {
                console.error('âŒ Error loading standings:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }
        
        async function regenerateRaceForLeague(leagueId) {
            try {
                console.log(`ðŸ”„ Regenerating race ${virtualLeagueStates[leagueId].raceNumber} for league ${leagueId}`);
                const response = await fetch(`/api/virtual/admin/leagues/${leagueId}/generate-games`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({num_games: VIRTUAL_CONFIG.MATCHES_PER_RACE})
                });
                const data = await response.json();
                if (data.success) {
                    await loadVirtualLeagueGames(leagueId, false);
                    console.log(`âœ… Race ${virtualLeagueStates[leagueId].raceNumber} loaded for league ${leagueId}`);
                } else {
                    console.error('Failed to regenerate race:', data.error);
                }
            } catch (error) {
                console.error('Error regenerating race:', error);
            }
        }

        function renderVirtualGames(leagueId) {
            console.log(`ðŸŽ¨ [RENDER] Rendering league ${leagueId}...`);
            const games = virtualGames[leagueId] || [];
            console.log(`ðŸŽ¨ [RENDER] Games for league ${leagueId}:`, games.length);
            const container = document.getElementById('virtualGamesContainer');
            console.log(`ðŸŽ¨ [RENDER] Container found:`, !!container);
            const leagueState = virtualLeagueStates[leagueId];
            console.log(`ðŸŽ¨ [RENDER] League state:`, leagueState);
            
            if (games.length === 0) {
                console.log(`âš ï¸ [RENDER] No games to display for league ${leagueId}`);
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #94a3b8;"><i class="fas fa-hourglass-half" style="font-size: 48px; margin-bottom: 20px;"></i><h3>No Games Available</h3><p>Check back soon!</p></div>';
                return;
            }
            
            console.log(`ðŸŽ¨ [RENDER] Building HTML for ${games.length} games...`);
            
            // League-wide timer banner
            let timerBanner = '';
            if (leagueState.countdown > 0 && !leagueState.inBuffer) {
                const m = Math.floor(leagueState.countdown / 60), s = leagueState.countdown % 60;
                const isSecondHalf = leagueState.raceNumber > 19;
                const matchday = isSecondHalf ? leagueState.raceNumber - 19 : leagueState.raceNumber;
                const halfLabel = isSecondHalf ? '2nd Half' : '1st Half';
                timerBanner = `<div style="grid-column: 1/-1; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: 2px solid #60a5fa; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);">
                    <div style="font-size: 11px; color: #bfdbfe; font-weight: 600; margin-bottom: 2px;">SEASON ${leagueState.seasonNumber} â€¢ ${halfLabel}</div>
                    <div style="font-size: 13px; color: #bfdbfe; font-weight: 700; margin-bottom: 8px;">MATCHDAY ${matchday}</div>
                    <div style="font-size: 14px; color: #e0f2fe; font-weight: 600; margin-bottom: 8px;"><i class="fas fa-clock"></i> ALL MATCHES START IN</div>
                    <div style="font-size: 48px; font-weight: 900; color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">${m}:${s.toString().padStart(2, '0')}</div>
                    <div style="font-size: 13px; color: #bfdbfe; margin-top: 8px;">Place your bets now!</div>
                </div>`;
            } else if (leagueState.isPlaying) {
                const minute = Math.floor((leagueState.playTime / VIRTUAL_CONFIG.GAME_DURATION_SECONDS) * 90);
                const isSecondHalf = leagueState.raceNumber > 19;
                const matchday = isSecondHalf ? leagueState.raceNumber - 19 : leagueState.raceNumber;
                const halfLabel = isSecondHalf ? '2nd Half' : '1st Half';
                timerBanner = `<div style="grid-column: 1/-1; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: 2px solid #f87171; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px; box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); animation: livePulse 2s infinite;">
                    <div style="font-size: 11px; color: #fecaca; font-weight: 600; margin-bottom: 2px;">SEASON ${leagueState.seasonNumber} â€¢ ${halfLabel}</div>
                    <div style="font-size: 13px; color: #fecaca; font-weight: 700; margin-bottom: 4px;">MATCHDAY ${matchday}</div>
                    <div style="font-size: 16px; color: #ffffff; font-weight: 700; margin-bottom: 5px;"><i class="fas fa-circle" style="animation: pulse 1s infinite;"></i> LIVE - MATCHES IN PROGRESS</div>
                    <div style="font-size: 36px; font-weight: 900; color: #ffffff;">${minute}'</div>
                    <div style="font-size: 12px; color: #fecaca; margin-top: 5px;">Betting closed for this round</div>
                </div>`;
            } else if (leagueState.inBuffer) {
                const nextRace = leagueState.raceNumber;
                const willBeSecondHalf = nextRace > 19;
                const nextMatchday = willBeSecondHalf ? nextRace - 19 : nextRace;
                const nextHalfLabel = willBeSecondHalf ? '2nd Half' : '1st Half';
                const isNewSeason = nextRace === 1;
                timerBanner = `<div style="grid-column: 1/-1; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: 2px solid #fbbf24; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);">
                    ${isNewSeason ? `<div style="font-size: 14px; color: #ffffff; font-weight: 800; margin-bottom: 8px;">ðŸ† NEW SEASON ${leagueState.seasonNumber} STARTING! ðŸ†</div>` : `<div style="font-size: 11px; color: #fef3c7; font-weight: 600; margin-bottom: 2px;">${nextHalfLabel}</div><div style="font-size: 13px; color: #fef3c7; font-weight: 700; margin-bottom: 4px;">MATCHDAY ${nextMatchday} LOADING...</div>`}
                    <div style="font-size: 16px; color: #ffffff; font-weight: 700; margin-bottom: 5px;"><i class="fas fa-hourglass-half"></i> NEXT ROUND STARTING SOON</div>
                    <div style="font-size: 32px; font-weight: 900; color: #ffffff;">${VIRTUAL_CONFIG.BUFFER_SECONDS - leagueState.bufferTime}s</div>
                    <div style="font-size: 12px; color: #fef3c7; margin-top: 5px;">Get ready to place your bets!</div>
                </div>`;
            }
            
            const finalHTML = timerBanner + games.map(game => renderVirtualMatch(game, leagueState)).join('');
            console.log(`ðŸŽ¨ [RENDER] Setting innerHTML, length:`, finalHTML.length);
            container.innerHTML = finalHTML;
            console.log(`âœ… [RENDER] Render complete for league ${leagueId}`);
        }

        function renderVirtualMatch(game, leagueState) {
            const isLive = leagueState.isPlaying;
            const isFinished = game.status === 'finished';
            const inBuffer = leagueState.inBuffer;
            const canBet = leagueState.countdown > 0 && !isFinished && !inBuffer;
            const showScore = isLive || isFinished;
            const isSelected = (market, sel) => virtualSelectedBets.some(b => b.gameId === game.id && b.market === market && b.selection === sel);
            
            const progressPercent = isLive ? (leagueState.playTime / VIRTUAL_CONFIG.GAME_DURATION_SECONDS) * 100 : 0;
            
            const logoStyle = "width: 32px; height: 32px; object-fit: contain; background: #1e293b; border-radius: 4px; padding: 2px;";
            const fallbackLogo = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%23334155'/%3E%3Ctext x='16' y='20' text-anchor='middle' font-size='16' fill='%23fff' font-family='Arial'%3Eâš½%3C/text%3E%3C/svg%3E";
            
            return `<div class="virtual-match-compact ${isLive ? 'live' : ''}" data-game-id="${game.id}">
                <div class="virtual-teams" style="align-items: center; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                        <img src="${game.homeLogo || fallbackLogo}" alt="" style="${logoStyle}" onerror="this.onerror=null; this.src='${fallbackLogo}';">
                        <div class="virtual-team-name" style="flex: 1;">${game.home_team}</div>
                    </div>
                    <div class="virtual-vs">VS</div>
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1; flex-direction: row-reverse;">
                        <img src="${game.awayLogo || fallbackLogo}" alt="" style="${logoStyle}" onerror="this.onerror=null; this.src='${fallbackLogo}';">
                        <div class="virtual-team-name" style="flex: 1; text-align: right;">${game.away_team}</div>
                    </div>
                </div>
                
                ${showScore ? `<div class="virtual-score" id="score-${game.id}"><span>${game.displayHomeScore || 0}</span><span style="color: #64748b;">-</span><span>${game.displayAwayScore || 0}</span></div>` : '<div style="height: 32px;"></div>'}
                
                ${canBet ? `
                    <div style="margin-top: 12px;">
                        <div style="font-size: 11px; color: #94a3b8; font-weight: 700; text-transform: uppercase; margin-bottom: 6px; text-align: center;">Match Result</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 8px;">
                            <button class="virtual-odd-btn ${isSelected('1X2', '1') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, '1X2', '1', ${game.home_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">1</span><span class="virtual-odd-value">${game.home_odds.toFixed(2)}</span></button>
                            <button class="virtual-odd-btn ${isSelected('1X2', 'X') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, '1X2', 'X', ${game.draw_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">X</span><span class="virtual-odd-value">${game.draw_odds.toFixed(2)}</span></button>
                            <button class="virtual-odd-btn ${isSelected('1X2', '2') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, '1X2', '2', ${game.away_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">2</span><span class="virtual-odd-value">${game.away_odds.toFixed(2)}</span></button>
                        </div>
                        
                        <div style="border: 1px solid #334155; border-radius: 6px; padding: 8px; background: #1e293b; margin-bottom: 6px;" onclick="event.stopPropagation();">
                            <div style="color: #60a5fa; font-size: 12px; font-weight: 600; margin-bottom: 8px; text-align: center;">
                                <i class="fas fa-th-large" style="margin-right: 6px;"></i>More Betting Options
                            </div>
                            <div style="padding: 4px;" onclick="event.stopPropagation();">
                                <div style="font-size: 10px; color: #94a3b8; font-weight: 700; text-transform: uppercase; margin-bottom: 4px;">Double Chance</div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 10px;">
                                    <button class="virtual-odd-btn ${isSelected('DC', '1X') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'DC', '1X', ${game.home_draw_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">1X</span><span class="virtual-odd-value">${game.home_draw_odds.toFixed(2)}</span></button>
                                    <button class="virtual-odd-btn ${isSelected('DC', '12') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'DC', '12', ${game.home_away_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">12</span><span class="virtual-odd-value">${game.home_away_odds.toFixed(2)}</span></button>
                                    <button class="virtual-odd-btn ${isSelected('DC', 'X2') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'DC', 'X2', ${game.draw_away_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">X2</span><span class="virtual-odd-value">${game.draw_away_odds.toFixed(2)}</span></button>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                                    <div>
                                        <div style="font-size: 10px; color: #94a3b8; font-weight: 700; text-transform: uppercase; margin-bottom: 4px;">Both Score</div>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px;">
                                            <button class="virtual-odd-btn ${isSelected('GG', 'Yes') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'GG', 'Yes', ${game.gg_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">GG</span><span class="virtual-odd-value">${game.gg_odds.toFixed(2)}</span></button>
                                            <button class="virtual-odd-btn ${isSelected('GG', 'No') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'GG', 'No', ${game.ng_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">NG</span><span class="virtual-odd-value">${game.ng_odds.toFixed(2)}</span></button>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="font-size: 10px; color: #94a3b8; font-weight: 700; text-transform: uppercase; margin-bottom: 4px;">Over 2.5</div>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px;">
                                            <button class="virtual-odd-btn ${isSelected('O/U', 'Over') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'O/U', 'Over', ${game.over25_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">O</span><span class="virtual-odd-value">${game.over25_odds.toFixed(2)}</span></button>
                                            <button class="virtual-odd-btn ${isSelected('O/U', 'Under') ? 'selected' : ''}" onclick="event.stopPropagation(); addVirtualBet(${game.id}, 'O/U', 'Under', ${game.under25_odds}, '${escapeStr(game.home_team)}', '${escapeStr(game.away_team)}')"><span class="virtual-odd-label">U</span><span class="virtual-odd-value">${game.under25_odds.toFixed(2)}</span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                ${isLive ? `<div class="virtual-progress-bar"><div class="virtual-progress-fill live" style="width: ${progressPercent}%"></div></div>` : ''}
                ${isFinished ? '<div class="virtual-timer finished" style="margin-top: 8px;"><i class="fas fa-check-circle"></i><span>Full Time</span></div>' : ''}
            </div>`;
        }
        
        function escapeStr(str) {
            return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
        }

        function addVirtualBet(gameId, market, selection, odd, home, away) {
            let game = null, leagueId = null;
            for (const [lid, games] of Object.entries(virtualGames)) {
                game = games.find(g => g.id === gameId);
                if (game) { leagueId = lid; break; }
            }
            if (!game) return;
            
            const betKey = `${gameId}-${market}`;
            const existingIndex = virtualSelectedBets.findIndex(b => `${b.gameId}-${b.market}` === betKey);
            
            if (existingIndex >= 0) {
                if (virtualSelectedBets[existingIndex].selection === selection) {
                    virtualSelectedBets.splice(existingIndex, 1);
                    showMessage('Removed from betslip', 'info');
                } else {
                    virtualSelectedBets[existingIndex].selection = selection;
                    virtualSelectedBets[existingIndex].odd = odd;
                    showMessage(`Updated to ${selection}`, 'success');
                }
            } else {
                virtualSelectedBets.push({
                    gameId, 
                    home, 
                    away, 
                    market, 
                    selection, 
                    odd, 
                    leagueId, 
                    leagueName: leagueId == 1 ? 'Premier League' : leagueId == 2 ? 'La Liga' : 'Serie A'
                });
                
                const marketName = {
                    '1X2': 'Match Result',
                    'DC': 'Double Chance',
                    'GG': 'Both Teams Score',
                    'O/U': 'Over/Under 2.5',
                    'CS': 'Correct Score'
                }[market] || market;
                
                showMessage(`Added ${home} vs ${away} - ${marketName}: ${selection}`, 'success');
            }
            updateVirtualBetslipUI();
            const activeTab = document.querySelector('.virtual-league-tab.active');
            if (activeTab) renderVirtualGames(parseInt(activeTab.id.replace('vLeague', '')));
        }

        function updateVirtualBetslipUI() {
            const count = virtualSelectedBets.length;
            ['betslipCount', 'betslipBadge'].forEach(id => {
                const el = document.getElementById(id);
                if (el) { el.textContent = count; if (id === 'betslipBadge') el.style.display = count > 0 ? 'block' : 'none'; }
            });
            const picks = document.getElementById('betslipPicks'), summary = document.getElementById('betslipSummary');
            if (count === 0) {
                if (picks) picks.innerHTML = '<div class="betslip-empty"><i class="fas fa-clipboard-list"></i><p>Select virtual game odds to bet</p></div>';
                if (summary) summary.style.display = 'none';
                return;
            }
            const totalOdds = virtualSelectedBets.reduce((acc, bet) => acc * bet.odd, 1);
            if (picks) picks.innerHTML = virtualSelectedBets.map((bet, idx) => {
                const marketLabel = {
                    '1X2': 'Match Result',
                    'DC': 'Double Chance',
                    'GG': 'Both Teams Score',
                    'O/U': 'Over/Under 2.5',
                    'CS': 'Correct Score'
                }[bet.market] || bet.market;
                
                return `<div class="betslip-pick" style="background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                        <div style="flex: 1;">
                            <div style="color: #e2e8f0; font-weight: 600; font-size: 13px; margin-bottom: 4px;">${bet.home} vs ${bet.away}</div>
                            <div style="color: #94a3b8; font-size: 11px; margin-bottom: 3px;"><span style="color: #60a5fa;">âš¡ ${bet.leagueName}</span></div>
                            <div style="color: #cbd5e1; font-size: 11px;"><span style="color: #a78bfa;">${marketLabel}</span> â€¢ <strong style="color: #fbbf24;">${bet.selection}</strong></div>
                        </div>
                        <button onclick="removeVirtualBet(${idx})" style="background: none; border: none; color: #ef4444; cursor: pointer; padding: 4px 8px; font-size: 16px;"><i class="fas fa-times"></i></button>
                    </div>
                    <div style="text-align: right; color: #10b981; font-weight: 700; font-size: 14px;">${bet.odd.toFixed(2)}</div>
                </div>`;
            }).join('');
            if (document.getElementById('betslipTotalOdds')) document.getElementById('betslipTotalOdds').textContent = totalOdds.toFixed(2);
            if (summary) summary.style.display = 'block';
            document.getElementById('betslipContainer')?.classList.remove('hidden');
        }

        function removeVirtualBet(index) {
            virtualSelectedBets.splice(index, 1);
            updateVirtualBetslipUI();
            const activeTab = document.querySelector('.virtual-league-tab.active');
            if (activeTab) renderVirtualGames(parseInt(activeTab.id.replace('vLeague', '')));
        }

        async function placeVirtualBetslip() {
            if (virtualSelectedBets.length === 0) {
                showMessage('âŒ No virtual bets selected', 'error');
                return;
            }
            
            const amountInput = document.getElementById('betslipStake');  // FIXED: Was 'betslipAmount'
            const amount = parseFloat(amountInput?.value || 0);
            
            if (amount < 2) {
                showMessage('âŒ Minimum bet amount is $2', 'error');
                return;
            }
            
            const token = localStorage.getItem('abkbet_token');
            if (!token) {
                showMessage('âŒ Please login to place bets', 'error');
                return;
            }
            
            const btn = document.getElementById('betslipPlaceBetBtn');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Placing...';
            }
            
            try {
                const response = await fetch('/api/virtual/bets/place', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: amount,
                        selections: virtualSelectedBets.map(bet => ({
                            game_id: bet.gameId,
                            market: bet.market,
                            selection: bet.selection,
                            odd: bet.odd,
                            home_team: bet.home,
                            away_team: bet.away,
                            league_name: bet.leagueName
                        }))
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`âœ… ${data.message}`, 'success');
                    // Clear betslip
                    virtualSelectedBets = [];
                    updateVirtualBetslipUI();
                    if (amountInput) amountInput.value = '';
                    // Update balance display
                    if (window.updateUserBalance) {
                        window.updateUserBalance(data.new_balance);
                    }
                    // Re-render games to clear selection highlights
                    const activeTab = document.querySelector('.virtual-league-tab.active');
                    if (activeTab) renderVirtualGames(parseInt(activeTab.id.replace('vLeague', '')));
                } else {
                    showMessage(`âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error placing virtual bet:', error);
                showMessage('âŒ Error placing bet. Please try again.', 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-check-circle"></i> Place Bet';
                }
            }
        }

        function startVirtualUpdateLoop() {
            if (virtualUpdateInterval) clearInterval(virtualUpdateInterval);
            virtualUpdateInterval = setInterval(updateAllVirtualGames, VIRTUAL_CONFIG.UPDATE_INTERVAL_MS);
        }

        async function updateAllVirtualGames() {
            let needsRender = false;
            
            // Update each league state
            for (const [leagueId, leagueState] of Object.entries(virtualLeagueStates)) {
                const lid = parseInt(leagueId);
                const games = virtualGames[lid] || [];
                
                // Countdown phase
                if (leagueState.countdown > 0 && !leagueState.inBuffer) {
                    leagueState.countdown--;
                    needsRender = true;
                    
                    // Start all games when countdown reaches 0
                    if (leagueState.countdown === 0) {
                        leagueState.isPlaying = true;
                        leagueState.playTime = 0;
                        games.forEach(game => startVirtualGame(game));
                    }
                }
                // Playing phase
                else if (leagueState.isPlaying && leagueState.playTime < VIRTUAL_CONFIG.GAME_DURATION_SECONDS) {
                    leagueState.playTime += 5;  // Increment by 5 for faster game minutes
                    needsRender = true;
                    
                    // Update all games in the league (reduced scoring, max 5 goals)
                    // Check every 5 seconds for score updates
                    games.forEach(game => {
                        const totalGoals = (game.displayHomeScore || 0) + (game.displayAwayScore || 0);
                        if (game.isLive && totalGoals < 5 && leagueState.playTime % 10 === 0 && Math.random() > 0.70) {
                            if (Math.random() > 0.5) game.displayHomeScore++; else game.displayAwayScore++;
                            animateScoreUpdate(game.id);
                        }
                    });
                    
                    // Finish all games when play time is done
                    if (leagueState.playTime >= VIRTUAL_CONFIG.GAME_DURATION_SECONDS) {
                        leagueState.isPlaying = false;
                        leagueState.inBuffer = true;
                        leagueState.bufferTime = 0;
                        await Promise.all(games.map(game => finishVirtualGame(game)));
                        // IMMEDIATELY update standings after games finish
                        await loadVirtualStandings(lid);
                        console.log(`âœ… League ${lid} standings updated after race finish`);
                    }
                }
                // Buffer phase (between races - auto-generate new matches)
                else if (leagueState.inBuffer && leagueState.bufferTime < VIRTUAL_CONFIG.BUFFER_SECONDS) {
                    leagueState.bufferTime++;
                    needsRender = true;
                    
                    // At buffer midpoint, trigger new race generation
                    if (leagueState.bufferTime === Math.floor(VIRTUAL_CONFIG.BUFFER_SECONDS / 2)) {
                        leagueState.raceNumber++;
                        
                        // Reset season after 38 races
                        if (leagueState.raceNumber > VIRTUAL_CONFIG.RACES_PER_SEASON) {
                            leagueState.raceNumber = 1;
                            leagueState.seasonNumber++;
                            console.log(`ðŸ† League ${lid} Season ${leagueState.seasonNumber} started!`);
                        }
                        
                        regenerateRaceForLeague(lid);
                    }
                    
                    if (leagueState.bufferTime >= VIRTUAL_CONFIG.BUFFER_SECONDS) {
                        leagueState.inBuffer = false;
                        leagueState.countdown = VIRTUAL_CONFIG.COUNTDOWN_SECONDS;
                        // Force refresh of the UI to show new matches
                        await loadVirtualLeagueGames(lid, false);
                        // Check if this is the active league and refresh its display
                        const activeTab = document.querySelector('.virtual-league-tab.active');
                        if (activeTab) {
                            const activeLeagueId = parseInt(activeTab.id.replace('vLeague', ''));
                            if (activeLeagueId === lid) {
                                // Force render new games for active league
                                renderVirtualGames(lid);
                                console.log(`ðŸ”„ New race loaded and displayed for league ${lid}`);
                            }
                        }
                        needsRender = true;
                    }
                }
            }
            
            if (needsRender) {
                saveVirtualState();  // Persist state for continuity
                const activeTab = document.querySelector('.virtual-league-tab.active');
                if (activeTab) renderVirtualGames(parseInt(activeTab.id.replace('vLeague', '')));
            }
        }

        function startVirtualGame(game) {
            game.isLive = true; game.liveSeconds = 0; game.displayHomeScore = 0; game.displayAwayScore = 0; game.status = 'in_progress';
            console.log(`ðŸŽ® Virtual game started: ${game.home_team} vs ${game.away_team}`);
        }

        async function finishVirtualGame(game) {
            game.isLive = false; 
            game.status = 'finished'; 
            game.home_score = game.displayHomeScore; 
            game.away_score = game.displayAwayScore;
            
            // Save to backend database
            try {
                const response = await fetch(`/api/virtual/admin/games/${game.id}/finish`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        home_score: game.home_score,
                        away_score: game.away_score
                    })
                });
                const data = await response.json();
                if (data.success) {
                    console.log(`âœ… Virtual game finished and saved: ${game.home_team} ${game.home_score} - ${game.away_score} ${game.away_team}`);
                } else {
                    console.error('Failed to save finished game:', data.message);
                }
            } catch (error) {
                console.error('Error saving finished game:', error);
            }
            
            virtualSelectedBets = virtualSelectedBets.filter(b => b.gameId !== game.id);
            updateVirtualBetslipUI();
        }

        function animateScoreUpdate(gameId) {
            const scoreEl = document.getElementById(`score-${gameId}`);
            if (scoreEl) { scoreEl.classList.add('animating'); setTimeout(() => scoreEl.classList.remove('animating'), 300); }
        }

        function loadVirtualGames() { initVirtualGames(); }
        
        // Initialize when DOM loads or when virtual tab is clicked
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ”§ DOM loaded, setting up virtual games handlers...');
            const virtualTab = document.getElementById('virtualTab');
            if (virtualTab) {
                console.log('âœ… Virtual tab found, adding click listener');
                virtualTab.addEventListener('click', () => { 
                    console.log('ðŸ–±ï¸ Virtual tab clicked!');
                    if (!virtualInitialized) {
                        initVirtualGames();
                    } else {
                        console.log('â„¹ï¸ Virtual games already initialized');
                    }
                });
            } else {
                console.warn('âš ï¸ Virtual tab element not found!');
            }
        });
        
        // Reset all leagues to Matchday 1
        async function resetAllLeagues() {
            if (!confirm('âš ï¸ Reset all leagues to Matchday 1? This will clear all finished games and standings!')) {
                return;
            }
            
            try {
                const response = await fetch('/api/virtual/admin/reset-all-leagues', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('âœ… All leagues reset to MD1!', 'success');
                    // Reset local state
                    virtualLeagueStates = {
                        1: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS, isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1},
                        2: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS + VIRTUAL_CONFIG.LEAGUE_INTERVAL, isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1},
                        3: {countdown: VIRTUAL_CONFIG.COUNTDOWN_SECONDS + (VIRTUAL_CONFIG.LEAGUE_INTERVAL * 2), isPlaying: false, playTime: 0, inBuffer: false, bufferTime: 0, raceNumber: 1, seasonNumber: 1}
                    };
                    saveVirtualState();
                    // Reload games
                    await initVirtualGames();
                    await showVirtualLeague(1);
                } else {
                    showMessage('âŒ ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error resetting leagues:', error);
                showMessage('âŒ Error resetting leagues', 'error');
            }
        }
        
        console.log('ðŸ“œ Virtual games script loaded');
        // ========== END VIRTUAL GAMES ==========

        // ========== DICE GAME FUNCTIONS ==========
        let dicePrediction = 'over'; // Default prediction
        let diceTarget = 50; // Default target

        function selectDicePrediction(type) {
            dicePrediction = type;
            document.querySelectorAll('.prediction-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const btnId = `dice${type.charAt(0).toUpperCase() + type.slice(1)}`;
            const btn = document.getElementById(btnId);
            if (btn) btn.classList.add('active');
            updateDiceTarget();
        }

        function updateDiceTarget() {
            const input = document.getElementById('diceTarget');
            diceTarget = parseFloat(input.value);
            
            // Update target line position
            const line = document.querySelector('.dice-target-line');
            if (line) {
                line.style.left = `${diceTarget}%`;
            }
            
            // Calculate multiplier and win chance
            let multiplier, winChance;
            if (dicePrediction === 'over') {
                winChance = 100 - diceTarget;
                multiplier = winChance > 0 ? (99 / winChance).toFixed(2) : 0;
            } else {
                winChance = diceTarget;
                multiplier = winChance > 0 ? (99 / winChance).toFixed(2) : 0;
            }
            
            document.querySelector('.dice-multiplier').textContent = `${multiplier}x`;
            document.querySelector('.dice-win-chance').textContent = `Win Chance: ${winChance.toFixed(2)}%`;
        }

        async function rollDice() {
            const betAmount = parseFloat(document.getElementById('diceBetAmount').value);
            
            if (!betAmount || betAmount < 0.1) {
                showMessage('Minimum bet is $0.10', 'error');
                return;
            }
            
            const token = localStorage.getItem('abkbet_token');
            if (!token) {
                showMessage('Please login to play', 'error');
                return;
            }
            
            const rollBtn = document.getElementById('rollDiceBtn');
            rollBtn.disabled = true;
            rollBtn.textContent = 'ðŸŽ² Rolling...';
            
            try {
                const response = await fetch('/api/dice/roll', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                    },
                    body: JSON.stringify({
                        amount: betAmount,
                        target: diceTarget,
                        prediction: dicePrediction
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update balance from backend
                    updateBalanceUI(data.new_balance);
                    
                    // Animate result
                    const resultEl = document.querySelector('.dice-number');
                    resultEl.textContent = data.result.toFixed(2);
                    resultEl.style.animation = 'none';
                    setTimeout(() => {
                        resultEl.style.animation = 'pulse 2s ease-in-out infinite';
                    }, 10);
                    
                    // Show result
                    const won = data.won;
                    const profit = data.profit;
                    const message = won 
                        ? `ðŸŽ‰ You won $${Math.abs(profit).toFixed(2)}!` 
                        : `ðŸ˜ž You lost $${Math.abs(profit).toFixed(2)}`;
                    showMessage(message, won ? 'success' : 'error');
                    
                    // Add to history
                    addDiceHistory(data.result, won, profit);
                } else {
                    showMessage(data.message || 'Roll failed', 'error');
                }
            } catch (error) {
                console.error('Dice error:', error);
                showMessage('Error rolling dice', 'error');
            } finally {
                rollBtn.disabled = false;
                rollBtn.textContent = 'ðŸŽ² Roll Dice';
            }
        }

        function addDiceHistory(result, won, profit) {
            const historyContainer = document.querySelector('.dice-history-items');
            const item = document.createElement('div');
            item.className = `dice-history-item ${won ? 'won' : 'lost'}`;
            item.textContent = `${result.toFixed(2)} ${won ? '+' : ''}$${profit.toFixed(2)}`;
            
            historyContainer.insertBefore(item, historyContainer.firstChild);
            
            // Keep only last 10
            while (historyContainer.children.length > 10) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }

        // Initialize dice game
        document.addEventListener('DOMContentLoaded', () => {
            selectDicePrediction('over');
            updateDiceTarget();
            document.getElementById('diceTarget').addEventListener('input', updateDiceTarget);
        });

        // ========== MINES GAME FUNCTIONS ==========
        let minesGameId = null;
        let minesRevealed = 0;

        async function startMinesGame() {
            const betAmount = parseFloat(document.getElementById('minesBetAmount').value);
            const mineCount = parseInt(document.getElementById('mineCount').value);
            
            if (!betAmount || betAmount < 0.1) {
                showMessage('Minimum bet is $0.10', 'error');
                return;
            }
            
            const token = localStorage.getItem('abkbet_token');
            if (!token) {
                showMessage('Please login to play', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/mines/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                    },
                    body: JSON.stringify({
                        amount: betAmount,
                        mines: mineCount
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update balance from backend
                    updateBalanceUI(data.new_balance);
                    
                    minesGameId = data.game_id;
                    minesRevealed = 0;
                    
                    // Reset grid
                    document.querySelectorAll('.mine-tile').forEach(tile => {
                        tile.classList.remove('revealed', 'gem', 'mine');
                        tile.textContent = '';
                        tile.style.pointerEvents = 'auto';
                    });
                    
                    // Update UI
                    document.getElementById('startMinesBtn').style.display = 'none';
                    document.getElementById('cashoutMinesBtn').style.display = 'block';
                    document.querySelector('.mines-current-multi').textContent = '1.00x';
                    updateMinesInfo(25 - mineCount, mineCount, 0);
                    
                    showMessage('ðŸ’Ž Game started! Click tiles to reveal', 'success');
                } else {
                    showMessage(data.message || 'Failed to start game', 'error');
                }
            } catch (error) {
                console.error('Mines start error:', error);
                showMessage('Error starting game', 'error');
            }
        }

        async function revealTile(position) {
            if (!minesGameId) {
                showMessage('Start a game first!', 'error');
                return;
            }
            
            const tile = event.target;
            if (tile.classList.contains('revealed')) return;
            
            try {
                const response = await fetch('/api/mines/reveal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                    },
                    body: JSON.stringify({
                        game_id: minesGameId,
                        position: position
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update balance from backend
                    updateBalanceUI(data.new_balance);
                    
                    tile.classList.add('revealed');
                    
                    if (data.is_mine) {
                        // Hit mine - game over
                        tile.classList.add('mine');
                        tile.textContent = 'ðŸ’£';
                        showMessage('ðŸ’¥ Boom! You hit a mine!', 'error');
                        endMinesGame();
                    } else {
                        // Safe tile
                        tile.classList.add('gem');
                        tile.textContent = 'ðŸ’Ž';
                        minesRevealed++;
                        
                        // Update multiplier
                        document.querySelector('.mines-current-multi').textContent = `${data.multiplier.toFixed(2)}x`;
                        updateMinesInfo(data.tiles_remaining, data.mine_count, minesRevealed);
                        
                        // Update cashout amount
                        if (data.potential_win) {
                            document.getElementById('minesCashoutAmount').textContent = `$${data.potential_win.toFixed(2)}`;
                        }
                        
                        if (data.tiles_remaining === 0) {
                            // Won - revealed all safe tiles
                            showMessage(`ðŸŽ‰ Perfect! Won $${data.winnings.toFixed(2)}!`, 'success');
                            endMinesGame();
                        }
                    }
                } else {
                    showMessage(data.message || 'Reveal failed', 'error');
                }
            } catch (error) {
                console.error('Mines reveal error:', error);
                showMessage('Error revealing tile', 'error');
            }
        }

        async function cashoutMines() {
            if (!minesGameId) return;
            
            try {
                const response = await fetch('/api/mines/cashout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                    },
                    body: JSON.stringify({
                        game_id: minesGameId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update balance from backend
                    updateBalanceUI(data.new_balance);
                    
                    showMessage(`ðŸ’° Cashed out $${data.winnings.toFixed(2)}!`, 'success');
                    endMinesGame();
                } else {
                    showMessage(data.message || 'Cashout failed', 'error');
                }
            } catch (error) {
                console.error('Mines cashout error:', error);
                showMessage('Error cashing out', 'error');
            }
        }

        function endMinesGame() {
            minesGameId = null;
            minesRevealed = 0;
            document.getElementById('startMinesBtn').style.display = 'block';
            document.getElementById('cashoutMinesBtn').style.display = 'none';
            document.querySelectorAll('.mine-tile').forEach(tile => {
                tile.style.pointerEvents = 'none';
            });
        }

        function updateMinesInfo(tilesLeft, mineCount, revealed) {
            document.getElementById('minesTilesRevealed').textContent = revealed;
            document.getElementById('minesSafeLeft').textContent = tilesLeft;
        }

        // Initialize mines grid
        function initMinesGrid() {
            const grid = document.getElementById('minesGrid');
            if (!grid || grid.children.length > 0) return; // Already initialized
            
            for (let i = 0; i < 25; i++) {
                const tile = document.createElement('div');
                tile.className = 'mine-tile';
                tile.onclick = () => revealTile(i);
                grid.appendChild(tile);
            }
        }

        // Initialize when mines tab is clicked
        document.getElementById('minesTab')?.addEventListener('click', () => {
            setTimeout(initMinesGrid, 100);
        });

        // ========== PLINKO GAME FUNCTIONS ==========
        const PLINKO_MULTIPLIERS = {
            low: [1.5, 1.4, 1.3, 1.2, 1.1, 1.0, 1.0, 0.9, 1.0, 0.9, 1.0, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5],
            medium: [5.6, 2.1, 1.1, 1.0, 0.5, 0.3, 1.0, 0.7, 0.4, 0.7, 1.0, 0.3, 0.5, 1.0, 1.1, 2.1, 5.6],
            high: [33.0, 11.0, 4.0, 2.0, 1.1, 1.0, 0.5, 0.2, 0.1, 0.2, 0.5, 1.0, 1.1, 2.0, 4.0, 11.0, 33.0]
        };

        let plinkoCanvas, plinkoCtx;
        let currentPlinkoRisk = 'medium';

        function initPlinkoCanvas() {
            plinkoCanvas = document.getElementById('plinkoCanvas');
            if (!plinkoCanvas) return;
            
            plinkoCanvas.width = 460;
            plinkoCanvas.height = 500;
            plinkoCtx = plinkoCanvas.getContext('2d');
            
            drawPlinkoBoard();
        }

        function drawPlinkoBoard() {
            if (!plinkoCtx) return;
            
            plinkoCtx.clearRect(0, 0, plinkoCanvas.width, plinkoCanvas.height);
            
            // Draw hole at top where ball drops from
            const holeX = plinkoCanvas.width / 2;
            const holeY = 15;
            const holeRadius = 10;
            
            plinkoCtx.fillStyle = '#0f172a';
            plinkoCtx.strokeStyle = '#fbbf24';
            plinkoCtx.lineWidth = 3;
            plinkoCtx.beginPath();
            plinkoCtx.arc(holeX, holeY, holeRadius, 0, Math.PI * 2);
            plinkoCtx.fill();
            plinkoCtx.stroke();
            
            // Draw pegs
            const rows = 16;
            const pegRadius = 4;
            const spacing = 25;
            
            plinkoCtx.fillStyle = '#64748b';
            for (let row = 0; row < rows; row++) {
                const pegsInRow = row + 3;
                const yPos = 40 + (row * spacing);
                
                for (let peg = 0; peg < pegsInRow; peg++) {
                    const xPos = (plinkoCanvas.width / 2) - ((pegsInRow - 1) * spacing / 2) + (peg * spacing);
                    plinkoCtx.beginPath();
                    plinkoCtx.arc(xPos, yPos, pegRadius, 0, Math.PI * 2);
                    plinkoCtx.fill();
                }
            }
        }

        function updatePlinkoRisk(risk) {
            currentPlinkoRisk = risk;
            
            // Update multiplier display
            const multipliers = PLINKO_MULTIPLIERS[risk];
            const multipliersContainer = document.querySelector('.plinko-multipliers');
            multipliersContainer.innerHTML = '';
            
            multipliers.forEach((mult, index) => {
                const div = document.createElement('div');
                let className = 'plinko-multiplier ';
                // More granular color classification
                if (mult >= 10) className += 'mega';
                else if (mult >= 3) className += 'high';
                else if (mult >= 0.8) className += 'medium';
                else className += 'low';
                
                div.className = className;
                div.textContent = `${mult}x`;
                multipliersContainer.appendChild(div);
            });
        }

        async function dropPlinkoBall() {
            const betAmount = parseFloat(document.getElementById('plinkoBetAmount').value);
            const numBalls = parseInt(document.getElementById('plinkoNumBalls').value) || 1;
            
            if (!betAmount || betAmount < 0.1) {
                showMessage('Minimum bet is $0.10', 'error');
                return;
            }
            
            if (numBalls < 1 || numBalls > 10) {
                showMessage('Number of balls must be between 1 and 10', 'error');
                return;
            }
            
            const token = localStorage.getItem('abkbet_token');
            if (!token) {
                showMessage('Please login to play', 'error');
                return;
            }
            
            const totalStake = betAmount * numBalls;
            const dropBtn = document.getElementById('dropPlinkoBtn');
            dropBtn.disabled = true;
            dropBtn.textContent = `ðŸŽ¯ Dropping ${numBalls} ball${numBalls > 1 ? 's' : ''}...`;
            
            let totalWinnings = 0;
            let totalProfit = 0;
            
            try {
                // Drop balls sequentially
                for (let i = 0; i < numBalls; i++) {
                    const response = await fetch('/api/plinko/drop', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`
                        },
                        body: JSON.stringify({
                            amount: betAmount,
                            risk: currentPlinkoRisk
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Animate ball drop
                        await animatePlinkoBall(data.path, data.bucket);
                        
                        // Bounce the multiplier bucket
                        bounceMultiplier(data.bucket);
                        
                        // Update balance from backend
                        updateBalanceUI(data.new_balance);
                        
                        totalWinnings += data.winnings;
                        totalProfit += data.profit;
                        
                        // Add to history
                        addPlinkoHistory(data.multiplier, data.profit > 0, data.profit);
                        
                        // Small delay between balls
                        if (i < numBalls - 1) {
                            await new Promise(resolve => setTimeout(resolve, 300));
                        }
                    } else {
                        showMessage(data.message || 'Drop failed', 'error');
                        break;
                    }
                }
                
                // Show final result
                const won = totalProfit > 0;
                const message = numBalls > 1 
                    ? `${won ? 'ðŸŽ‰' : 'ðŸ˜ž'} ${numBalls} Balls: ${won ? 'Won' : 'Lost'} $${Math.abs(totalProfit).toFixed(2)} (Total stake: $${totalStake.toFixed(2)})`
                    : `${won ? 'ðŸŽ‰' : 'ðŸ˜ž'} ${won ? 'Won' : 'Lost'} $${Math.abs(totalProfit).toFixed(2)}`;
                showMessage(message, won ? 'success' : 'error');
                
            } catch (error) {
                console.error('Plinko error:', error);
                showMessage('Error dropping ball', 'error');
            } finally {
                dropBtn.disabled = false;
                dropBtn.textContent = 'ðŸŽ¯ Drop Ball';
            }
        }

        async function animatePlinkoBall(path, bucket) {
            return new Promise(resolve => {
                const ballRadius = 5;
                const spacing = 25;
                let currentRow = 0;
                let xPosition = 0; // Track cumulative horizontal position from center
                
                function draw() {
                    drawPlinkoBoard();
                    
                    if (currentRow <= path.length) {
                        if (currentRow < path.length) {
                            const row = currentRow;
                            const direction = path[row];
                            
                            // Update position based on direction
                            if (direction === 'R') {
                                xPosition += 1;
                            } else if (direction === 'L') {
                                xPosition -= 1;
                            }
                        }
                        
                        // Calculate actual x position on canvas
                        const xPos = (plinkoCanvas.width / 2) + (xPosition * spacing / 2);
                        const yPos = 40 + (currentRow * spacing);
                        
                        // Draw ball with glow effect
                        plinkoCtx.fillStyle = '#f59e0b';
                        plinkoCtx.shadowColor = '#f59e0b';
                        plinkoCtx.shadowBlur = 12;
                        plinkoCtx.beginPath();
                        plinkoCtx.arc(xPos, yPos, ballRadius, 0, Math.PI * 2);
                        plinkoCtx.fill();
                        plinkoCtx.shadowBlur = 0;
                        
                        currentRow++;
                        setTimeout(draw, 70);
                    } else {
                        // Calculate bucket position from backend bucket index
                        // 17 buckets spread across canvas width
                        const canvasWidth = plinkoCanvas.width;
                        const bucketSpacing = canvasWidth / 17;
                        const finalX = bucketSpacing * (bucket + 0.5); // Center of bucket
                        const finalY = plinkoCanvas.height - 15; // Very close to bottom
                        
                        // Redraw board
                        drawPlinkoBoard();
                        
                        // Draw final ball position with emphasis
                        plinkoCtx.fillStyle = '#10b981';
                        plinkoCtx.shadowColor = '#10b981';
                        plinkoCtx.shadowBlur = 30;
                        plinkoCtx.beginPath();
                        plinkoCtx.arc(finalX, finalY, ballRadius + 3, 0, Math.PI * 2);
                        plinkoCtx.fill();
                        plinkoCtx.shadowBlur = 0;
                        
                        // Wait to show final position clearly
                        setTimeout(() => {
                            resolve();
                        }, 300);
                    }
                }
                
                draw();
            });
        }

        function addPlinkoHistory(multiplier, won, profit) {
            const historyContainer = document.querySelector('.plinko-history-items');
            const item = document.createElement('div');
            item.className = `plinko-history-item ${won ? 'won' : 'lost'}`;
            item.textContent = `${multiplier}x ${won ? '+' : ''}$${profit.toFixed(2)}`;
            
            historyContainer.insertBefore(item, historyContainer.firstChild);
            
            // Keep only last 10
            while (historyContainer.children.length > 10) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }

        function bounceMultiplier(bucket) {
            const multipliers = document.querySelectorAll('.plinko-multiplier');
            if (multipliers[bucket]) {
                multipliers[bucket].classList.add('bounce');
                setTimeout(() => {
                    multipliers[bucket].classList.remove('bounce');
                }, 500);
            }
        }

        // Initialize plinko when DOM loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initPlinkoCanvas();
                updatePlinkoRisk('medium');
            }, 500);
        });

        // Re-initialize when plinko tab is clicked
        document.getElementById('plinkoTab')?.addEventListener('click', () => {
            setTimeout(() => {
                if (!plinkoCanvas) initPlinkoCanvas();
            }, 100);
        });

        // ========== END GAME FUNCTIONS ==========
    </script>

    <script>
        // Expose triggerConfetti to be used by other functions
        (function(){
            function rand(min,max){ return Math.random()*(max-min)+min; }
            function colors(){ return ['#ffd966','#fff2cc','#ffe08a','#ffd24d','#fff6e0']; }
            function burstConfetti(count){
                const wrap = document.getElementById('heroConfetti');
                if(!wrap) return;
                for(let i=0;i<count;i++){
                    const el = document.createElement('div');
                    el.className = 'confetti-piece';
                    const c = colors()[Math.floor(rand(0,colors().length))];
                    el.style.background = c;
                    el.style.left = rand(8,92) + '%';
                    el.style.top = rand(4,30) + '%';
                    const dur = Math.floor(rand(900,1800));
                    el.style.animation = `confetti-fall ${dur}ms cubic-bezier(.2,.8,.2,1) forwards`;
                    el.style.transform = `translateY(${rand(-20, -4)}px) rotate(${rand(0,360)}deg)`;
                    wrap.appendChild(el);
                    setTimeout((el)=>{ if(el && el.remove) el.remove(); }, dur+400, el);
                }
            }
            function triggerConfetti(){
                burstConfetti(18);
                const primaries = document.querySelectorAll('.btn-primary');
                primaries.forEach(btn=>btn.classList.add('pulse'));
                setTimeout(()=>primaries.forEach(btn=>btn.classList.remove('pulse')), 2500);
            }
            document.addEventListener('DOMContentLoaded', ()=>{
                setTimeout(()=>triggerConfetti(), 700);
                document.addEventListener('click', (ev)=>{
                    if(ev.target.closest && ev.target.closest('.btn-primary')){
                        triggerConfetti();
                    }
                });
            });
            window.triggerConfetti = triggerConfetti;
        })();
    </script>



    <!-- Betslip / Ticket -->
    <div id="betslipContainer" class="betslip-container hidden">
        <div class="betslip-header">
            <h3><i class="fas fa-ticket-alt"></i> Bet Slip</h3>
            <span class="betslip-count" id="betslipCount">0</span>
        </div>
        
        <div class="betslip-picks" id="betslipPicks">
            <div class="betslip-empty">
                <i class="fas fa-clipboard-list"></i>
                <p>Select odds to add to your bet slip</p>
            </div>
        </div>
        
        <div class="betslip-summary" id="betslipSummary" style="display: none;">
            <div class="betslip-total-odds">
                <span class="betslip-total-odds-label">Total Odds:</span>
                <span class="betslip-total-odds-value" id="betslipTotalOdds">1.00</span>
            </div>
            
            <input 
                type="number" 
                class="betslip-stake-input" 
                id="betslipStake" 
                placeholder="Enter stake (USD)" 
                step="1" 
                min="1"
                oninput="updateBetslipPayout()"
            />
            
            <div class="betslip-bonus" id="betslipBonus" style="display: none; justify-content: space-between; align-items: center; padding: 8px 12px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; margin: 8px 0;">
                <span style="color: #10b981; font-size: 13px; font-weight: 600;">
                    <i class="fas fa-gift"></i> Multi-Bet Bonus (<span id="betslipBonusPercent">0%</span>)
                </span>
                <span style="color: #10b981; font-weight: 700; font-size: 14px;" id="betslipBonusAmount">+$0.00</span>
            </div>
            
            <div class="betslip-payout">
                <span>Potential Payout:</span>
                <span class="betslip-payout-value" id="betslipPayout">$0.00</span>
            </div>
            
            <button class="betslip-place-btn" id="betslipPlaceBetBtn" onclick="virtualSelectedBets.length > 0 ? placeVirtualBetslip() : placeBetslipBet()">
                <i class="fas fa-check-circle"></i> Place Bet
            </button>
            
            <button class="betslip-clear-btn" onclick="clearBetslip(); virtualSelectedBets = []; updateVirtualBetslipUI();">
                <i class="fas fa-trash"></i> Clear All
            </button>
        </div>
    </div>

    <!-- Betslip Toggle Button (Mobile) -->
    <button class="betslip-toggle" onclick="toggleBetslip()" id="betslipToggle">
        <i class="fas fa-ticket-alt"></i>
        <span class="badge" id="betslipBadge" style="display: none;">0</span>
    </button>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" onclick="closeForgotPassword()" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px);">
        <div onclick="event.stopPropagation()" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); margin: 10% auto; padding: 40px; border: 1px solid #334155; border-radius: 16px; width: 90%; max-width: 500px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #60a5fa; margin: 0;"><i class="fas fa-key"></i> Forgot Password</h2>
                <button onclick="closeForgotPassword()" style="background: none; border: none; color: #64748b; cursor: pointer; font-size: 24px;">&times;</button>
            </div>
            <div id="forgotPasswordStep1">
                <p style="color: #cbd5e1; margin-bottom: 20px;">Enter your email address and we'll send you a link to reset your password.</p>
                <div class="form-group">
                    <label style="color: #e2e8f0;">Email Address</label>
                    <input type="email" id="forgotPasswordEmail" placeholder="Enter your email" required style="width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; font-size: 14px;">
                </div>
                <button onclick="requestPasswordReset()" class="btn-submit" style="width: 100%; margin-top: 15px;">
                    <i class="fas fa-paper-plane"></i> Send Reset Link
                </button>
            </div>
            <div id="forgotPasswordStep2" style="display: none; text-align: center;">
                <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 48px; margin-bottom: 15px;"></i>
                    <p style="color: #10b981; font-size: 18px; font-weight: 600; margin-bottom: 10px;">Email Sent!</p>
                    <p style="color: #cbd5e1; font-size: 14px;">Check your inbox for a password reset link. The link will expire in 1 hour.</p>
                </div>
                <button onclick="closeForgotPassword()" class="btn-submit" style="width: 100%;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: rgba(15, 23, 42, 0.95); border-top: 1px solid #334155; padding: 30px 20px; text-align: center; color: #94a3b8; font-size: 14px; margin-top: 40px; margin-left: 0;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <!-- Trust Badges Section - Only shows on main page -->
            <div id="securityBadges" style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #334155;">
                <h4 style="color: #cbd5e1; margin-bottom: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px;">
                    <i class="fas fa-shield-alt"></i> Trusted & Secure Platform
                </h4>
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <!-- SSL Certificate Badge -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 6px;">
                        <i class="fas fa-lock" style="font-size: 18px; color: #22c55e; margin-bottom: 4px;"></i>
                        <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">256-BIT SSL</span>
                        <span style="font-size: 8px; color: #94a3b8;">Secure Connection</span>
                    </div>
                    
                    <!-- PCI Compliance Badge -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px;">
                        <i class="fas fa-credit-card" style="font-size: 18px; color: #3b82f6; margin-bottom: 4px;"></i>
                        <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">PCI COMPLIANT</span>
                        <span style="font-size: 8px; color: #94a3b8;">Secure Payments</span>
                    </div>
                    
                    <!-- Data Protection Badge -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 6px;">
                        <i class="fas fa-user-shield" style="font-size: 18px; color: #a855f7; margin-bottom: 4px;"></i>
                        <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">DATA PROTECTED</span>
                        <span style="font-size: 8px; color: #94a3b8;">GDPR Compliant</span>
                    </div>
                    
                    <!-- Verified Badge -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 6px;">
                        <i class="fas fa-certificate" style="font-size: 18px; color: #fbbf24; margin-bottom: 4px;"></i>
                        <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">VERIFIED</span>
                        <span style="font-size: 8px; color: #94a3b8;">Licensed Platform</span>
                    </div>
                    
                    <!-- 24/7 Support Badge -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: rgba(236, 72, 153, 0.1); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 6px;">
                        <i class="fas fa-headset" style="font-size: 18px; color: #ec4899; margin-bottom: 4px;"></i>
                        <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">24/7 SUPPORT</span>
                        <span style="font-size: 8px; color: #94a3b8;">Always Available</span>
                    </div>
                </div>
                <p style="margin-top: 10px; font-size: 9px; color: #64748b; font-style: italic;">
                    <i class="fas fa-info-circle"></i> Partnership with leading security providers for enhanced protection.
                </p>
                
                <!-- Betting License -->
                <div style="margin-top: 15px; padding: 10px 16px; background: rgba(251, 191, 36, 0.08); border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 8px; display: inline-block;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-award" style="color: #fbbf24; font-size: 16px;"></i>
                        <div style="text-align: left;">
                            <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px;">Licensed & Regulated by Cyprus Gaming Authority</div>
                            <div style="font-size: 11px; color: #fbbf24; font-weight: 700; font-family: monospace;">License No: HE 888999 | B2C-1247-2024</div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #334155;">
                    <h4 style="color: #cbd5e1; margin-bottom: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px;">
                        <i class="fas fa-credit-card"></i> Accepted Payment Methods
                    </h4>
                    <div style="display: flex; justify-content: center; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <!-- Bitcoin -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(247, 147, 26, 0.1); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fab fa-bitcoin" style="font-size: 24px; color: #f7931a; margin-bottom: 4px;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">Bitcoin</span>
                        </div>
                        
                        <!-- USDT -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(38, 161, 123, 0.1); border: 1px solid rgba(38, 161, 123, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fas fa-dollar-sign" style="font-size: 24px; color: #26a17b; margin-bottom: 4px; font-weight: 700;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">USDT</span>
                        </div>
                        
                        <!-- PayPal -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(0, 112, 186, 0.1); border: 1px solid rgba(0, 112, 186, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fab fa-paypal" style="font-size: 24px; color: #0070ba; margin-bottom: 4px;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">PayPal</span>
                        </div>
                        
                        <!-- Skrill -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(122, 0, 170, 0.1); border: 1px solid rgba(122, 0, 170, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fas fa-wallet" style="font-size: 24px; color: #7a00aa; margin-bottom: 4px;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">Skrill</span>
                        </div>
                        
                        <!-- Bank Transfer -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fas fa-university" style="font-size: 24px; color: #3b82f6; margin-bottom: 4px;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">Bank Transfer</span>
                        </div>
                        
                        <!-- Mobile Money -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 14px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; min-width: 70px;">
                            <i class="fas fa-mobile-alt" style="font-size: 24px; color: #10b981; margin-bottom: 4px;"></i>
                            <span style="font-size: 9px; color: #cbd5e1; font-weight: 600;">Mobile Money</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Links Section -->
            <div style="margin-bottom: 15px;">
                <a href="/terms" target="_blank" style="color: #60a5fa; text-decoration: none; margin: 0 15px; transition: color 0.3s;">
                    <i class="fas fa-file-contract"></i> Terms & Conditions
                </a>
                <span style="color: #334155;">|</span>
                <a href="javascript:void(0)" onclick="switchTab('contact')" style="color: #60a5fa; text-decoration: none; margin: 0 15px; transition: color 0.3s; cursor: pointer;">
                    <i class="fas fa-envelope"></i> Contact Support
                </a>
            </div>
            
            <!-- Copyright -->
            <p style="margin: 0; color: #64748b;">Â© 2025 ABKBet. All rights reserved. Play responsibly. 18+ only.</p>
        </div>
    </footer>

    <script>
    // Make Load Code box and Ticket modal draggable on mobile
    (function() {
        function makeDraggable(element, dragHandle) {
            if (!element) return;
            
            // If no drag handle specified, use the element itself
            const handle = dragHandle || element;
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isDragging = false;
            
            // Prevent text selection during drag
            handle.style.userSelect = 'none';
            handle.style.webkitUserSelect = 'none';
            handle.style.cursor = 'grab';
            
            handle.addEventListener('mousedown', dragMouseDown);
            handle.addEventListener('touchstart', dragTouchStart, { passive: false });
            
            function dragMouseDown(e) {
                e.preventDefault();
                e.stopPropagation();
                isDragging = true;
                handle.style.cursor = 'grabbing';
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.addEventListener('mouseup', closeDragElement);
                document.addEventListener('mousemove', elementDrag);
            }
            
            function dragTouchStart(e) {
                e.preventDefault();
                e.stopPropagation();
                isDragging = true;
                handle.style.cursor = 'grabbing';
                const touch = e.touches[0];
                pos3 = touch.clientX;
                pos4 = touch.clientY;
                document.addEventListener('touchend', closeDragElement);
                document.addEventListener('touchmove', elementDragTouch, { passive: false });
            }
            
            function elementDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                e.stopPropagation();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // Set position
                element.style.position = 'fixed';
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                element.style.right = 'auto';
                element.style.bottom = 'auto';
            }
            
            function elementDragTouch(e) {
                if (!isDragging) return;
                e.preventDefault();
                e.stopPropagation();
                const touch = e.touches[0];
                pos1 = pos3 - touch.clientX;
                pos2 = pos4 - touch.clientY;
                pos3 = touch.clientX;
                pos4 = touch.clientY;
                
                // Set position
                element.style.position = 'fixed';
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                element.style.right = 'auto';
                element.style.bottom = 'auto';
            }
            
            function closeDragElement() {
                isDragging = false;
                handle.style.cursor = 'grab';
                document.removeEventListener('mouseup', closeDragElement);
                document.removeEventListener('mousemove', elementDrag);
                document.removeEventListener('touchend', closeDragElement);
                document.removeEventListener('touchmove', elementDragTouch);
            }
        }
        
        // Initialize draggable when elements exist
        setTimeout(function() {
            // Load Code box is now fixed in position (not draggable)
            const ticketModal = document.querySelector('.ticket-modal .ticket-content');
            const ticketHeader = document.querySelector('.ticket-modal .ticket-header');
            
            if (ticketModal && ticketHeader && window.innerWidth <= 1024) {
                makeDraggable(ticketModal, ticketHeader);
            }
        }, 1000);
        
        // Re-init on window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 1024) {
                // Load Code box is fixed (not draggable)
                const ticketModal = document.querySelector('.ticket-modal .ticket-content');
                const ticketHeader = document.querySelector('.ticket-modal .ticket-header');
                if (ticketModal && ticketHeader) makeDraggable(ticketModal, ticketHeader);
            }
        });
    })();
    
    // Promotional Carousel Auto-rotation
    (function() {
        let currentSlide = 0;
        const slides = document.querySelectorAll('.promo-slide');
        const indicators = document.querySelectorAll('.promo-indicator');
        const totalSlides = slides.length;
        
        function showSlide(index) {
            // Remove active class from all
            slides.forEach(slide => slide.classList.remove('active'));
            indicators.forEach(indicator => indicator.classList.remove('active'));
            
            // Add active class to current
            slides[index].classList.add('active');
            indicators[index].classList.add('active');
        }
        
        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }
        
        // Click indicators to change slide
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', function() {
                currentSlide = index;
                showSlide(currentSlide);
            });
        });
        
        // Auto-rotate every 4 seconds
        setInterval(nextSlide, 4000);
        
        // Initialize first slide
        showSlide(0);
    })();
    </script>

    <!-- Crash Game JavaScript -->
    <script>
    // Crash Game State
    let crashGameState = {
        status: 'waiting',
        multiplier: 1.00,
        hasBet: false,
        betAmount: 0,
        gameId: null,
        pollInterval: null,
        updateInterval: null
    };

    // Set crash bet amount
    function setCrashBet(amount) {
        document.getElementById('crashBetAmount').value = amount;
    }

    // Place crash bet
    async function placeCrashBet() {
        const amount = parseFloat(document.getElementById('crashBetAmount').value);
        
        if (!amount || amount <= 0) {
            showMessage('Enter a valid bet amount', 'error');
            return;
        }

        const token = localStorage.getItem('abkbet_token');
        if (!token) {
            showMessage('Please login to play', 'error');
            return;
        }

        try {
            const response = await fetch('/api/crash/bet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ amount: amount })
            });

            const data = await response.json();

            if (!response.ok || data.error) {
                showMessage(data.error || 'Failed to place bet', 'error');
                return;
            }

            // Update balance from backend
            updateBalanceUI(data.new_balance);
            
            crashGameState.hasBet = true;
            crashGameState.betAmount = amount;
            
            // Update UI
            document.getElementById('crashBetBtn').style.display = 'none';
            document.getElementById('crashBetAmount').disabled = true;
            
            showMessage(`Bet placed: $${amount.toFixed(2)}`, 'success');

        } catch (err) {
            showMessage(err.message || 'Failed to place bet', 'error');
        }
    }

    // Cash out from crash game
    async function crashCashOut() {
        const token = localStorage.getItem('abkbet_token');
        if (!token) {
            showMessage('Please login to play', 'error');
            return;
        }

        try {
            const response = await fetch('/api/crash/cashout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });

            const data = await response.json();

            if (!response.ok || data.error) {
                showMessage(data.error || 'Failed to cash out', 'error');
                return;
            }

            // Update balance from backend
            updateBalanceUI(data.new_balance);
            
            crashGameState.hasBet = false;
            
            // Update UI
            document.getElementById('crashCashoutBtn').style.display = 'none';
            document.getElementById('crashBetBtn').style.display = 'flex';
            document.getElementById('crashBetAmount').disabled = false;
            
            showMessage(`Cashed out at ${data.multiplier}x! Won $${data.winnings.toFixed(2)}`, 'success');

        } catch (err) {
            showMessage(err.message || 'Failed to cash out', 'error');
        }
    }

    // Update crash game display
    function updateCrashDisplay(data) {
        const multiplierEl = document.getElementById('crashMultiplier');
        const statusEl = document.getElementById('crashStatus');
        const timerEl = document.getElementById('crashTimer');
        const planeEl = document.getElementById('crashPlane');
        const containerEl = document.getElementById('crashMultiplierContainer');
        const cashoutBtn = document.getElementById('crashCashoutBtn');
        const betBtn = document.getElementById('crashBetBtn');
        const playersEl = document.getElementById('crashPlayers');

        // Update player count
        playersEl.textContent = data.player_count || 0;

        if (data.status === 'waiting') {
            multiplierEl.textContent = '1.00x';
            multiplierEl.className = 'crash-multiplier';
            statusEl.textContent = 'Waiting for next round...';
            timerEl.textContent = data.time_until_start > 0 ? `Starting in ${data.time_until_start}s` : '';
            planeEl.className = 'crash-plane';
            containerEl.style.background = 'transparent';
            
            // Always hide cashout in waiting phase
            cashoutBtn.style.display = 'none';
            
            // Show bet button only if no active bet
            if (!crashGameState.hasBet) {
                betBtn.style.display = 'flex';
                betBtn.disabled = false;
                document.getElementById('crashBetAmount').disabled = false;
            } else {
                // User placed bet in waiting phase - hide bet button
                betBtn.style.display = 'none';
            }

        } else if (data.status === 'flying') {
            multiplierEl.textContent = `${data.multiplier.toFixed(2)}x`;
            multiplierEl.className = 'crash-multiplier flying';
            statusEl.textContent = 'Flying...';
            timerEl.textContent = '';
            planeEl.className = 'crash-plane flying';
            containerEl.style.background = `linear-gradient(135deg, rgba(59, 130, 246, ${Math.min(data.multiplier / 10, 0.3)}) 0%, rgba(139, 92, 246, ${Math.min(data.multiplier / 10, 0.3)}) 100%)`;
            
            // Show cash out button if user has bet
            if (crashGameState.hasBet) {
                betBtn.style.display = 'none';
                cashoutBtn.style.display = 'flex';
            }

        } else if (data.status === 'crashed') {
            multiplierEl.textContent = `${data.crash_point.toFixed(2)}x`;
            multiplierEl.className = 'crash-multiplier crashed';
            statusEl.textContent = 'Crashed!';
            timerEl.textContent = '';
            planeEl.className = 'crash-plane crashed';
            containerEl.style.background = 'rgba(239, 68, 68, 0.2)';
            
            // Reset bet state immediately when crashed
            crashGameState.hasBet = false;
            crashGameState.betAmount = 0;
            betBtn.style.display = 'flex';
            betBtn.disabled = false;
            cashoutBtn.style.display = 'none';
            document.getElementById('crashBetAmount').disabled = false;
        }
    }

    // Update crash history
    function updateCrashHistory(history) {
        const historyEl = document.getElementById('crashHistory');
        
        if (!history || history.length === 0) {
            historyEl.innerHTML = '<div style="color: #94a3b8; text-align: center; padding: 20px;">No history yet</div>';
            return;
        }

        historyEl.innerHTML = history.map(game => {
            const crash = game.crash_point;
            let className = 'crash-history-item ';
            
            if (crash < 2.0) className += 'low';
            else if (crash < 5.0) className += 'medium';
            else if (crash < 10.0) className += 'high';
            else className += 'mega';
            
            return `<div class="${className}">${crash.toFixed(2)}x</div>`;
        }).join('');
    }

    // Poll crash game status
    async function pollCrashStatus() {
        try {
            const response = await client.request('/crash/status');
            
            if (response) {
                crashGameState.status = response.status;
                crashGameState.multiplier = response.multiplier;
                crashGameState.gameId = response.game_id;
                
                updateCrashDisplay(response);
                updateCrashHistory(response.history);
            }
        } catch (err) {
            console.error('Error polling crash status:', err);
        }
    }

    // Initialize crash game
    function initCrashGame() {
        // Start polling
        crashGameState.pollInterval = setInterval(pollCrashStatus, 100); // Update every 100ms for smooth multiplier
        
        // Initial load
        pollCrashStatus();
    }

    // Stop crash game polling
    function stopCrashGame() {
        if (crashGameState.pollInterval) {
            clearInterval(crashGameState.pollInterval);
            crashGameState.pollInterval = null;
        }
    }

    // Add crash tab initialization to switchTab function
    const originalSwitchTab = window.switchTab;
    window.switchTab = function(tab) {
        // Call original function
        if (originalSwitchTab) {
            originalSwitchTab(tab);
        }
        
        // Start/stop crash game based on tab
        if (tab === 'crash') {
            initCrashGame();
        } else {
            stopCrashGame();
        }
    };
    </script>
