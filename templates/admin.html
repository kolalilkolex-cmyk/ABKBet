<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Admin Panel - ABKBet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .admin-sidebar {
            width: 260px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-right: 2px solid #334155;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #334155;
        }

        .sidebar-logo {
            color: #3b82f6;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-logo i { font-size: 28px; }

        .sidebar-nav { padding: 20px 0; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .nav-item.active {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border-left-color: #3b82f6;
        }

        .nav-item i {
            font-size: 18px;
            width: 24px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #334155;
            margin-top: auto;
        }

        .admin-logout {
            width: 100%;
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .admin-logout:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        /* ===== MAIN CONTENT ===== */
        .admin-main {
            margin-left: 260px;
            flex: 1;
            min-height: 100vh;
        }

        .admin-header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 2px solid #3b82f6;
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .admin-header h1 {
            color: #3b82f6;
            font-size: 26px;
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #94a3b8;
        }

        .admin-user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .admin-container {
            padding: 32px;
            max-width: 1600px;
        }

        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .stat-icon.blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .stat-icon.green { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .stat-icon.orange { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .stat-icon.red { background: rgba(220, 38, 38, 0.2); color: #dc2626; }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-label {
            font-size: 14px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* ===== SECTIONS ===== */
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i { color: #3b82f6; }

        /* ===== TABLES ===== */
        .data-table {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #0f172a;
            color: #3b82f6;
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 14px 16px;
            border-top: 1px solid #334155;
            font-size: 14px;
            color: #cbd5e1;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.08);
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-approve {
            background: #10b981;
            color: white;
        }

        .btn-approve:hover {
            background: #059669;
        }

        .btn-reject, .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-reject:hover, .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-edit {
            background: #8b5cf6;
            color: white;
        }

        .btn-edit:hover {
            background: #7c3aed;
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        /* ===== BADGES ===== */
        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-completed {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-failed {
            background: rgba(220, 38, 38, 0.2);
            color: #dc2626;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }

        .badge-scheduled {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .badge-live {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
            animation: pulse 2s infinite;
        }

        .badge-finished {
            background: rgba(100, 116, 139, 0.2);
            color: #64748b;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 28px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #94a3b8;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .form-control, .form-select {
            width: 100%;
            background: #0f172a;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }

        /* ===== MESSAGES ===== */
        .message {
            padding: 14px 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .message.active {
            display: flex;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .message.error {
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid #dc2626;
            color: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* ===== PAYMENT DETAILS DROPDOWN ===== */
        .payment-details-container {
            width: 100%;
        }
        
        .payment-details-short {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            background: #1f2937;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .payment-details-short:hover {
            background: #374151;
        }
        
        .payment-details-short i {
            margin-left: 8px;
            font-size: 12px;
            color: #9ca3af;
        }
        
        .payment-details-full {
            margin-top: 8px;
            padding: 12px;
            background: #111827;
            border-radius: 4px;
            border: 1px solid #374151;
        }
        
        .full-address {
            font-size: 13px;
            word-break: break-all;
        }
        
        .btn-copy {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .btn-copy:hover {
            background: #2563eb;
        }
        
        .btn-copy i {
            margin-right: 4px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .admin-sidebar.open {
                transform: translateX(0);
            }

            .admin-main {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="admin-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-shield-alt"></i>
                <span>ABKBet Admin</span>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item active" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showSection('matches')">
                <i class="fas fa-futbol"></i>
                <span>Manual Matches</span>
            </div>
            <div class="nav-item" onclick="window.location.href='/premium_admin'">
                <i class="fas fa-crown"></i>
                <span>Premium Bookings</span>
            </div>
            <div class="nav-item" onclick="showSection('virtual')">
                <i class="fas fa-gamepad"></i>
                <span>Virtual Games</span>
            </div>
            <div class="nav-item" onclick="showSection('deposits')">
                <i class="fas fa-arrow-down"></i>
                <span>Deposits</span>
            </div>
            <div class="nav-item" onclick="showSection('withdrawals')">
                <i class="fas fa-arrow-up"></i>
                <span>Withdrawals</span>
            </div>
            <div class="nav-item" onclick="showSection('users')">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </div>
            <div class="nav-item" onclick="showSection('bets')">
                <i class="fas fa-ticket-alt"></i>
                <span>All Bets</span>
            </div>
            <div class="nav-item" onclick="showSection('transactions')">
                <i class="fas fa-list"></i>
                <span>Transactions</span>
            </div>
            <div class="nav-item" onclick="showSection('payment-methods')">
                <i class="fas fa-credit-card"></i>
                <span>Payment Methods</span>
            </div>
        </div>
        
        <div class="sidebar-footer">
            <button class="admin-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="admin-main">
        <div class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="admin-user-info">
                <div class="admin-user-avatar">A</div>
                <span id="adminUsername">Admin</span>
            </div>
        </div>

        <div class="admin-container">
            <div id="message" class="message"></div>

            <!-- DASHBOARD SECTION -->
            <div id="dashboard-section" class="admin-section active">
                <!-- Financial Summary Section -->
                <div class="section-header" style="margin-bottom: 10px;">
                    <h2 class="section-title">
                        <i class="fas fa-dollar-sign"></i>
                        Business Financials
                    </h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-arrow-circle-down"></i>
                        </div>
                        <div class="stat-value" id="totalDeposits">$0.00</div>
                        <div class="stat-label">Total Deposits Received</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-arrow-circle-up"></i>
                        </div>
                        <div class="stat-value" id="totalWithdrawals">$0.00</div>
                        <div class="stat-label">Total Withdrawals Paid</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="stat-value" id="outstandingBets">$0.00</div>
                        <div class="stat-label">Outstanding Bets</div>
                    </div>
                    <div class="stat-card" style="border: 2px solid #10b981;">
                        <div class="stat-icon purple">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="netRevenue" style="color: #10b981;">$0.00</div>
                        <div class="stat-label">Net Platform Revenue</div>
                    </div>
                </div>

                <!-- Betting Statistics Section -->
                <div class="section-header" style="margin-top: 30px; margin-bottom: 10px;">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Betting Statistics
                    </h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-value" id="activeBets">0</div>
                        <div class="stat-label">Active Bets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-value" id="bettingVolume">$0.00</div>
                        <div class="stat-label">Betting Volume Wagered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-value" id="totalPayouts">$0.00</div>
                        <div class="stat-label">Payouts to Winners</div>
                    </div>
                </div>

                <!-- Pending Actions Section -->
                <div class="section-header" style="margin-top: 30px; margin-bottom: 10px;">
                    <h2 class="section-title">
                        <i class="fas fa-tasks"></i>
                        Pending Actions
                    </h2>
                </div>
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <div class="stat-value" id="pendingDeposits">0</div>
                        <div class="stat-label">Pending Deposits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                        <div class="stat-value" id="pendingWithdrawals">0</div>
                        <div class="stat-label">Pending Withdrawals</div>
                    </div>
                </div>

                <!-- Live Matches Management Section -->
                <div class="section-header" style="margin-top: 30px; margin-bottom: 10px;">
                    <h2 class="section-title">
                        <i class="fas fa-broadcast-tower"></i>
                        Live Matches Management
                    </h2>
                </div>
                <div style="background: linear-gradient(135deg, #7c2d12 0%, #991b1b 100%); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h3 style="color: #fbbf24; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-sync-alt" style="animation: pulse 2s infinite;"></i>
                                Update Live Match Scores
                            </h3>
                            <p style="color: #fed7aa; font-size: 14px; margin: 0;">
                                Sync live match scores, times, and status from API. Updates all matches currently marked as "live" in the database.
                            </p>
                        </div>
                        <button class="btn btn-primary" onclick="updateLiveMatches()" style="background: #f59e0b; border-color: #f59e0b; font-size: 16px; padding: 12px 24px;">
                            <i class="fas fa-sync"></i>
                            Update Live Matches
                        </button>
                    </div>
                </div>

                <!-- Database Population Tools -->
                <div class="stat-card" style="margin-top: 20px; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); border: 1px solid #8b5cf6;">
                    <div class="stat-icon" style="background: rgba(139, 92, 246, 0.2);">
                        <i class="fas fa-database" style="color: #a78bfa;"></i>
                    </div>
                    <div>
                        <h3 style="color: #e9d5ff; margin-bottom: 10px;">Database Management</h3>
                        <p style="color: #c4b5fd; font-size: 14px; margin-bottom: 15px;">
                            Populate database with sample matches or check existing matches
                        </p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="populateMatches()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-plus-circle"></i> Populate Sample Matches
                            </button>
                            <button onclick="checkDatabaseMatches()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-search"></i> View Database Matches
                            </button>
                        </div>
                        <div id="populateStatus" style="margin-top: 12px; padding: 10px; border-radius: 6px; display: none; background: rgba(0,0,0,0.3);"></div>
                        <div id="dbMatchesStatus" style="margin-top: 12px; padding: 10px; border-radius: 6px; display: none; max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3);"></div>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 30px;">
                    <h2 class="section-title">
                        <i class="fas fa-clock"></i>
                        Recent Activity
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Type</th>
                                <th>User</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivityTable">
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <i class="fas fa-history"></i>
                                    <h3>No recent activity</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- MATCHES SECTION -->
            <div id="matches-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-futbol"></i>
                        Manual Matches Management
                    </h2>
                    <button class="btn btn-primary" onclick="openCreateMatchModal()">
                        <i class="fas fa-plus"></i>
                        Create New Match
                    </button>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Match</th>
                                <th>League</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Score</th>
                                <th>Odds (H/D/A)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="matchesTable">
                            <tr>
                                <td colspan="8" class="empty-state">
                                    <i class="fas fa-futbol"></i>
                                    <h3>No matches yet</h3>
                                    <p>Create your first manual match</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIRTUAL GAMES SECTION -->
            <div id="virtual-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-gamepad"></i>
                        Virtual Games Management
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="btn btn-danger" onclick="resetAllLeaguesToMD1()" title="Reset all leagues to Matchday 1 - Clear finished games history" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                            <i class="fas fa-redo"></i>
                            Reset to MD1
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteAllLeagues()" title="Delete ALL leagues, teams, and games - complete reset">
                            <i class="fas fa-bomb"></i>
                            Delete Everything
                        </button>
                        <button type="button" class="btn btn-warning" onclick="clearAllVirtualGames()" title="Clear all games but keep leagues and teams">
                            <i class="fas fa-trash-alt"></i>
                            Clear All Games
                        </button>
                        <button type="button" class="btn btn-primary" onclick="runQuickSetup()">
                            <i class="fas fa-magic"></i>
                            Quick Setup (3 Leagues)
                        </button>
                    </div>
                </div>

                <!-- Virtual Games Stats -->
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-value" id="virtualLeaguesCount">0</div>
                        <div class="stat-label">Total Leagues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="virtualTeamsCount">0</div>
                        <div class="stat-label">Total Teams</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-futbol"></i>
                        </div>
                        <div class="stat-value" id="virtualGamesCount">0</div>
                        <div class="stat-label">Total Games</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="stat-value" id="virtualActiveGamesCount">0</div>
                        <div class="stat-label">Active Games</div>
                    </div>
                </div>

                <!-- Leagues Table -->
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;"><i class="fas fa-trophy"></i> Leagues & Race Management</h3>
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>League Name</th>
                                    <th>Teams</th>
                                    <th>Season/Matchday</th>
                                    <th>Games (S/L/F)</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="virtualLeaguesTable">
                                <tr>
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <h3>Loading leagues...</h3>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Games Table -->
                <div>
                    <h3 style="margin-bottom: 15px;"><i class="fas fa-futbol"></i> Virtual Games</h3>
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Match</th>
                                    <th>League</th>
                                    <th>Scheduled</th>
                                    <th>Status</th>
                                    <th>Score</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="virtualGamesTable">
                                <tr>
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <h3>Loading games...</h3>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- DEPOSITS SECTION -->
            <div id="deposits-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-arrow-down"></i>
                        Pending Deposits
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Amount (BTC)</th>
                                <th>Method</th>
                                <th>Reference</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="depositsTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <h3>No pending deposits</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- WITHDRAWALS SECTION -->
            <div id="withdrawals-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-arrow-up"></i>
                        Pending Withdrawals
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Amount (BTC)</th>
                                <th>Method</th>
                                <th>Address</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <h3>No pending withdrawals</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- USERS SECTION -->
            <div id="users-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i>
                        All Users
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Is Admin</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="8" class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h3>Loading users...</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- BETS SECTION -->
            <div id="bets-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-ticket-alt"></i>
                        All Bets
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Match/Event</th>
                                <th>Selection</th>
                                <th>Amount</th>
                                <th>Odds</th>
                                <th>Potential Payout</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="betsTable">
                            <tr>
                                <td colspan="10" class="empty-state">
                                    <i class="fas fa-ticket-alt"></i>
                                    <h3>Loading bets...</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TRANSACTIONS SECTION -->
            <div id="transactions-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-list"></i>
                        All Transactions
                    </h2>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Reference</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-list"></i>
                                    <h3>Loading transactions...</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PAYMENT METHODS SECTION -->
            <div id="payment-methods-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-credit-card"></i>
                        Platform Payment Methods
                    </h2>
                    <button class="btn btn-primary" onclick="openPaymentMethodModal()">
                        <i class="fas fa-plus"></i> Add Payment Method
                    </button>
                </div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Method Type</th>
                                <th>Method Name</th>
                                <th>Details</th>
                                <th>Status</th>
                                <th>Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentMethodsTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-credit-card"></i>
                                    <h3>Loading payment methods...</h3>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MATCH MODAL -->
    <div id="matchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-futbol"></i>
                <span id="matchModalTitle">Create New Match</span>
            </div>
            <form id="matchForm">
                <input type="hidden" id="matchId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Home Team *</label>
                        <input type="text" class="form-control" id="homeTeam" required>
                    </div>
                    <div class="form-group">
                        <label>Away Team *</label>
                        <input type="text" class="form-control" id="awayTeam" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>League *</label>
                    <input type="text" class="form-control" id="league" required placeholder="e.g., Premier League">
                </div>

                <div class="form-group">
                    <label>Match Date & Time *</label>
                    <input type="datetime-local" class="form-control" id="matchDate" required>
                </div>

                <!-- 1X2 Match Result (Required) -->
                <h3 style="color: #3b82f6; margin: 20px 0 10px 0; font-size: 16px;">Match Result (1X2) - Required</h3>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Home Odds *</label>
                        <input type="number" step="0.01" class="form-control" id="homeOdds" required placeholder="1.50">
                    </div>
                    <div class="form-group">
                        <label>Draw Odds *</label>
                        <input type="number" step="0.01" class="form-control" id="drawOdds" required placeholder="3.50">
                    </div>
                    <div class="form-group">
                        <label>Away Odds *</label>
                        <input type="number" step="0.01" class="form-control" id="awayOdds" required placeholder="2.80">
                    </div>
                </div>

                <!-- Double Chance (Optional) -->
                <h3 style="color: #10b981; margin: 20px 0 10px 0; font-size: 16px;">Double Chance (Optional)</h3>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>1X (Home or Draw)</label>
                        <input type="number" step="0.01" class="form-control" id="homeDrawOdds" placeholder="1.25">
                    </div>
                    <div class="form-group">
                        <label>12 (Home or Away)</label>
                        <input type="number" step="0.01" class="form-control" id="homeAwayOdds" placeholder="1.30">
                    </div>
                    <div class="form-group">
                        <label>X2 (Draw or Away)</label>
                        <input type="number" step="0.01" class="form-control" id="drawAwayOdds" placeholder="1.60">
                    </div>
                </div>

                <!-- Both Teams to Score (Optional) -->
                <h3 style="color: #f59e0b; margin: 20px 0 10px 0; font-size: 16px;">Both Teams to Score (Optional)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>GG (Both Score)</label>
                        <input type="number" step="0.01" class="form-control" id="ggOdds" placeholder="1.85">
                    </div>
                    <div class="form-group">
                        <label>NG (Not Both)</label>
                        <input type="number" step="0.01" class="form-control" id="ngOdds" placeholder="1.90">
                    </div>
                </div>

                <!-- Over/Under Goals (Optional) -->
                <h3 style="color: #6366f1; margin: 20px 0 10px 0; font-size: 16px;">Over/Under Goals (Optional)</h3>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Over 1.5</label>
                        <input type="number" step="0.01" class="form-control" id="over15Odds" placeholder="1.25">
                    </div>
                    <div class="form-group">
                        <label>Under 1.5</label>
                        <input type="number" step="0.01" class="form-control" id="under15Odds" placeholder="3.50">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Over 2.5</label>
                        <input type="number" step="0.01" class="form-control" id="over25Odds" placeholder="1.80">
                    </div>
                    <div class="form-group">
                        <label>Under 2.5</label>
                        <input type="number" step="0.01" class="form-control" id="under25Odds" placeholder="2.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Over 3.5</label>
                        <input type="number" step="0.01" class="form-control" id="over35Odds" placeholder="3.00">
                    </div>
                    <div class="form-group">
                        <label>Under 3.5</label>
                        <input type="number" step="0.01" class="form-control" id="under35Odds" placeholder="1.35">
                    </div>
                </div>

                <!-- Half Time/Full Time (Optional) -->
                <h3 style="color: #ec4899; margin: 20px 0 10px 0; font-size: 16px;">Half Time/Full Time (Optional)</h3>
                <p style="color: #94a3b8; font-size: 13px; margin-bottom: 10px;">Format: HT/FT (e.g., H/H = Home/Home)</p>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>H/H</label>
                        <input type="number" step="0.01" class="form-control" id="htftHH" placeholder="3.50">
                    </div>
                    <div class="form-group">
                        <label>H/D</label>
                        <input type="number" step="0.01" class="form-control" id="htftHD" placeholder="6.00">
                    </div>
                    <div class="form-group">
                        <label>H/A</label>
                        <input type="number" step="0.01" class="form-control" id="htftHA" placeholder="15.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>D/H</label>
                        <input type="number" step="0.01" class="form-control" id="htftDH" placeholder="4.50">
                    </div>
                    <div class="form-group">
                        <label>D/D</label>
                        <input type="number" step="0.01" class="form-control" id="htftDD" placeholder="8.00">
                    </div>
                    <div class="form-group">
                        <label>D/A</label>
                        <input type="number" step="0.01" class="form-control" id="htftDA" placeholder="10.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>A/H</label>
                        <input type="number" step="0.01" class="form-control" id="htftAH" placeholder="20.00">
                    </div>
                    <div class="form-group">
                        <label>A/D</label>
                        <input type="number" step="0.01" class="form-control" id="htftAD" placeholder="12.00">
                    </div>
                    <div class="form-group">
                        <label>A/A</label>
                        <input type="number" step="0.01" class="form-control" id="htftAA" placeholder="5.00">
                    </div>
                </div>

                <!-- Correct Score (Optional) -->
                <h3 style="color: #06b6d4; margin: 20px 0 10px 0; font-size: 16px;">Correct Score (Optional)</h3>
                <p style="color: #94a3b8; font-size: 13px; margin-bottom: 10px;">Popular scorelines</p>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>1-0</label>
                        <input type="number" step="0.01" class="form-control" id="cs10" placeholder="8.00">
                    </div>
                    <div class="form-group">
                        <label>2-0</label>
                        <input type="number" step="0.01" class="form-control" id="cs20" placeholder="12.00">
                    </div>
                    <div class="form-group">
                        <label>2-1</label>
                        <input type="number" step="0.01" class="form-control" id="cs21" placeholder="10.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>3-0</label>
                        <input type="number" step="0.01" class="form-control" id="cs30" placeholder="18.00">
                    </div>
                    <div class="form-group">
                        <label>3-1</label>
                        <input type="number" step="0.01" class="form-control" id="cs31" placeholder="15.00">
                    </div>
                    <div class="form-group">
                        <label>3-2</label>
                        <input type="number" step="0.01" class="form-control" id="cs32" placeholder="25.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>0-0</label>
                        <input type="number" step="0.01" class="form-control" id="cs00" placeholder="9.00">
                    </div>
                    <div class="form-group">
                        <label>1-1</label>
                        <input type="number" step="0.01" class="form-control" id="cs11" placeholder="7.00">
                    </div>
                    <div class="form-group">
                        <label>2-2</label>
                        <input type="number" step="0.01" class="form-control" id="cs22" placeholder="14.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>0-1</label>
                        <input type="number" step="0.01" class="form-control" id="cs01" placeholder="9.00">
                    </div>
                    <div class="form-group">
                        <label>0-2</label>
                        <input type="number" step="0.01" class="form-control" id="cs02" placeholder="13.00">
                    </div>
                    <div class="form-group">
                        <label>1-2</label>
                        <input type="number" step="0.01" class="form-control" id="cs12" placeholder="11.00">
                    </div>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>0-3</label>
                        <input type="number" step="0.01" class="form-control" id="cs03" placeholder="20.00">
                    </div>
                    <div class="form-group">
                        <label>1-3</label>
                        <input type="number" step="0.01" class="form-control" id="cs13" placeholder="16.00">
                    </div>
                    <div class="form-group">
                        <label>2-3</label>
                        <input type="number" step="0.01" class="form-control" id="cs23" placeholder="28.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Score</label>
                    <input type="number" step="0.01" class="form-control" id="csOther" placeholder="35.00">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeMatchModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Match
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- RESULT MODAL -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-flag-checkered"></i>
                <span id="resultModalTitle">Update Match Result</span>
            </div>
            <form id="resultForm">
                <input type="hidden" id="resultMatchId">
                <input type="hidden" id="resultType"><!-- 'halftime' or 'fulltime' -->
                
                <div id="halftimeSection" style="display:none;">
                    <h4 style="margin-bottom: 15px; color: #60a5fa;"><i class="fas fa-clock"></i> Half-Time Score</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>HT Home Score *</label>
                            <input type="number" class="form-control" id="htHomeScore" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>HT Away Score *</label>
                            <input type="number" class="form-control" id="htAwayScore" min="0" value="0">
                        </div>
                    </div>
                </div>

                <div id="fulltimeSection">
                    <h4 style="margin-bottom: 15px; color: #60a5fa;"><i class="fas fa-flag-checkered"></i> Full-Time Score</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Home Score *</label>
                            <input type="number" class="form-control" id="homeScore" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Away Score *</label>
                            <input type="number" class="form-control" id="awayScore" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Match Status *</label>
                        <select class="form-select" id="matchStatus" required>
                            <option value="scheduled">Scheduled</option>
                            <option value="live">Live</option>
                            <option value="finished">Finished</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeResultModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        <span id="resultSubmitText">Update Result</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- WITHDRAWAL MODAL -->
    <div id="withdrawalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-money-bill-wave"></i>
                <span>Process Withdrawal</span>
            </div>
            <form id="withdrawalForm">
                <input type="hidden" id="withdrawalId">
                
                <div class="form-group">
                    <label>Transaction Reference *</label>
                    <input type="text" class="form-control" id="withdrawalTxRef" required placeholder="Enter blockchain transaction ID">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeWithdrawalModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        Confirm Processing
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- PAYMENT INFO MODAL -->
    <div id="paymentInfoModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <i class="fas fa-wallet"></i>
                <span id="paymentInfoModalTitle">User Payment Information</span>
            </div>
            <form id="paymentInfoForm">
                <input type="hidden" id="paymentUserId">
                
                <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                    <i class="fas fa-user"></i> Account Details
                </h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" id="paymentUsername" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" class="form-control" id="paymentEmail" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Current Balance</label>
                        <input type="text" class="form-control" id="paymentBalance" readonly>
                    </div>
                </div>

                <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                    <i class="fas fa-bitcoin"></i> Crypto Wallets
                </h4>
                <div class="form-group">
                    <label>Bitcoin Withdrawal Wallet</label>
                    <input type="text" class="form-control" id="withdrawalWallet" placeholder="Enter BTC wallet address">
                </div>
                <div class="form-group">
                    <label>USDT Wallet (TRC20/ERC20)</label>
                    <input type="text" class="form-control" id="usdtWallet" placeholder="Enter USDT wallet address">
                </div>

                <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                    <i class="fas fa-university"></i> Bank Details
                </h4>
                <div class="form-group">
                    <label>Account Holder Name</label>
                    <input type="text" class="form-control" id="bankAccountName" placeholder="Full name on bank account">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <input type="text" class="form-control" id="bankName" placeholder="Bank name">
                    </div>
                    <div class="form-group">
                        <label>Account Number</label>
                        <input type="text" class="form-control" id="bankAccountNumber" placeholder="Account number">
                    </div>
                </div>

                <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                    <i class="fas fa-credit-card"></i> Other Payment Methods
                </h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>PayPal Email</label>
                        <input type="email" class="form-control" id="paypalEmail" placeholder="PayPal email address">
                    </div>
                    <div class="form-group">
                        <label>Skrill Email</label>
                        <input type="email" class="form-control" id="skrillEmail" placeholder="Skrill email address">
                    </div>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea class="form-control" id="paymentNotes" rows="3" placeholder="Any additional payment information or notes"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closePaymentInfoModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- PLATFORM PAYMENT METHOD MODAL -->
    <div id="paymentMethodModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <i class="fas fa-credit-card"></i>
                <span id="paymentMethodModalTitle">Add Payment Method</span>
            </div>
            <form id="paymentMethodForm">
                <input type="hidden" id="paymentMethodId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Method Type *</label>
                        <select class="form-select" id="methodType" required onchange="updateMethodFields()">
                            <option value="">Select type...</option>
                            <option value="usdt">USDT (Tether)</option>
                            <option value="bitcoin">Bitcoin/Crypto</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="mobile_money">Mobile Money</option>
                            <option value="paypal">PayPal</option>
                            <option value="skrill">Skrill</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Method Name *</label>
                        <input type="text" class="form-control" id="methodName" required placeholder="e.g., Bitcoin (BTC)">
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isActive" checked> 
                        <span>Active (visible to users)</span>
                    </label>
                </div>

                <!-- USDT Fields -->
                <div id="usdtFields" style="display:none;">
                    <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                        <i class="fas fa-coins"></i> USDT Wallet
                    </h4>
                    <div class="form-group">
                        <label>USDT Wallet Address *</label>
                        <input type="text" class="form-control" id="usdtWalletAddress" placeholder="Enter USDT wallet address">
                    </div>
                    <div class="form-group">
                        <label>Network Type *</label>
                        <select class="form-select" id="usdtNetwork">
                            <option value="">Select network...</option>
                            <option value="TRC20">TRC20 (Tron - Low Fees)</option>
                            <option value="ERC20">ERC20 (Ethereum)</option>
                            <option value="BEP20">BEP20 (Binance Smart Chain)</option>
                            <option value="Polygon">Polygon (MATIC)</option>
                            <option value="Solana">Solana</option>
                        </select>
                    </div>
                </div>

                <!-- Crypto Fields -->
                <div id="cryptoFields" style="display:none;">
                    <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                        <i class="fas fa-bitcoin"></i> Crypto Wallet
                    </h4>
                    <div class="form-group">
                        <label>Wallet Address</label>
                        <input type="text" class="form-control" id="walletAddress" placeholder="Enter wallet address">
                    </div>
                </div>

                <!-- Bank Fields -->
                <div id="bankFields" style="display:none;">
                    <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                        <i class="fas fa-university"></i> Bank Details
                    </h4>
                    <div class="form-group">
                        <label>Account Name</label>
                        <input type="text" class="form-control" id="methodAccountName" placeholder="Account holder name">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Bank Name</label>
                            <input type="text" class="form-control" id="methodBankName" placeholder="Bank name">
                        </div>
                        <div class="form-group">
                            <label>Account Number</label>
                            <input type="text" class="form-control" id="methodAccountNumber" placeholder="Account number">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>SWIFT/BIC Code (Optional)</label>
                        <input type="text" class="form-control" id="methodSwiftCode" placeholder="For international transfers">
                    </div>
                </div>

                <!-- Email Fields (PayPal, Skrill, etc.) -->
                <div id="emailFields" style="display:none;">
                    <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                        <i class="fas fa-envelope"></i> Email Details
                    </h4>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" class="form-control" id="methodEmail" placeholder="Payment email">
                    </div>
                </div>

                <!-- Mobile Money Fields -->
                <div id="mobileFields" style="display:none;">
                    <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                        <i class="fas fa-mobile-alt"></i> Mobile Money
                    </h4>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" class="form-control" id="methodPhone" placeholder="+1234567890">
                    </div>
                </div>

                <!-- Common Fields -->
                <h4 style="margin: 20px 0 15px 0; color: #60a5fa;">
                    <i class="fas fa-info-circle"></i> Additional Information
                </h4>
                <div class="form-group">
                    <label>QR Code (Optional)</label>
                    <input type="text" class="form-control" id="methodQRCode" placeholder="QR code data or image URL">
                    <small style="color: #94a3b8;">Leave empty or paste QR code data/URL</small>
                </div>
                <div class="form-group">
                    <label>Instructions for Users</label>
                    <textarea class="form-control" id="methodInstructions" rows="3" placeholder="Special instructions users should follow when using this payment method"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closePaymentMethodModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Payment Method
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/abkbet-client.js"></script>
    <script>
        // Check authentication on page load
        (function checkAuth() {
            const token = localStorage.getItem('abkbet_token');
            const userStr = localStorage.getItem('abkbet_user');
            
            if (!token || !userStr) {
                // Not logged in, redirect to admin login
                window.location.href = '/secure-admin-access-2024';
                return;
            }
            
            try {
                const user = JSON.parse(userStr);
                if (!user.is_admin) {
                    // Not an admin, redirect to admin login
                    alert('Access denied. Admin privileges required.');
                    window.location.href = '/secure-admin-access-2024';
                    return;
                }
            } catch (e) {
                // Invalid stored data, redirect to login
                localStorage.removeItem('abkbet_token');
                localStorage.removeItem('abkbet_user');
                window.location.href = '/secure-admin-access-2024';
                return;
            }
        })();

        const client = new ABKBetClient();
        let currentEditMatchId = null;

        // Navigation
        function showSection(section) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.textContent.toLowerCase().includes(section.replace('-', ' '))) {
                    item.classList.add('active');
                }
            });

            // Update sections
            document.querySelectorAll('.admin-section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById(section + '-section').classList.add('active');

            // Load data
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'matches':
                    loadMatches();
                    break;
                case 'deposits':
                    loadDeposits();
                    break;
                case 'withdrawals':
                    loadWithdrawals();
                    break;
                case 'payment-methods':
                    loadPaymentMethods();
                    break;
                case 'virtual':
                    loadVirtualGames();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'bets':
                    loadAllBets();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
            }
        }

        // Messages
        function showMessage(text, type = 'success') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type} active`;
            setTimeout(() => {
                msg.classList.remove('active');
            }, 5000);
        }

        // ===== DASHBOARD =====
        async function loadDashboard() {
            try {
                const stats = await client.request('/admin/statistics');
                
                // Business Financials
                document.getElementById('totalDeposits').textContent = `$${(stats.total_deposits || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                document.getElementById('totalWithdrawals').textContent = `$${(stats.total_withdrawals || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                document.getElementById('outstandingBets').textContent = `$${(stats.outstanding_bets || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Net Revenue with color coding
                const netRevenue = stats.net_revenue || 0;
                const netRevenueElement = document.getElementById('netRevenue');
                netRevenueElement.textContent = `$${netRevenue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                netRevenueElement.style.color = netRevenue >= 0 ? '#10b981' : '#ef4444';
                
                // Betting Statistics
                document.getElementById('totalUsers').textContent = stats.total_users || 0;
                document.getElementById('activeBets').textContent = stats.active_bets || 0;
                document.getElementById('bettingVolume').textContent = `$${(stats.betting_volume || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                document.getElementById('totalPayouts').textContent = `$${(stats.total_payouts || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Pending Actions
                document.getElementById('pendingDeposits').textContent = stats.pending_deposits || 0;
                document.getElementById('pendingWithdrawals').textContent = stats.pending_withdrawals || 0;
                
                // Load recent activity
                await loadRecentActivity();
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // ===== RECENT ACTIVITY =====
        async function loadRecentActivity() {
            try {
                const response = await client.request('/admin/activity/recent?limit=15&_t=' + Date.now());
                const tbody = document.getElementById('recentActivityTable');
                
                if (!response.activities || response.activities.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <i class="fas fa-history"></i>
                                <h3>No recent activity</h3>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.activities.map(activity => {
                    const typeIcons = {
                        'bet_placed': 'fa-ticket-alt',
                        'bet_settled': 'fa-check-circle',
                        'deposit': 'fa-arrow-down',
                        'withdrawal': 'fa-arrow-up',
                        'user_registered': 'fa-user-plus'
                    };
                    
                    const typeColors = {
                        'bet_placed': '#3b82f6',
                        'bet_settled': '#10b981',
                        'deposit': '#10b981',
                        'withdrawal': '#f59e0b',
                        'user_registered': '#8b5cf6'
                    };
                    
                    const typeLabels = {
                        'bet_placed': 'Bet Placed',
                        'bet_settled': 'Bet Settled',
                        'deposit': 'Deposit',
                        'withdrawal': 'Withdrawal',
                        'user_registered': 'New User'
                    };
                    
                    const statusClass = activity.status === 'won' || activity.status === 'completed' || activity.status === 'active' ? 'success' : 
                                       activity.status === 'lost' || activity.status === 'failed' ? 'danger' : 'warning';
                    
                    const timeAgo = getTimeAgo(new Date(activity.time));
                    const amountUsd = activity.amount > 0 ? activity.amount.toFixed(2) : null;
                    
                    return `
                        <tr>
                            <td>${timeAgo}</td>
                            <td>
                                <span style="display: inline-flex; align-items: center; gap: 6px; color: ${typeColors[activity.type] || '#64748b'};">
                                    <i class="fas ${typeIcons[activity.type] || 'fa-circle'}"></i>
                                    ${typeLabels[activity.type] || activity.type}
                                </span>
                            </td>
                            <td><strong>${activity.user}</strong></td>
                            <td>${amountUsd ? '$' + amountUsd : '-'}</td>
                            <td><span class="badge badge-${statusClass}">${activity.status}</span></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
            return date.toLocaleDateString();
        }

        // ===== UPDATE LIVE MATCHES =====
        async function updateLiveMatches() {
            try {
                // Show loading state
                const button = event.target.closest('button');
                const originalHTML = button.innerHTML;
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                
                const response = await client.request('/admin/update-live-matches', 'POST');
                
                // Restore button
                button.disabled = false;
                button.innerHTML = originalHTML;
                
                if (response.success) {
                    showMessage(` ${response.message}`, 'success');
                    // Reload recent activity to show updates
                    await loadRecentActivity();
                } else {
                    showMessage(` Error: ${response.message}`, 'error');
                }
            } catch (error) {
                console.error('Error updating live matches:', error);
                showMessage(' Failed to update live matches', 'error');
                
                // Restore button
                const button = event.target.closest('button');
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-sync"></i> Update Live Matches';
            }
        }

        // ===== DATABASE POPULATION TOOLS =====
        async function populateMatches() {
            const statusDiv = document.getElementById('populateStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(59, 130, 246, 0.2)';
            statusDiv.style.color = '#60a5fa';
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Populating database...';
            
            try {
                const response = await client.request('/bets/admin/populate-matches', 'POST');
                
                if (response.status === 'success') {
                    statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                    statusDiv.style.color = '#10b981';
                    statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${response.message}<br><small>Total matches in database: ${response.total_in_db}</small>`;
                    
                    showMessage(' Database populated successfully!', 'success');
                    // Reload matches if on matches section
                    if (typeof loadMatches === 'function') {
                        setTimeout(() => loadMatches(), 1000);
                    }
                } else {
                    throw new Error(response.message || 'Failed to populate');
                }
            } catch (error) {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                statusDiv.style.color = '#ef4444';
                statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${error.message}`;
                console.error('Populate error:', error);
            }
        }

        async function checkDatabaseMatches() {
            const statusDiv = document.getElementById('dbMatchesStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(59, 130, 246, 0.2)';
            statusDiv.style.color = '#60a5fa';
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking database...';
            
            try {
                const response = await client.request('/bets/test/db-matches');
                
                if (response.status === 'success') {
                    statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                    statusDiv.style.color = '#e9d5ff';
                    
                    let html = `<div style="font-weight: 700; margin-bottom: 10px; color: #fff;">
                        <i class="fas fa-database"></i> Total Matches: ${response.total}
                    </div>`;
                    
                    if (response.matches && response.matches.length > 0) {
                        html += '<div style="font-size: 12px;">';
                        response.matches.forEach((match, idx) => {
                            const date = new Date(match.match_date);
                            html += `
                                <div style="background: rgba(0,0,0,0.3); padding: 8px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid #10b981;">
                                    <strong>${idx + 1}. ${match.home_team} vs ${match.away_team}</strong><br>
                                    <small>League: ${match.league} | Status: ${match.status}</small><br>
                                    <small>Date: ${date.toLocaleString()}</small>
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<div style="color: #fbbf24; margin-top: 10px;"><i class="fas fa-exclamation-triangle"></i> No matches found in database</div>';
                    }
                    
                    statusDiv.innerHTML = html;
                } else {
                    throw new Error(response.message || 'Failed to fetch matches');
                }
            } catch (error) {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                statusDiv.style.color = '#ef4444';
                statusDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${error.message}`;
                console.error('Check DB error:', error);
            }
        }

        // ===== MATCHES =====
        async function loadMatches() {
            try {
                // Add timestamp to bypass cache
                const response = await client.request('/admin/matches?_t=' + Date.now());
                console.log('=== MATCHES RESPONSE ===');
                console.log('Total matches:', response.matches ? response.matches.length : 0);
                console.log('Full response:', response);
                
                const tbody = document.getElementById('matchesTable');
                
                if (!response.matches || response.matches.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="empty-state">
                                <i class="fas fa-futbol"></i>
                                <h3>No matches yet</h3>
                                <p>Create your first manual match</p>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.matches.map(match => `
                    <tr>
                        <td>${match.id}</td>
                        <td>${match.home_team} vs ${match.away_team}</td>
                        <td>${match.league}</td>
                        <td>${new Date(match.match_date).toLocaleString()}</td>
                        <td><span class="badge badge-${match.status}">${match.status}</span></td>
                        <td>${match.home_score || 0} - ${match.away_score || 0}</td>
                        <td>${match.home_odds} / ${match.draw_odds} / ${match.away_odds}</td>
                        <td>
                            <button class="btn btn-edit" onclick="openEditMatchModal(${match.id})" title="Edit Match">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-primary" onclick="openHalfTimeModal(${match.id})" title="HT Result" ${match.ht_status === 'completed' ? 'disabled' : ''}>
                                <i class="fas fa-clock"></i>
                            </button>
                            <button class="btn" onclick="openLiveScoreModal(${match.id})" title="Live Score" style="background: #f59e0b; color: white;">
                                <i class="fas fa-broadcast-tower"></i>
                            </button>
                            <button class="btn btn-primary" onclick="openResultModal(${match.id})" title="Final Result">
                                <i class="fas fa-flag-checkered"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteMatch(${match.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading matches:', error);
                showMessage('Error loading matches: ' + error.message, 'error');
            }
        }

        function openCreateMatchModal() {
            document.getElementById('matchModalTitle').textContent = 'Create New Match';
            document.getElementById('matchForm').reset();
            document.getElementById('matchId').value = '';
            
            // Set default date/time to current time for convenience
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString()
                .slice(0, 16);
            document.getElementById('matchDate').value = localDateTime;
            
            document.getElementById('matchModal').classList.add('active');
        }

        async function openEditMatchModal(id) {
            try {
                const response = await client.request(`/admin/matches/${id}?_t=` + Date.now());
                const match = response.match; // Extract match from response
                
                document.getElementById('matchModalTitle').textContent = 'Edit Match';
                document.getElementById('matchId').value = match.id;
                document.getElementById('homeTeam').value = match.home_team;
                document.getElementById('awayTeam').value = match.away_team;
                document.getElementById('league').value = match.league;
                
                // Handle date properly - match_date comes as ISO string from backend
                if (match.match_date) {
                    // Remove seconds and timezone info for datetime-local input
                    const dateStr = match.match_date.slice(0, 16);
                    document.getElementById('matchDate').value = dateStr;
                }
                
                document.getElementById('homeOdds').value = match.home_odds;
                document.getElementById('drawOdds').value = match.draw_odds;
                document.getElementById('awayOdds').value = match.away_odds;
                
                // Load optional Double Chance odds
                document.getElementById('homeDrawOdds').value = match.home_draw_odds || '';
                document.getElementById('homeAwayOdds').value = match.home_away_odds || '';
                document.getElementById('drawAwayOdds').value = match.draw_away_odds || '';
                
                // Load optional GG/NG odds
                document.getElementById('ggOdds').value = match.gg_odds || '';
                document.getElementById('ngOdds').value = match.ng_odds || '';
                
                // Load optional Over/Under odds
                document.getElementById('over15Odds').value = match.over15_odds || '';
                document.getElementById('under15Odds').value = match.under15_odds || '';
                document.getElementById('over25Odds').value = match.over25_odds || '';
                document.getElementById('under25Odds').value = match.under25_odds || '';
                document.getElementById('over35Odds').value = match.over35_odds || '';
                document.getElementById('under35Odds').value = match.under35_odds || '';
                
                // Load HT/FT odds if available
                if (match.htft_odds) {
                    const htft = typeof match.htft_odds === 'string' ? JSON.parse(match.htft_odds) : match.htft_odds;
                    document.getElementById('htftHH').value = htft.HH || '';
                    document.getElementById('htftHD').value = htft.HD || '';
                    document.getElementById('htftHA').value = htft.HA || '';
                    document.getElementById('htftDH').value = htft.DH || '';
                    document.getElementById('htftDD').value = htft.DD || '';
                    document.getElementById('htftDA').value = htft.DA || '';
                    document.getElementById('htftAH').value = htft.AH || '';
                    document.getElementById('htftAD').value = htft.AD || '';
                    document.getElementById('htftAA').value = htft.AA || '';
                }
                
                // Load Correct Score odds if available
                if (match.correct_score_odds) {
                    const cs = typeof match.correct_score_odds === 'string' ? JSON.parse(match.correct_score_odds) : match.correct_score_odds;
                    document.getElementById('cs10').value = cs['1-0'] || '';
                    document.getElementById('cs20').value = cs['2-0'] || '';
                    document.getElementById('cs21').value = cs['2-1'] || '';
                    document.getElementById('cs30').value = cs['3-0'] || '';
                    document.getElementById('cs31').value = cs['3-1'] || '';
                    document.getElementById('cs32').value = cs['3-2'] || '';
                    document.getElementById('cs40').value = cs['4-0'] || '';
                    document.getElementById('cs41').value = cs['4-1'] || '';
                    document.getElementById('cs42').value = cs['4-2'] || '';
                    document.getElementById('cs00').value = cs['0-0'] || '';
                    document.getElementById('cs11').value = cs['1-1'] || '';
                    document.getElementById('cs22').value = cs['2-2'] || '';
                    document.getElementById('cs33').value = cs['3-3'] || '';
                    document.getElementById('cs01').value = cs['0-1'] || '';
                    document.getElementById('cs02').value = cs['0-2'] || '';
                    document.getElementById('cs12').value = cs['1-2'] || '';
                    document.getElementById('cs03').value = cs['0-3'] || '';
                    document.getElementById('cs13').value = cs['1-3'] || '';
                    document.getElementById('cs23').value = cs['2-3'] || '';
                    document.getElementById('cs04').value = cs['0-4'] || '';
                    document.getElementById('cs14').value = cs['1-4'] || '';
                    document.getElementById('cs24').value = cs['2-4'] || '';
                }
                
                document.getElementById('matchModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading match: ' + error.message, 'error');
            }
        }

        function closeMatchModal() {
            document.getElementById('matchModal').classList.remove('active');
        }

        document.getElementById('matchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchId = document.getElementById('matchId').value;
            
            // Get the datetime value and format it without timezone conversion
            const matchDateInput = document.getElementById('matchDate').value;
            const matchDateISO = matchDateInput ? matchDateInput + ':00' : new Date().toISOString();
            
            const data = {
                home_team: document.getElementById('homeTeam').value,
                away_team: document.getElementById('awayTeam').value,
                league: document.getElementById('league').value,
                match_date: matchDateISO,
                home_odds: parseFloat(document.getElementById('homeOdds').value),
                draw_odds: parseFloat(document.getElementById('drawOdds').value),
                away_odds: parseFloat(document.getElementById('awayOdds').value)
            };

            // Collect optional Double Chance odds
            if (document.getElementById('homeDrawOdds').value) {
                data.home_draw_odds = parseFloat(document.getElementById('homeDrawOdds').value);
            }
            if (document.getElementById('homeAwayOdds').value) {
                data.home_away_odds = parseFloat(document.getElementById('homeAwayOdds').value);
            }
            if (document.getElementById('drawAwayOdds').value) {
                data.draw_away_odds = parseFloat(document.getElementById('drawAwayOdds').value);
            }

            // Collect optional GG/NG odds
            if (document.getElementById('ggOdds').value) {
                data.gg_odds = parseFloat(document.getElementById('ggOdds').value);
            }
            if (document.getElementById('ngOdds').value) {
                data.ng_odds = parseFloat(document.getElementById('ngOdds').value);
            }

            // Collect optional Over/Under odds
            if (document.getElementById('over15Odds').value) {
                data.over15_odds = parseFloat(document.getElementById('over15Odds').value);
            }
            if (document.getElementById('under15Odds').value) {
                data.under15_odds = parseFloat(document.getElementById('under15Odds').value);
            }
            if (document.getElementById('over25Odds').value) {
                data.over25_odds = parseFloat(document.getElementById('over25Odds').value);
            }
            if (document.getElementById('under25Odds').value) {
                data.under25_odds = parseFloat(document.getElementById('under25Odds').value);
            }
            if (document.getElementById('over35Odds').value) {
                data.over35_odds = parseFloat(document.getElementById('over35Odds').value);
            }
            if (document.getElementById('under35Odds').value) {
                data.under35_odds = parseFloat(document.getElementById('under35Odds').value);
            }

            // Collect HT/FT odds
            const htftOdds = {};
            if (document.getElementById('htftHH').value) htftOdds['HH'] = parseFloat(document.getElementById('htftHH').value);
            if (document.getElementById('htftHD').value) htftOdds['HD'] = parseFloat(document.getElementById('htftHD').value);
            if (document.getElementById('htftHA').value) htftOdds['HA'] = parseFloat(document.getElementById('htftHA').value);
            if (document.getElementById('htftDH').value) htftOdds['DH'] = parseFloat(document.getElementById('htftDH').value);
            if (document.getElementById('htftDD').value) htftOdds['DD'] = parseFloat(document.getElementById('htftDD').value);
            if (document.getElementById('htftDA').value) htftOdds['DA'] = parseFloat(document.getElementById('htftDA').value);
            if (document.getElementById('htftAH').value) htftOdds['AH'] = parseFloat(document.getElementById('htftAH').value);
            if (document.getElementById('htftAD').value) htftOdds['AD'] = parseFloat(document.getElementById('htftAD').value);
            if (document.getElementById('htftAA').value) htftOdds['AA'] = parseFloat(document.getElementById('htftAA').value);
            if (Object.keys(htftOdds).length > 0) {
                data.htft_odds = JSON.stringify(htftOdds);
            }

            // Collect Correct Score odds
            const csOdds = {};
            if (document.getElementById('cs10').value) csOdds['1-0'] = parseFloat(document.getElementById('cs10').value);
            if (document.getElementById('cs20').value) csOdds['2-0'] = parseFloat(document.getElementById('cs20').value);
            if (document.getElementById('cs21').value) csOdds['2-1'] = parseFloat(document.getElementById('cs21').value);
            if (document.getElementById('cs30').value) csOdds['3-0'] = parseFloat(document.getElementById('cs30').value);
            if (document.getElementById('cs31').value) csOdds['3-1'] = parseFloat(document.getElementById('cs31').value);
            if (document.getElementById('cs32').value) csOdds['3-2'] = parseFloat(document.getElementById('cs32').value);
            if (document.getElementById('cs00').value) csOdds['0-0'] = parseFloat(document.getElementById('cs00').value);
            if (document.getElementById('cs11').value) csOdds['1-1'] = parseFloat(document.getElementById('cs11').value);
            if (document.getElementById('cs22').value) csOdds['2-2'] = parseFloat(document.getElementById('cs22').value);
            if (document.getElementById('cs01').value) csOdds['0-1'] = parseFloat(document.getElementById('cs01').value);
            if (document.getElementById('cs02').value) csOdds['0-2'] = parseFloat(document.getElementById('cs02').value);
            if (document.getElementById('cs12').value) csOdds['1-2'] = parseFloat(document.getElementById('cs12').value);
            if (document.getElementById('cs03').value) csOdds['0-3'] = parseFloat(document.getElementById('cs03').value);
            if (document.getElementById('cs13').value) csOdds['1-3'] = parseFloat(document.getElementById('cs13').value);
            if (document.getElementById('cs23').value) csOdds['2-3'] = parseFloat(document.getElementById('cs23').value);
            if (document.getElementById('csOther').value) csOdds['Other'] = parseFloat(document.getElementById('csOther').value);
            if (Object.keys(csOdds).length > 0) {
                data.correct_score_odds = JSON.stringify(csOdds);
            }

            try {
                if (matchId) {
                    await client.request(`/admin/matches/${matchId}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                    showMessage('Match updated successfully!');
                } else {
                    await client.request('/admin/matches', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    showMessage('Match created successfully!');
                }
                closeMatchModal();
                // Wait a moment then reload to ensure data is saved
                setTimeout(() => loadMatches(), 500);
            } catch (error) {
                showMessage('Error saving match: ' + error.message, 'error');
            }
        });

        async function openResultModal(id) {
            try {
                const response = await client.request(`/admin/matches/${id}?_t=` + Date.now());
                const match = response.match; // Extract match from response
                
                document.getElementById('resultMatchId').value = match.id;
                document.getElementById('resultType').value = 'fulltime';
                document.getElementById('homeScore').value = match.home_score || 0;
                document.getElementById('awayScore').value = match.away_score || 0;
                document.getElementById('matchStatus').value = match.status;
                
                // Show/hide sections
                document.getElementById('halftimeSection').style.display = 'none';
                document.getElementById('fulltimeSection').style.display = 'block';
                
                // Manage required attributes
                document.getElementById('htHomeScore').removeAttribute('required');
                document.getElementById('htAwayScore').removeAttribute('required');
                document.getElementById('homeScore').setAttribute('required', 'required');
                document.getElementById('awayScore').setAttribute('required', 'required');
                document.getElementById('matchStatus').setAttribute('required', 'required');
                
                // Enable status dropdown for final result
                document.getElementById('matchStatus').disabled = false;
                
                document.getElementById('resultModalTitle').textContent = 'Update Final Result';
                document.getElementById('resultSubmitText').textContent = 'Update Result';
                
                document.getElementById('resultModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading match: ' + error.message, 'error');
            }
        }

        async function openLiveScoreModal(id) {
            try {
                const response = await client.request(`/admin/matches/${id}?_t=` + Date.now());
                const match = response.match;
                
                document.getElementById('resultMatchId').value = match.id;
                document.getElementById('resultType').value = 'live';
                document.getElementById('homeScore').value = match.home_score || 0;
                document.getElementById('awayScore').value = match.away_score || 0;
                document.getElementById('matchStatus').value = 'live';
                
                // Show/hide sections
                document.getElementById('halftimeSection').style.display = 'none';
                document.getElementById('fulltimeSection').style.display = 'block';
                
                // Manage required attributes
                document.getElementById('htHomeScore').removeAttribute('required');
                document.getElementById('htAwayScore').removeAttribute('required');
                document.getElementById('homeScore').setAttribute('required', 'required');
                document.getElementById('awayScore').setAttribute('required', 'required');
                
                // Lock status to 'live'
                document.getElementById('matchStatus').value = 'live';
                document.getElementById('matchStatus').disabled = true;
                
                document.getElementById('resultModalTitle').textContent = 'Update Live Score';
                document.getElementById('resultSubmitText').textContent = 'Update Live Score';
                
                document.getElementById('resultModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading match: ' + error.message, 'error');
            }
        }

        async function openHalfTimeModal(id) {
            try {
                const response = await client.request(`/admin/matches/${id}?_t=` + Date.now());
                const match = response.match; // Extract match from response
                
                if (match.ht_status === 'completed') {
                    showMessage('Half-time result already submitted', 'info');
                    return;
                }
                
                document.getElementById('resultMatchId').value = match.id;
                document.getElementById('resultType').value = 'halftime';
                document.getElementById('htHomeScore').value = match.ht_home_score || 0;
                document.getElementById('htAwayScore').value = match.ht_away_score || 0;
                
                // Show/hide sections
                document.getElementById('halftimeSection').style.display = 'block';
                document.getElementById('fulltimeSection').style.display = 'none';
                
                // Manage required attributes
                document.getElementById('htHomeScore').setAttribute('required', 'required');
                document.getElementById('htAwayScore').setAttribute('required', 'required');
                document.getElementById('homeScore').removeAttribute('required');
                document.getElementById('awayScore').removeAttribute('required');
                document.getElementById('matchStatus').removeAttribute('required');
                
                document.getElementById('resultModalTitle').textContent = 'Update Half-Time Result';
                document.getElementById('resultSubmitText').textContent = 'Save HT Result';
                
                document.getElementById('resultModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading match: ' + error.message, 'error');
            }
        }

        function closeResultModal() {
            document.getElementById('resultModal').classList.remove('active');
        }

        document.getElementById('resultForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchId = document.getElementById('resultMatchId').value;
            const resultType = document.getElementById('resultType').value;
            
            // Re-enable status dropdown before reading value
            const statusDropdown = document.getElementById('matchStatus');
            statusDropdown.disabled = false;
            
            let data;
            if (resultType === 'halftime') {
                data = {
                    ht_home_score: parseInt(document.getElementById('htHomeScore').value),
                    ht_away_score: parseInt(document.getElementById('htAwayScore').value),
                    ht_status: 'completed'
                };
            } else if (resultType === 'live') {
                // Live score update - force status to 'live'
                data = {
                    home_score: parseInt(document.getElementById('homeScore').value),
                    away_score: parseInt(document.getElementById('awayScore').value),
                    status: 'live'
                };
            } else {
                // Final result
                data = {
                    home_score: parseInt(document.getElementById('homeScore').value),
                    away_score: parseInt(document.getElementById('awayScore').value),
                    status: statusDropdown.value
                };
            }

            try {
                console.log('Submitting result for match:', matchId, 'Type:', resultType, 'Data:', data);
                const response = await client.request(`/admin/matches/${matchId}/result`, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                
                if (resultType === 'halftime') {
                    showMessage('Half-time result saved successfully!');
                } else if (resultType === 'live') {
                    showMessage('Live score updated successfully!');
                } else {
                    showMessage('Match result updated! Bets settled automatically.');
                }
                
                closeResultModal();
                loadMatches();
            } catch (error) {
                console.error('Result update error:', error);
                showMessage('Error updating result: ' + error.message, 'error');
            }
        });

        async function deleteMatch(id) {
            if (!confirm('Are you sure you want to delete this match?')) return;
            
            try {
                await client.request(`/admin/matches/${id}`, {
                    method: 'DELETE'
                });
                showMessage('Match deleted successfully!');
                loadMatches();
            } catch (error) {
                // Check if error has bet information
                if (error.message.includes('existing bet')) {
                    const forceDelete = confirm(
                        `${error.message}\n\n` +
                        `This match has bets from deleted users or orphaned bets.\n\n` +
                        `Click OK to FORCE DELETE (removes match + all bets)\n` +
                        `Click Cancel to keep the match`
                    );
                    
                    if (forceDelete) {
                        try {
                            await client.request(`/admin/matches/${id}?force=true`, {
                                method: 'DELETE'
                            });
                            showMessage('Match and associated bets deleted successfully!');
                            loadMatches();
                        } catch (forceError) {
                            showMessage('Error force deleting match: ' + forceError.message, 'error');
                        }
                    }
                } else {
                    showMessage('Error deleting match: ' + error.message, 'error');
                }
            }
        }

        // ===== DEPOSITS =====
        async function loadDeposits() {
            try {
                const response = await client.request('/deposit/pending?_t=' + Date.now());
                const tbody = document.getElementById('depositsTable');
                
                if (!response.deposits || response.deposits.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <h3>No pending deposits</h3>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.deposits.map(deposit => `
                    <tr>
                        <td>${deposit.id}</td>
                        <td>${deposit.username}</td>
                        <td>$${deposit.amount.toFixed(2)}</td>
                        <td>${deposit.payment_method || 'N/A'}</td>
                        <td>${deposit.transaction_reference || 'N/A'}</td>
                        <td>${new Date(deposit.created_at).toLocaleString()}</td>
                        <td>
                            <button class="btn btn-approve" onclick="approveDeposit(${deposit.id})">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-reject" onclick="rejectDeposit(${deposit.id})">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showMessage('Error loading deposits: ' + error.message, 'error');
            }
        }

        async function approveDeposit(id) {
            if (!confirm('Approve this deposit?')) return;
            
            try {
                await client.request(`/deposit/approve/${id}`, {
                    method: 'POST'
                });
                showMessage('Deposit approved successfully!');
                loadDeposits();
                loadDashboard();
            } catch (error) {
                showMessage('Error approving deposit: ' + error.message, 'error');
            }
        }

        async function rejectDeposit(id) {
            const reason = prompt('Reason for rejection (optional):');
            if (reason === null) return; // User cancelled
            
            try {
                await client.request(`/deposit/reject/${id}`, {
                    method: 'POST',
                    body: JSON.stringify({ admin_notes: reason || 'Rejected by admin' })
                });
                showMessage('Deposit rejected successfully!');
                loadDeposits();
                loadDashboard();
            } catch (error) {
                showMessage('Error rejecting deposit: ' + error.message, 'error');
            }
        }

        // ===== WITHDRAWALS =====
        async function loadWithdrawals() {
            try {
                const response = await client.request('/withdrawal/admin/withdrawals?status=PENDING&_t=' + Date.now());
                const tbody = document.getElementById('withdrawalsTable');
                
                if (!response.withdrawals || response.withdrawals.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <h3>No pending withdrawals</h3>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.withdrawals.map(withdrawal => {
                    // Display wallet address or bank details based on payment method
                    let paymentDetails = '';
                    let fullDetails = '';
                    
                    if (withdrawal.wallet_address) {
                        fullDetails = withdrawal.wallet_address;
                        paymentDetails = `
                            <div class="payment-details-container">
                                <div class="payment-details-short" onclick="togglePaymentDetails(${withdrawal.id})">
                                    <span>${withdrawal.wallet_address.substring(0, 20)}...</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="payment-details-${withdrawal.id}" class="payment-details-full" style="display: none;">
                                    <div class="full-address">
                                        <input type="text" value="${withdrawal.wallet_address}" readonly style="width: 100%; padding: 5px; margin-bottom: 5px; border: 1px solid #374151; background: #1f2937; color: #fff; border-radius: 4px;">
                                        <button class="btn-copy" onclick="copyToClipboard('${withdrawal.wallet_address}', event)">
                                            <i class="fas fa-copy"></i> Copy
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (withdrawal.bank_name) {
                        fullDetails = `${withdrawal.bank_name} - ${withdrawal.account_number}`;
                        paymentDetails = `
                            <div class="payment-details-container">
                                <div class="payment-details-short" onclick="togglePaymentDetails(${withdrawal.id})">
                                    <span>${withdrawal.bank_name}</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="payment-details-${withdrawal.id}" class="payment-details-full" style="display: none;">
                                    <div class="full-address">
                                        <strong>Bank:</strong> ${withdrawal.bank_name}<br>
                                        <strong>Account:</strong> ${withdrawal.account_number}<br>
                                        <strong>Name:</strong> ${withdrawal.account_name || 'N/A'}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        paymentDetails = 'N/A';
                    }
                    
                    return `
                        <tr>
                            <td>${withdrawal.id}</td>
                            <td>${withdrawal.username}</td>
                            <td>$${withdrawal.amount_usd.toFixed(2)}</td>
                            <td>${withdrawal.payment_method || 'N/A'}</td>
                            <td>${paymentDetails}</td>
                            <td>${new Date(withdrawal.created_at).toLocaleString()}</td>
                            <td>
                                <button class="btn btn-approve" onclick="approveWithdrawal(${withdrawal.id})">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-reject" onclick="rejectWithdrawal(${withdrawal.id})">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                showMessage('Error loading withdrawals: ' + error.message, 'error');
            }
        }

        
        async function approveWithdrawal(id) {
            if (!confirm('Approve this withdrawal? The user will receive their funds.')) return;
            
            try {
                await client.request(`/withdrawal/admin/withdrawals/${id}/approve`, {
                    method: 'POST',
                    body: JSON.stringify({ notes: 'Approved by admin' })
                });
                showMessage('Withdrawal approved successfully!');
                loadWithdrawals();
                loadDashboard();
            } catch (error) {
                showMessage('Error approving withdrawal: ' + error.message, 'error');
            }
        }
        async function rejectWithdrawal(id) {
            const reason = prompt('Reason for rejection (optional):');
            if (reason === null) return; // User cancelled
            
            try {
                await client.request(`/withdrawal/admin/withdrawals/${id}/reject`, {
                    method: 'POST',
                    body: JSON.stringify({ reason: reason || 'Rejected by admin' })
                });
                showMessage('Withdrawal rejected successfully!');
                loadWithdrawals();
                loadDashboard();
            } catch (error) {
                showMessage('Error rejecting withdrawal: ' + error.message, 'error');
            }
        }
        
        function togglePaymentDetails(id) {
            const detailsDiv = document.getElementById(`payment-details-${id}`);
            const isVisible = detailsDiv.style.display === 'block';
            detailsDiv.style.display = isVisible ? 'none' : 'block';
            
            // Toggle chevron icon
            const parent = detailsDiv.previousElementSibling;
            const icon = parent.querySelector('i');
            if (icon) {
                icon.className = isVisible ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
            }
        }
        
        function copyToClipboard(text, event) {
            event.stopPropagation();
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Copied to clipboard!', 'success');
            }).catch(err => {
                showMessage('Failed to copy', 'error');
            });
        }

        // ===== USERS =====
        async function loadUsers() {
            try {
                const response = await client.request('/admin/users?_t=' + Date.now());
                const tbody = document.getElementById('usersTable');
                
                if (!response.users || response.users.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-users"></i>
                                <h3>No users found</h3>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.users.map(user => {
                    const balanceUsd = user.balance ? user.balance.toFixed(2) : '0.00';
                    return `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>$${balanceUsd}</td>
                        <td>${user.is_active ? '<span class="badge badge-completed">Active</span>' : '<span class="badge badge-failed">Suspended</span>'}</td>
                        <td>${user.is_admin ? '<span class="badge badge-completed">Yes</span>' : '<span class="badge badge-pending">No</span>'}</td>
                        <td>${new Date(user.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewUserBets(${user.id}, '${user.username}')" title="View Bets">
                                <i class="fas fa-ticket-alt"></i>
                            </button>
                            <button class="btn btn-info" onclick="viewPaymentInfo(${user.id}, '${user.username}')" title="Payment Info">
                                <i class="fas fa-wallet"></i>
                            </button>
                            ${!user.is_admin ? (user.is_active ? 
                                `<button class="btn btn-warning" onclick="suspendUser(${user.id}, '${user.username}')" title="Suspend">
                                    <i class="fas fa-ban"></i>
                                </button>` : 
                                `<button class="btn btn-success" onclick="unsuspendUser(${user.id}, '${user.username}')" title="Unsuspend">
                                    <i class="fas fa-check-circle"></i>
                                </button>`) : ''}
                        </td>
                    </tr>
                `;
                }).join('');
            } catch (error) {
                showMessage('Error loading users: ' + error.message, 'error');
            }
        }

        async function viewUser(id) {
            try {
                const user = await client.request(`/admin/users/${id}`);
                const balanceUsd = user.balance ? user.balance.toFixed(2) : '0.00';
                alert(`User Details:

ID: ${user.id}
Username: ${user.username}
Email: ${user.email}
Balance: $${balanceUsd}
Admin: ${user.is_admin ? 'Yes' : 'No'}`);
            } catch (error) {
                showMessage('Error loading user: ' + error.message, 'error');
            }
        }

        // ===== BETS =====
        async function loadAllBets() {
            try {
                const response = await client.request('/admin/bets?_t=' + Date.now());
                console.log('Bets response:', response);
                const tbody = document.getElementById('betsTable');
                
                if (!response.bets || response.bets.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="10" class="empty-state">
                                <i class="fas fa-ticket-alt"></i>
                                <h3>No bets found</h3>
                                <p>No bets have been placed yet</p>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.bets.map((bet, index) => {
                    const statusClass = bet.status === 'won' ? 'success' : 
                                       bet.status === 'lost' ? 'danger' : 
                                       bet.status === 'active' ? 'warning' : 
                                       bet.status === 'pending' ? 'warning' : 'secondary';
                    
                    // Amounts are already in USD
                    const amountUsd = bet.amount;
                    const payoutUsd = bet.potential_payout;
                    
                    // Determine match display with expandable details for multi-bets
                    let matchDisplay = '';
                    let isMultiBet = false;
                    let isPremium = false;
                    
                    if (bet.match) {
                        // Single match bet - has a match object
                        matchDisplay = `<strong>${bet.match.home_team} vs ${bet.match.away_team}</strong><br><small style="color: #94a3b8;">${bet.match.league}</small>`;
                        if (bet.match.status === 'finished' && bet.match.home_score !== null) {
                            matchDisplay += `<br><span style="color: #3b82f6; font-size: 11px;">Score: ${bet.match.home_score}-${bet.match.away_score}</span>`;
                        }
                    } else {
                        // No match object = multi-bet or premium
                        isMultiBet = true;
                        // Check if it's premium (booking code starts with "PRM")
                        if (bet.booking_code && bet.booking_code.startsWith('PRM')) {
                            isPremium = true;
                        }
                        
                        const uniqueId = 'bet-details-' + bet.id;
                        const previewText = isPremium ? 
                            `Code: ${bet.booking_code}` : 
                            bet.event_description.substring(0, 50) + (bet.event_description.length > 50 ? '...' : '');
                        
                        const borderColor = isPremium ? '#fbbf24' : '#3b82f6';
                        const titleColor = isPremium ? '#fbbf24' : '#60a5fa';
                        const icon = isPremium ? 'fa-star' : 'fa-layer-group';
                        const title = isPremium ? 'Premium Ticket' : 'Multi-Bet';
                        
                        matchDisplay = `
                            <div style="position: relative;">
                                <div style="cursor: pointer; padding: 8px; background: #0f172a; border-radius: 6px; border-left: 3px solid ${borderColor};" onclick="document.getElementById('${uniqueId}').style.display = document.getElementById('${uniqueId}').style.display === 'none' ? 'block' : 'none'">
                                    <strong style="color: ${titleColor};">
                                        <i class="fas ${icon}"></i> ${title}
                                    </strong>
                                    <span style="float: right; color: #60a5fa;">
                                        <i class="fas fa-chevron-down" style="font-size: 10px;"></i> Click to expand
                                    </span>
                                    <br><small style="color: #94a3b8;">${previewText}</small>
                                </div>
                                <div id="${uniqueId}" style="display: none; margin-top: 8px; padding: 10px; background: #1e293b; border-radius: 6px; border: 1px solid #334155;">
                                    <div style="max-height: 200px; overflow-y: auto;">
                                        <strong style="color: #60a5fa; display: block; margin-bottom: 8px;">
                                            <i class="fas fa-list"></i> Full Details:
                                        </strong>
                                        <div style="white-space: pre-wrap; color: #e2e8f0; font-size: 12px; line-height: 1.6;">${bet.event_description}</div>
                                        ${bet.booking_code ? `<div style="margin-top: 8px; padding: 6px; background: #0f172a; border-radius: 4px; border-left: 2px solid #fbbf24;">
                                            <strong style="color: #fbbf24;">Booking Code:</strong> ${bet.booking_code}
                                        </div>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Enhanced selection display - show what was picked
                    let selectionDisplay = '';
                    if (bet.selection && !isMultiBet) {
                        selectionDisplay = `<div style="background: #0f172a; padding: 6px 10px; border-radius: 4px; border-left: 2px solid #3b82f6;">
                            <strong style="color: #60a5fa; font-size: 12px;">${bet.selection}</strong>
                        </div>`;
                    } else if (isPremium) {
                        selectionDisplay = '<strong style="color: #fbbf24;"><i class="fas fa-star"></i> Premium</strong>';
                    } else if (isMultiBet) {
                        // Count selections if possible
                        const selectionCount = bet.event_description.split('\n').filter(line => line.includes('') || line.includes(':')).length;
                        selectionDisplay = `<span style="color: #fbbf24; font-weight: 600;">
                            <i class="fas fa-layer-group"></i> ${selectionCount > 0 ? selectionCount + ' Picks' : 'Multi'}
                        </span>`;
                    } else {
                        selectionDisplay = '<span style="color: #94a3b8;">Multi/Combo</span>';
                    }
                    
                    // Status indicator with icon
                    let statusDisplay = '';
                    if (bet.status === 'won') {
                        statusDisplay = '<span style="color: #10b981; font-weight: 700;"> WON</span>';
                    } else if (bet.status === 'lost') {
                        statusDisplay = '<span style="color: #ef4444; font-weight: 700;"> LOST</span>';
                    } else if (bet.status === 'voided' || bet.status === 'cancelled') {
                        statusDisplay = '<span style="color: #94a3b8;"> VOID</span>';
                    } else {
                        statusDisplay = '<span style="color: #60a5fa;"> PENDING</span>';
                    }
                    
                    return `
                        <tr>
                            <td>${bet.id}</td>
                            <td><strong>${bet.username}</strong></td>
                            <td style="max-width: 300px;">${matchDisplay}</td>
                            <td>${selectionDisplay}</td>
                            <td><strong>$${amountUsd.toFixed(2)}</strong></td>
                            <td><span style="color: #fbbf24; font-weight: 600;">${bet.odds.toFixed(2)}x</span></td>
                            <td><strong style="color: #10b981;">$${payoutUsd.toFixed(2)}</strong></td>
                            <td>${statusDisplay}</td>
                            <td><small>${new Date(bet.created_at).toLocaleString()}</small></td>
                            <td>
                                ${(bet.status === 'active' || bet.status === 'pending') ? 
                                    `<button class="btn btn-sm btn-success" onclick='settleBet(${bet.id}, "win")' title="Mark as Won" style="margin: 2px;">
                                        <i class="fas fa-check"></i> Won
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick='settleBet(${bet.id}, "loss")' title="Mark as Lost" style="margin: 2px;">
                                        <i class="fas fa-times"></i> Lost
                                    </button>` : 
                                    `<span style="color: #64748b; font-size: 12px;">Settled</span>`}
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading bets:', error);
                const tbody = document.getElementById('betsTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                            <h3 style="color: #ef4444;">Error Loading Bets</h3>
                            <p style="color: #94a3b8;">${error.message || 'Unknown error occurred'}</p>
                            <p style="font-size: 12px; color: #64748b; margin-top: 10px;">
                                Check browser console (F12) for more details
                            </p>
                        </td>
                    </tr>
                `;
                showMessage('Error loading bets: ' + (error.message || 'Unknown error'), 'error');
            }
        }

        async function settleBet(betId, result) {
            const action = result === 'win' ? 'WON' : 'LOST';
            const message = result === 'win' ? 
                'This will pay the user their full winnings.' : 
                'This will mark the bet as lost with no payout.';
            
            if (!confirm(`Mark bet #${betId} as ${action}?\n\n${message}`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/bets/${betId}/settle`, {
                    method: 'POST',
                    body: JSON.stringify({
                        result: result,
                        payout: result === 'win' ? null : 0
                    })
                });
                showMessage(`Bet #${betId} marked as ${action}!`, 'success');
                
                // Reload all bets
                await loadAllBets();
            } catch (error) {
                showMessage('Error settling bet: ' + error.message, 'error');
            }
        }

        // ===== TRANSACTIONS =====
        async function loadTransactions() {
            try {
                const response = await client.request('/admin/transactions?_t=' + Date.now());
                console.log('Transactions response:', response);
                const tbody = document.getElementById('transactionsTable');
                
                if (!response.transactions || response.transactions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-list"></i>
                                <h3>No transactions found</h3>
                                <p style="color: #94a3b8;">Deposits and withdrawals will appear here</p>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.transactions.map(tx => {
                    // Amounts are in USD
                    const amountUsd = tx.amount;
                    return `
                        <tr>
                            <td>${tx.id}</td>
                            <td>${tx.username}</td>
                            <td>${tx.type}</td>
                            <td>$${amountUsd.toFixed(2)}</td>
                            <td><span class="badge badge-${tx.status}">${tx.status}</span></td>
                            <td>${tx.tx_hash || 'N/A'}</td>
                            <td>${new Date(tx.created_at).toLocaleString()}</td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading transactions:', error);
                const tbody = document.getElementById('transactionsTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                            <h3 style="color: #ef4444;">Error Loading Transactions</h3>
                            <p style="color: #94a3b8;">${error.message || 'Unknown error occurred'}</p>
                            <p style="font-size: 12px; color: #64748b;">Check browser console (F12) for details</p>
                        </td>
                    </tr>
                `;
                showMessage('Error loading transactions: ' + error.message, 'error');
            }
        }

        // ===== USER MANAGEMENT =====
        async function suspendUser(userId, username) {
            if (!confirm(`Are you sure you want to SUSPEND user "${username}"?\n\nThis will:\n- Prevent them from logging in\n- Prevent them from placing bets\n- Freeze their account activity`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/users/${userId}/suspend`, 'POST');
                showMessage(`User "${username}" has been suspended`, 'success');
                await loadUsers();
            } catch (error) {
                showMessage('Error suspending user: ' + error.message, 'error');
            }
        }

        async function unsuspendUser(userId, username) {
            if (!confirm(`Are you sure you want to UNSUSPEND user "${username}"?\n\nThis will reactivate their account.`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/users/${userId}/unsuspend`, 'POST');
                showMessage(`User "${username}" has been reactivated`, 'success');
                await loadUsers();
            } catch (error) {
                showMessage('Error unsuspending user: ' + error.message, 'error');
            }
        }

        async function viewUserBets(userId, username) {
            try {
                console.log('Fetching bets for user:', userId, username);
                const response = await client.request(`/admin/users/${userId}/bets`);
                console.log('Response received:', response);
                
                if (!response.bets || response.bets.length === 0) {
                    alert(`No bets found for user "${username}"`);
                    return;
                }
                
                // Amounts are already in USD
                
                // Create a modal to display user bets
                const modalHtml = `
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;" onclick="this.remove()">
                        <div style="background: #1e293b; border-radius: 12px; max-width: 95%; max-height: 90vh; overflow: auto; padding: 0;" onclick="event.stopPropagation()">
                            <div style="position: sticky; top: 0; background: #1e293b; padding: 20px; border-bottom: 2px solid #334155; display: flex; justify-content: space-between; align-items: center; z-index: 1;">
                                <h2 style="margin: 0; color: #3b82f6;">
                                    <i class="fas fa-ticket-alt"></i> Bets for ${username}
                                </h2>
                                <button onclick="this.closest('div[style*=fixed]').remove()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 16px;">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                            <div style="padding: 20px;">
                                <table class="data-table" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Match</th>
                                            <th>User Picked</th>
                                            <th>Odds</th>
                                            <th>Stake</th>
                                            <th>Potential Win</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${response.bets.map(bet => {
                                            // Determine match display with detailed info
                                            let matchDisplay = '';
                                            let detailsHtml = '';
                                            
                                            if (bet.match) {
                                                // Single match bet - show full details
                                                matchDisplay = `<strong style="font-size: 14px;">${bet.match.home_team} vs ${bet.match.away_team}</strong><br>
                                                               <small style="color: #94a3b8;">${bet.match.league}</small>`;
                                                
                                                // Add match result if available
                                                if (bet.match.status === 'finished' && bet.match.home_score !== null) {
                                                    detailsHtml = `<br><span style="color: #3b82f6; font-weight: 600; font-size: 13px;">Final: ${bet.match.home_score} - ${bet.match.away_score}</span>`;
                                                } else if (bet.match.status === 'live') {
                                                    detailsHtml = `<br><span style="background: #ef4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600;">LIVE</span>`;
                                                } else {
                                                    detailsHtml = `<br><small style="color: #64748b;">Scheduled</small>`;
                                                }
                                            } else if (bet.booking_code) {
                                                matchDisplay = `<strong>Premium Booking Code</strong><br><small style="color: #fbbf24;">Code: ${bet.booking_code}</small>`;
                                            } else if (bet.is_multi_bet) {
                                                matchDisplay = `<strong>Multi Bet</strong><br><small style="color: #94a3b8;">${bet.event_description || 'Multiple selections'}</small>`;
                                            } else {
                                                matchDisplay = bet.event_description || 'N/A';
                                            }
                                            
                                            // Enhanced selection display - show what user picked with odds
                                            let selectionDisplay = '';
                                            if (bet.selection) {
                                                selectionDisplay = `<div style="background: #0f172a; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #3b82f6;">
                                                    <strong style="color: #60a5fa; font-size: 13px; display: block;">${bet.selection}</strong>
                                                    <small style="color: #94a3b8;">Selected Outcome</small>
                                                </div>`;
                                            } else if (bet.booking_code) {
                                                selectionDisplay = `<div style="background: #0f172a; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #fbbf24;">
                                                    <strong style="color: #fbbf24;">Premium Ticket</strong>
                                                </div>`;
                                            } else {
                                                selectionDisplay = `<span style="color: #94a3b8;">Multi/Combo</span>`;
                                            }
                                            
                                            // Determine if bet won or lost based on status and result
                                            let outcomeIndicator = '';
                                            if (bet.status === 'won') {
                                                outcomeIndicator = '<span style="color: #10b981; font-weight: 700; font-size: 14px;"> WON</span>';
                                            } else if (bet.status === 'lost') {
                                                outcomeIndicator = '<span style="color: #ef4444; font-weight: 700; font-size: 14px;"> LOST</span>';
                                            } else if (bet.status === 'voided' || bet.status === 'cancelled') {
                                                outcomeIndicator = '<span style="color: #94a3b8; font-size: 14px;"> VOID</span>';
                                            } else if (bet.status === 'cashed_out') {
                                                outcomeIndicator = '<span style="color: #fbbf24; font-size: 14px;">$ CASHED OUT</span>';
                                            } else {
                                                outcomeIndicator = '<span style="color: #60a5fa; font-size: 14px;"> PENDING</span>';
                                            }
                                            
                                            return `
                                            <tr>
                                                <td><strong>#${bet.id}</strong></td>
                                                <td style="max-width: 250px;">${matchDisplay}${detailsHtml}</td>
                                                <td>${selectionDisplay}</td>
                                                <td><span style="background: #fbbf24; color: #0f172a; padding: 4px 8px; border-radius: 4px; font-weight: 700; font-size: 13px;">${bet.odds.toFixed(2)}x</span></td>
                                                <td><strong style="font-size: 14px;">$${bet.amount.toFixed(2)}</strong></td>
                                                <td><strong style="color: #10b981; font-size: 14px;">$${bet.potential_payout.toFixed(2)}</strong></td>
                                                <td>${outcomeIndicator}</td>
                                                <td><small style="color: #94a3b8;">${new Date(bet.created_at).toLocaleString()}</small></td>
                                                <td>
                                                    ${(bet.status === 'active' || bet.status === 'pending') ? 
                                                        `<button class="btn btn-success btn-sm" onclick="markBetWon(${bet.id}, ${userId}, '${username}')" title="Mark as Won" style="margin: 2px;">
                                                            <i class="fas fa-check"></i> Won
                                                        </button>
                                                        <button class="btn btn-danger btn-sm" onclick="markBetLost(${bet.id}, ${userId}, '${username}')" title="Mark as Lost" style="margin: 2px;">
                                                            <i class="fas fa-times"></i> Lost
                                                        </button>
                                                        <button class="btn btn-warning btn-sm" onclick="voidBet(${bet.id}, ${userId}, '${username}')" title="Void Bet" style="margin: 2px;">
                                                            <i class="fas fa-ban"></i> Void
                                                        </button>` : 
                                                        `<span style="color: #64748b; font-size: 12px;">Settled</span>`}
                                                </td>
                                            </tr>
                                        `}).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to page
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
            } catch (error) {
                console.error('Error in viewUserBets:', error);
                showMessage('Error loading user bets: ' + (error.message || error), 'error');
            }
        }

        async function voidBet(betId, userId, username) {
            const reason = prompt(`Enter reason for voiding bet #${betId}:`, 'Admin void');
            if (!reason) return;
            
            if (!confirm(`Are you sure you want to VOID bet #${betId} for user "${username}"?\n\nThis will:\n- Refund the bet amount\n- Mark the bet as voided\n\nReason: ${reason}`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/bets/${betId}/void`, {
                    method: 'POST',
                    body: JSON.stringify({ reason })
                });
                showMessage(response.message || 'Bet voided successfully', 'success');
                
                // Reload bets for this user
                await viewUserBets(userId, username);
            } catch (error) {
                showMessage('Error voiding bet: ' + error.message, 'error');
            }
        }

        async function markBetWon(betId, userId, username) {
            if (!confirm(`Mark bet #${betId} as WON for user "${username}"?\n\nThis will:\n- Pay out the full potential winnings\n- Update bet status to "won"`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/bets/${betId}/settle`, {
                    method: 'POST',
                    body: JSON.stringify({
                        result: 'win',
                        payout: null  // Use full potential payout
                    })
                });
                showMessage('Bet marked as WON! User has been paid.', 'success');
                
                // Reload bets for this user
                await viewUserBets(userId, username);
            } catch (error) {
                showMessage('Error marking bet as won: ' + error.message, 'error');
            }
        }

        async function markBetLost(betId, userId, username) {
            if (!confirm(`Mark bet #${betId} as LOST for user "${username}"?\n\nThis will:\n- Mark bet as lost\n- No payout will be made`)) {
                return;
            }
            
            try {
                const response = await client.request(`/admin/bets/${betId}/settle`, {
                    method: 'POST',
                    body: JSON.stringify({
                        result: 'loss',
                        payout: 0
                    })
                });
                showMessage('Bet marked as LOST.', 'success');
                
                // Reload bets for this user
                await viewUserBets(userId, username);
            } catch (error) {
                showMessage('Error marking bet as lost: ' + error.message, 'error');
            }
        }

        // ===== PAYMENT INFO =====
        async function viewPaymentInfo(userId, username) {
            try {
                const response = await client.request(`/admin/users/${userId}/payment-info`);
                const info = response.payment_info;
                
                // Set readonly fields
                document.getElementById('paymentUserId').value = info.user_id;
                document.getElementById('paymentUsername').value = info.username;
                document.getElementById('paymentEmail').value = info.email;
                const balanceUsd = info.balance || 0;
                document.getElementById('paymentBalance').value = `$${balanceUsd.toFixed(2)}`;
                
                // Set editable fields
                document.getElementById('withdrawalWallet').value = info.withdrawal_wallet || '';
                document.getElementById('usdtWallet').value = info.usdt_wallet || '';
                document.getElementById('bankAccountName').value = info.bank_account_name || '';
                document.getElementById('bankName').value = info.bank_name || '';
                document.getElementById('bankAccountNumber').value = info.bank_account_number || '';
                document.getElementById('paypalEmail').value = info.paypal_email || '';
                document.getElementById('skrillEmail').value = info.skrill_email || '';
                document.getElementById('paymentNotes').value = info.payment_notes || '';
                
                document.getElementById('paymentInfoModalTitle').textContent = `Payment Info: ${username}`;
                document.getElementById('paymentInfoModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading payment info: ' + error.message, 'error');
            }
        }

        function closePaymentInfoModal() {
            document.getElementById('paymentInfoModal').classList.remove('active');
        }

        document.getElementById('paymentInfoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userId = document.getElementById('paymentUserId').value;
            const username = document.getElementById('paymentUsername').value;
            
            const data = {
                withdrawal_wallet: document.getElementById('withdrawalWallet').value,
                usdt_wallet: document.getElementById('usdtWallet').value,
                bank_account_name: document.getElementById('bankAccountName').value,
                bank_name: document.getElementById('bankName').value,
                bank_account_number: document.getElementById('bankAccountNumber').value,
                paypal_email: document.getElementById('paypalEmail').value,
                skrill_email: document.getElementById('skrillEmail').value,
                payment_notes: document.getElementById('paymentNotes').value
            };
            
            try {
                const response = await client.request(`/admin/users/${userId}/payment-info`, 'PUT', data);
                showMessage(`Payment info updated for ${username}`, 'success');
                closePaymentInfoModal();
            } catch (error) {
                showMessage('Error updating payment info: ' + error.message, 'error');
            }
        });

        // ===== PLATFORM PAYMENT METHODS =====
        async function loadPaymentMethods() {
            try {
                const response = await client.request('/admin/payment-methods?include_inactive=true');
                const tbody = document.getElementById('paymentMethodsTable');
                
                if (!response.payment_methods || response.payment_methods.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-credit-card"></i>
                                <h3>No payment methods configured</h3>
                                <p>Add payment methods for users to deposit funds</p>
                            </td>
                        </tr>`;
                    return;
                }

                tbody.innerHTML = response.payment_methods.map(method => {
                    let details = '';
                    if (method.usdt_wallet_address) {
                        details = `${method.usdt_wallet_address.substring(0, 15)}... (${method.usdt_network || 'Network not set'})`;
                    } else if (method.wallet_address) {
                        details = `${method.wallet_address.substring(0, 15)}...`;
                    } else if (method.account_number) {
                        details = `${method.bank_name} - ${method.account_number}`;
                    } else if (method.email) {
                        details = method.email;
                    } else if (method.phone) {
                        details = method.phone;
                    } else {
                        details = 'See details';
                    }
                    
                    return `
                        <tr>
                            <td>${method.id}</td>
                            <td><span style="text-transform: capitalize;">${method.method_type.replace('_', ' ')}</span></td>
                            <td><strong>${method.method_name}</strong></td>
                            <td>${details}</td>
                            <td>
                                ${method.is_active ? 
                                    '<span class="badge badge-completed">Active</span>' : 
                                    '<span class="badge badge-pending">Inactive</span>'}
                            </td>
                            <td>${new Date(method.updated_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-primary" onclick="editPaymentMethod(${method.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn ${method.is_active ? 'btn-warning' : 'btn-success'}" 
                                        onclick="togglePaymentMethod(${method.id}, '${method.method_name}', ${method.is_active})" 
                                        title="${method.is_active ? 'Deactivate' : 'Activate'}">
                                    <i class="fas fa-${method.is_active ? 'eye-slash' : 'eye'}"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deletePaymentMethod(${method.id}, '${method.method_name}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                showMessage('Error loading payment methods: ' + error.message, 'error');
            }
        }

        function openPaymentMethodModal(methodId = null) {
            if (methodId) {
                // Edit mode - load existing method
                editPaymentMethod(methodId);
            } else {
                // Create mode
                document.getElementById('paymentMethodModalTitle').textContent = 'Add Payment Method';
                document.getElementById('paymentMethodForm').reset();
                document.getElementById('paymentMethodId').value = '';
                document.getElementById('isActive').checked = true;
                updateMethodFields();
                document.getElementById('paymentMethodModal').classList.add('active');
            }
        }

        function closePaymentMethodModal() {
            document.getElementById('paymentMethodModal').classList.remove('active');
        }

        function updateMethodFields() {
            const methodType = document.getElementById('methodType').value;
            
            // Hide all conditional fields
            document.getElementById('usdtFields').style.display = 'none';
            document.getElementById('cryptoFields').style.display = 'none';
            document.getElementById('bankFields').style.display = 'none';
            document.getElementById('emailFields').style.display = 'none';
            document.getElementById('mobileFields').style.display = 'none';
            
            // Show relevant fields based on method type
            if (methodType === 'usdt') {
                document.getElementById('usdtFields').style.display = 'block';
            } else if (methodType === 'bitcoin' || methodType === 'crypto') {
                document.getElementById('cryptoFields').style.display = 'block';
            } else if (methodType === 'bank_transfer') {
                document.getElementById('bankFields').style.display = 'block';
            } else if (methodType === 'paypal' || methodType === 'skrill') {
                document.getElementById('emailFields').style.display = 'block';
            } else if (methodType === 'mobile_money') {
                document.getElementById('mobileFields').style.display = 'block';
            }
        }

        async function editPaymentMethod(methodId) {
            try {
                const response = await client.request(`/admin/payment-methods/${methodId}`);
                const method = response.payment_method;
                
                document.getElementById('paymentMethodModalTitle').textContent = 'Edit Payment Method';
                document.getElementById('paymentMethodId').value = method.id;
                document.getElementById('methodType').value = method.method_type;
                document.getElementById('methodName').value = method.method_name;
                document.getElementById('isActive').checked = method.is_active;
                
                // USDT fields
                document.getElementById('usdtWalletAddress').value = method.usdt_wallet_address || '';
                document.getElementById('usdtNetwork').value = method.usdt_network || '';
                
                // Crypto fields
                document.getElementById('walletAddress').value = method.wallet_address || '';
                
                // Bank fields
                document.getElementById('methodAccountName').value = method.account_name || '';
                document.getElementById('methodAccountNumber').value = method.account_number || '';
                document.getElementById('methodBankName').value = method.bank_name || '';
                document.getElementById('methodSwiftCode').value = method.swift_code || '';
                
                // Email and phone
                document.getElementById('methodEmail').value = method.email || '';
                document.getElementById('methodPhone').value = method.phone || '';
                
                // Common fields
                document.getElementById('methodQRCode').value = method.qr_code || '';
                document.getElementById('methodInstructions').value = method.instructions || '';
                
                updateMethodFields();
                document.getElementById('paymentMethodModal').classList.add('active');
            } catch (error) {
                showMessage('Error loading payment method: ' + error.message, 'error');
            }
        }

        document.getElementById('paymentMethodForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const methodId = document.getElementById('paymentMethodId').value;
            const isEdit = methodId !== '';
            
            const data = {
                method_type: document.getElementById('methodType').value,
                method_name: document.getElementById('methodName').value,
                is_active: document.getElementById('isActive').checked,
                usdt_wallet_address: document.getElementById('usdtWalletAddress').value || null,
                usdt_network: document.getElementById('usdtNetwork').value || null,
                wallet_address: document.getElementById('walletAddress').value || null,
                account_name: document.getElementById('methodAccountName').value || null,
                account_number: document.getElementById('methodAccountNumber').value || null,
                bank_name: document.getElementById('methodBankName').value || null,
                swift_code: document.getElementById('methodSwiftCode').value || null,
                email: document.getElementById('methodEmail').value || null,
                phone: document.getElementById('methodPhone').value || null,
                qr_code: document.getElementById('methodQRCode').value || null,
                instructions: document.getElementById('methodInstructions').value || null
            };
            
            try {
                let response;
                if (isEdit) {
                    response = await client.request(`/admin/payment-methods/${methodId}`, 'PUT', data);
                    showMessage('Payment method updated successfully', 'success');
                } else {
                    response = await client.request('/admin/payment-methods', 'POST', data);
                    showMessage('Payment method created successfully', 'success');
                }
                
                closePaymentMethodModal();
                loadPaymentMethods();
            } catch (error) {
                showMessage('Error saving payment method: ' + error.message, 'error');
            }
        });

        async function togglePaymentMethod(methodId, methodName, currentStatus) {
            const action = currentStatus ? 'deactivate' : 'activate';
            if (!confirm(`Are you sure you want to ${action} "${methodName}"?`)) {
                return;
            }
            
            try {
                await client.request(`/admin/payment-methods/${methodId}/toggle`, 'POST');
                showMessage(`Payment method ${action}d successfully`, 'success');
                loadPaymentMethods();
            } catch (error) {
                showMessage('Error toggling payment method: ' + error.message, 'error');
            }
        }

        async function deletePaymentMethod(methodId, methodName) {
            if (!confirm(`Are you sure you want to DELETE "${methodName}"?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            try {
                await client.request(`/admin/payment-methods/${methodId}`, 'DELETE');
                showMessage(`Payment method "${methodName}" deleted successfully`, 'success');
                loadPaymentMethods();
            } catch (error) {
                showMessage('Error deleting payment method: ' + error.message, 'error');
            }
        }

        // Update Live Matches
        async function updateLiveMatches() {
            const button = event.target.closest('button');
            const originalHTML = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            
            try {
                const response = await client.request('/admin/update-live-matches', 'POST');
                
                button.disabled = false;
                button.innerHTML = originalHTML;
                
                if (response.success) {
                    showMessage(` ${response.message}`, 'success');
                    // Optionally reload recent activity to show update
                    await loadRecentActivity();
                } else {
                    showMessage(` Error: ${response.message}`, 'error');
                }
            } catch (error) {
                button.disabled = false;
                button.innerHTML = originalHTML;
                showMessage(` Error updating live matches: ${error.message}`, 'error');
            }
        }

        // Virtual Games Functions
        async function loadVirtualGames() {
            try {
                const leaguesRes = await fetch('/api/virtual/leagues', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}` }
                });
                const leaguesData = await leaguesRes.json();
                
                const gamesRes = await fetch('/api/virtual/admin/games', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}` }
                });
                const gamesData = await gamesRes.json();
                
                document.getElementById('virtualLeaguesCount').textContent = leaguesData.leagues?.length || 0;
                document.getElementById('virtualTeamsCount').textContent = 
                    leaguesData.leagues?.reduce((sum, l) => sum + (l.teams_count || 0), 0) || 0;
                document.getElementById('virtualGamesCount').textContent = gamesData.games?.length || 0;
                document.getElementById('virtualActiveGamesCount').textContent = 
                    gamesData.games?.filter(g => g.status === 'scheduled' || g.status === 'in_progress').length || 0;
                
                if (leaguesData.success && leaguesData.leagues.length > 0) {
                    // Load race info for each league
                    const leaguesWithRaceInfo = await Promise.all(leaguesData.leagues.map(async (league) => {
                        try {
                            const raceResponse = await fetch(`/api/virtual/admin/leagues/${league.id}/race-info`, {
                                headers: {'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`}
                            });
                            const raceData = await raceResponse.json();
                            return {...league, raceInfo: raceData.success ? raceData : null};
                        } catch (e) {
                            return {...league, raceInfo: null};
                        }
                    }));
                    
                    document.getElementById('virtualLeaguesTable').innerHTML = leaguesWithRaceInfo.map(league => {
                        const raceInfo = league.raceInfo;
                        const seasonDisplay = raceInfo ? `S${raceInfo.current_season} MD${raceInfo.current_matchday}` : 'N/A';
                        const gamesDisplay = raceInfo ? `${raceInfo.scheduled}/${raceInfo.live}/${raceInfo.finished}` : `${league.games_count || 0}/0/0`;
                        
                        return `
                        <tr>
                            <td>${league.id}</td>
                            <td><strong>${league.name}</strong></td>
                            <td>${league.teams_count || 0} teams</td>
                            <td><span style="font-weight: 600; color: #3b82f6;">${seasonDisplay}</span></td>
                            <td><small style="color: #64748b;">S:</small> <span style="color: #3b82f6;">${raceInfo?.scheduled || 0}</span> <small style="color: #64748b;">L:</small> <span style="color: #10b981;">${raceInfo?.live || 0}</span> <small style="color: #64748b;">F:</small> <span style="color: #64748b;">${raceInfo?.finished || 0}</span></td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td style="white-space: nowrap;">
                                <button class="btn btn-sm btn-primary" onclick="generateGamesForLeague(${league.id})" title="Generate 10 matches for next race">
                                    <i class="fas fa-plus"></i> Race
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="clearLeagueGames(${league.id})" title="Clear all games from this league">
                                    <i class="fas fa-eraser"></i> Clear
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="resetLeague(${league.id})" title="Reset league to season 1">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </td>
                        </tr>
                    `;
                    }).join('');
                } else {
                    document.getElementById('virtualLeaguesTable').innerHTML = `
                        <tr><td colspan="7" class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <h3>No leagues found</h3>
                            <p>Click "Quick Setup" to create 3 leagues with 20 teams each</p>
                        </td></tr>
                    `;
                }
                
                if (gamesData.success && gamesData.games.length > 0) {
                    document.getElementById('virtualGamesTable').innerHTML = gamesData.games.map(game => {
                        const statusColors = {
                            'scheduled': 'info',
                            'in_progress': 'warning',
                            'finished': 'success'
                        };
                        const statusBadge = `<span class="badge badge-${statusColors[game.status] || 'secondary'}">${game.status}</span>`;
                        
                        return `
                            <tr>
                                <td>${game.id}</td>
                                <td><strong>${game.home_team} vs ${game.away_team}</strong></td>
                                <td>${game.league_name}</td>
                                <td>${new Date(game.scheduled_time).toLocaleString()}</td>
                                <td>${statusBadge}</td>
                                <td>${game.home_score !== null ? `${game.home_score} - ${game.away_score}` : '-'}</td>
                                <td>
                                    ${game.status === 'scheduled' ? `
                                        <button class="btn btn-sm btn-success" onclick="startVirtualGame(${game.id})">
                                            <i class="fas fa-play"></i> Start
                                        </button>
                                    ` : ''}
                                    ${game.status === 'in_progress' ? `
                                        <button class="btn btn-sm btn-warning" onclick="finishVirtualGame(${game.id})">
                                            <i class="fas fa-flag-checkered"></i> Finish
                                        </button>
                                    ` : ''}
                                </td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    document.getElementById('virtualGamesTable').innerHTML = `
                        <tr><td colspan="7" class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <h3>No games scheduled</h3>
                            <p>Generate games for a league to get started</p>
                        </td></tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading virtual games:', error);
                showMessage('Error loading virtual games: ' + error.message, 'error');
            }
        }

        async function runQuickSetup() {
            if (!confirm('This will create 3 leagues with 20 teams each and generate 10 matches per league (30 total). Continue?')) {
                return;
            }
            
            console.log('[Admin] Running Quick Setup...');
            showMessage(' Setting up leagues...', 'info');
            
            try {
                const token = localStorage.getItem('abkbet_token');
                console.log('[Admin] Token present:', !!token);
                
                const res = await fetch('/api/virtual/admin/quick-setup', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                console.log('[Admin] Quick Setup response status:', res.status);
                const data = await res.json();
                console.log('[Admin] Quick Setup response data:', data);
                
                if (res.ok && data.success) {
                    showMessage(` Quick Setup Complete! Created ${data.leagues_created} leagues, ${data.teams_created} teams, ${data.games_created} games`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Quick Setup failed: ' + (data.message || data.error || 'Unknown error'), 'error');
                    console.error('[Admin] Quick Setup error:', data);
                }
            } catch (error) {
                console.error('[Admin] Error running quick setup:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function deleteAllLeagues() {
            if (!confirm(' DELETE EVERYTHING?\n\nThis will permanently delete:\n All leagues\n All teams\n All games\n\nThis CANNOT be undone!\n\nClick OK to proceed.')) {
                return;
            }
            
            console.log('[Admin] Deleting all leagues...');
            showMessage(' Deleting everything...', 'info');
            
            try {
                const token = localStorage.getItem('abkbet_token');
                console.log('[Admin] Token present:', !!token);
                
                const res = await fetch('/api/virtual/admin/delete-all-leagues', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('[Admin] Delete response status:', res.status);
                const data = await res.json();
                console.log('[Admin] Delete response data:', data);
                
                if (res.ok && data.success) {
                    showMessage(` ${data.message}`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                    console.error('[Admin] Delete error:', data);
                }
            } catch (error) {
                console.error('[Admin] Error deleting leagues:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function resetAllLeaguesToMD1() {
            if (!confirm(' Reset All Leagues to Matchday 1?\n\nThis will:\n Delete all game history (finished & scheduled)\n Reset standings to 0 for all teams\n Return all leagues to Matchday 1\n\nLeagues and teams will remain.\n\nClick OK to proceed.')) {
                return;
            }
            
            // Second confirmation for safety
            if (!confirm(' Are you absolutely sure?\n\nAll match history and standings will be lost!')) {
                return;
            }
            
            console.log('[Admin] Resetting all leagues to MD1...');
            showMessage(' Resetting to Matchday 1...', 'info');
            
            try {
                const token = localStorage.getItem('abkbet_token');
                console.log('[Admin] Token present:', !!token);
                
                const res = await fetch('/api/virtual/admin/reset-all-leagues', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('[Admin] Reset response status:', res.status);
                const data = await res.json();
                console.log('[Admin] Reset response data:', data);
                
                if (res.ok && data.success) {
                    showMessage(` ${data.message}`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                    console.error('[Admin] Reset error:', data);
                }
            } catch (error) {
                console.error('[Admin] Error resetting leagues:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function startVirtualGame(gameId) {
            try {
                const res = await fetch(`/api/virtual/admin/games/${gameId}/start`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage('Game started!', 'success');
                    loadVirtualGames();
                } else {
                    showMessage('Error starting game: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error starting game:', error);
                showMessage('Error starting game: ' + error.message, 'error');
            }
        }

        async function finishVirtualGame(gameId) {
            try {
                const res = await fetch(`/api/virtual/admin/games/${gameId}/finish`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(`Game finished! Score: ${data.game.home_score} - ${data.game.away_score}`, 'success');
                    loadVirtualGames();
                } else {
                    showMessage('Error finishing game: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error finishing game:', error);
                showMessage('Error finishing game: ' + error.message, 'error');
            }
        }

        async function generateGamesForLeague(leagueId) {
            if (!confirm('Generate 10 matches for next race?')) {
                return;
            }
            
            try {
                const res = await fetch(`/api/virtual/admin/leagues/${leagueId}/generate-games`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ num_games: 10 })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(` Generated ${data.games?.length || 10} new matches!`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error generating games:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function clearLeagueGames(leagueId) {
            if (!confirm('Clear all games from this league? This cannot be undone!')) {
                return;
            }
            
            try {
                const res = await fetch(`/api/virtual/admin/leagues/${leagueId}/clear-games`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(` Cleared ${data.games_deleted} games!`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error clearing games:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function resetLeague(leagueId) {
            if (!confirm('Reset this league to Season 1? All game history will be deleted!')) {
                return;
            }
            
            try {
                const res = await fetch(`/api/virtual/admin/leagues/${leagueId}/reset`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(` League reset! Deleted ${data.games_deleted} games.`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error resetting league:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        async function clearAllVirtualGames() {
            if (!confirm(' WARNING: Clear ALL virtual games from ALL leagues?\n\nThis will delete EVERYTHING and cannot be undone!')) {
                return;
            }
            
            try {
                const res = await fetch(`/api/virtual/admin/clear-all-games`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('abkbet_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(` Cleared ${data.games_deleted} games from all leagues!`, 'success');
                    await loadVirtualGames();
                } else {
                    showMessage(' Error: ' + (data.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error clearing all games:', error);
                showMessage(' Error: ' + error.message, 'error');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('abkbet_token');
            localStorage.removeItem('abkbet_user');
            window.location.href = '/secure-admin-access-2024';
        }

        // Init
        loadDashboard();
    </script>
</body>
</html>
